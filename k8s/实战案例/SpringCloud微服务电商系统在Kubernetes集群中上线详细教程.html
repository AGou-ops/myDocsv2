<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringCloud微服务电商系统在Kubernetes集群中上线详细教程 | AGou&#39;s Docs-v2</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="https://infinitypro-img.infinitynewtab.com/custom-icon/8001de1jd3n68lbfnxxt564xvb0vl5.png?imageMogr2/thumbnail/240x/format/webp/blur/1x0/quality/100|imageslim">
    <script language="javascript" type="text/javascript" src="https://cdn.staticfile.org/jquery/1.7.2/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-2DZCW6NJZF"></script>
    <script language="javascript" type="text/javascript" content="function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag(&quot;js&quot;,new Date),gtag(&quot;config&quot;,&quot;G-2DZCW6NJZF&quot;);"></script>
    <meta name="description" content="岂能尽如人意，但求无愧我心。">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/myDocsv2/assets/css/0.styles.21bb8301.css" as="style"><link rel="preload" href="/myDocsv2/assets/js/app.792c833e.js" as="script"><link rel="preload" href="/myDocsv2/assets/js/5.dd197eb6.js" as="script"><link rel="preload" href="/myDocsv2/assets/js/1.3bd7010a.js" as="script"><link rel="preload" href="/myDocsv2/assets/js/2.0c757b52.js" as="script"><link rel="preload" href="/myDocsv2/assets/js/78.82d49b8f.js" as="script"><link rel="preload" href="/myDocsv2/assets/js/17.ce9a229a.js" as="script"><link rel="prefetch" href="/myDocsv2/assets/js/10.560f0585.js"><link rel="prefetch" href="/myDocsv2/assets/js/100.d260e792.js"><link rel="prefetch" href="/myDocsv2/assets/js/101.59a52c3b.js"><link rel="prefetch" href="/myDocsv2/assets/js/102.c83fe080.js"><link rel="prefetch" href="/myDocsv2/assets/js/103.486f1569.js"><link rel="prefetch" href="/myDocsv2/assets/js/104.147ef422.js"><link rel="prefetch" href="/myDocsv2/assets/js/105.7cdddb7f.js"><link rel="prefetch" href="/myDocsv2/assets/js/106.6bb6504a.js"><link rel="prefetch" href="/myDocsv2/assets/js/107.958c4a2e.js"><link rel="prefetch" href="/myDocsv2/assets/js/108.89dea5fa.js"><link rel="prefetch" href="/myDocsv2/assets/js/109.25e918a2.js"><link rel="prefetch" href="/myDocsv2/assets/js/11.30085370.js"><link rel="prefetch" href="/myDocsv2/assets/js/110.5b72de31.js"><link rel="prefetch" href="/myDocsv2/assets/js/111.950db23b.js"><link rel="prefetch" href="/myDocsv2/assets/js/112.dea68ec6.js"><link rel="prefetch" href="/myDocsv2/assets/js/113.4cd2fdf5.js"><link rel="prefetch" href="/myDocsv2/assets/js/114.8fb68b8d.js"><link rel="prefetch" href="/myDocsv2/assets/js/115.853e9eac.js"><link rel="prefetch" href="/myDocsv2/assets/js/116.370ed12f.js"><link rel="prefetch" href="/myDocsv2/assets/js/117.e54ab1d2.js"><link rel="prefetch" href="/myDocsv2/assets/js/118.f875192d.js"><link rel="prefetch" href="/myDocsv2/assets/js/119.130ba6df.js"><link rel="prefetch" href="/myDocsv2/assets/js/12.bad43817.js"><link rel="prefetch" href="/myDocsv2/assets/js/120.ea722a75.js"><link rel="prefetch" href="/myDocsv2/assets/js/121.e6b1a38f.js"><link rel="prefetch" href="/myDocsv2/assets/js/122.cfa9c92b.js"><link rel="prefetch" href="/myDocsv2/assets/js/123.bd0e517c.js"><link rel="prefetch" href="/myDocsv2/assets/js/124.516b8976.js"><link rel="prefetch" href="/myDocsv2/assets/js/125.aa9491a0.js"><link rel="prefetch" href="/myDocsv2/assets/js/126.249ad6f3.js"><link rel="prefetch" href="/myDocsv2/assets/js/127.15e07998.js"><link rel="prefetch" href="/myDocsv2/assets/js/128.6e4e1f1d.js"><link rel="prefetch" href="/myDocsv2/assets/js/129.9fa7ef9d.js"><link rel="prefetch" href="/myDocsv2/assets/js/13.4f93795a.js"><link rel="prefetch" href="/myDocsv2/assets/js/130.7ed7958f.js"><link rel="prefetch" href="/myDocsv2/assets/js/131.6a4ed50f.js"><link rel="prefetch" href="/myDocsv2/assets/js/132.60d2ac03.js"><link rel="prefetch" href="/myDocsv2/assets/js/133.657186df.js"><link rel="prefetch" href="/myDocsv2/assets/js/134.de4a0998.js"><link rel="prefetch" href="/myDocsv2/assets/js/135.773bff70.js"><link rel="prefetch" href="/myDocsv2/assets/js/136.03b7adc5.js"><link rel="prefetch" href="/myDocsv2/assets/js/137.e59abdb8.js"><link rel="prefetch" href="/myDocsv2/assets/js/138.b00ee386.js"><link rel="prefetch" href="/myDocsv2/assets/js/139.11d16ca5.js"><link rel="prefetch" href="/myDocsv2/assets/js/14.5b43ffdb.js"><link rel="prefetch" href="/myDocsv2/assets/js/140.d2461af0.js"><link rel="prefetch" href="/myDocsv2/assets/js/141.51a02429.js"><link rel="prefetch" href="/myDocsv2/assets/js/142.de00d6b2.js"><link rel="prefetch" href="/myDocsv2/assets/js/143.2e00599f.js"><link rel="prefetch" href="/myDocsv2/assets/js/144.d91b742b.js"><link rel="prefetch" href="/myDocsv2/assets/js/145.fd4eeb59.js"><link rel="prefetch" href="/myDocsv2/assets/js/146.2da768b9.js"><link rel="prefetch" href="/myDocsv2/assets/js/147.2392d1bd.js"><link rel="prefetch" href="/myDocsv2/assets/js/148.3f9f1e85.js"><link rel="prefetch" href="/myDocsv2/assets/js/149.ccc77b35.js"><link rel="prefetch" href="/myDocsv2/assets/js/15.567b35e8.js"><link rel="prefetch" href="/myDocsv2/assets/js/150.bc27fad5.js"><link rel="prefetch" href="/myDocsv2/assets/js/151.8d88bccd.js"><link rel="prefetch" href="/myDocsv2/assets/js/152.2f8b753c.js"><link rel="prefetch" href="/myDocsv2/assets/js/153.3e99f777.js"><link rel="prefetch" href="/myDocsv2/assets/js/154.28a03309.js"><link rel="prefetch" href="/myDocsv2/assets/js/155.d31e6da9.js"><link rel="prefetch" href="/myDocsv2/assets/js/156.dbbb018d.js"><link rel="prefetch" href="/myDocsv2/assets/js/157.dacf2c34.js"><link rel="prefetch" href="/myDocsv2/assets/js/158.92d5a5c7.js"><link rel="prefetch" href="/myDocsv2/assets/js/159.163e1ce5.js"><link rel="prefetch" href="/myDocsv2/assets/js/16.246dc068.js"><link rel="prefetch" href="/myDocsv2/assets/js/160.f6373d44.js"><link rel="prefetch" href="/myDocsv2/assets/js/161.1ee05cbb.js"><link rel="prefetch" href="/myDocsv2/assets/js/162.90d44205.js"><link rel="prefetch" href="/myDocsv2/assets/js/163.0ab9f4cc.js"><link rel="prefetch" href="/myDocsv2/assets/js/164.e7b76b81.js"><link rel="prefetch" href="/myDocsv2/assets/js/165.f4e96a57.js"><link rel="prefetch" href="/myDocsv2/assets/js/166.9da04171.js"><link rel="prefetch" href="/myDocsv2/assets/js/167.7869b189.js"><link rel="prefetch" href="/myDocsv2/assets/js/168.fd171306.js"><link rel="prefetch" href="/myDocsv2/assets/js/169.a3accba0.js"><link rel="prefetch" href="/myDocsv2/assets/js/170.69b8ea3d.js"><link rel="prefetch" href="/myDocsv2/assets/js/171.8519d41a.js"><link rel="prefetch" href="/myDocsv2/assets/js/172.853e162a.js"><link rel="prefetch" href="/myDocsv2/assets/js/173.61f68a82.js"><link rel="prefetch" href="/myDocsv2/assets/js/174.4a6c4ebe.js"><link rel="prefetch" href="/myDocsv2/assets/js/175.4da076f8.js"><link rel="prefetch" href="/myDocsv2/assets/js/176.db59955f.js"><link rel="prefetch" href="/myDocsv2/assets/js/177.8e8a7c16.js"><link rel="prefetch" href="/myDocsv2/assets/js/178.c253fb27.js"><link rel="prefetch" href="/myDocsv2/assets/js/179.5662c8f8.js"><link rel="prefetch" href="/myDocsv2/assets/js/18.42c2a799.js"><link rel="prefetch" href="/myDocsv2/assets/js/180.54165af7.js"><link rel="prefetch" href="/myDocsv2/assets/js/181.e07c952b.js"><link rel="prefetch" href="/myDocsv2/assets/js/182.53626bff.js"><link rel="prefetch" href="/myDocsv2/assets/js/183.b92c4e7a.js"><link rel="prefetch" href="/myDocsv2/assets/js/184.640e2011.js"><link rel="prefetch" href="/myDocsv2/assets/js/185.82c83e0f.js"><link rel="prefetch" href="/myDocsv2/assets/js/186.0e7a9c8a.js"><link rel="prefetch" href="/myDocsv2/assets/js/187.b1279218.js"><link rel="prefetch" href="/myDocsv2/assets/js/188.919e8202.js"><link rel="prefetch" href="/myDocsv2/assets/js/189.12ca6319.js"><link rel="prefetch" href="/myDocsv2/assets/js/19.80fbdf4d.js"><link rel="prefetch" href="/myDocsv2/assets/js/190.0cabf0ec.js"><link rel="prefetch" href="/myDocsv2/assets/js/191.4473c05d.js"><link rel="prefetch" href="/myDocsv2/assets/js/192.cfd1676f.js"><link rel="prefetch" href="/myDocsv2/assets/js/193.be924226.js"><link rel="prefetch" href="/myDocsv2/assets/js/194.28405918.js"><link rel="prefetch" href="/myDocsv2/assets/js/195.895d8931.js"><link rel="prefetch" href="/myDocsv2/assets/js/196.a5074835.js"><link rel="prefetch" href="/myDocsv2/assets/js/197.5ac7add8.js"><link rel="prefetch" href="/myDocsv2/assets/js/198.1243e120.js"><link rel="prefetch" href="/myDocsv2/assets/js/199.1dedd774.js"><link rel="prefetch" href="/myDocsv2/assets/js/20.03b1f0ff.js"><link rel="prefetch" href="/myDocsv2/assets/js/200.47677147.js"><link rel="prefetch" href="/myDocsv2/assets/js/201.ae7c32ad.js"><link rel="prefetch" href="/myDocsv2/assets/js/202.b9ab3aba.js"><link rel="prefetch" href="/myDocsv2/assets/js/203.5716a175.js"><link rel="prefetch" href="/myDocsv2/assets/js/204.0dff0870.js"><link rel="prefetch" href="/myDocsv2/assets/js/205.5722c8b0.js"><link rel="prefetch" href="/myDocsv2/assets/js/206.94ecd56d.js"><link rel="prefetch" href="/myDocsv2/assets/js/207.fbef39ad.js"><link rel="prefetch" href="/myDocsv2/assets/js/208.f033c96a.js"><link rel="prefetch" href="/myDocsv2/assets/js/209.b022ee5b.js"><link rel="prefetch" href="/myDocsv2/assets/js/21.2048f6fd.js"><link rel="prefetch" href="/myDocsv2/assets/js/210.c8278e5f.js"><link rel="prefetch" href="/myDocsv2/assets/js/211.df648ec4.js"><link rel="prefetch" href="/myDocsv2/assets/js/212.c591597e.js"><link rel="prefetch" href="/myDocsv2/assets/js/213.59dd0072.js"><link rel="prefetch" href="/myDocsv2/assets/js/214.4250b8d5.js"><link rel="prefetch" href="/myDocsv2/assets/js/215.06bf9012.js"><link rel="prefetch" href="/myDocsv2/assets/js/216.f9f569dc.js"><link rel="prefetch" href="/myDocsv2/assets/js/217.0d90efa0.js"><link rel="prefetch" href="/myDocsv2/assets/js/218.941f9041.js"><link rel="prefetch" href="/myDocsv2/assets/js/219.087abc3e.js"><link rel="prefetch" href="/myDocsv2/assets/js/22.1468e026.js"><link rel="prefetch" href="/myDocsv2/assets/js/220.4519068e.js"><link rel="prefetch" href="/myDocsv2/assets/js/221.020f293f.js"><link rel="prefetch" href="/myDocsv2/assets/js/222.0eabad26.js"><link rel="prefetch" href="/myDocsv2/assets/js/223.ad574537.js"><link rel="prefetch" href="/myDocsv2/assets/js/224.ae6d0b7a.js"><link rel="prefetch" href="/myDocsv2/assets/js/225.8a723b88.js"><link rel="prefetch" href="/myDocsv2/assets/js/226.7285c5f4.js"><link rel="prefetch" href="/myDocsv2/assets/js/227.a14fc969.js"><link rel="prefetch" href="/myDocsv2/assets/js/228.66daebef.js"><link rel="prefetch" href="/myDocsv2/assets/js/229.6403de74.js"><link rel="prefetch" href="/myDocsv2/assets/js/23.e667901e.js"><link rel="prefetch" href="/myDocsv2/assets/js/230.03323ece.js"><link rel="prefetch" href="/myDocsv2/assets/js/231.f3295fcb.js"><link rel="prefetch" href="/myDocsv2/assets/js/232.9c83055f.js"><link rel="prefetch" href="/myDocsv2/assets/js/233.169da2a3.js"><link rel="prefetch" href="/myDocsv2/assets/js/234.2c098527.js"><link rel="prefetch" href="/myDocsv2/assets/js/235.62700dfa.js"><link rel="prefetch" href="/myDocsv2/assets/js/236.f682323d.js"><link rel="prefetch" href="/myDocsv2/assets/js/237.60773b74.js"><link rel="prefetch" href="/myDocsv2/assets/js/238.fb376db3.js"><link rel="prefetch" href="/myDocsv2/assets/js/239.21fe9787.js"><link rel="prefetch" href="/myDocsv2/assets/js/24.18db0e43.js"><link rel="prefetch" href="/myDocsv2/assets/js/240.412b1fd5.js"><link rel="prefetch" href="/myDocsv2/assets/js/241.eb5e205b.js"><link rel="prefetch" href="/myDocsv2/assets/js/242.1b505ffe.js"><link rel="prefetch" href="/myDocsv2/assets/js/243.07e81cfd.js"><link rel="prefetch" href="/myDocsv2/assets/js/244.82c529d0.js"><link rel="prefetch" href="/myDocsv2/assets/js/245.c3458778.js"><link rel="prefetch" href="/myDocsv2/assets/js/246.66e98887.js"><link rel="prefetch" href="/myDocsv2/assets/js/247.1a0993dd.js"><link rel="prefetch" href="/myDocsv2/assets/js/248.a63069b1.js"><link rel="prefetch" href="/myDocsv2/assets/js/249.dd372d75.js"><link rel="prefetch" href="/myDocsv2/assets/js/25.285160e4.js"><link rel="prefetch" href="/myDocsv2/assets/js/250.eb634570.js"><link rel="prefetch" href="/myDocsv2/assets/js/251.f04a5705.js"><link rel="prefetch" href="/myDocsv2/assets/js/252.6ad19080.js"><link rel="prefetch" href="/myDocsv2/assets/js/253.dd154571.js"><link rel="prefetch" href="/myDocsv2/assets/js/254.230b3e5e.js"><link rel="prefetch" href="/myDocsv2/assets/js/255.d40d9e7e.js"><link rel="prefetch" href="/myDocsv2/assets/js/256.28281885.js"><link rel="prefetch" href="/myDocsv2/assets/js/257.6298bda8.js"><link rel="prefetch" href="/myDocsv2/assets/js/258.2fefa56c.js"><link rel="prefetch" href="/myDocsv2/assets/js/259.cb5aea63.js"><link rel="prefetch" href="/myDocsv2/assets/js/26.fae61a7f.js"><link rel="prefetch" href="/myDocsv2/assets/js/260.b29da0f4.js"><link rel="prefetch" href="/myDocsv2/assets/js/261.3db0aa59.js"><link rel="prefetch" href="/myDocsv2/assets/js/262.0b3015b0.js"><link rel="prefetch" href="/myDocsv2/assets/js/263.7577edc3.js"><link rel="prefetch" href="/myDocsv2/assets/js/264.5ff38add.js"><link rel="prefetch" href="/myDocsv2/assets/js/265.e339901e.js"><link rel="prefetch" href="/myDocsv2/assets/js/266.a2027a85.js"><link rel="prefetch" href="/myDocsv2/assets/js/267.08188cb1.js"><link rel="prefetch" href="/myDocsv2/assets/js/268.d30558f8.js"><link rel="prefetch" href="/myDocsv2/assets/js/269.aa62020a.js"><link rel="prefetch" href="/myDocsv2/assets/js/27.b1a4cdea.js"><link rel="prefetch" href="/myDocsv2/assets/js/270.56fe4e52.js"><link rel="prefetch" href="/myDocsv2/assets/js/271.4dbe5ca9.js"><link rel="prefetch" href="/myDocsv2/assets/js/272.ebb4279a.js"><link rel="prefetch" href="/myDocsv2/assets/js/273.82120a56.js"><link rel="prefetch" href="/myDocsv2/assets/js/274.409c4f82.js"><link rel="prefetch" href="/myDocsv2/assets/js/275.b1030128.js"><link rel="prefetch" href="/myDocsv2/assets/js/276.e35f1ba0.js"><link rel="prefetch" href="/myDocsv2/assets/js/277.78b42eab.js"><link rel="prefetch" href="/myDocsv2/assets/js/278.1d224e38.js"><link rel="prefetch" href="/myDocsv2/assets/js/279.5c7dd3ae.js"><link rel="prefetch" href="/myDocsv2/assets/js/28.e9c369f8.js"><link rel="prefetch" href="/myDocsv2/assets/js/280.07aa017e.js"><link rel="prefetch" href="/myDocsv2/assets/js/281.dcb43aec.js"><link rel="prefetch" href="/myDocsv2/assets/js/282.22bc522a.js"><link rel="prefetch" href="/myDocsv2/assets/js/283.c8474c90.js"><link rel="prefetch" href="/myDocsv2/assets/js/284.581fa5ab.js"><link rel="prefetch" href="/myDocsv2/assets/js/285.208c4406.js"><link rel="prefetch" href="/myDocsv2/assets/js/286.5e6c6df0.js"><link rel="prefetch" href="/myDocsv2/assets/js/287.acef2acc.js"><link rel="prefetch" href="/myDocsv2/assets/js/288.ae3f5d32.js"><link rel="prefetch" href="/myDocsv2/assets/js/289.039c32e1.js"><link rel="prefetch" href="/myDocsv2/assets/js/29.a3644474.js"><link rel="prefetch" href="/myDocsv2/assets/js/290.80dfce69.js"><link rel="prefetch" href="/myDocsv2/assets/js/291.9396076f.js"><link rel="prefetch" href="/myDocsv2/assets/js/292.aafda658.js"><link rel="prefetch" href="/myDocsv2/assets/js/293.9d432ff9.js"><link rel="prefetch" href="/myDocsv2/assets/js/294.9bd1328b.js"><link rel="prefetch" href="/myDocsv2/assets/js/295.272f5c7a.js"><link rel="prefetch" href="/myDocsv2/assets/js/296.0cc8fe44.js"><link rel="prefetch" href="/myDocsv2/assets/js/297.67a972ae.js"><link rel="prefetch" href="/myDocsv2/assets/js/298.9d16d98c.js"><link rel="prefetch" href="/myDocsv2/assets/js/299.0f04c0eb.js"><link rel="prefetch" href="/myDocsv2/assets/js/30.b5a32504.js"><link rel="prefetch" href="/myDocsv2/assets/js/300.d4e215e6.js"><link rel="prefetch" href="/myDocsv2/assets/js/301.60d51efc.js"><link rel="prefetch" href="/myDocsv2/assets/js/302.abb371d9.js"><link rel="prefetch" href="/myDocsv2/assets/js/303.b22b36ac.js"><link rel="prefetch" href="/myDocsv2/assets/js/304.3261e7b2.js"><link rel="prefetch" href="/myDocsv2/assets/js/305.807e25af.js"><link rel="prefetch" href="/myDocsv2/assets/js/306.fe10f19e.js"><link rel="prefetch" href="/myDocsv2/assets/js/307.9f74b43c.js"><link rel="prefetch" href="/myDocsv2/assets/js/308.b8c9f8e6.js"><link rel="prefetch" href="/myDocsv2/assets/js/309.1e5c14f9.js"><link rel="prefetch" href="/myDocsv2/assets/js/31.12707513.js"><link rel="prefetch" href="/myDocsv2/assets/js/310.911f38ce.js"><link rel="prefetch" href="/myDocsv2/assets/js/311.3940d290.js"><link rel="prefetch" href="/myDocsv2/assets/js/312.af9de452.js"><link rel="prefetch" href="/myDocsv2/assets/js/313.e10357a1.js"><link rel="prefetch" href="/myDocsv2/assets/js/314.8d732c56.js"><link rel="prefetch" href="/myDocsv2/assets/js/315.97345578.js"><link rel="prefetch" href="/myDocsv2/assets/js/316.5de46f5d.js"><link rel="prefetch" href="/myDocsv2/assets/js/317.ecbaee88.js"><link rel="prefetch" href="/myDocsv2/assets/js/318.f16657b3.js"><link rel="prefetch" href="/myDocsv2/assets/js/319.e9fc2b8b.js"><link rel="prefetch" href="/myDocsv2/assets/js/32.4794eb28.js"><link rel="prefetch" href="/myDocsv2/assets/js/320.87a080c9.js"><link rel="prefetch" href="/myDocsv2/assets/js/321.dc421947.js"><link rel="prefetch" href="/myDocsv2/assets/js/322.0d8f158f.js"><link rel="prefetch" href="/myDocsv2/assets/js/323.9feb5296.js"><link rel="prefetch" href="/myDocsv2/assets/js/324.11b428d5.js"><link rel="prefetch" href="/myDocsv2/assets/js/325.51e26ebb.js"><link rel="prefetch" href="/myDocsv2/assets/js/326.d7c9128a.js"><link rel="prefetch" href="/myDocsv2/assets/js/327.d2a1a3da.js"><link rel="prefetch" href="/myDocsv2/assets/js/328.f3119b29.js"><link rel="prefetch" href="/myDocsv2/assets/js/329.01ae2bb1.js"><link rel="prefetch" href="/myDocsv2/assets/js/33.7e8c531c.js"><link rel="prefetch" href="/myDocsv2/assets/js/330.757b5be7.js"><link rel="prefetch" href="/myDocsv2/assets/js/331.335622c4.js"><link rel="prefetch" href="/myDocsv2/assets/js/332.79b5dfeb.js"><link rel="prefetch" href="/myDocsv2/assets/js/333.b5bff6cd.js"><link rel="prefetch" href="/myDocsv2/assets/js/334.b4e9badb.js"><link rel="prefetch" href="/myDocsv2/assets/js/335.aed5ff57.js"><link rel="prefetch" href="/myDocsv2/assets/js/336.14ce19b1.js"><link rel="prefetch" href="/myDocsv2/assets/js/337.f0e871b6.js"><link rel="prefetch" href="/myDocsv2/assets/js/338.ba74f399.js"><link rel="prefetch" href="/myDocsv2/assets/js/339.e308e875.js"><link rel="prefetch" href="/myDocsv2/assets/js/34.76ac76e5.js"><link rel="prefetch" href="/myDocsv2/assets/js/340.8afe9761.js"><link rel="prefetch" href="/myDocsv2/assets/js/341.5f7f2739.js"><link rel="prefetch" href="/myDocsv2/assets/js/342.856b7535.js"><link rel="prefetch" href="/myDocsv2/assets/js/343.b71213f5.js"><link rel="prefetch" href="/myDocsv2/assets/js/344.4e9b4c16.js"><link rel="prefetch" href="/myDocsv2/assets/js/345.fde23f4c.js"><link rel="prefetch" href="/myDocsv2/assets/js/346.20b96938.js"><link rel="prefetch" href="/myDocsv2/assets/js/347.476680bb.js"><link rel="prefetch" href="/myDocsv2/assets/js/348.ecf44b79.js"><link rel="prefetch" href="/myDocsv2/assets/js/349.19235284.js"><link rel="prefetch" href="/myDocsv2/assets/js/35.b761363a.js"><link rel="prefetch" href="/myDocsv2/assets/js/350.42e4d37c.js"><link rel="prefetch" href="/myDocsv2/assets/js/351.6982f677.js"><link rel="prefetch" href="/myDocsv2/assets/js/352.f17e6bce.js"><link rel="prefetch" href="/myDocsv2/assets/js/353.2be51bc7.js"><link rel="prefetch" href="/myDocsv2/assets/js/354.77f5d2fb.js"><link rel="prefetch" href="/myDocsv2/assets/js/355.f6285383.js"><link rel="prefetch" href="/myDocsv2/assets/js/356.94418b9f.js"><link rel="prefetch" href="/myDocsv2/assets/js/357.b8b20e21.js"><link rel="prefetch" href="/myDocsv2/assets/js/358.1b2e896c.js"><link rel="prefetch" href="/myDocsv2/assets/js/36.34a14d0e.js"><link rel="prefetch" href="/myDocsv2/assets/js/37.aa4916db.js"><link rel="prefetch" href="/myDocsv2/assets/js/38.deb490d2.js"><link rel="prefetch" href="/myDocsv2/assets/js/39.8672f15d.js"><link rel="prefetch" href="/myDocsv2/assets/js/40.644dee16.js"><link rel="prefetch" href="/myDocsv2/assets/js/41.1b06014c.js"><link rel="prefetch" href="/myDocsv2/assets/js/42.e7ff72f1.js"><link rel="prefetch" href="/myDocsv2/assets/js/43.02a62ac3.js"><link rel="prefetch" href="/myDocsv2/assets/js/44.cd8672e0.js"><link rel="prefetch" href="/myDocsv2/assets/js/45.02596789.js"><link rel="prefetch" href="/myDocsv2/assets/js/46.a1c40368.js"><link rel="prefetch" href="/myDocsv2/assets/js/47.8d8b2f4d.js"><link rel="prefetch" href="/myDocsv2/assets/js/48.5dadf9f0.js"><link rel="prefetch" href="/myDocsv2/assets/js/49.ea5bbb89.js"><link rel="prefetch" href="/myDocsv2/assets/js/50.ad180d98.js"><link rel="prefetch" href="/myDocsv2/assets/js/51.0df9f4e8.js"><link rel="prefetch" href="/myDocsv2/assets/js/52.f04a6e1b.js"><link rel="prefetch" href="/myDocsv2/assets/js/53.74f2f2cf.js"><link rel="prefetch" href="/myDocsv2/assets/js/54.e8578653.js"><link rel="prefetch" href="/myDocsv2/assets/js/55.79a1b789.js"><link rel="prefetch" href="/myDocsv2/assets/js/56.693e099d.js"><link rel="prefetch" href="/myDocsv2/assets/js/57.82c7c63a.js"><link rel="prefetch" href="/myDocsv2/assets/js/58.15dea23c.js"><link rel="prefetch" href="/myDocsv2/assets/js/59.63d66b63.js"><link rel="prefetch" href="/myDocsv2/assets/js/6.97e7a4cb.js"><link rel="prefetch" href="/myDocsv2/assets/js/60.80a3efc6.js"><link rel="prefetch" href="/myDocsv2/assets/js/61.3f648458.js"><link rel="prefetch" href="/myDocsv2/assets/js/62.991be8f4.js"><link rel="prefetch" href="/myDocsv2/assets/js/63.c70d0dfb.js"><link rel="prefetch" href="/myDocsv2/assets/js/64.cbfa33ab.js"><link rel="prefetch" href="/myDocsv2/assets/js/65.f89bbfb7.js"><link rel="prefetch" href="/myDocsv2/assets/js/66.70c68ea1.js"><link rel="prefetch" href="/myDocsv2/assets/js/67.27436099.js"><link rel="prefetch" href="/myDocsv2/assets/js/68.6c730d30.js"><link rel="prefetch" href="/myDocsv2/assets/js/69.31e87a96.js"><link rel="prefetch" href="/myDocsv2/assets/js/7.b469f62b.js"><link rel="prefetch" href="/myDocsv2/assets/js/70.66a0fe4e.js"><link rel="prefetch" href="/myDocsv2/assets/js/71.150be7fc.js"><link rel="prefetch" href="/myDocsv2/assets/js/72.a2b6c89a.js"><link rel="prefetch" href="/myDocsv2/assets/js/73.65559007.js"><link rel="prefetch" href="/myDocsv2/assets/js/74.f61e2991.js"><link rel="prefetch" href="/myDocsv2/assets/js/75.fde71997.js"><link rel="prefetch" href="/myDocsv2/assets/js/76.cf3d3a31.js"><link rel="prefetch" href="/myDocsv2/assets/js/77.36633bd8.js"><link rel="prefetch" href="/myDocsv2/assets/js/79.6c213d15.js"><link rel="prefetch" href="/myDocsv2/assets/js/8.ebe4b359.js"><link rel="prefetch" href="/myDocsv2/assets/js/80.e6ee5654.js"><link rel="prefetch" href="/myDocsv2/assets/js/81.2d6febe8.js"><link rel="prefetch" href="/myDocsv2/assets/js/82.b1d7c015.js"><link rel="prefetch" href="/myDocsv2/assets/js/83.e4d15d98.js"><link rel="prefetch" href="/myDocsv2/assets/js/84.98d75c07.js"><link rel="prefetch" href="/myDocsv2/assets/js/85.8bd12af2.js"><link rel="prefetch" href="/myDocsv2/assets/js/86.3bc59854.js"><link rel="prefetch" href="/myDocsv2/assets/js/87.c26415ef.js"><link rel="prefetch" href="/myDocsv2/assets/js/88.12cc1dae.js"><link rel="prefetch" href="/myDocsv2/assets/js/89.1e08c26e.js"><link rel="prefetch" href="/myDocsv2/assets/js/9.bd9ef1a2.js"><link rel="prefetch" href="/myDocsv2/assets/js/90.4d879007.js"><link rel="prefetch" href="/myDocsv2/assets/js/91.089c1c17.js"><link rel="prefetch" href="/myDocsv2/assets/js/92.5aec83b9.js"><link rel="prefetch" href="/myDocsv2/assets/js/93.efe44a21.js"><link rel="prefetch" href="/myDocsv2/assets/js/94.ffc75f13.js"><link rel="prefetch" href="/myDocsv2/assets/js/95.d2012256.js"><link rel="prefetch" href="/myDocsv2/assets/js/96.87fef0cb.js"><link rel="prefetch" href="/myDocsv2/assets/js/97.aae1fc0b.js"><link rel="prefetch" href="/myDocsv2/assets/js/98.5f33b8aa.js"><link rel="prefetch" href="/myDocsv2/assets/js/99.f3fbb5db.js"><link rel="prefetch" href="/myDocsv2/assets/js/vendors~flowchart.f05697d3.js">
    <link rel="stylesheet" href="/myDocsv2/assets/css/0.styles.21bb8301.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-584a622c><div data-v-584a622c><div id="loader-wrapper" class="loading-wrapper" data-v-1c4f0192 data-v-584a622c data-v-584a622c><div class="loader-main" data-v-1c4f0192><div data-v-1c4f0192></div><div data-v-1c4f0192></div><div data-v-1c4f0192></div><div data-v-1c4f0192></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-73c95a87 data-v-584a622c data-v-584a622c><h3 class="title" style="display:none;" data-v-73c95a87 data-v-73c95a87>AGou's Docs-v2</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-73c95a87 data-v-73c95a87><input type="password" value="" data-v-73c95a87> <span data-v-73c95a87>Konck! Knock!</span> <button data-v-73c95a87>OK</button></label> <div class="footer" style="display:none;" data-v-73c95a87 data-v-73c95a87><span data-v-73c95a87><i class="iconfont reco-theme" data-v-73c95a87></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-73c95a87>vuePress-theme-reco</a></span> <span data-v-73c95a87><i class="iconfont reco-copyright" data-v-73c95a87></i> <a data-v-73c95a87><span data-v-73c95a87>AGou-ops</span>
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-584a622c><header class="navbar" data-v-584a622c><div title="导航" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myDocsv2/" class="home-link router-link-active"><img src="/myDocsv2/favicon.png" alt="AGou's Docs-v2" class="logo"> <span class="site-name">AGou's Docs-v2</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myDocsv2/timeline/" class="nav-link"><i class="iconfont undefined"></i>
  🕟时间线
</a></div><div class="nav-item"><a href="/myDocsv2/" class="nav-link"><i class="iconfont undefined"></i>
  🏠Home
</a></div><div class="nav-item"><a href="/myDocsv2/guide/" class="nav-link"><i class="iconfont undefined"></i>
  🗺️Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      📄其它
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myDocsv2/Golang/" class="nav-link"><i class="iconfont undefined"></i>
  📚Golang
</a></li><li class="dropdown-item"><!----> <a href="/myDocsv2/k8s/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  🚢K8s
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      版本
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  ver 1.0
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  ver 2.0
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://agou-ops.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  ✨myBlog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/AGou-ops/myDocsv2" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-584a622c></div> <aside class="sidebar" data-v-584a622c><div class="personal-info-wrapper" data-v-7e653f02><img src="/myDocsv2/favicon.png" alt="author-avatar" class="personal-img" data-v-7e653f02> <h3 class="name" data-v-7e653f02>
    AGou-ops
  </h3> <div class="num" data-v-7e653f02><div data-v-7e653f02><h3 data-v-7e653f02>2</h3> <h6 data-v-7e653f02>文章</h6></div> <div data-v-7e653f02><h3 data-v-7e653f02>1</h3> <h6 data-v-7e653f02>标签</h6></div></div> <hr data-v-7e653f02></div> <nav class="nav-links"><div class="nav-item"><a href="/myDocsv2/timeline/" class="nav-link"><i class="iconfont undefined"></i>
  🕟时间线
</a></div><div class="nav-item"><a href="/myDocsv2/" class="nav-link"><i class="iconfont undefined"></i>
  🏠Home
</a></div><div class="nav-item"><a href="/myDocsv2/guide/" class="nav-link"><i class="iconfont undefined"></i>
  🗺️Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      📄其它
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myDocsv2/Golang/" class="nav-link"><i class="iconfont undefined"></i>
  📚Golang
</a></li><li class="dropdown-item"><!----> <a href="/myDocsv2/k8s/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  🚢K8s
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      版本
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://agou-ops.cn/myDocs" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  ver 1.0
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://agou-ops.cn/myDocsv2" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  ver 2.0
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://agou-ops.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  ✨myBlog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/AGou-ops/myDocsv2" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/myDocsv2/k8s/Installation/" class="sidebar-heading clickable"><span>K8s Installation</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/myDocsv2/k8s/实战案例/" class="sidebar-heading clickable open"><span>K8s 实战案例</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html" class="active sidebar-link">SpringCloud微服务电商系统在Kubernetes集群中上线详细教程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_1-微服务架构及理论概述" class="sidebar-link">1.微服务架构及理论概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_1-1-单体架构与微服务架构的区别" class="sidebar-link">1.1.单体架构与微服务架构的区别</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_1-2-微服务组件架构图" class="sidebar-link">1.2.微服务组件架构图</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_1-3-微服务注册中心" class="sidebar-link">1.3.微服务注册中心</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_1-4-不同的部署环境对于程序配置文件如何管理" class="sidebar-link">1.4.不同的部署环境对于程序配置文件如何管理</a></li></ul></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_2-微服务迁移至kubernetes平台流程" class="sidebar-link">2.微服务迁移至kubernetes平台流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_2-1-项目迁移到k8s平台流程" class="sidebar-link">2.1.项目迁移到K8S平台流程</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_2-2-传统部署与k8s部署的区别" class="sidebar-link">2.2.传统部署与K8S部署的区别</a></li></ul></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_3-微服务程序前期环境准备-配置、编译、制作镜像" class="sidebar-link">3.微服务程序前期环境准备（配置、编译、制作镜像）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_3-1-simple-microservice微服务项目介绍" class="sidebar-link">3.1.simple-microservice微服务项目介绍</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_3-2-simple微服务部署到k8s逻辑架构" class="sidebar-link">3.2.simple微服务部署到K8S逻辑架构</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_3-3-准备微服务各程序的配置文件" class="sidebar-link">3.3.准备微服务各程序的配置文件</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_3-4-制作微服务程序所使用的的底层系统镜像" class="sidebar-link">3.4.制作微服务程序所使用的的底层系统镜像</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_3-5-调整protal微服务中连接gateway网关的地址" class="sidebar-link">3.5.调整Protal微服务中连接Gateway网关的地址</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_3-6-部署ingress用于将微服务程序发布到互联网" class="sidebar-link">3.6.部署Ingress用于将微服务程序发布到互联网</a></li></ul></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-在kubernetes集群部署simple微服务项目" class="sidebar-link">4.在kubernetes集群部署simple微服务项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-1-部署simple微服务程序的mysql数据库环境" class="sidebar-link">4.1.部署simple微服务程序的mysql数据库环境</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-2-部署eureka微服务注册中心" class="sidebar-link">4.2.部署eureka微服务注册中心</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-3-配置各个微服务程序连接eureka集群的地址" class="sidebar-link">4.3.配置各个微服务程序连接Eureka集群的地址</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-4-将各个程序代码编译成可部署的程序" class="sidebar-link">4.4.将各个程序代码编译成可部署的程序</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-3-中部署gateway网关服务" class="sidebar-link">4.3.中部署Gateway网关服务</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-4-编写快速部署微服务到k8s集群的脚本" class="sidebar-link">4.4.编写快速部署微服务到K8S集群的脚本</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-5-使用脚本部署order订单服务" class="sidebar-link">4.5.使用脚本部署Order订单服务</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-6-使用脚本部署product商品服务" class="sidebar-link">4.6.使用脚本部署Product商品服务</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-7-使用脚本部署stock库存服务" class="sidebar-link">4.7.使用脚本部署Stock库存服务</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-8-使用脚本部署portal前端首页" class="sidebar-link">4.8.使用脚本部署Portal前端首页</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-9-查看eureka注册中心中各个微服务的信息" class="sidebar-link">4.9.查看Eureka注册中心中各个微服务的信息</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_4-10-使用simple微服务电商平台" class="sidebar-link">4.10.使用simple微服务电商平台</a></li></ul></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_5-基于k8s集群的微服务的扩容与升级" class="sidebar-link">5.基于K8S集群的微服务的扩容与升级</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_5-1-微服务的扩容" class="sidebar-link">5.1.微服务的扩容</a></li><li class="sidebar-sub-header"><a href="/myDocsv2/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.html#_5-2-微服务的升级" class="sidebar-link">5.2.微服务的升级</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/myDocsv2/k8s/Quicklystart/" class="sidebar-heading clickable"><span>k8s 快速手册</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/myDocsv2/k8s/Helm/" class="sidebar-heading clickable"><span>Helm</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group depth-0"><a href="/myDocsv2/k8s/" class="sidebar-heading clickable router-link-active"><span>Others</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/myDocsv2/k8s/Kubernetes Yaml quicklystart.html" class="sidebar-link">⭐k8s Yaml quicklystart</a></li><li><a href="/myDocsv2/k8s/k8s command.html" class="sidebar-link">⭐k8s command quicklystart</a></li><li><a href="/myDocsv2/k8s/Kubernetes with Jenkins CICD.html" class="sidebar-link">Kubernetes with Jenkins CICD</a></li><li><a href="/myDocsv2/k8s/Prometheus+Grafana全方位监控Kubernetes集群.html" class="sidebar-link">Prometheus+Grafana全方位监控Kubernetes集群</a></li><li><a href="/myDocsv2/k8s/kompose Basic.html" class="sidebar-link">kompose Basic</a></li><li><a href="/myDocsv2/k8s/kubenetes远程调试工具.html" class="sidebar-link">kubenetes远程调试工具</a></li><li><a href="/myDocsv2/k8s/Kubernetes REST API.html" class="sidebar-link">Kubernetes REST API</a></li><li><a href="/myDocsv2/k8s/k3d.html" class="sidebar-link">k3d</a></li><li><a href="/myDocsv2/k8s/Minikube Basic.html" class="sidebar-link">Minikube Basic</a></li><li><a href="/myDocsv2/k8s/Remote access k8s.html" class="sidebar-link">Remote access k8s</a></li><li><a href="/myDocsv2/k8s/k8s 图解大全.html" class="sidebar-link">k8s 图解大全</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-73c95a87 data-v-584a622c><h3 class="title" style="display:none;" data-v-73c95a87 data-v-73c95a87></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-73c95a87 data-v-73c95a87><input type="password" value="" data-v-73c95a87> <span data-v-73c95a87>Konck! Knock!</span> <button data-v-73c95a87>OK</button></label> <div class="footer" style="display:none;" data-v-73c95a87 data-v-73c95a87><span data-v-73c95a87><i class="iconfont reco-theme" data-v-73c95a87></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-73c95a87>vuePress-theme-reco</a></span> <span data-v-73c95a87><i class="iconfont reco-copyright" data-v-73c95a87></i> <a data-v-73c95a87><span data-v-73c95a87>AGou-ops</span>
            
          <!---->
          2022
        </a></span></div></div> <div data-v-584a622c><main class="page"><!----> <div class="page-title" style="display:none;"><h1>SpringCloud微服务电商系统在Kubernetes集群中上线详细教程</h1> <hr> <div data-v-7b2e794a><i class="iconfont reco-account" data-v-7b2e794a><span data-v-7b2e794a>AGou-ops</span></i> <!----> <i class="iconfont reco-eye" data-v-7b2e794a><span id="/myDocsv2/k8s/%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F%E5%9C%A8Kubernetes%E9%9B%86%E7%BE%A4%E4%B8%AD%E4%B8%8A%E7%BA%BF%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-7b2e794a><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="springcloud微服务电商系统在kubernetes集群中上线详细教程"><a href="#springcloud微服务电商系统在kubernetes集群中上线详细教程" class="header-anchor">#</a> SpringCloud微服务电商系统在Kubernetes集群中上线详细教程</h1> <blockquote><p>该文章来自：https://jiangxl.blog.csdn.net/article/details/121740024</p> <p>仅做个人备份学习使用。</p></blockquote> <h2 id="_1-微服务架构及理论概述"><a href="#_1-微服务架构及理论概述" class="header-anchor">#</a> 1.<a href="https://so.csdn.net/so/search?q=%E5%BE%AE%E6%9C%8D%E5%8A%A1&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">微服务<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>架构及理论概述</h2> <p>程序<a href="https://so.csdn.net/so/search?q=%E6%9E%B6%E6%9E%84&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">架构<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>一共经历了3个阶段：单体架构、SOA架构、微服务架构。</p> <p>微服务系统应用由原来的单体变成几十到几百个不同的工程，会产生例如包括服务间的依赖，服务如何拆封，内部接口规范，数据传递等等问题，尤其是服务拆分，需要团队熟悉业务流程，懂得取舍，要保证拆分的粒度服务既符合“高内聚，低耦合”的基本原则，还要兼顾业务的发展以及公司的愿景，要还要说服团队成员为之努力，并且积极投入，在多方中间取得平衡。</p> <p>微服务从概念上讲就是将一个大的平台拆分成几个独立的小模块，这些模块有自己专门的数据库服务，即使这个单独模块出现了故障，也不会影响整个平台的使用，例如一个平台中有订单模块、新闻模块、咨询模块，即使新闻模块宕机了，订单模块、新闻模块依然工作正常，也不会造成整个网站的瘫痪。</p> <p>对于微服务版本迭代而言，只需要针对特定功能所在的子项目上线即可，版本迭代更加灵活，而单体程序版本迭代，哪怕只是一个小小的功能也需要对整个系统进行更新。</p> <p>目前主流的程序架构就是微服务系统，运用的技术栈更加丰富，例如kubernetes、CI/CD、Devops等等。</p> <p>微服务项目在kubernetes环境部署主要有两种实现方式：无状态的部署、istio微服务网格部署。</p> <p>可以把微服务理解为是一个大的框架，在这个框架里面内嵌各个子系统。</p> <h3 id="_1-1-单体架构与微服务架构的区别"><a href="#_1-1-单体架构与微服务架构的区别" class="header-anchor">#</a> 1.1.单体架构与微服务架构的区别</h3> <p><strong>微服务的特点：</strong></p> <ul><li>系统服务独立化
<ul><li>每个子项目系统都会独立开发、部署，有效的避免一个服务的bug影响整个系统的使用</li></ul></li> <li>技术栈灵活
<ul><li>每个子系统之间约定一个通信方式，例如MQ、API等，不再像单体服务那么的局限性</li></ul></li> <li>独立部署
<ul><li>每个微服务系统都独立部署，都有单独的war包，即使其中一个服务异常宕机，也不会对整个平台产生影响</li></ul></li> <li>扩展性强
<ul><li>每个微服务都可以部署多套，配合注册中心实现负载均衡能力</li></ul></li> <li>独立数据
<ul><li>每个微服务都有独立的存储组件，比如数据库、缓存等，互不影响</li></ul></li></ul> <p><strong>单体服务的特点</strong></p> <ul><li>易于部署
<ul><li>单体服务只有一个程序包，只需要部署一个服务即可完成整个系统的建设</li></ul></li> <li>易于测试
<ul><li>测试用例也只需要设计一个即可</li></ul></li></ul> <p><strong>单体服务的不足</strong></p> <ul><li>代码量级巨大，难以维护，如果系统中存在bug，修复起来牵扯功能太多，故障百出</li> <li>构建、部署的成本巨大，服务都集成在一起，启动的时间也会非常缓慢</li> <li>新人上手较难，如果整个服务也没有注释的情况下，新的开发人员上手会非常难</li></ul> <p><strong>微服务与单体服务架构上的不同</strong></p> <blockquote><p>单体服务：程序包只有一个，开发团队可能有一群人，用户之间访问程序包即可获取系统信息，后端对应一个数据库</p> <p>微服务：程序包有多个，每个程序包都是不同的功能结合，且每个微服务程序都有自己的单独数据库存储数据，所有的微服务信息都会存储到注册中心，网关程序在最前面，当用户有请求进来后，首先发送给网关服务，然后网关根据注册中心的数据，将不同功能的请求转发给不同的微服务程序</p></blockquote> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/caf1d3f6f0f4405ea879f6408a54faf5.png" alt="在这里插入图片描述"></p> <h3 id="_1-2-微服务组件架构图"><a href="#_1-2-微服务组件架构图" class="header-anchor">#</a> 1.2.微服务组件架构图</h3> <p>以电商平台为例，描述一个购买商品的微服务之间调用流程</p> <p>用户首先访问到平台的静态首页，发送一个搜索请求从前端页面提交给微服务的网关服务，网关服务是对外的，也就是不管用户要操作什么请求，都需要由网关服务转发给具体的微服务，因为网关服务是入口，因此网关服务一般都是多台做成的负载均衡，搜索请求到达网关服务后，网关服务会根据请求的功能转发到搜索服务的程序上，搜索出来商品后，会调用商品服务程序，查看商品的详细情况，用户选择完商品后，商品服务再调用订单服务，完成订单的创建，再由订单服务调用支付服务，完成商品的购买。</p> <p>所有的微服务接口信息都会注册到注册中心，当程序启动成功就会自动注册到注册中心，注册中心也会起到一个负载均衡的作用，根据网关的API请求，在注册中心上找到特定的微服务程序进行转发。</p> <p>微服务程序还有自己的一套配置中心，保存着各个微服务的配置文件，所有的微服务程序可能都有自己独立的后端组件，比如MySQL、Redis、MQ、分布式存储。</p> <p>微服务之间的通信可以采用接口API、MQ、RPAC等机制</p> <p>微服务在kubernetes集群中部署时可以采用无状态服务的部署，对于数据库、Redis、MQ、存储还是建议部署在k8s集群之外。</p> <p>注册中心与微服务之间的联系：发现微服务—&gt;微服务注册到注册中心—&gt;进行心跳监测，异常的节点会踢出</p> <p>微服务程序的门户网站会配置Gateway网关服务的地址，由门户网站用户请求的微服务信息，转发给Gateway网关程序，所有的微服务都会注册在Eureka注册中心中，Gateway网关会将请求通过注册中心转发给对应的微服务程序。
<img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/0225cafb98dd43d98ddd102cf1203791.png" alt="在这里插入图片描述"></p> <h3 id="_1-3-微服务注册中心"><a href="#_1-3-微服务注册中心" class="header-anchor">#</a> 1.3.微服务注册中心</h3> <p>微服务面对着很多问题：</p> <ul><li>如何记录一个微服务副本的接口地址，如何对多个微服务节点组成的集群做负载均衡</li> <li>符合判断集群中某一个微服务是否可用</li></ul> <p>微服务面临的这些问题都可以通过注册中心去解决，在注册中心中可用记录某一个微服务的所有副本节点，当一个副本节点挂掉了，注册中心也会将其踢出集群，注册中心会将一个微服务的所有副本节点自动形成一个负载均衡</p> <p>在微服务中配合注册中心地址之后，程序一旦启动，无需配置注册中心，且能够自动注册到注册中心</p> <p>微服务接入注册中心流程：微服务程序----&gt;注册----&gt;注册中心服务器</p> <p>注册中心调用微服务流程：微服务网关程序----&gt;注册/查询微服务（调用微服务）----&gt;注册中心----&gt;微服务程序</p> <p>当然也可以不适用注册中心，k8s自身的功能就有服务发现自动形成负载均衡，也可以用健康检查监控服务的运行状况</p> <p>目前主流的注册中心：Eureka、Nacos</p> <h3 id="_1-4-不同的部署环境对于程序配置文件如何管理"><a href="#_1-4-不同的部署环境对于程序配置文件如何管理" class="header-anchor">#</a> 1.4.不同的部署环境对于程序配置文件如何管理</h3> <p>可以通过以下四种方式来管理不同环境使用不同的配置文件</p> <ul><li>kubernetes configmap资源
<ul><li>可以根据线上、预发布、测试环境编写不同的configmap资源，然后将其挂载到对应的deployment资源上</li></ul></li> <li>docker 容器启动脚本entrypoint.sh
<ul><li>根据环境的不同在entrypoint.sh声明环境变量，运行特定的配置文件</li></ul></li> <li>java启动命令控制
<ul><li>java程序可以同时存在多个程序配置文件，可以在配置文件中声明各自的变量，然后使用<code>java --spring.profiles.active=xxx xxx.jar</code>的方式来指定不同环境的配置文件</li></ul></li> <li>使用开源的统一配置中心程序，比如市面上主流的Apollo以及Disconf，这两款程序都有自己的图形化管理系统，配置可视化</li></ul> <h2 id="_2-微服务迁移至kubernetes平台流程"><a href="#_2-微服务迁移至kubernetes平台流程" class="header-anchor">#</a> 2.微服务迁移至kubernetes平台流程</h2> <h3 id="_2-1-项目迁移到k8s平台流程"><a href="#_2-1-项目迁移到k8s平台流程" class="header-anchor">#</a> 2.1.项目迁移到K8S平台流程</h3> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/47633ea793f24a4b8727059870501e50.png" alt="在这里插入图片描述">
项目迁移到K8S平台大致流程分为以下几个阶段：</p> <ul><li>制作程序镜像
<ul><li>在K8s环境，所有的程序都是以Docker镜像来运行的，一个镜像包含了文件系统、程序的运行环境、程序本身，可以通过Dockerfile的形式制作镜像</li></ul></li> <li>使用资源控制器管理Pod资源
<ul><li>程序镜像运行需要依靠Pod资源，需要有Pod控制器去管理Pod资源</li> <li>常见的Pod控制器：Deployment（无状态程序部署）、Statefulset（有状态程序部署）、Job/CronJob（批量处理）</li></ul></li> <li>将Pod资源使用服务发现对外进行暴露
<ul><li>Services资源注意通过label标签与Pod进行关联，实现对一组Pod的自动负载均衡以及服务发现</li> <li>Services资源支持Cluster、Nodeport、LoadBalancer三种类型</li></ul></li> <li>对外发布应用程序
<ul><li>可以使用单独的nginx容器去反向代理Cordns解析的services名称将Pod应用对外发布</li> <li>也可以使用ingress+services的方式将应用程序对外发布，使用ingress的前提是必须可以通过域名访问应用</li> <li>架构图如下
<img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/4450dd7d3c994bb78ca36b43af66e28a.png" alt="在这里插入图片描述"></li></ul></li> <li>后期的日志收集与监控
<ul><li>当应用在K8s程序运行后，对于程序的日志比如nginx、tomcat这些日志文件都不会做持久化，因此就需要考虑对日志进行收集，可以采用Filebeat+ELK方式对程序日志进行收集</li> <li>使用Prometheus+Grafana对整个K8s平台进行全方面监控</li></ul></li></ul> <h3 id="_2-2-传统部署与k8s部署的区别"><a href="#_2-2-传统部署与k8s部署的区别" class="header-anchor">#</a> 2.2.传统部署与K8S部署的区别</h3> <blockquote><p><strong>传统方式部署项目方式：</strong></p> <p>首先由开发人员提交代码到Gitlab代码仓库，Jenkins触发更新从Gitlab上获取最新代码，通过maven将代码编译成war包或者jar包，再由Jenkins通过写好的自动化部署脚本或者Ansible自动化程序将war包部署到程序所在的云主机，云主机一定会是多台组成的负载均衡集群，将负载均衡VIP与域名进行绑定，用户通过访问域名由负载均衡转发至对应的后台主机。</p> <p>传统架构运维环境一般由zabbix监控系统进行监控，日志采集会使用ELK平台。</p></blockquote> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/e34c94fc97e0416cb21cd00879244103.png" alt="在这里插入图片描述"></p> <blockquote><p><strong>Kubernetes平台部署项目方式：</strong></p> <p>首先由开发人员提交代码到Gitlab代码仓库，Jenkins触发更新从Gitlab上获取最新代码，通过写好流水线将程序打包成Docker镜像并推送至Harbor仓库，再由Jenkins调用K8s的Master Api将程序的镜像采用Deployment控制器部署到K8s集群，再由service资源暴露pod资源，最后由ingress或者nginx资源将程序发布到互联网。</p></blockquote> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/3ca0d364bdc24690a04d4ca95eb1cb05.png" alt="在这里插入图片描述"></p> <h2 id="_3-微服务程序前期环境准备-配置、编译、制作镜像"><a href="#_3-微服务程序前期环境准备-配置、编译、制作镜像" class="header-anchor">#</a> 3.微服务程序前期环境准备（配置、编译、制作镜像）</h2> <h3 id="_3-1-simple-microservice微服务项目介绍"><a href="#_3-1-simple-microservice微服务项目介绍" class="header-anchor">#</a> 3.1.simple-microservice微服务项目介绍</h3> <p>本次使用的微服务为spring cloud的电商平台项目</p> <p>项目名称：simple-microservice</p> <p>simple-microservice微服务的各个程序：</p> <ul><li>eureka-service（注册中心）</li> <li>gateway-service（网管服务）</li> <li>order-service（订单服务）</li> <li>product-service（商品服务）</li> <li>portal-service（门户网站）</li> <li>stock-service（库存服务）</li></ul> <p>用户请求首先到Protal前端页面，也就是程序的首页，在首页的各项功能操作都会由Gateway网关服务转发到各自的微服务程序上，比如请求一个订单服务，订单服务会事先注册到Eureka中，由Gateway将请求发送给Eureka，再由Eureka转发给具体的微服务程序，这些微服务程序都有自己单独的数据库服务。</p> <p>微服务程序的门户网站会配置Gateway网关服务的地址，由门户网站用户请求的微服务信息，转发给Gateway网关程序，所有的微服务都会注册在Eureka注册中心中，Gateway网关会将请求通过注册中心转发给对应的微服务程序。
<img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/b89c6c882bbe4a2d9ab53f97d5fe1f35.png" alt="在这里插入图片描述"></p> <p>该微服务程序代码可以托管在gitlab代码仓库中，我们可以建立多个分支模拟从开发到上线的流程，理念：分别创建5个分支，在每个分支中增加对应的代码，最后合并到master分支，也可以直接就在master分支上新增配置文件，我是直接拉取dev1分支，只有程序代码的分支，然后新增一系列配置，最后上线。</p> <p>拉取dev1分支，进行一系列配置的话，首先要把master分支里的protal程序代码同步到dev1分支里，因为dev1的protal程序代码有点bug，整个微服务运行完毕后，order订单服务会报错。</p> <p>分别有五个分支：</p> <ul><li>dev1：交付代码</li> <li>dev2：新增程序打包的Dockerfile文件</li> <li>dev3：新增K8s资源编排Yaml文件</li> <li>dev4：微服务链路监控</li> <li>dev5：新功能代码更新上线</li> <li>master：上线版本</li></ul> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/258d6fe2cd114cd58843209bdf1f85de.png" alt="在这里插入图片描述"></p> <h3 id="_3-2-simple微服务部署到k8s逻辑架构"><a href="#_3-2-simple微服务部署到k8s逻辑架构" class="header-anchor">#</a> 3.2.simple微服务部署到K8S逻辑架构</h3> <p><strong>simple-microservice微服务部署到k8s平台主要分为如下几个步骤：</strong></p> <ul><li>修改程序配置文件，将数据库等各组件地址修改为当前环境</li> <li>将各个微服务程序使用Maven编译成可部署的jar包</li> <li>编写Dockerfile将程序做成docker镜像</li></ul> <p><strong>对K8S环境的要求：</strong></p> <p>一套完整的K8S集群、有cordns可以解析Service地址、Harbor镜像仓库、Nginx容器将项目发布到互联网或者INgress资源将项目发布到互联网。</p> <p><strong>微服务部署到K8S环境之后架构是怎样的</strong></p> <blockquote><p>首先用户访问网站的域名，请求达到前端页面，点击前端页面中的功能跳转到不同的微服务，比如商品服务，将商品服务的请求交个Gateway网关服务，由网关服务转发给商品的微服务程序Product，各个微服务之间的调用，都从Eureka注册中心读取各个微服务的信息完成调度，Product（商品）、Order（订单）、Stock（库存）都有单独的数据库，MySQL数据部署在K8S集群之外。</p> <p>服务发布到互联网采用Nginx而不采用Ingress，Nginx可以配置更多的参数，将Nginx容器运行在每一个Node主机上，映射Node主机的80/443端口，通过在hosts文件里绑定node主机ip+程序域名的方式访问微服务。</p></blockquote> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/60f3e04a6fb3410cbdc1f54eee6a7c4e.png" alt="在这里插入图片描述"></p> <h3 id="_3-3-准备微服务各程序的配置文件"><a href="#_3-3-准备微服务各程序的配置文件" class="header-anchor">#</a> 3.3.准备微服务各程序的配置文件</h3> <p>在使用Maven之前，首先将程序的配置文件进行修改，编译成功之后再想修改配置文件内容，就需要重新编译了，将每个微服务的环境地址都修改成自己环境的地址。</p> <p>拉取dev1分支展开全新配置</p> <h4 id="_3-3-1-创建微服务各个程序的prod配置文件"><a href="#_3-3-1-创建微服务各个程序的prod配置文件" class="header-anchor">#</a> 3.3.1.创建微服务各个程序的prod配置文件</h4> <p>eureka（注册中心）、gateway（网关）、order（订单）、portal（首页）、product（商品）、stock（库存）这几个微服务程序都需要配置，新建一个prod的配置文件，用于线上生产环境</p> <p>order（订单）、product（商品）、stock（库存）这些微服务有两个包，分别是xxx-biz和xxx-api，只需要部署biz目录下的jar包即可，api的目录只是存在一些依赖</p> <p>order（订单）、product（商品）、stock（库存）这些微服务都有自己单独的数据库</p> <p>先将prod的配置文件创建出来，待eureka项目部署完成后，再进行进一步的修改，最后将程序编译</p> <p><strong>1.eureka-service配置文件</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.创建一个prod的配置文件
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># cd eureka-service/src/main/resources/</span>
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/eureka-service/src/main/resources<span class="token punctuation">]</span><span class="token comment"># cp application-fat.yml application-prod.yml</span>

<span class="token number">2</span>.程序使用prod的配置文件运行
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/eureka-service/src/main/resources<span class="token punctuation">]</span><span class="token comment"># vim application.yml </span>
server:
  port: <span class="token number">8080</span>        <span class="token comment">#eureka的端口号</span>
spring:
  application:
    name: legendshop-basic-eureka
  profiles:
    active: prod    <span class="token comment">#将这里修改为prod就会调用prod配置文件</span>

<span class="token number">3</span>.配置eureka服务的配置文件
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/eureka-service/src/main/resources<span class="token punctuation">]</span><span class="token comment"># vim application-prod.yml </span>
eureka:
  server:
    renewal-percent-threshold: <span class="token number">0.9</span>
    enable-self-preservation: <span class="token boolean">false</span>
    eviction-interval-timer-in-ms: <span class="token number">40000</span>
  instance:
    hostname: <span class="token number">127.0</span>.0.1
    prefer-ip-address: <span class="token boolean">true</span>
  client:
    register-with-eureka: <span class="token boolean">false</span>
    serviceUrl:
      defaultZone: http://127.0.0.1:<span class="token variable">${server.port}</span>/eureka/
    fetch-registry: <span class="token boolean">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><strong>2.gateway-service配置文件</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.创建一个prod的配置文件
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># cd gateway-service/src/main/resources/</span>
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/gateway-service/src/main/resources<span class="token punctuation">]</span><span class="token comment"># cp application-fat.yml application-prod.yml</span>

<span class="token number">2</span>.程序使用prod的配置文件运行
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/gateway-service/src/main/resources<span class="token punctuation">]</span><span class="token comment"># cat application.yml </span>
server:
  port: <span class="token number">8080</span>
spring:
  profiles:
    active: prod
  application:
    name: @artifactId@
    
<span class="token number">3</span>.配置程序配置文件    
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/gateway-service/src/main/resources<span class="token punctuation">]</span><span class="token comment"># vim application-prod.yml </span>
······
eureka:
  instance:
    prefer-ip-address: <span class="token boolean">true</span>
  client:
    register-with-eureka: <span class="token boolean">true</span>
    fetch-registry: <span class="token boolean">true</span>
    service-url:
      defaultZone: http://eureka-0.eureka-service:8080/eureka/      <span class="token comment">#修改eureka地址</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>3.order-service配置文件</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.创建一个prod的配置文件
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># cd order-service/order-service-biz/src/main/resources/</span>
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/order-service/order-service-biz/src/main/resources<span class="token punctuation">]</span><span class="token comment"># cp application-fat.yml application-prod.yml</span>

<span class="token number">2</span>.程序使用prod的配置文件运行
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/order-service/order-service-biz/src/main/resources<span class="token punctuation">]</span><span class="token comment"># vim application.yml </span>
server:
  port: <span class="token number">8080</span>
spring:
  profiles:
    active: prod
  application:
    name: order-service

<span class="token number">3</span>.配置程序配置文件    
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/order-service/order-service-biz/src/main/resources<span class="token punctuation">]</span><span class="token comment"># vim application-prod.yml </span>
spring:
  datasource:
    url: jdbc:mysql://192.168.20.11:3306/tb_order?characterEncoding<span class="token operator">=</span>utf-8     <span class="token comment">#mysql数据库地址</span>
    username: root  
    password: <span class="token number">123456</span>
    driver-class-name: com.mysql.jdbc.Driver

eureka:
  instance:
    prefer-ip-address: <span class="token boolean">true</span>
  client:
    register-with-eureka: <span class="token boolean">true</span>
    fetch-registry: <span class="token boolean">true</span>
    service-url:
      defaultZone: http://eureka-0.eureka-service:8080/eureka/      <span class="token comment">#eureka地址</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>5.product-service配置文件</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.创建一个prod的配置文件
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># cd product-service/product-service-biz/src/main/resources/</span>
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/product-service/product-service-biz/src/main/resources<span class="token punctuation">]</span><span class="token comment"># cp application-fat.yml application-prod.yml</span>

<span class="token number">2</span>.程序使用prod的配置文件运行
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/product-service/product-service-biz/src/main/resources<span class="token punctuation">]</span><span class="token comment"># vim application.yml </span>
server:
  port: <span class="token number">8080</span>
spring:
  profiles:
    active: prod
  application:
    name: product-service

<span class="token number">3</span>.配置程序配置文件
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/product-service/product-service-biz/src/main/resources<span class="token punctuation">]</span><span class="token comment"># vim application-prod.yml </span>
spring:
  datasource:
    url: jdbc:mysql://192.168.20.11:3306/tb_product?characterEncoding<span class="token operator">=</span>utf-8     <span class="token comment">#数据库地址</span>
    username: root
    password: <span class="token number">123456</span>
    driver-class-name: com.mysql.jdbc.Driver

eureka:
  instance:
    prefer-ip-address: <span class="token boolean">true</span>
  client:
    register-with-eureka: <span class="token boolean">true</span>
    fetch-registry: <span class="token boolean">true</span>
    service-url:
      defaultZone: http://eureka-0.eureka-service:8080/eureka/      <span class="token comment">#eureka地址</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>6.stock-service配置文件</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.创建一个prod的配置文件
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># cd stock-service/stock-service-biz/src/main/resources/</span>
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/stock-service/stock-service-biz/src/main/resources<span class="token punctuation">]</span><span class="token comment"># cp application-fat.yml application-prod.yml</span>

<span class="token number">2</span>.程序使用prod的配置文件运行
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/stock-service/stock-service-biz/src/main/resources<span class="token punctuation">]</span><span class="token comment"># vim application.yml </span>
server:
  port: <span class="token number">8080</span>
spring:
  profiles:
    active: prod
  application:
    name: stock-service

<span class="token number">3</span>.配置程序配置文件
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/stock-service/stock-service-biz/src/main/resources<span class="token punctuation">]</span><span class="token comment"># vim application-prod.yml </span>
spring:
  datasource:
    url: jdbc:mysql://192.168.20.11:3306/tb_stock?characterEncoding<span class="token operator">=</span>utf-8   <span class="token comment">#数据库地址</span>
    username: root
    password: <span class="token number">123456</span>
    driver-class-name: com.mysql.jdbc.Driver

eureka:
  instance:
    prefer-ip-address: <span class="token boolean">true</span>
  client:
    register-with-eureka: <span class="token boolean">true</span>
    fetch-registry: <span class="token boolean">true</span>
    service-url:
      defaultZone: http://eureka-service.eureka:8080/eureka/      <span class="token comment">#eureka地址                            </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>4.portal-service配置文件</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.创建一个prod的配置文件
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># cd portal-service/src/main/resources/</span>
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/portal-service/src/main/resources<span class="token punctuation">]</span><span class="token comment"># cp application-fat.yml application-prod.yml</span>

<span class="token number">2</span>.程序使用prod的配置文件运行
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/portal-service/src/main/resources<span class="token punctuation">]</span><span class="token comment"># vim application.yml </span>
server:
  port: <span class="token number">8080</span>
  undertow:
    io-threads: <span class="token number">16</span>
    worker-threads: <span class="token number">256</span>
    buffer-size: <span class="token number">1024</span>
    direct-buffers: <span class="token boolean">true</span>
spring:
  application:
    name: portal-service
  profiles:
    active: prod

<span class="token number">3</span>.配置程序配置文件
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/portal-service/src/main/resources<span class="token punctuation">]</span><span class="token comment"># vim application-prod.yml </span>
eureka:
  instance:
    prefer-ip-address: <span class="token boolean">true</span>
  client:
    service-url:
      defaultZone: http://eureka-0.eureka-service:8080/eureka/      <span class="token comment">#指定eureka地址</span>
    register-with-eureka: <span class="token boolean">true</span>
    fetch-registry: <span class="token boolean">true</span>
······
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h4 id="_3-3-2-调整每个微服务的pom文件增加prod环境"><a href="#_3-3-2-调整每个微服务的pom文件增加prod环境" class="header-anchor">#</a> 3.3.2.调整每个微服务的pom文件增加prod环境</h4> <p>由于我们新加了一个prod线上环境的配置文件，因此也需要在pom.xml中配置，配置完成后可以编译一下，看看是否可以做成可部署的程序包</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.安装maven
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># yum -y install java-1.8.0-openjdk maven</span>

<span class="token number">2</span>.调整pom.xml增加prod环境配置
<span class="token punctuation">[</span>root@binary-k8s-master1 simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># vim pom.xml </span>
······      <span class="token comment">#65行左右</span>
    <span class="token operator">&lt;</span>profile<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>prod<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>properties<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>profileActive<span class="token operator">&gt;</span>prod<span class="token operator">&lt;</span>/profileActive<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>/properties<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/profile<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>/profiles<span class="token operator">&gt;</span>
······

<span class="token number">2</span>.编译程序
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># mvn clean package -D maven.test.skip=true -P prod</span>

<span class="token number">3</span>.查看编译成功的war包
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># find . -name &quot;*.jar&quot;</span>
./basic-common/basic-common-core/target/basic-common-core.jar
./eureka-service/target/eureka-service.jar
./gateway-service/target/gateway-service.jar
./order-service/order-service-api/target/order-service-api.jar
./order-service/order-service-biz/target/order-service-biz.jar
./portal-service/target/portal-service.jar
./product-service/product-service-api/target/product-service-api.jar
./product-service/product-service-biz/target/product-service-biz.jar
./stock-service/stock-service-api/target/stock-service-api.jar
./stock-service/stock-service-biz/target/stock-service-biz.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="_3-4-制作微服务程序所使用的的底层系统镜像"><a href="#_3-4-制作微服务程序所使用的的底层系统镜像" class="header-anchor">#</a> 3.4.制作微服务程序所使用的的底层系统镜像</h3> <h4 id="_3-4-1-为程序环境构建底层系统镜像"><a href="#_3-4-1-为程序环境构建底层系统镜像" class="header-anchor">#</a> 3.4.1.为程序环境构建底层系统镜像</h4> <p>由于是SpringCloud微服务系统，SpringCloud属于JAVA语言开发的项目，因此要有JAVA启动环境。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.拉取centos7.5作为底层容器
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># docker pull centos:7.5.1804</span>

<span class="token number">2</span>.启动容器
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># docker run -itd centos:7.5.1804</span>

<span class="token number">3</span>.进入系统容器进行环境配置
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it 462237f9a0a bash</span>
<span class="token comment">#安装java环境</span>
<span class="token punctuation">[</span>root@2fcfb51f04e0 /<span class="token punctuation">]</span><span class="token comment"># yum -y install java-1.8.0-openjdk net-tools</span>
<span class="token punctuation">[</span>root@2fcfb51f04e0 /<span class="token punctuation">]</span><span class="token comment"># java  -version</span>
openjdk version <span class="token string">&quot;1.8.0_302&quot;</span>
OpenJDK Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_302-b08<span class="token punctuation">)</span>
OpenJDK <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.302</span>-b08, mixed mode<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@2fcfb51f04e0 /<span class="token punctuation">]</span><span class="token comment"># mkdir /data/simple-microservice -p</span>
<span class="token comment">#调整系统时区</span>
<span class="token punctuation">[</span>root@2fcfb51f04e0 /<span class="token punctuation">]</span><span class="token comment"># yum -y intall tzdata</span>
<span class="token punctuation">[</span>root@2fcfb51f04e0 /<span class="token punctuation">]</span><span class="token comment"># ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime </span>

<span class="token number">4</span>.将容器提交为镜像
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># docker commit 2fcfb51f04e0 centos-java:v1</span>

<span class="token number">5</span>.配置Harbor镜像仓库
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/docker/daemon.json </span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://9wn5tbfh.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;insecure-registries&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.20.10&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker</span>

<span class="token number">6</span>.提交镜像到Harbor仓库
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># docker login -u admin -p Harbor12345 192.168.20.10</span>
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># docker tag centos-java:v1 192.168.20.11/base/centos-java:v1</span>
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># docker push 192.168.20.11/base/centos-java:v1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h4 id="_3-4-2-为每个微服务程序编写dockerfile"><a href="#_3-4-2-为每个微服务程序编写dockerfile" class="header-anchor">#</a> 3.4.2.为每个微服务程序编写Dockerfile</h4> <p><strong>设计概念：</strong></p> <p>采用3.3.1中制作的底层镜像</p> <p>第一步：在镜像里面创建<code>/data/simple-microservice/微服务名称</code>这样的目录用于存放程序的jar包</p> <p>第二步：将程序的jar包拷贝至镜像中</p> <p>第三步：生成一个启动脚本，由于服务名称都不一样也就是每个程序的路径都不同，想要做到一个底层镜像多个程序复用，那么就需要在启动脚本里手动指定程序的路径，在脚本中指定程序的部署路径以及日志路径</p> <p>第四步：暴露8080端口</p> <p>将Dockerfile放到程序编译的目录也就是与src在同一目录</p> <p><strong>1.eureka-service服务</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>在4.2.2.会写
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>2.gateway-service服务</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/gateway-service<span class="token punctuation">]</span><span class="token comment"># vim Dockerfile </span>
FROM <span class="token number">192.168</span>.20.11/base/centos-java:v1
RUN <span class="token function">mkdir</span> /data/simple-microservice/gateway-service -p
COPY ./target/gateway-service.jar /data/simple-microservice/gateway-service/
RUN <span class="token builtin class-name">echo</span> -e <span class="token string">&quot;#!/bin/bash <span class="token entity" title="\n">\n</span>java -jar /data/simple-microservice/gateway-service/gateway-service.jar &gt; /data/simple-microservice/gateway-service/gateway-service.log &amp; <span class="token entity" title="\n">\n</span>tail -f /data/simple-microservice/gateway-service/gateway-service.log&quot;</span> <span class="token operator">&gt;</span> /data/entrypoint.sh <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> a+x /data/entrypoint.sh
EXPOSE <span class="token number">8080</span>
ENTRYPOINT /data/entrypoint.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>3.order-service服务</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/order-service/order-service-biz<span class="token punctuation">]</span><span class="token comment"># vim Dockerfile </span>
FROM <span class="token number">192.168</span>.20.11/base/centos-java:v1
RUN <span class="token function">mkdir</span> /data/simple-microservice/order-service -p
COPY ./target/order-service-biz.jar /data/simple-microservice/order-service/
RUN <span class="token builtin class-name">echo</span> -e <span class="token string">&quot;#!/bin/bash <span class="token entity" title="\n">\n</span>java -jar /data/simple-microservice/order-service/order-service-biz.jar &gt; /data/simple-microservice/order-service/order-service-biz.log &amp; <span class="token entity" title="\n">\n</span>tail -f /data/simple-microservice/order-service/order-service-biz.log&quot;</span> <span class="token operator">&gt;</span> /data/entrypoint.sh <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> a+x /data/entrypoint.sh
EXPOSE <span class="token number">8080</span>
ENTRYPOINT /data/entrypoint.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>4.portal-service服务</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/portal-service<span class="token punctuation">]</span><span class="token comment"># vim Dockerfile </span>
FROM <span class="token number">192.168</span>.20.11/base/centos-java:v1
RUN <span class="token function">mkdir</span> /data/simple-microservice/portal-service -p
COPY ./target/portal-service.jar /data/simple-microservice/portal-service/
RUN <span class="token builtin class-name">echo</span> -e <span class="token string">&quot;#!/bin/bash <span class="token entity" title="\n">\n</span>java -jar /data/simple-microservice/portal-service/portal-service.jar &gt; /data/simple-microservice/portal-service/portal-service.log &amp; <span class="token entity" title="\n">\n</span>tail -f /data/simple-microservice/portal-service/portal-service.log&quot;</span> <span class="token operator">&gt;</span> /data/entrypoint.sh <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> a+x /data/entrypoint.sh
EXPOSE <span class="token number">8080</span>
ENTRYPOINT /data/entrypoint.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>5.product-service服务</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/product-service/product-service-biz<span class="token punctuation">]</span><span class="token comment"># vim Dockerfile</span>
FROM <span class="token number">192.168</span>.20.11/base/centos-java:v1
RUN <span class="token function">mkdir</span> /data/simple-microservice/product-service -p
COPY ./target/product-service-biz.jar /data/simple-microservice/product-service/
RUN <span class="token builtin class-name">echo</span> -e <span class="token string">&quot;#!/bin/bash <span class="token entity" title="\n">\n</span>java -jar /data/simple-microservice/product-service/product-service-biz.jar &gt; /data/simple-microservice/product-service/product-service-biz.log &amp; <span class="token entity" title="\n">\n</span>tail -f /data/simple-microservice/product-service/product-service-biz.log&quot;</span> <span class="token operator">&gt;</span> /data/entrypoint.sh <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> a+x /data/entrypoint.sh
EXPOSE <span class="token number">8080</span>
ENTRYPOINT /data/entrypoint.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>6.stock-service服务</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/simple-microservice-dev1/stock-service/stock-service-biz<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile</span>
FROM <span class="token number">192.168</span>.20.11/base/centos-java:v1
RUN <span class="token function">mkdir</span> /data/simple-microservice/stock-service -p
COPY ./target/stock-service-biz.jar /data/simple-microservice/stock-service/
RUN <span class="token builtin class-name">echo</span> -e <span class="token string">&quot;#!/bin/bash <span class="token entity" title="\n">\n</span>java -jar /data/simple-microservice/stock-service/stock-service-biz.jar &gt; /data/simple-microservice/stock-service/stock-service-biz.log &amp; <span class="token entity" title="\n">\n</span>tail -f /data/simple-microservice/stock-service/stock-service-biz.log&quot;</span> <span class="token operator">&gt;</span> /data/entrypoint.sh <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> a+x /data/entrypoint.sh
EXPOSE <span class="token number">8080</span>
ENTRYPOINT /data/entrypoint.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-5-调整protal微服务中连接gateway网关的地址"><a href="#_3-5-调整protal微服务中连接gateway网关的地址" class="header-anchor">#</a> 3.5.调整Protal微服务中连接Gateway网关的地址</h3> <p>Protal是我们电商平台的门户网站，也就是前端首页，在Protal微服务中会填写好其他微服务程序的地址，Gateway网关程序的地址就是写死在Protal项目的js里，在我们定义好Gateway网关服务的域名后，就要将域名写入到对应的js文件里，否则当项目启动之后是无法调通的。</p> <p>需要修改下列这四个文件</p> <p>portal-service/src/main/resources/static/js/orderList.js</p> <p>portal-service/src/main/resources/static/js/productList.js
<img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/d0e207db0cb54e6296ca185728e5ed1c.png" alt="在这里插入图片描述"></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>打开这四个文件，将里面的gateway.ctnrs.com域名修改为gateway.jiangxl.com域名

vim修改命令：%s/gateway.ctnrs.com/gateway.jiangxl.com/g
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-6-部署ingress用于将微服务程序发布到互联网"><a href="#_3-6-部署ingress用于将微服务程序发布到互联网" class="header-anchor">#</a> 3.6.部署Ingress用于将微服务程序发布到互联网</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.下载ingress部署的yaml文件
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml</span>
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml</span>

<span class="token number">2</span>.调整ingress nodeport端口
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/ingress<span class="token punctuation">]</span><span class="token comment"># vim service-nodeport.yaml</span>
······
  ports:
    - name: http
      port: <span class="token number">80</span>
      targetPort: <span class="token number">80</span>
      nodePort: <span class="token number">80</span>
      protocol: TCP
    - name: https
      port: <span class="token number">443</span>
      targetPort: <span class="token number">443</span>
      nodePort: <span class="token number">443</span>
      protocol: TCP
······

<span class="token number">3</span>.部署ingress
<span class="token punctuation">[</span>root@binary-k8s-master1 ~/springcloud/ingress<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f mandatory.yaml</span>

<span class="token number">4</span>.查看ingress部署的结果
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all -n ingress-nginx</span>
NAME                                            READY   STATUS    RESTARTS   AGE
pod/nginx-ingress-controller-766867958b-n7dwj   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          49m

NAME                    TYPE       CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                 AGE
service/ingress-nginx   NodePort   <span class="token number">10.0</span>.0.107   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:80/TCP,443:443/TCP   49m

NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/nginx-ingress-controller   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           49m

NAME                                                  DESIRED   CURRENT   READY   AGE
replicaset.apps/nginx-ingress-controller-766867958b   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       49m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="_4-在kubernetes集群部署simple微服务项目"><a href="#_4-在kubernetes集群部署simple微服务项目" class="header-anchor">#</a> 4.在kubernetes集群部署simple微服务项目</h2> <p>simple微服务项目在K8S集群中部署，只有eureka服务采用statefulset控制器部署，其余所有微服务均采用deployment控制器部署，所有的微服务通过ingress发布在互联网。</p> <p><strong>simple微服务电商项目在K8S集群部署流程</strong></p> <p>1）部署simple电商微服务项目的数据库环境</p> <p>2）在K8S中部署Eureka注册中心</p> <p>3）修改每个微服务的配置文件，指定eureka注册中心集群的地址</p> <p>4）使用maven将每个微服务构建成可部署的jar包</p> <p>5）部署Gateway关服务</p> <p>6）部署protal、order、product、stock服务</p> <h3 id="_4-1-部署simple微服务程序的mysql数据库环境"><a href="#_4-1-部署simple微服务程序的mysql数据库环境" class="header-anchor">#</a> 4.1.部署simple微服务程序的mysql数据库环境</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.安装MySQL数据库
<span class="token punctuation">[</span>root@harbor-mysql ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh http://repo.mysql.com/yum/mysql-5.6-community/el/7/x86_64/mysql-community-release-el7-5.noarch.rpm</span>
<span class="token punctuation">[</span>root@harbor-mysql ~<span class="token punctuation">]</span><span class="token comment">#  yum install mysql-community-server </span>

<span class="token number">2</span>.启动MySQL
<span class="token punctuation">[</span>root@harbor-mysql ~<span class="token punctuation">]</span><span class="token comment"># systemctl start mysqld</span>
<span class="token punctuation">[</span>root@harbor-mysql ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable mysqld</span>

<span class="token number">3</span>.设置数据库密码
<span class="token punctuation">[</span>root@harbor-mysql ~<span class="token punctuation">]</span><span class="token comment"># mysqladmin -u root password '123456'</span>

<span class="token number">4</span>.创建order（订单）、product（商品）、stock（库存）微服务的数据库
<span class="token punctuation">[</span>root@harbor-mysql ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p123456</span>
mysql<span class="token operator">&gt;</span> create database tb_order<span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> create database tb_product<span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> create database tb_stock<span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token number">5</span>.导入数据库数据
<span class="token comment">#将数据库文件传到数据库服务器</span>
<span class="token punctuation">[</span>root@binary-k8s-master1 simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># scp -r db root@192.168.20.11:/root</span>
<span class="token comment">#导入order数据库的数据</span>
mysql<span class="token operator">&gt;</span> use tb_order
mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">source</span> /root/db/order.sql
<span class="token comment">#导入product数据库的数据</span>
mysql<span class="token operator">&gt;</span> use tb_product
mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">source</span> /root/db/product.sql
<span class="token comment">#导入stock数据库的数据</span>
mysql<span class="token operator">&gt;</span> use tb_stock<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">source</span> /root/db/stock.sql

<span class="token number">6</span>.允许数据库远程访问
mysql<span class="token operator">&gt;</span> grant all privileges on *.* to <span class="token string">'root'</span>@<span class="token string">'%'</span> identified by <span class="token string">'123456'</span> with grant option<span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="_4-2-部署eureka微服务注册中心"><a href="#_4-2-部署eureka微服务注册中心" class="header-anchor">#</a> 4.2.部署eureka微服务注册中心</h3> <p>Eureka在整个微服务架构中起到至关重要的的作用，必须保证Eureka服务高可用。</p> <p>Eureka服务采用statefulset有状态应用部署方式再K8S集群中进行部署。</p> <p>Eureka本身就可以利用自身的服务发现来实现集群的高可用，只需要在Eureka配置文件中指定各个Eureka节点的地址就可以实现。</p> <p>将程序部署在K8S之后，如何能够保证每个Eureka Pod的地址唯一不变，就需要用到Statefulset控制器采用有状态的应用部署，使用Statefulset控制器之后，每个Pod的名称都是唯一不变的，并且每个Pod都有一个DNS服务发现地址，通过这个DNS地址就可以请求到Pod中的服务，主要是coredns组件来实现的，因此集群还需要安装有coredns服务，我们可以将每一个Eureka Pod的DNS服务发现地址写入到Eureka的配置文件中，每个Eureka节点相互注册，最终形成高可用集群。</p> <p>Statefulset+Headless部署的程序DNS名格式：<code>&lt;statefulsetName-index&gt;.&lt;service-name&gt;.&lt;namespace-name&gt;.svc.cluster.local</code>后面的.svc.cluster.local可以去掉，K8S默认就是.svc.cluster.local。</p> <p><code>&lt;statefulsetName-index&gt;</code>就是Pod的名称，-index是每一个Pod名称后面的数字编号，Statefulset控制器部署好的Pod，会在每一个Pod名称后面加上一个数字编号，从0开始，一次累加，保证所有的Pod都有一个独立的访问入口</p> <p><code>&lt;service-name&gt;</code>是程序的service资源的名称</p> <p><code>&lt;namespace-name&gt;</code>是程序所在的namespace名称</p> <p>我们的Eureka规定的节点数为3个，也就是最终statefulset会启动3个Pod副本组成Eureka集群。</p> <h4 id="_4-2-1-修改eureka配置文件增加各节点地址"><a href="#_4-2-1-修改eureka配置文件增加各节点地址" class="header-anchor">#</a> 4.2.1.修改Eureka配置文件增加各节点地址</h4> <p>Eureka集群节点每个Pod副本服务发现地址如下，需要将其配置在eureka中</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://eureka-0.eureka-service.simple-ms`
`http://eureka-0.eureka-service.simple-ms`
`http://eureka-0.eureka-service.simple-ms
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>修改Eureka的配置文件，采用Dns服务发现地址的形式将每个节点的地址都写在配置文件中，当Eureka启动之后，每个节点都会相互发现最终形成高可用集群。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.修改Eureka配置文件中的节点地址
<span class="token punctuation">[</span>root@binary-k8s-master1 eureka-service<span class="token punctuation">]</span><span class="token comment"># vim src/main/resources/application-prod.yml</span>
eureka:
  server:
    renewal-percent-threshold: <span class="token number">0.9</span>
    enable-self-preservation: <span class="token boolean">false</span>
    eviction-interval-timer-in-simple-ms: <span class="token number">40000</span>
  instance:
    hostname: <span class="token number">127.0</span>.0.1
    prefer-ip-address: <span class="token boolean">false</span>
  client:
    register-with-eureka: <span class="token boolean">true</span>
    serviceUrl:
      defaultZone: http://eureka-0.eureka.simple-ms:<span class="token variable">${server.port}</span>/eureka/,http://eureka-1.eureka.simple-ms:<span class="token variable">${server.port}</span>/eureka/,http://eureka-2.eureka.simple-ms:<span class="token variable">${server.port}</span>/eureka/
    fetch-registry: <span class="token boolean">true</span>

<span class="token number">2</span>.使用maven将最新的Eureka编译
<span class="token punctuation">[</span>root@binary-k8s-master1 simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># mvn clean package -D maven.test.skip=true -P prod</span>

注意：只能在项目最外层的目录中执行mvn clean package
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_4-2-2-调整eureka的dockerfile"><a href="#_4-2-2-调整eureka的dockerfile" class="header-anchor">#</a> 4.2.2.调整Eureka的Dockerfile</h4> <p>由于我们在Eureka配置文件中配置的是以dns名称来互相发现对方，并不是以IP地址形式发现，因此我们需要配置Dockerfile，在启动程序时将配置文件中的hostname字段值修改为当前Pod的dns名称。</p> <p>因为我们的Eureka是多Pod组成的高可用集群，因此不能将dns名称写死在配置文件中，不然每个Pod都是同样的地址，集群是组件不成功的，所以就需要在Dockerfile中定义程序启动命令时，将dns名称地址设置成变量，由Pod资源将变量值传入到启动命令中，程序启动时就会用Pod的dns名称地址替换掉配置文件中的IP地址。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.修改DOckerfile文件内容
<span class="token punctuation">[</span>root@binary-k8s-master1 eureka-service<span class="token punctuation">]</span><span class="token comment"># vim Dockerfile </span>
FROM <span class="token number">192.168</span>.20.11/base/centos-java:v1
RUN <span class="token function">mkdir</span> /data/simple-microservice/eureka-service -p
COPY ./target/eureka-service.jar /data/simple-microservice/eureka-service/
RUN <span class="token builtin class-name">echo</span> -e <span class="token string">&quot;#!/bin/bash <span class="token entity" title="\n">\n</span>java -jar -Deureka.instance.hostname=<span class="token variable">${MY_POD_NAME}</span>.eureka.simple-ms /data/simple-microservice/eureka-service/eureka-service.jar &gt; /data/simple-microservice/eureka-service/eureka-service.log &amp; <span class="token entity" title="\n">\n</span>tail -f /data/simple-microservice/eureka-service/eureka-service.log&quot;</span> <span class="token operator">&gt;</span> /data/entrypoint.sh <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> a+x /data/entrypoint.sh
EXPOSE <span class="token number">8080</span>
ENTRYPOINT /data/entrypoint.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>启动命令单独拉出来看一下，<code>-Deureka.instance.hostname</code>这个参数表示修改配置文件中hostname参数的值，<code>${MY_POD_NAME}</code>这个变量使从deployment资源文件中定义的env变量，将Pod的名称赋给MY_POD_NAME变量，最后引入到启动命令中，最后在配置文件中hostname字段的值应该是<code>eureka-0.eureka-service.simple-ms</code></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>java -jar -Deureka.instance.hostname<span class="token operator">=</span><span class="token variable">${MY_POD_NAME}</span>.eureka-service.simple-ms /data/simple-microservice/eureka-service/eureka-service.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4-2-3-构建eureka服务的docker镜像"><a href="#_4-2-3-构建eureka服务的docker镜像" class="header-anchor">#</a> 4.2.3.构建Eureka服务的Docker镜像</h4> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 eureka-service<span class="token punctuation">]</span><span class="token comment"># docker build -t  192.168.20.11/simple-microservice/eureka-service:v1 .</span>

<span class="token punctuation">[</span>root@binary-k8s-master1 eureka-service<span class="token punctuation">]</span><span class="token comment"># docker images | grep eureka</span>
<span class="token number">192.168</span>.20.11/simp-microservice/eureka-service        v1                  1dc64fc9ba09        About a minute ago   800MB

<span class="token punctuation">[</span>root@binary-k8s-master1 eureka-service<span class="token punctuation">]</span><span class="token comment"># docker push 192.168.20.11/simple-microservice/eureka-service:v1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_4-2-4-编写eureka部署yaml资源文件"><a href="#_4-2-4-编写eureka部署yaml资源文件" class="header-anchor">#</a> 4.2.4.编写Eureka部署YAML资源文件</h4> <p><strong>1）创建命名空间</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>1.创建命名空间
<span class="token comment"># kubectl create ns simple-ms</span>
namespace/simple<span class="token punctuation">-</span>ms created

2.创建资源编排YAML文件存放路径
<span class="token punctuation">[</span>root@binary<span class="token punctuation">-</span>k8s<span class="token punctuation">-</span>master1 ~<span class="token punctuation">]</span><span class="token comment"># mkdir springcloud/simple-microservice-dev1/k8s/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>2）登录Harbor</strong></p> <p>可以不在每一个Node节点使用docker login登陆Harbor仓库，可以将Harbor仓库的认证信息做成secret，通过使用secret的方式连接Harbor。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl create secret docker-registry registry-pull-secret --docker-server=192.168.20.11 --docker-username=admin --docker-password=Harbor12345 --docker-email=admin@ctnrs.com -n simple-ms</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>3）编写资源YAML文件</strong></p> <p>eureka要做成集群式的服务，所以要采用statefulset控制器部署，并采用headless service保证statefulset创建的pod名称唯一性，最后通过ingress将eureka服务发布在互联网环境。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@binary<span class="token punctuation">-</span>k8s<span class="token punctuation">-</span>master1 k8s<span class="token punctuation">]</span><span class="token comment"># vim eureka-deploy.yaml </span>
<span class="token punctuation">---</span>
<span class="token comment">#ingress资源</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress           <span class="token comment">#类型为ingress</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>             <span class="token comment">#定义元数据信息：资源名称、资源所在的命名空间</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka 
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>ms
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>                  <span class="token comment">#定义ingress规则</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> eureka.jiangxl.com          <span class="token comment">#定义eureka使用的域名</span>
      <span class="token key atrule">http</span><span class="token punctuation">:</span>                   <span class="token comment">#采用http类型的访问方式</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>                  <span class="token comment">#定义程序的url路径</span>
        <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
          <span class="token key atrule">backend</span><span class="token punctuation">:</span>                <span class="token comment">#针对定义的程序路径关于对应的后端service资源</span>
            <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> eureka
            <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
            
<span class="token punctuation">---</span>
<span class="token comment">#headless service资源</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1          
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>ms
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">clusterIP</span><span class="token punctuation">:</span> None       <span class="token comment">#ClusterIP资源设置为Node就代表headless类型的service</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>            <span class="token comment">#定义暴露的eureka端口号</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka 
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>           <span class="token comment">#标签选择器，关联后端pod</span>
    <span class="token key atrule">project</span><span class="token punctuation">:</span> simple
    <span class="token key atrule">app</span><span class="token punctuation">:</span> eureka

<span class="token punctuation">---</span>
<span class="token comment">#statefulset资源</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StatefulSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>ms
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>               <span class="token comment">#副本数</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>                 <span class="token comment">#标签选择器</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">project</span><span class="token punctuation">:</span> simple         
      <span class="token key atrule">app</span><span class="token punctuation">:</span> eureka
  <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> <span class="token string">&quot;eureka&quot;</span>           <span class="token comment">#service的名称，也就是将来的pod名称</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>                 
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">project</span><span class="token punctuation">:</span> simple
        <span class="token key atrule">app</span><span class="token punctuation">:</span> eureka
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>           <span class="token comment">#harbor镜像仓库的凭据信息</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> registry<span class="token punctuation">-</span>pull<span class="token punctuation">-</span>secret
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka
        <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.20.11/simple<span class="token punctuation">-</span>microservice/eureka<span class="token punctuation">-</span>service<span class="token punctuation">:</span>v1
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
            <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>              <span class="token comment">#增加一个环境变量，变量名为MY_POD_NAME，值为pod的名称，这个变量信息会传入dockerfile中</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> MY_POD_NAME
            <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
              <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.name
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>            <span class="token comment">#资源配额</span>
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>           <span class="token comment">#最小资源限制，cpu为0.5，内存为256M</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">0.5</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>           <span class="token comment">#最大资源限制，cpu为1，内存为1G</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">1</span>          
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 1Gi
        <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>         <span class="token comment">#就绪性健康检查</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>          <span class="token comment">#以tcp 8080端口作为健康检查的机制</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>  
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>     <span class="token comment">#容器启动60秒后进行检测</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>         <span class="token comment">#探测的频率</span>
        <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>            <span class="token comment">#存活性健康检查</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>            <span class="token comment">#以tcp 8080端口作为健康检查的机制</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>  
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>       <span class="token comment">#容器启动60秒后进行检查</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>           <span class="token comment">#探测的频率为10秒一次</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br></div></div><h4 id="_4-2-5-在k8s集群中部署eureka注册中心"><a href="#_4-2-5-在k8s集群中部署eureka注册中心" class="header-anchor">#</a> 4.2.5.在K8S集群中部署Eureka注册中心</h4> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.部署eureka服务
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f eureka-deploy.yaml </span>

<span class="token number">2</span>.查看部署的资源状态
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get all -n simple-ms</span>
NAME           READY   STATUS    RESTARTS   AGE
pod/eureka-0   <span class="token number">1</span>/1     Running   <span class="token number">1</span>          12h
pod/eureka-1   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12h
pod/eureka-2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12h

NAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>    AGE
service/eureka   ClusterIP   None         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span>/TCP   13h

NAME                      READY   AGE
statefulset.apps/eureka   <span class="token number">3</span>/3     13h

<span class="token number">3</span>.查看eureka的ingress状态
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get ingress -n simple-ms</span>
NAME     CLASS    HOSTS                ADDRESS      PORTS   AGE
eureka   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   eureka.jiangxl.com   <span class="token number">10.0</span>.0.107   <span class="token number">80</span>      13h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>首先在本地hosts文件中绑定eureka域名解析，然后在浏览器中输入eureka.jiangxl.com访问eureka服务。</p> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/dac8c49c10904c4591acb933a094c0d7.png" alt="在这里插入图片描述"></p> <h3 id="_4-3-配置各个微服务程序连接eureka集群的地址"><a href="#_4-3-配置各个微服务程序连接eureka集群的地址" class="header-anchor">#</a> 4.3.配置各个微服务程序连接Eureka集群的地址</h3> <p>在程序的配置文件中填写eureka集群所有节点的服务发现地址</p> <p><strong>1.gateway-service配置文件</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># vim gateway-service/src/main/resources/application-prod.yml </span>
······
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>0.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>1.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>2.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>2.order-service配置文件</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># vim order-service/order-service-biz/src/main/resources/application-prod.yml </span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.20.11<span class="token punctuation">:</span>3306/tb_order<span class="token punctuation">?</span>characterEncoding=utf<span class="token punctuation">-</span><span class="token number">8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver

<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>0.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>1.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>2.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>3.product-service配置文件</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># vim product-service/product-service-biz/src/main/resources/application-prod.yml </span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.20.11<span class="token punctuation">:</span>3306/tb_product<span class="token punctuation">?</span>characterEncoding=utf<span class="token punctuation">-</span><span class="token number">8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver

<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>0.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>1.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>2.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>4.stock-service配置文件</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># vim stock-service/stock-service-biz/src/main/resources/application-prod.yml </span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.20.11<span class="token punctuation">:</span>3306/tb_stock<span class="token punctuation">?</span>characterEncoding=utf<span class="token punctuation">-</span><span class="token number">8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver

<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>0.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>1.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>2.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>5.portal-service配置文件</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># vim portal-service/src/main/resources/application-prod.yml </span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>0.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>1.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>2.eureka.simple<span class="token punctuation">-</span>ms<span class="token punctuation">:</span>8080/eureka
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
······
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_4-4-将各个程序代码编译成可部署的程序"><a href="#_4-4-将各个程序代码编译成可部署的程序" class="header-anchor">#</a> 4.4.将各个程序代码编译成可部署的程序</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># mvn clean package -D maven.test.skip=true -P prod</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-3-中部署gateway网关服务"><a href="#_4-3-中部署gateway网关服务" class="header-anchor">#</a> 4.3.中部署Gateway网关服务</h3> <h4 id="_4-3-1-将gateway程序打包成docker镜像"><a href="#_4-3-1-将gateway程序打包成docker镜像" class="header-anchor">#</a> 4.3.1.将Gateway程序打包成docker镜像</h4> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 gateway-service<span class="token punctuation">]</span><span class="token comment"># docker build -t 192.168.20.11/simple-microservice/gateway-service:v1 .</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4-3-2-在k8s集群中部署gateway网关服务"><a href="#_4-3-2-在k8s集群中部署gateway网关服务" class="header-anchor">#</a> 4.3.2.在K8S集群中部署Gateway网关服务</h4> <p>所有程序的资源YAML文件都存放在/root/springcloud/simple-microservice-dev1/k8s路径。</p> <p>微服务程序的话就不需要有状态应用部署了，直接采用deployment无状态应用部署的控制器，字段配置和eureka服务的statefulset配置参数几乎是一样的，微服务的各个程序也都采用有deployment控制器去部署，每个程序的yaml文件也只有名字、使用的镜像不同，其余所有参数均一致。</p> <p>gateway是网关服务，需要配置一个ingress和service资源，将其发布在集群之外。</p> <p>字段配置和statefulset的一致，不再做注释信息</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># vim gateway-deploy.yaml</span>
<span class="token punctuation">---</span>
<span class="token comment">#ingress资源YAML</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway 
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>ms 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> gateway.jiangxl.com 
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
          <span class="token key atrule">backend</span><span class="token punctuation">:</span>
            <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> gateway
            <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">8080</span>

<span class="token punctuation">---</span>
<span class="token comment">#service资源YAML</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>ms
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">project</span><span class="token punctuation">:</span> simple
    <span class="token key atrule">app</span><span class="token punctuation">:</span> gateway

<span class="token punctuation">---</span>
<span class="token comment">#deployment资源YAML</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment 
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>ms 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>         <span class="token comment">#副本数设置1个，后续再加</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">project</span><span class="token punctuation">:</span> simple
      <span class="token key atrule">app</span><span class="token punctuation">:</span> gateway
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">project</span><span class="token punctuation">:</span> simple 
        <span class="token key atrule">app</span><span class="token punctuation">:</span> gateway
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> registry<span class="token punctuation">-</span>pull<span class="token punctuation">-</span>secret
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway
        <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.20.11/simple<span class="token punctuation">-</span>microservice/gateway<span class="token punctuation">-</span>service<span class="token punctuation">:</span>v1
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
            <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span> 
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">0.5</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 1Gi
        <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
        <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><h4 id="_4-3-3-在k8s集群中部署gateway网关服务"><a href="#_4-3-3-在k8s集群中部署gateway网关服务" class="header-anchor">#</a> 4.3.3.在K8S集群中部署Gateway网关服务</h4> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.部署网关服务
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f gateway-deploy.yaml</span>

<span class="token number">2</span>.查看gateway pod资源的状态
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pod -n simple-ms</span>
NAME                       READY   STATUS    RESTARTS   AGE
eureka-0                   <span class="token number">1</span>/1     Running   <span class="token number">1</span>          2d12h
eureka-1                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2d12h
eureka-2                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2d12h
gateway-7c687f6c45-mcwpf   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m2s

<span class="token number">3</span>.查看deployment和svc的资源状态
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy,svc -n simple-ms</span>
NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/gateway   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           17h

NAME              TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>    AGE
service/eureka    ClusterIP   None         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span>/TCP   2d13h
service/gateway   ClusterIP   <span class="token number">10.0</span>.0.188   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span>/TCP   17h

<span class="token number">4</span>.查看gateway ingress资源状态
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get ingress -n simple-ms</span>
NAME      CLASS    HOSTS                 ADDRESS      PORTS   AGE
eureka    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   eureka.jiangxl.com    <span class="token number">10.0</span>.0.107   <span class="token number">80</span>      2d13h
gateway   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   gateway.jiangxl.com   <span class="token number">10.0</span>.0.107   <span class="token number">80</span>      17h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="_4-4-编写快速部署微服务到k8s集群的脚本"><a href="#_4-4-编写快速部署微服务到k8s集群的脚本" class="header-anchor">#</a> 4.4.编写快速部署微服务到K8S集群的脚本</h3> <p>由于微服务程序众多，并且每个程序在K8S集群部署的流程也基本一样，因此我们编写一个部署脚本，只要准备好程序的jar包以及资源YAML文件就可以将其一键部署到K8S集群，当前也可以通过Helm来实现。</p> <p><strong>1.脚本内容</strong></p> <p>实现逻辑：</p> <p>1.将harbor仓库的地址、所有微服务的名称、k8s yaml文件的路径、微服务代码所在的路径都定义成环境变量。</p> <p>2.如果只想部署其中一个微服务的话，通过位置传参的方式来实现，也就是再定义一个微服务名称的变量，变量值为KaTeX parse error: Expected '}', got 'EOF' at end of input: {1:-{service_list}}，将要部署的微服务名称通过位置传参的方式，将值传入到service_list变量名里，覆盖原service_list变量值，实现单个微服务的部署，如果没有使用位置参数，那么默认部署全部的微服务。</p> <p>3.进入微服务代码所在的路径。然后通过for循环的方式，遍历service_list变量中的各个微服务，然后本次循环的微服务代码路径，判断是否有包含biz的目录，如果有biz目录则切入到biz目录，然后通过变量的形式定义镜像名称，构建镜像、推送至镜像仓库。</p> <p>4.将最新打包好的docker进在yaml文件中通过sed命令替换，最后在k8s集群中部署这个微服务。</p> <p><code>${1:-${service_list}}</code>：这个的意思就是如果<code>$1</code>位置参数没有传入值，那么service_list变量的值就是<code>$service_list</code>变量的值，相当于一个判断。</p> <p>本脚本可以自动化完成微服务到K8S集群的一个部署，包括程序的编译、打包成docker镜像、推荐镜像到Harbor仓库，最后将程序部署到K8S集群</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">registry_addr</span><span class="token operator">=</span><span class="token number">192.168</span>.20.11
<span class="token assign-left variable">service_list</span><span class="token operator">=</span><span class="token string">&quot;eureka-service gateway-service order-service product-service stock-service portal-service&quot;</span>
<span class="token assign-left variable">service_list</span><span class="token operator">=</span><span class="token variable">${1<span class="token operator">:-</span>${service_list}</span><span class="token punctuation">}</span>      
<span class="token assign-left variable">current_dir</span><span class="token operator">=</span>/root/springcloud/simple-microservice-dev1/k8s
<span class="token assign-left variable">service_dir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> $current_dir<span class="token variable">)</span></span>

<span class="token builtin class-name">cd</span> <span class="token variable">$service_dir</span>
<span class="token comment">#mvn clean package -Dmaven.test.skip=true</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">service</span> <span class="token keyword">in</span> <span class="token variable">$service_list</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
   <span class="token builtin class-name">cd</span> <span class="token variable">$service_dir</span>/<span class="token variable">$service</span>
   <span class="token assign-left variable">biz_count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">grep</span> biz <span class="token operator">|</span> <span class="token function">wc</span> -l<span class="token variable">`</span></span>
   <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$biz_count</span> -eq <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
      <span class="token builtin class-name">cd</span> <span class="token variable">${service}</span>-biz
   <span class="token keyword">fi</span>
   <span class="token assign-left variable">service_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $service <span class="token operator">|</span> <span class="token function">awk</span> -F- <span class="token string">'{print $1}'</span><span class="token variable">`</span></span>
   <span class="token assign-left variable">image_name</span><span class="token operator">=</span><span class="token variable">${registry_addr}</span>/simple-microservice/<span class="token variable">${service}</span>:v1
   <span class="token assign-left variable">yaml_name</span><span class="token operator">=</span><span class="token variable">${service_name}</span>-deploy.yaml
   <span class="token function">docker</span> build -t <span class="token variable">${image_name}</span> <span class="token builtin class-name">.</span>
   <span class="token function">docker</span> push <span class="token variable">${image_name}</span>
   <span class="token function">sed</span> -i -r <span class="token string">&quot;s#(image: )(.*)#<span class="token entity" title="\1">\1</span><span class="token variable">$image_name</span>#&quot;</span> <span class="token variable">${current_dir}</span>/<span class="token variable">${yaml_name}</span>
   kubectl apply -f <span class="token variable">${current_dir}</span>/<span class="token variable">${yaml_name}</span>
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>2.脚本使用方式</strong></p> <p>执行本脚本前提是必须先将程序部署的YAML文件准备好，放在/root/springcloud/simple-microservice-dev1/k8s路径</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>脚本的用法：
<span class="token function">sh</span> deploy_k8s.sh 微服务名称
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_4-5-使用脚本部署order订单服务"><a href="#_4-5-使用脚本部署order订单服务" class="header-anchor">#</a> 4.5.使用脚本部署Order订单服务</h3> <h4 id="_4-5-1-编写资源部署yaml文件"><a href="#_4-5-1-编写资源部署yaml文件" class="header-anchor">#</a> 4.5.1.编写资源部署YAML文件</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># vim order-deploy.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment 
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> order
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>ms 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">project</span><span class="token punctuation">:</span> simple
      <span class="token key atrule">app</span><span class="token punctuation">:</span> order
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">project</span><span class="token punctuation">:</span> simple 
        <span class="token key atrule">app</span><span class="token punctuation">:</span> order
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> registry<span class="token punctuation">-</span>pull<span class="token punctuation">-</span>secret
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> order
        <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.20.11/simple<span class="token punctuation">-</span>microservice/order<span class="token punctuation">-</span>service<span class="token punctuation">:</span>v1
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
            <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span> 
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">0.5</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 1Gi
        <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
        <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h4 id="_4-5-2在k8s集群中部署order订单服务"><a href="#_4-5-2在k8s集群中部署order订单服务" class="header-anchor">#</a> 4.5.2在K8S集群中部署Order订单服务</h4> <p><strong>1.使用脚本将Order服务部署到K8S集群</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># sh deploy_k8s.sh order-service</span>

执行完脚本，order程序的docker镜像已经制作好并且推送到了harbor仓库，已经使用sed命令将镜像的名称在yaml中替换成了最新的镜像，部署到了K8S集群
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/be81d4ca75f14ea1afd933b7e4f34ea5.png" alt="在这里插入图片描述"></p> <p><strong>2.查看程序资源的状态</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.查看pod的状态
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get all -n simple-ms</span>
NAME                          READY   STATUS    RESTARTS   AGE
pod/eureka-0                  <span class="token number">1</span>/1     Running   <span class="token number">1</span>          2d15h
pod/eureka-1                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2d15h
pod/eureka-2                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2d15h
pod/gateway-8665d5d56-tx2m8   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          39m
pod/order-6694f4c474-cp5d6    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          35m

<span class="token number">2</span>.查看deployment资源的状态
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy -n simple-ms</span>
NAME      READY   UP-TO-DATE   AVAILABLE   AGE
gateway   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           21h
order     <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           36m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_4-6-使用脚本部署product商品服务"><a href="#_4-6-使用脚本部署product商品服务" class="header-anchor">#</a> 4.6.使用脚本部署Product商品服务</h3> <h4 id="_4-6-1-编写资源部署yaml文件"><a href="#_4-6-1-编写资源部署yaml文件" class="header-anchor">#</a> 4.6.1.编写资源部署YAML文件</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># vim product-deploy.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment 
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> product
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>ms 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">project</span><span class="token punctuation">:</span> simple
      <span class="token key atrule">app</span><span class="token punctuation">:</span> product
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">project</span><span class="token punctuation">:</span> simple 
        <span class="token key atrule">app</span><span class="token punctuation">:</span> product
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> registry<span class="token punctuation">-</span>pull<span class="token punctuation">-</span>secret
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> product
        <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.20.11/simple<span class="token punctuation">-</span>microservice/product<span class="token punctuation">-</span>service<span class="token punctuation">:</span>v1
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
            <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span> 
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">0.5</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 1Gi
        <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
        <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h4 id="_4-6-2-在k8s集群中熟不熟product商品服务"><a href="#_4-6-2-在k8s集群中熟不熟product商品服务" class="header-anchor">#</a> 4.6.2.在K8S集群中熟不熟Product商品服务</h4> <p><strong>1.使用脚本在K8S集群中部署product服务</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># sh deploy_k8s.sh product-service</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/72e772fd74a1497188734a6e1fd3d28e.png" alt="在这里插入图片描述"></p> <p><strong>2.查看程序资源的状态</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.查看pod的状态
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pod -n simple-ms</span>
NAME                       READY   STATUS    RESTARTS   AGE
eureka-1                   <span class="token number">1</span>/1     Running   <span class="token number">3</span>          2d16h
eureka-2                   <span class="token number">1</span>/1     Running   <span class="token number">2</span>          2d16h
gateway-8665d5d56-tx2m8    <span class="token number">1</span>/1     Running   <span class="token number">2</span>          74m
order-6694f4c474-cp5d6     <span class="token number">1</span>/1     Running   <span class="token number">4</span>          69m
product-77c8bb6847-vbxnr   <span class="token number">1</span>/1     Running   <span class="token number">2</span>          21m

<span class="token number">2</span>.查看deployment资源的状态
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy -n simple-ms</span>
NAME      READY   UP-TO-DATE   AVAILABLE   AGE
gateway   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           21h
order     <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           72m
product   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           24m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_4-7-使用脚本部署stock库存服务"><a href="#_4-7-使用脚本部署stock库存服务" class="header-anchor">#</a> 4.7.使用脚本部署Stock库存服务</h3> <h4 id="_4-7-1-编写资源部署yaml文件"><a href="#_4-7-1-编写资源部署yaml文件" class="header-anchor">#</a> 4.7.1.编写资源部署YAML文件</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># vim product-deploy.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment 
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> product
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>ms 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">project</span><span class="token punctuation">:</span> simple
      <span class="token key atrule">app</span><span class="token punctuation">:</span> product
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">project</span><span class="token punctuation">:</span> simple 
        <span class="token key atrule">app</span><span class="token punctuation">:</span> product
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> registry<span class="token punctuation">-</span>pull<span class="token punctuation">-</span>secret
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> product
        <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.20.11/simple<span class="token punctuation">-</span>microservice/product<span class="token punctuation">-</span>service<span class="token punctuation">:</span>v1
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
            <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span> 
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">0.5</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 1Gi
        <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
        <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h4 id="_4-7-2-在k8s集群中部署stock库存服务"><a href="#_4-7-2-在k8s集群中部署stock库存服务" class="header-anchor">#</a> 4.7.2.在K8S集群中部署Stock库存服务</h4> <p><strong>1.使用脚本在K8S集群中部署stock服务</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># sh deploy_k8s.sh stock-service</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/34720b14a59e4d8e97e5d887beff8a9d.png" alt="在这里插入图片描述"></p> <p><strong>2.查看程序资源的状态</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.查看pod的状态
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pod -n simple-ms</span>
NAME                       READY   STATUS    RESTARTS   AGE
eureka-0                   <span class="token number">1</span>/1     Running   <span class="token number">5</span>          2d16h
eureka-1                   <span class="token number">1</span>/1     Running   <span class="token number">3</span>          2d16h
eureka-2                   <span class="token number">1</span>/1     Running   <span class="token number">2</span>          2d16h
gateway-8665d5d56-tx2m8    <span class="token number">1</span>/1     Running   <span class="token number">2</span>          112m
order-6694f4c474-cp5d6     <span class="token number">1</span>/1     Running   <span class="token number">4</span>          107m
product-77c8bb6847-vbxnr   <span class="token number">1</span>/1     Running   <span class="token number">2</span>          59m
stock-6cf98bb445-mxf7b     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          30m

<span class="token number">2</span>.查看deployment资源的状态
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy -n simple-ms</span>
NAME      READY   UP-TO-DATE   AVAILABLE   AGE
gateway   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           22h
order     <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           108m
product   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           60m
stock     <span class="token number">2</span>/2     <span class="token number">2</span>            <span class="token number">2</span>           31m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_4-8-使用脚本部署portal前端首页"><a href="#_4-8-使用脚本部署portal前端首页" class="header-anchor">#</a> 4.8.使用脚本部署Portal前端首页</h3> <h4 id="_4-8-1-编写资源部署yaml文件"><a href="#_4-8-1-编写资源部署yaml文件" class="header-anchor">#</a> 4.8.1.编写资源部署YAML文件</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># vim portal-deploy.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> portal 
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>ms 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> portal.jiangxl.com 
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
          <span class="token key atrule">backend</span><span class="token punctuation">:</span>
            <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> portal 
            <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> portal
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>ms
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> portal 
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">project</span><span class="token punctuation">:</span> simple
    <span class="token key atrule">app</span><span class="token punctuation">:</span> portal
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment 
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> portal
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>ms 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">project</span><span class="token punctuation">:</span> simple
      <span class="token key atrule">app</span><span class="token punctuation">:</span> portal
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">project</span><span class="token punctuation">:</span> simple 
        <span class="token key atrule">app</span><span class="token punctuation">:</span> portal
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> registry<span class="token punctuation">-</span>pull<span class="token punctuation">-</span>secret
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> portal
        <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.20.11/simple<span class="token punctuation">-</span>microservice/portal<span class="token punctuation">-</span>service<span class="token punctuation">:</span>v1
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
            <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span> 
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">0.5</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 1Gi
        <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
        <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><h4 id="_4-8-2-在k8s集群中熟不熟portal存服务"><a href="#_4-8-2-在k8s集群中熟不熟portal存服务" class="header-anchor">#</a> 4.8.2.在K8S集群中熟不熟Portal存服务</h4> <p><strong>1.使用脚本在K8S集群中部署portal服务</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># sh deploy_k8s.sh portal-service</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/c452fabffdb24a97b0ec5dbfc8dbe6b5.png" alt="在这里插入图片描述"></p> <p><strong>2.查看程序资源的状态</strong></p> <p>到此为止，所有的simple电商平台的微服务程序以及全部部署完毕。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>.查看所有微服务的程序
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get all -n simple-ms</span>
NAME                           READY   STATUS    RESTARTS   AGE
pod/eureka-0                   <span class="token number">1</span>/1     Running   <span class="token number">5</span>          2d16h
pod/eureka-1                   <span class="token number">1</span>/1     Running   <span class="token number">3</span>          2d16h
pod/eureka-2                   <span class="token number">1</span>/1     Running   <span class="token number">2</span>          2d16h
pod/gateway-8665d5d56-tx2m8    <span class="token number">1</span>/1     Running   <span class="token number">2</span>          117m
pod/order-6694f4c474-cp5d6     <span class="token number">1</span>/1     Running   <span class="token number">4</span>          112m
pod/portal-d5d55b784-7kntp     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m53s
pod/product-77c8bb6847-vbxnr   <span class="token number">1</span>/1     Running   <span class="token number">2</span>          64m
pod/stock-6cf98bb445-mxf7b     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          35m

NAME              TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>    AGE
service/eureka    ClusterIP   None         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span>/TCP   2d18h
service/gateway   ClusterIP   <span class="token number">10.0</span>.0.188   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span>/TCP   22h
service/portal    ClusterIP   <span class="token number">10.0</span>.0.190   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span>/TCP   2m53s

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/gateway   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           22h
deployment.apps/order     <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           112m
deployment.apps/portal    <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           2m53s
deployment.apps/product   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           65m
deployment.apps/stock     <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           35m

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/gateway-8665d5d56    <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       117m
replicaset.apps/order-6694f4c474     <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       112m
replicaset.apps/portal-d5d55b784     <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       2m53s
replicaset.apps/product-77c8bb6847   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       64m
replicaset.apps/stock-6cf98bb445     <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       35m

NAME                      READY   AGE
statefulset.apps/eureka   <span class="token number">3</span>/3     2d18h

<span class="token number">2</span>.查看所有微服务的ingress资源
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get ingress -n simple-ms</span>
NAME      CLASS    HOSTS                 ADDRESS      PORTS   AGE
eureka    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   eureka.jiangxl.com    <span class="token number">10.0</span>.0.107   <span class="token number">80</span>      2d18h
gateway   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   gateway.jiangxl.com   <span class="token number">10.0</span>.0.107   <span class="token number">80</span>      22h
portal    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   portal.jiangxl.com    <span class="token number">10.0</span>.0.107   <span class="token number">80</span>      3m16s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="_4-9-查看eureka注册中心中各个微服务的信息"><a href="#_4-9-查看eureka注册中心中各个微服务的信息" class="header-anchor">#</a> 4.9.查看Eureka注册中心中各个微服务的信息</h3> <p>每个微服务程序均在Eureka注册中心中注册完成。</p> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/feae01f050a440ed92aa5f948efd875f.png" alt="在这里插入图片描述"></p> <h3 id="_4-10-使用simple微服务电商平台"><a href="#_4-10-使用simple微服务电商平台" class="header-anchor">#</a> 4.10.使用simple微服务电商平台</h3> <p>到4.8步骤之后，我们的simple微服务电商平台已经全部部署在K8S集群了，可以在本机hosts里绑定simple微服务的域名，操作电商平台。</p> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/11d0320836a54e1b96d6e6801bdb9f8b.png" alt="在这里插入图片描述"></p> <p>这个微服务平台的背景图其实是京东的一张图而已，是不可以点的。</p> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/5de80a8717554409af8d9a14b6462e30.png" alt="在这里插入图片描述"></p> <p>只能在商品服务中查询能购买的商品，然后进行购买，最后在订单服务中查询。</p> <p>搜索商品时会调用product商品微服务，下单后，查询订单服务时会调用order订单服务。</p> <p>点击查询商品服务，我们来下单一个美女观察一下效果，下单后会提示下单成功。</p> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/2776324a762543f5a9df8fc3fc0f6e19.png" alt="在这里插入图片描述"></p> <p>点击查询订单服务就可以看到我吗下的订单了</p> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/91eee91044a3497986b5f0f788a95738.png" alt="在这里插入图片描述"></p> <h2 id="_5-基于k8s集群的微服务的扩容与升级"><a href="#_5-基于k8s集群的微服务的扩容与升级" class="header-anchor">#</a> 5.基于K8S集群的微服务的扩容与升级</h2> <h3 id="_5-1-微服务的扩容"><a href="#_5-1-微服务的扩容" class="header-anchor">#</a> 5.1.微服务的扩容</h3> <p>微服务在物理机环境运行时，网站并发量高的情况下，扩容只能去购买云服务器，然后搭建一套一模一样的服务，手动组成负载均衡集群，增加一台其实还好，如果要增加几十台，太费人工成本了。</p> <p>当微服务迁移到K8S集群之后，扩容其实变得非常简单，只需要增加程序Pod的副本数就可以完成程序的扩容。</p> <p>命令如下，以扩展order商品微服务为例。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>将order商品服务的副本数调整为3个，原本是1个，现在扩容到3个
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl scale deploy order --replicas=3 -n simple-ms</span>
deployment.apps/order scaled

可以看到order订单服务目前已经有3个pod副本了
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pod -n simple-ms</span>
NAME                       READY   STATUS    RESTARTS   AGE
eureka-0                   <span class="token number">1</span>/1     Running   <span class="token number">1</span>          6m15s
eureka-1                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          7m59s
eureka-2                   <span class="token number">1</span>/1     Running   <span class="token number">1</span>          9m40s
gateway-848874fc9d-pwp9w   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          48m
order-6694f4c474-cp5d6     <span class="token number">1</span>/1     Running   <span class="token number">4</span>          3h29m
order-6694f4c474-kh8hm     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          96s
order-6694f4c474-rg7kw     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          96s
portal-6fdcd765bd-mtq68    <span class="token number">1</span>/1     Running   <span class="token number">1</span>          24m
product-784d9f77b5-rxsf2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          64m
stock-6cf98bb445-l8gxb     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          133m

缩容也很简单，将order的副本数缩减成1个
<span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl scale deploy order --replicas=1 -n simple-ms</span>
deployment.apps/order scaled

成功缩减到1个副本
<span class="token punctuation">[</span>root@binary-k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pod -n simple-ms</span>
NAME                       READY   STATUS    RESTARTS   AGE
eureka-0                   <span class="token number">1</span>/1     Running   <span class="token number">1</span>          9m24s
eureka-1                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          11m
eureka-2                   <span class="token number">1</span>/1     Running   <span class="token number">1</span>          12m
gateway-848874fc9d-pwp9w   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          51m
order-6694f4c474-rg7kw     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4m45s
portal-6fdcd765bd-mtq68    <span class="token number">1</span>/1     Running   <span class="token number">1</span>          27m
product-784d9f77b5-rxsf2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          67m
stock-6cf98bb445-l8gxb     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          136m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="_5-2-微服务的升级"><a href="#_5-2-微服务的升级" class="header-anchor">#</a> 5.2.微服务的升级</h3> <p>微服务在物理机环境更新时只需要拉取最新的代码，编译成jar包，在服务器上部署就可以了，但是微服务迁移到K8S集群之后，更新过程就变得比较复杂了，首先更新的代码，然后编译成jar包，再通过Dockerfile将jar包做成docker镜像，然后在k8s集群中部署，当然这些流程可以通过Jenkins实现自动化上线。</p> <h4 id="_5-2-1-微调portal前端首页的代码"><a href="#_5-2-1-微调portal前端首页的代码" class="header-anchor">#</a> 5.2.1.微调Portal前端首页的代码</h4> <p>将平台的这些文件修改成jiangxl.com的内容完成一次portal前端首页的升级</p> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/6fff8cf3680744d9bd8f4340015acf60.png" alt="在这里插入图片描述"></p> <p>首先找到记录这些文字的文件</p> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/c8b660cdf01f4e92aed03aa0005f48a4.png" alt="在这里插入图片描述"></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># vim templates/index.ftl</span>
<span class="token comment"># vim templates/orderList.ftl </span>
<span class="token comment"># vim templates/productList.ftl</span>

进入文件后在末行模式输入：
%s/容器学院 www.ctnrs.com/jiangxl.com/g
%s/www.ctnrs.com/jiangxl.com/g
然后将所有的容器学院的文字删除
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_5-2-2-编译最新代码"><a href="#_5-2-2-编译最新代码" class="header-anchor">#</a> 5.2.2.编译最新代码</h4> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 simple-microservice-dev1<span class="token punctuation">]</span><span class="token comment"># mvn clean package -D maven.test.skip=true -P prod</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_5-2-3-通过脚本将protal最新代码打包成镜像"><a href="#_5-2-3-通过脚本将protal最新代码打包成镜像" class="header-anchor">#</a> 5.2.3.通过脚本将Protal最新代码打包成镜像</h4> <p>直接使用前面部署程序的脚本即可</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># sh deploy_k8s.sh portal-service</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_5-2-4-升级k8s集群中的protal微服务"><a href="#_5-2-4-升级k8s集群中的protal微服务" class="header-anchor">#</a> 5.2.4.升级K8S集群中的Protal微服务</h4> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@binary-k8s-master1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl -n simple-ms set image deployment portal portal=192.168.20.11/simple-microservice/portal-service:v1 --record</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>程序更新完成后刷新页面就可以看到我们更新的页面内容</p> <p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASmlhbmd4bH4=,size_20,color_FFFFFF,t_70,g_se,x_16.png" alt="在这里插入图片描述"></p></div> <footer class="page-edit" style="display:none;"><div class="edit-link"><a href="https://github.com/AGou-ops/myDocsv2/edit/master/docs/k8s/实战案例/SpringCloud微服务电商系统在Kubernetes集群中上线详细教程.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2022/06/01, 14:44:58</span></div></footer> <!----> <!----> <div class="article-list" data-v-2af88190><div class="article-title" data-v-2af88190><a href="/myDocsv2/timeline/" class="iconfont icon-shizhong" data-v-2af88190>最近更新</a></div> <div class="article-wrapper" data-v-2af88190><dl data-v-2af88190><dd data-v-2af88190>01</dd> <dt data-v-2af88190><a href="/myDocsv2/timeline/2022-03-09.html" data-v-2af88190><div data-v-2af88190>生命短暂，犹如露珠消散，人们在奔波中寻求答案。</div></a> <span data-v-2af88190>03-09</span></dt></dl><dl data-v-2af88190><dd data-v-2af88190>02</dd> <dt data-v-2af88190><a href="/myDocsv2/timeline/2018-05-06.html" data-v-2af88190><div data-v-2af88190>人生天地之间，若白驹过隙，忽然而已。</div></a> <span data-v-2af88190>05-06</span></dt></dl></div> <div data-v-2af88190><a href="/myDocsv2/timeline/" class="article-more" data-v-2af88190>更多文章 &gt;</a></div></div></main> <!----> <div class="comments-wrapper" data-v-584a622c><div class="valine-wrapper"><div id="valine"></div></div></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div><!----><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 AGou's Docs-v2
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><div></div><!----><div data-v-3338c3f8><div class="DetailsOpenFlag" style="right:1rem;bottom:9rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;font-size:14px;font-weight:500;display:none;" data-v-3338c3f8>
 展开

</div></div></div></div>
    <script src="/myDocsv2/assets/js/app.792c833e.js" defer></script><script src="/myDocsv2/assets/js/5.dd197eb6.js" defer></script><script src="/myDocsv2/assets/js/1.3bd7010a.js" defer></script><script src="/myDocsv2/assets/js/2.0c757b52.js" defer></script><script src="/myDocsv2/assets/js/78.82d49b8f.js" defer></script><script src="/myDocsv2/assets/js/17.ce9a229a.js" defer></script>
  </body>
</html>
