(window.webpackJsonp=window.webpackJsonp||[]).push([[177],{809:function(a,s,t){"use strict";t.r(s);var e=t(6),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"grafana-loki"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#grafana-loki"}},[a._v("#")]),a._v(" Grafana Loki")]),a._v(" "),t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[a._v("#")]),a._v(" 简介")]),a._v(" "),t("p",[a._v("Loki 是 Grafana Labs 团队最新的开源项目，是一个水平可扩展，高可用性，多租户的日志聚合系统。它的设计非常经济高效且易于操作，因为它不会为日志内容编制索引，而是为每个日志流配置一组标签。项目受 Prometheus 启发，官方的介绍就是："),t("code",[a._v("Like Prometheus, but for logs")]),a._v("，类似于 Prometheus 的日志系统。")]),a._v(" "),t("h2",{attrs:{id:"loki-架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#loki-架构"}},[a._v("#")]),a._v(" Loki 架构")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://banzaicloud.com/img/blog/k8s-logging-loki/loki_architecutre.png",alt:"Loki Arch"}})]),a._v(" "),t("ul",[t("li",[t("code",[a._v("Distributor")]),a._v(": 负责客户端处理传入的数据流。这是日志数据写入路径中的第一站。分发者收到一组流后，将验证每个流的正确性并确保其在配置的租户（或全局）限制之内。然后，将有效块拆分为多个批次 ，并并行发送到多个ingester。")]),a._v(" "),t("li",[t("code",[a._v("Ingester")]),a._v(": 负责将路径上的日志数据写入到长期存储后端（DynamoDB，S3，Cassandra等）并返回日志数据在内存中查询读取路径上。")]),a._v(" "),t("li",[t("code",[a._v("Querier")]),a._v(": 查询器服务处理查询使用LogQL查询语言,抓取日志ingesters和长期存储。")]),a._v(" "),t("li",[t("code",[a._v("index")]),a._v("&"),t("code",[a._v("chunks")]),a._v(": Loki分成两种存储，一种叫Index(索引)，一种叫Chunk(块)。通过命名可以很清晰地明白index为日志的索引存储，而Chunk为日志的内容存储。查询的时候是按照先找索引再找到具体的chunk存储。")])]),a._v(" "),t("h2",{attrs:{id:"loki-部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#loki-部署"}},[a._v("#")]),a._v(" Loki 部署")]),a._v(" "),t("h3",{attrs:{id:"install-loki-with-docker-or-docker-compose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-loki-with-docker-or-docker-compose"}},[a._v("#")]),a._v(" install Loki with Docker or Docker-compose")]),a._v(" "),t("p",[a._v("详情参考: https://grafana.com/docs/loki/latest/installation/docker/")]),a._v(" "),t("p",[a._v("以下仅记录关键命令:")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用docker")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://raw.githubusercontent.com/grafana/loki/v1.6.0/cmd/loki/loki-local-config.yaml -O loki-config.yaml\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run -v "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(":/mnt/config -p "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3100")]),a._v(":3100 grafana/loki:1.6.0 -config.file"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/mnt/config/loki-config.yaml\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://raw.githubusercontent.com/grafana/loki/v1.6.0/cmd/promtail/promtail-docker-config.yaml -O promtail-config.yaml\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run -v "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(":/mnt/config -v /var/log:/var/log grafana/promtail:1.6.0 -config.file"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/mnt/config/promtail-config.yaml\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用docker-compose")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://raw.githubusercontent.com/grafana/loki/v1.6.0/production/docker-compose.yaml -O docker-compose.yaml\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" -f docker-compose.yaml up\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br")])]),t("p",[a._v("安装完成之后打开浏览器访问: http://localhost:3000 进入"),t("code",[a._v("Grafana")]),a._v("面板, 输入默认账号密码"),t("code",[a._v("admin/admin")]),a._v(".")]),a._v(" "),t("h4",{attrs:{id:"添加loki数据源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加loki数据源"}},[a._v("#")]),a._v(" 添加"),t("code",[a._v("Loki")]),a._v("数据源:")]),a._v(" "),t("ol",[t("li",[a._v("打开"),t("code",[a._v("Grafana UI")]),a._v("并登录, 依次点击")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/loki/add%20loki%20data%20source-1.png",alt:""}})]),a._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[a._v("在列表中找到"),t("code",[a._v("Loki")]),a._v("并点击")]),a._v(" "),t("li",[a._v("添加URL为"),t("code",[a._v("http://localhost:3100")]),a._v("(如果使用的是"),t("code",[a._v("docker-compose")]),a._v("部署, 则需要填写的URL为"),t("code",[a._v("http://loki:3100")]),a._v("), 然后点击"),t("code",[a._v("Save & Test")]),a._v("即可")]),a._v(" "),t("li",[a._v("点击左侧列表中的"),t("code",[a._v("Explore")]),a._v(", 选择一个数据流")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/loki/add%20loki%20data%20source-2.png",alt:""}})]),a._v(" "),t("h3",{attrs:{id:"install-loki-with-helm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-loki-with-helm"}},[a._v("#")]),a._v(" install Loki with Helm")]),a._v(" "),t("p",[a._v("详情参考: https://grafana.com/docs/loki/latest/installation/helm/")]),a._v(" "),t("p",[a._v("以下仅记录关键命令:")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 添加loki仓库")]),a._v("\nhelm repo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" loki https://grafana.github.io/loki/charts\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 升级仓库")]),a._v("\nhelm repo update\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Deploy in a custom namespace")]),a._v("\nhelm upgrade --install loki --namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("loki loki/loki\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Deploy Loki Stack (Loki, Promtail, Grafana, Prometheus) with persistent volume claim")]),a._v("\nhelm upgrade --install loki loki/loki-stack  --set grafana.enabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true,prometheus.enabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true,prometheus.alertmanager.persistentVolume.enabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false,prometheus.server.persistentVolume.enabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false,loki.persistence.enabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true,loki.persistence.storageClassName"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("standard,loki.persistence.size"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("5Gi\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Deploy Grafana to your cluster")]),a._v("\nhelm "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" stable/grafana -n loki-grafana\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 获取grafana密码")]),a._v("\nkubectl get secret --namespace "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("YOUR-NAMESPACE"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" loki-grafana -o "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"{.data.admin-password}"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" base64 --decode "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 运行grafana UI")]),a._v("\nkubectl port-forward --namespace "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("YOUR-NAMESPACE"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" service/loki-grafana "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3000")]),a._v(":80\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br")])]),t("p",[a._v("随后打开浏览器访问: http://localhost:3000")]),a._v(" "),t("h2",{attrs:{id:"示例promtail文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#示例promtail文件"}},[a._v("#")]),a._v(" 示例"),t("code",[a._v("promtail")]),a._v("文件")]),a._v(" "),t("p",[a._v("静态标签指定:")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[a._v("$ cat promtail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("config.yaml\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("http_listen_port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9080")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("grpc_listen_port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("positions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("filename")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /tmp/positions.yaml\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("clients")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//loki"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3100/loki/api/v1/push\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("scrape_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" system\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" localhost\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 标签, 重要.")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" varlogs\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("__path__")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /var/log/"),t("span",{pre:!0,attrs:{class:"token important"}},[a._v("*log")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br")])]),t("p",[a._v("使用客户端命令"),t("code",[a._v("promtail")]),a._v("传送日志到"),t("code",[a._v("loki")]),a._v(": "),t("code",[a._v("promtail -config.file=promtail-local-config.yaml")])]),a._v(" "),t("p",[a._v("动态标签定义:")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("...")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用pipeline_stages")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" system\n   "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("pipeline_stages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("regex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("expression")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"^(?P<ip>\\\\S+) (?P<identd>\\\\S+) (?P<user>\\\\S+) \\\\[(?P<timestamp>[\\\\w:/]+\\\\s[+\\\\-]\\\\d{4})\\\\] \\"(?P<action>\\\\S+)\\\\s?(?P<path>\\\\S+)?\\\\s?(?P<protocol>\\\\S+)?\\" (?P<status_code>\\\\d{3}|-) (?P<size>\\\\d+|-)\\\\s?\\"?(?P<referer>[^\\"]*)\\"?\\\\s?\\"?(?P<useragent>[^\\"]*)?\\"?$"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("action")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("status_code")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" localhost\n     "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" apache\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("env")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("__path__")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /var/log/apache.log\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br")])]),t("h2",{attrs:{id:"logql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#logql"}},[a._v("#")]),a._v(" LogQL")]),a._v(" "),t("p",[a._v("Log Query Language, 用于查询和筛选"),t("code",[a._v("grafana loki")]),a._v("数据.")]),a._v(" "),t("blockquote",[t("p",[a._v("​\t"),t("strong",[a._v("Log Stream Selector")])]),a._v(" "),t("ul",[t("li",[t("code",[a._v("=")]),a._v(": exactly equal.")]),a._v(" "),t("li",[t("code",[a._v("!=")]),a._v(": not equal.")]),a._v(" "),t("li",[t("code",[a._v("=~")]),a._v(": regex matches.")]),a._v(" "),t("li",[t("code",[a._v("!~")]),a._v(": regex does not match.")])]),a._v(" "),t("p",[a._v("Examples:")]),a._v(" "),t("ul",[t("li",[t("code",[a._v('{name=~"mysql.+"}')])]),a._v(" "),t("li",[t("code",[a._v('{name!~"mysql.+"}')])]),a._v(" "),t("li",[t("code",[a._v("{name!~")]),a._v("mysql-\\d+"),t("code",[a._v("}")])])]),a._v(" "),t("p",[t("strong",[a._v("Filter Expression")])]),a._v(" "),t("ul",[t("li",[t("code",[a._v("|=")]),a._v(": Log line contains string.")]),a._v(" "),t("li",[t("code",[a._v("!=")]),a._v(": Log line does not contain string.")]),a._v(" "),t("li",[t("code",[a._v("|~")]),a._v(": Log line matches regular expression.")]),a._v(" "),t("li",[t("code",[a._v("!~")]),a._v(": Log line does not match regular expression.")])]),a._v(" "),t("p",[a._v("Examples:")]),a._v(" "),t("ul",[t("li",[t("p",[t("code",[a._v('{filename="/var/log/nginx/access.log"} |= "404"')]),a._v(": 查找有关"),t("code",[a._v("404")]),a._v("的日志信息")])]),a._v(" "),t("li",[t("p",[t("code",[a._v('{filename="/var/log/nginx/access.log"} |~ "Mozilla/5.0.*"')]),a._v(": 使用正则表达式;")])]),a._v(" "),t("li",[t("p",[t("code",[a._v("rate")]),a._v(": calculates the number of entries per second")])]),a._v(" "),t("li",[t("p",[t("code",[a._v("count_over_time")]),a._v(": counts the entries for each log stream within the given range.")])]),a._v(" "),t("li",[t("p",[t("code",[a._v("bytes_rate")]),a._v(": calculates the number of bytes per second for each stream.")])]),a._v(" "),t("li",[t("p",[t("code",[a._v("bytes_over_time")]),a._v(": counts the amount of bytes used by each log stream for a given range.")])])]),a._v(" "),t("h4",{attrs:{id:"examples"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#examples"}},[a._v("#")]),a._v(" Examples")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('count_over_time({job="mysql"}[5m])\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])])]),a._v(" "),t("h2",{attrs:{id:"lokicli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lokicli"}},[a._v("#")]),a._v(" Lokicli")]),a._v(" "),t("p",[a._v("使用命令行查看 LOGS")]),a._v(" "),t("p",[a._v("参考: https://grafana.com/docs/loki/latest/getting-started/logcli/")]),a._v(" "),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[a._v("#")]),a._v(" 参考链接")]),a._v(" "),t("ul",[t("li",[a._v("Loki Arch: https://grafana.com/docs/loki/latest/architecture/")]),a._v(" "),t("li",[a._v("Loki installation: https://grafana.com/docs/loki/latest/installation/")]),a._v(" "),t("li",[a._v("promtail pipelines: https://grafana.com/docs/loki/latest/clients/promtail/pipelines/")]),a._v(" "),t("li",[a._v("promtail configuration: https://grafana.com/docs/loki/latest/clients/promtail/configuration/")]),a._v(" "),t("li",[a._v("LogQL: https://grafana.com/docs/loki/latest/logql/#logql-log-query-language")])])])}),[],!1,null,null,null);s.default=n.exports}}]);