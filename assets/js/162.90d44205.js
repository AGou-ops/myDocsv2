(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{794:function(a,s,t){"use strict";t.r(s);var e=t(6),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("Helm使用的包格式称为 "),t("em",[a._v("charts")]),a._v("。 chart就是一个描述Kubernetes相关资源的文件集合。单个chart可以用来部署一些简单的，类似于memcache pod，或者某些复杂的HTTP服务器以及web全栈应用、数据库、缓存等等。")]),a._v(" "),t("p",[a._v("Chart是作为特定目录布局的文件被创建的。它们可以打包到要部署的版本存档中。")]),a._v(" "),t("p",[a._v("如果你想下载和查看一个发布的chart，但不安装它，你可以用这个命令： "),t("code",[a._v("helm pull chartrepo/chartname")]),a._v("。")]),a._v(" "),t("p",[a._v("该文档解释说明了chart格式，并提供了用Helm构建chart的基本指导。")]),a._v(" "),t("h2",{attrs:{id:"chart-文件结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chart-文件结构"}},[a._v("#")]),a._v(" Chart 文件结构")]),a._v(" "),t("p",[a._v("chart是一个组织在文件目录中的集合。目录名称就是chart名称（没有版本信息）。因而描述WordPress的chart可以存储在"),t("code",[a._v("wordpress/")]),a._v("目录中。")]),a._v(" "),t("p",[a._v("在这个目录中，Helm 期望可以匹配以下结构：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("wordpress/\n  Chart.yaml          # 包含了chart信息的YAML文件\n  LICENSE             # 可选: 包含chart许可证的纯文本文件\n  README.md           # 可选: 可读的README文件\n  values.yaml         # chart 默认的配置值\n  values.schema.json  # 可选: 一个使用JSON结构的values.yaml文件\n  charts/             # 包含chart依赖的其他chart\n  crds/               # 自定义资源的定义\n  templates/          # 模板目录， 当和values 结合时，可生成有效的Kubernetes manifest文件\n  templates/NOTES.txt # 可选: 包含简要使用说明的纯文本文件\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br")])]),t("p",[a._v("Helm保留使用 "),t("code",[a._v("charts/")]),a._v("，"),t("code",[a._v("crds/")]),a._v("， "),t("code",[a._v("templates/")]),a._v("目录，以及列举出的文件名。其他文件保持原样。")]),a._v(" "),t("h2",{attrs:{id:"chart-yaml-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chart-yaml-文件"}},[a._v("#")]),a._v(" Chart.yaml 文件")]),a._v(" "),t("p",[t("code",[a._v("Chart.yaml")]),a._v("文件是chart必需的。包含了以下字段：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" chart API 版本 （必需）\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" chart名称 （必需）\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 语义化2 版本（必需）\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kubeVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 兼容Kubernetes版本的语义化版本（可选）\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 一句话对这个项目的描述（可选）\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" chart类型 （可选）\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("keywords")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 关于项目的一组关键字（可选）\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("home")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 项目home页面的URL （可选）\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 项目源码的URL列表（可选）\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# chart 必要条件列表 （可选）")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" chart名称 (nginx)\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(' chart版本 ("1.2.3")\n    '),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(' 仓库URL ("https'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v('//example.com/charts") 或别名 ("@repo'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v('name")\n    '),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("condition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" （可选） 解析为布尔值的yaml路径，用于启用/禁用chart (e.g. subchart1.enabled )\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# （可选）")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 用于一次启用/禁用 一组chart的tag\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" （可选） 决定是否加载chart的布尔值\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("import-values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# （可选）")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ImportValue 保存源值到导入父键的映射。每项可以是字符串或者一对子/父列表项\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("alias")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" （可选） chart中使用的别名。当你要多次添加相同的chart时会很有用\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("maintainers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# （可选）")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 维护者名字 （每个维护者都需要）\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("email")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 维护者邮箱 （每个维护者可选）\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 维护者URL （每个维护者可选）\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("icon")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 用做icon的SVG或PNG图片URL （可选）\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("appVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 包含的应用版本（可选）。不需要是语义化的\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("deprecated")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 不被推荐的chart （可选，布尔值）\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("annotations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("example")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 按名称输入的批注列表 （可选）.\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br")])]),t("p",[a._v("其他字段将被忽略。")]),a._v(" "),t("h3",{attrs:{id:"chart和版本控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chart和版本控制"}},[a._v("#")]),a._v(" Chart和版本控制")]),a._v(" "),t("p",[a._v("每个chart都必须有个版本号。版本必须遵循 "),t("a",{attrs:{href:"https://semver.org/spec/v2.0.0.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("语义化版本 2"),t("OutboundLink")],1),a._v(" 标准。\n不像经典Helm， Helm v2以及后续版本会使用版本号作为发布标记。仓库中的包通过名称加版本号标识。")]),a._v(" "),t("p",[a._v("比如 "),t("code",[a._v("nginx")]),a._v(" chart的版本字段"),t("code",[a._v("version: 1.2.3")]),a._v("按照名称被设置为：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("nginx-1.2.3.tgz\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("更多复杂的语义化版本2 都是支持的，比如 "),t("code",[a._v("version: 1.2.3-alpha.1+ef365")]),a._v("。 但系统明确禁止非语义化版本名称。")]),a._v(" "),t("p",[t("strong",[a._v("注意：")]),a._v(" 鉴于经典Helm和部署管理器在使用chart时都非常倾向于GitHub，Helm v2 和后续版本不再依赖或需要GitHub甚至是Git。\n因此，它完全不使用Git SHA进行版本控制。")]),a._v(" "),t("p",[t("code",[a._v("Chart.yaml")]),a._v("文件中的"),t("code",[a._v("version")]),a._v("字段被很多Helm工具使用，包括CLI。当生成一个包时，\n"),t("code",[a._v("helm package")]),a._v("命令可以用"),t("code",[a._v("Chart.yaml")]),a._v("文件中找到的版本号作为包名中的token。\n系统假设chart包名中的版本号可以与"),t("code",[a._v("Chart.yaml")]),a._v("文件中的版本号匹配。如果不满足这一假设会导致错误。")]),a._v(" "),t("h3",{attrs:{id:"apiversion-字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#apiversion-字段"}},[a._v("#")]),a._v(" "),t("code",[a._v("apiVersion")]),a._v(" 字段")]),a._v(" "),t("p",[a._v("对于至少需要Helm 3的chart，"),t("code",[a._v("apiVersion")]),a._v(" 字段应该是 "),t("code",[a._v("v2")]),a._v("。Chart支持之前"),t("code",[a._v("apiVersion")]),a._v(" 设置为 "),t("code",[a._v("v1")]),a._v(" 的Helm 版本，\n并且在Helm 3中仍然可安装。")]),a._v(" "),t("p",[t("code",[a._v("v1")]),a._v(" 到 "),t("code",[a._v("v2")]),a._v("的改变：")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("dependencies")]),a._v("字段定义了chart的依赖，针对于"),t("code",[a._v("v1")]),a._v(" 版本的chart被放置在分隔开的"),t("code",[a._v("requirements.yaml")]),a._v(" 文件中\n（查看 "),t("a",{attrs:{href:"#chart-dependency"}},[a._v("Chart 依赖")]),a._v(").")]),a._v(" "),t("li",[t("code",[a._v("type")]),a._v("字段, 用于识别应用和库类型的chart（查看 "),t("a",{attrs:{href:"#chart-types"}},[a._v("Chart 类型")]),a._v(").")])]),a._v(" "),t("h3",{attrs:{id:"appversion-字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#appversion-字段"}},[a._v("#")]),a._v(" "),t("code",[a._v("appVersion")]),a._v(" 字段")]),a._v(" "),t("p",[a._v("注意这个 "),t("code",[a._v("appVersion")]),a._v(" 字段与 "),t("code",[a._v("version")]),a._v(" 字段无关。它是指定应用程序版本的一种方式。\n比如"),t("code",[a._v("drupal")]),a._v(" chart 可以是 "),t("code",[a._v("appVersion: 8.2.1")]),a._v("， 表示包含在chart中（默认）的Drupal 版本是 "),t("code",[a._v("8.2.1")]),a._v("。\n这个字段是信息字段，对chart版本的计算没有影响。")]),a._v(" "),t("h3",{attrs:{id:"kubeversion-字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubeversion-字段"}},[a._v("#")]),a._v(" "),t("code",[a._v("kubeVersion")]),a._v(" 字段")]),a._v(" "),t("p",[a._v("可选的 "),t("code",[a._v("kubeVersion")]),a._v(" 字段可以在支持的Kubernetes版本上定义语义化版本约束，Helm 在安装chart时会验证这个版本约束，\n并在集群运行不支持的Kubernetes版本时显示失败。")]),a._v(" "),t("p",[a._v("版本约束可以包括空格分隔和比较运算符，比如：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v(">= 1.13.0 < 1.15.0\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("或者它们可以用或操作符 "),t("code",[a._v("||")]),a._v(" 连接，比如：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v(">= 1.13.0 < 1.14.0 || >= 1.14.1 < 1.15.0\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("这个例子中排除了 "),t("code",[a._v("1.14.0")]),a._v(" 版本，如果确定某些版本中的错误导致chart无法正常运行，这一点就很有意义。")]),a._v(" "),t("p",[a._v("除了版本约束外，使用运算符 "),t("code",[a._v("=")]),a._v(" "),t("code",[a._v("!=")]),a._v(" "),t("code",[a._v(">")]),a._v(" "),t("code",[a._v("<")]),a._v(" "),t("code",[a._v(">=")]),a._v(" "),t("code",[a._v("<=")]),a._v(" 支持一下速记符号：")]),a._v(" "),t("ul",[t("li",[a._v("闭合间隔的连字符范围， "),t("code",[a._v("1.1 - 2.3.4")]),a._v(" 等价于 "),t("code",[a._v(">= 1.1 <= 2.3.4")])]),a._v(" "),t("li",[a._v("通配符 "),t("code",[a._v("x")]),a._v("， "),t("code",[a._v("X")]),a._v(" 和 "),t("code",[a._v("*")]),a._v("， "),t("code",[a._v("1.2.x")]),a._v(" 等价于 "),t("code",[a._v(">= 1.2.0 < 1.3.0")])]),a._v(" "),t("li",[a._v("波浪符号~范围 （允许改变补丁版本）， "),t("code",[a._v("~1.2.3")]),a._v(" 等价于 "),t("code",[a._v(">= 1.2.3 < 1.3.0")])]),a._v(" "),t("li",[a._v("插入符号^范围 （允许改变次版本）， "),t("code",[a._v("^1.2.3")]),a._v(" 等价于 "),t("code",[a._v(">= 1.2.3 < 2.0.0")])])]),a._v(" "),t("p",[a._v("支持的语义化版本约束的细节说明请查看 "),t("a",{attrs:{href:"https://github.com/Masterminds/semver",target:"_blank",rel:"noopener noreferrer"}},[a._v("Masterminds/semver"),t("OutboundLink")],1)]),a._v(" "),t("h3",{attrs:{id:"已弃用的chart"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#已弃用的chart"}},[a._v("#")]),a._v(" 已弃用的Chart")]),a._v(" "),t("p",[a._v("在Chart仓库管理chart时，有时需要废弃一个chart。 "),t("code",[a._v("Chart.yaml")]),a._v(" 中可选的"),t("code",[a._v("deprecated")]),a._v("字段可以用来标记已弃用的chart。\n如果"),t("strong",[a._v("latest")]),a._v("版本被标记为已弃用，则所有的chart都会被认为是已弃用的。以后可以通过发布未标记为已弃用的新版本来重新使用chart名称。"),t("a",{attrs:{href:"https://github.com/helm/charts",target:"_blank",rel:"noopener noreferrer"}},[a._v("kubernetes/charts"),t("OutboundLink")],1),a._v(" 项目遵循的弃用图标的工作流是：")]),a._v(" "),t("ol",[t("li",[a._v("升级chart的 "),t("code",[a._v("Chart.yaml")]),a._v("  文件，将这个chart标记为已弃用， 并更改版本")]),a._v(" "),t("li",[a._v("在chart仓库中发布新版的chart")]),a._v(" "),t("li",[a._v("从源仓库中移除这个chart （比如用 git）")])]),a._v(" "),t("h3",{attrs:{id:"chart-types"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chart-types"}},[a._v("#")]),a._v(" Chart Types")]),a._v(" "),t("p",[t("code",[a._v("type")]),a._v("字段定义了chart的类型。有两种类型： "),t("code",[a._v("application")]),a._v(" 和 "),t("code",[a._v("library")]),a._v("。 应用是默认类型，是可以完全操作的标准chart。\n"),t("a",{attrs:{href:"http://helm.sh/docs/topics/library_charts.md",target:"_blank",rel:"noopener noreferrer"}},[a._v("库类型 chart"),t("OutboundLink")],1),a._v(" 提供针对chart构建的实用程序和功能。\n库类型chart与应用类型chart不同，因为它不能安装，通常不包含任何资源对象。")]),a._v(" "),t("p",[t("strong",[a._v("注意：")]),a._v(" 应用类型chart 可以作为库类型chart使用。可以通过将类型设置为 "),t("code",[a._v("library")]),a._v("来实现。\n然后这个库就被渲染成了一个库类型chart，所有的实用程序和功能都可以使用。所有的资源对象不会被渲染。")]),a._v(" "),t("h2",{attrs:{id:"chart-许可证-自述和注释"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chart-许可证-自述和注释"}},[a._v("#")]),a._v(" Chart 许可证，自述和注释")]),a._v(" "),t("p",[a._v("Chart也可以包含描述安装，配置和使用文件，以及chart许可证。")]),a._v(" "),t("p",[a._v("许可证（LICENSE）是一个包含了chart "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Software_license",target:"_blank",rel:"noopener noreferrer"}},[a._v("license"),t("OutboundLink")],1),a._v(" 的纯文本文件。\nchart可以包含一个许可证，因为在模板里不只是配置，还可能有编码逻辑。如果需要，还可以为chart安装的应用程序提供单独的许可证。")]),a._v(" "),t("p",[a._v("chart的自述文件README文件应该使用Markdown格式(README.md)，一般应包含：")]),a._v(" "),t("ul",[t("li",[a._v("chart提供的应用或服务的描述")]),a._v(" "),t("li",[a._v("运行chart的先决条件或要求")]),a._v(" "),t("li",[t("code",[a._v("values.yaml")]),a._v("的可选项和默认值的描述")]),a._v(" "),t("li",[a._v("与chart的安装或配置相关的其他任何信息")])]),a._v(" "),t("p",[t("code",[a._v("README.md")]),a._v(" 文件会包含hub和用户接口显示的chart的详细信息。")]),a._v(" "),t("p",[a._v("chart也会包含一个简短的纯文本 "),t("code",[a._v("templates/NOTES.txt")]),a._v(" 文件，这会在安装后及查看版本状态时打印出来。 这个文件会作为一个 "),t("a",{attrs:{href:"#templates-and-values"}},[a._v("模板")]),a._v("来评估，并用来显示使用说明，后续步骤，或者其他chart版本的相关信息。 比如，可以提供连接数据库的说明，web UI的访问。由于此文件是在运行"),t("code",[a._v("helm install")]),a._v("或"),t("code",[a._v("helm status")]),a._v("时打印到STDOUT的，因此建议保持内容简短，并指向自述文件以获取更多详细信息。")]),a._v(" "),t("h2",{attrs:{id:"chart-dependency"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chart-dependency"}},[a._v("#")]),a._v(" Chart dependency")]),a._v(" "),t("p",[a._v("Helm 中，chart可能会依赖其他任意个cahrt。 这些依赖可以使用"),t("code",[a._v("Chart.yaml")]),a._v("文件中的"),t("code",[a._v("dependencies")]),a._v(" 字段动态链接，或者被带入到 "),t("code",[a._v("charts/")]),a._v(" 目录并手动配置。")]),a._v(" "),t("h3",{attrs:{id:"使用-dependencies-字段管理依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-dependencies-字段管理依赖"}},[a._v("#")]),a._v(" 使用 "),t("code",[a._v("dependencies")]),a._v(" 字段管理依赖")]),a._v(" "),t("p",[a._v("当前chart依赖的其他chart会在"),t("code",[a._v("dependencies")]),a._v("字段定义为一个列表。")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" apache\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 1.2.3\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//example.com/charts\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" mysql\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 3.2.1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//another.example.com/charts\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("ul",[t("li",[t("code",[a._v("name")]),a._v("字段是你需要的chart的名称")]),a._v(" "),t("li",[t("code",[a._v("version")]),a._v("字段是你需要的chart的版本")]),a._v(" "),t("li",[t("code",[a._v("repository")]),a._v("字段是chart仓库的完整URL。注意你必须使用"),t("code",[a._v("helm repo add")]),a._v("在本地添加仓库")]),a._v(" "),t("li",[a._v("你可以使用仓库的名称代替URL")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ helm repo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" fantastic-charts https://fantastic-charts.storage.googleapis.com\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" awesomeness\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 1.0.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"@fantastic-charts"')]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("  一旦你定义好了依赖，运行 "),t("code",[a._v("helm dependency update")]),a._v(" 就会使用你的依赖文件下载所有你指定的chart到你的"),t("code",[a._v("charts/")]),a._v("目录。")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ helm dep up foochart\nHang tight "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("while")]),a._v(" we grab the latest from your chart repositories"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".Successfully got an update from the "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"local"')]),a._v(" chart repository\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".Successfully got an update from the "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"stable"')]),a._v(" chart repository\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".Successfully got an update from the "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"example"')]),a._v(" chart repository\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".Successfully got an update from the "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"another"')]),a._v(" chart repository\nUpdate Complete. Happy Helming"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v("\nSaving "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" charts\nDownloading apache from repo https://example.com/charts\nDownloading mysql from repo https://another.example.com/charts\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br")])]),t("p",[a._v("当 "),t("code",[a._v("helm dependency update")]),a._v(" 拉取chart时，会在"),t("code",[a._v("charts/")]),a._v("目录中形成一个chart包。因此对于上面的示例，会在chart目录中期望看到以下文件：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("charts/\n  apache-1.2.3.tgz\n  mysql-3.2.1.tgz\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("h4",{attrs:{id:"依赖的别名字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依赖的别名字段"}},[a._v("#")]),a._v(" 依赖的别名字段")]),a._v(" "),t("p",[a._v("除了上面的其他字段之外，每个需求项可以包含一个可选的字段 "),t("code",[a._v("alias")]),a._v("。\n为依赖chart添加一个别名，会使用别名作为新依赖chart的名称。\n需要使用其他名称访问chart时可以使用"),t("code",[a._v("alias")]),a._v("。")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# parentchart/Chart.yaml")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" subchart\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10191")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 0.1.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("alias")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("subchart"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" subchart\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10191")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 0.1.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("alias")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("subchart"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" subchart\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10191")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 0.1.0\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br")])]),t("p",[a._v("上述例子中，我们会获得"),t("code",[a._v("parentchart")]),a._v("所有的3个依赖项：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("subchart\nnew-subchart-1\nnew-subchart-2\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("p",[a._v("手动完成的方式是将同一个chart用不同的名称复制/粘贴多次到"),t("code",[a._v("charts/")]),a._v("目录中。")]),a._v(" "),t("h4",{attrs:{id:"依赖中的tag和条件字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依赖中的tag和条件字段"}},[a._v("#")]),a._v(" 依赖中的tag和条件字段")]),a._v(" "),t("p",[a._v("除了上面的其他字段外，每个需求项可以包含可选字段 "),t("code",[a._v("tags")]),a._v(" 和 "),t("code",[a._v("condition")]),a._v("。")]),a._v(" "),t("p",[a._v("所有的chart会默认加载。如果存在 "),t("code",[a._v("tags")]),a._v(" 或者 "),t("code",[a._v("condition")]),a._v(" 字段，它们将被评估并用于控制它们应用的chart的加载。")]),a._v(" "),t("p",[a._v("Condition - 条件字段field 包含一个或多个YAML路径（用逗号分隔）。\n如果这个路径在上层values中已存在并解析为布尔值，chart会基于布尔值启用或禁用chart。\n只会使用列表中找到的第一个有效路径，如果路径为未找到则条件无效。")]),a._v(" "),t("p",[a._v("Tags - tag字段是与chart关联的YAML格式的标签列表。在顶层value中，通过指定tag和布尔值，可以启用或禁用所有的带tag的chart。")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# parentchart/Chart.yaml")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" subchart1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10191")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 0.1.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("condition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" subchart1.enabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" global.subchart1.enabled\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" front"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("end\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" subchart1\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" subchart2\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10191")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 0.1.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("condition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" subchart2.enabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("global.subchart2.enabled\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" back"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("end\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" subchart2\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br")])]),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# parentchart/values.yaml")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("subchart1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("front-end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("back-end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("p",[a._v("在上面的例子中，所有带 "),t("code",[a._v("front-end")]),a._v("tag的chart都会被禁用，但只要上层的value中\n"),t("code",[a._v("subchart1.enabled")]),a._v(" 路径被设置为 'true'，该条件会覆盖 "),t("code",[a._v("front-end")]),a._v("标签且 "),t("code",[a._v("subchart1")]),a._v(" 会被启用。")]),a._v(" "),t("p",[a._v("一旦 "),t("code",[a._v("subchart2")]),a._v("使用了"),t("code",[a._v("back-end")]),a._v("标签并被设置为了 "),t("code",[a._v("true")]),a._v("，"),t("code",[a._v("subchart2")]),a._v("就会被启用。\n也要注意尽管"),t("code",[a._v("subchart2")]),a._v(" 指定了一个条件字段， 但是上层value没有相应的路径和value，因此这个条件不会生效。")]),a._v(" "),t("h5",{attrs:{id:"使用带有标签和条件的cli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用带有标签和条件的cli"}},[a._v("#")]),a._v(" 使用带有标签和条件的CLI")]),a._v(" "),t("p",[t("code",[a._v("--set")]),a._v(" 参数一如既往可以用来设置标签和条件值。")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("helm "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" --set tags.front-end"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true --set subchart2.enabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h5",{attrs:{id:"标签和条件的解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#标签和条件的解析"}},[a._v("#")]),a._v(" 标签和条件的解析")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("条件 （当设置在value中时）总是会覆盖标签")]),a._v(" 第一个chart条件路径存在时会忽略后面的路径。")]),a._v(" "),t("li",[a._v("标签被定义为 '如果任意的chart标签是true，chart就可以启用'。")]),a._v(" "),t("li",[a._v("标签和条件值必须被设置在顶层value中。")]),a._v(" "),t("li",[a._v("value中的"),t("code",[a._v("tags:")]),a._v("键必须是顶层键。 全局和嵌套的"),t("code",[a._v("tags:")]),a._v("表现在不支持了。")])]),a._v(" "),t("h4",{attrs:{id:"通过依赖导入子value"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过依赖导入子value"}},[a._v("#")]),a._v(" 通过依赖导入子Value")]),a._v(" "),t("p",[a._v("在某些情况下，允许子chart的值作为公共默认传递到父chart中是值得的。使用\n"),t("code",[a._v("exports")]),a._v("格式的额外好处是它可是将来的工具可以自检用户可设置的值。")]),a._v(" "),t("p",[a._v("被导入的包含值的key可以在父chart的 "),t("code",[a._v("dependencies")]),a._v(" 中的 "),t("code",[a._v("import-values")]),a._v(" 字段以YAML列表形式指定。\n列表中的每一项是从子chart中"),t("code",[a._v("exports")]),a._v("字段导入的key。")]),a._v(" "),t("p",[a._v("导入"),t("code",[a._v("exports")]),a._v(" key中未包含的值，使用"),t("a",{attrs:{href:"#using-the-child-parent-format"}},[a._v("子-父")]),a._v("格式。两种格式的示例如下所述。")]),a._v(" "),t("h5",{attrs:{id:"使用导出格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用导出格式"}},[a._v("#")]),a._v(" 使用导出格式")]),a._v(" "),t("p",[a._v("如果子chart的"),t("code",[a._v("values.yaml")]),a._v("文件中在根节点包含了"),t("code",[a._v("exports")]),a._v("字段，它的内容可以通过指定的可以被直接导入到父chart的value中，\n如下所示：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# parent's Chart.yaml file")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" subchart\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10191")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 0.1.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("import-values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" data\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br")])]),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# child's values.yaml file")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("exports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("myint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("99")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])]),t("p",[a._v("只要我们再导入列表中指定了键"),t("code",[a._v("data")]),a._v("，Helm就会在子chart的"),t("code",[a._v("exports")]),a._v("字段查找"),t("code",[a._v("data")]),a._v("键并导入它的内容。")]),a._v(" "),t("p",[a._v("最终的父级value会包含我们的导出字段：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# parent's values")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("myint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("99")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("p",[a._v("注意父级键 "),t("code",[a._v("data")]),a._v(" 没有包含在父级最终的value中，如果想指定这个父级键，要使用'子-父' 格式。")]),a._v(" "),t("h5",{attrs:{id:"using-the-child-parent-format"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#using-the-child-parent-format"}},[a._v("#")]),a._v(" Using the child-parent format")]),a._v(" "),t("p",[a._v("要访问子chart中未包含的 "),t("code",[a._v("exports")]),a._v(" 键的值，你需要指定要导入的值的源键("),t("code",[a._v("child")]),a._v(")和父chart("),t("code",[a._v("parent")]),a._v(")中值的目标路径。")]),a._v(" "),t("p",[a._v("下面示例中的"),t("code",[a._v("import-values")]),a._v(" 指示Helm去拿到能再"),t("code",[a._v("child:")]),a._v("路径中找到的任何值，并拷贝到"),t("code",[a._v("parent:")]),a._v("的指定路径。")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# parent's Chart.yaml file")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" subchart1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10191")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 0.1.0\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("...")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("import-values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("child")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" default.data\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("parent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" myimports\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br")])]),t("p",[a._v("上面的例子中，在subchart1里面找到的"),t("code",[a._v("default.data")]),a._v("的值会被导入到父chart的"),t("code",[a._v("myimports")]),a._v("键中，细节如下：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# parent's values.yaml file")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("myimports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("myint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mybool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mystring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"helm rocks!"')]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# subchart1's values.yaml file")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("myint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("999")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mybool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("p",[a._v("父chart的结果值将会是这样：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# parent's final values")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("myimports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("myint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("999")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mybool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mystring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"helm rocks!"')]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("p",[a._v("父chart中的最终值包含了从 subchart1中导入的"),t("code",[a._v("myint")]),a._v("和"),t("code",[a._v("mybool")]),a._v("字段。")]),a._v(" "),t("h3",{attrs:{id:"通过charts-目录手动管理依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过charts-目录手动管理依赖"}},[a._v("#")]),a._v(" 通过"),t("code",[a._v("charts/")]),a._v("目录手动管理依赖")]),a._v(" "),t("p",[a._v("如果对依赖进行更多控制，通过将有依赖关系的chart复制到"),t("code",[a._v("charts/")]),a._v("目录中来显式表达这些依赖关系。")]),a._v(" "),t("p",[a._v("依赖可以是chart包("),t("code",[a._v("foo-1.2.3.tgz")]),a._v(") 或者一个解压的chart目录。但是名字不能以"),t("code",[a._v("_")]),a._v("或"),t("code",[a._v(".")]),a._v("开头，否则会被chart加载器忽略。")]),a._v(" "),t("p",[a._v("比如，如果WordPress chart依赖于Apache chart，那么（正确版本的）Apache chart需要放在WordPress chart 的"),t("code",[a._v("charts/")]),a._v("目录中：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("wordpress")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  Chart.yaml\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ...")]),a._v("\n  charts/\n    apache/\n      Chart.yaml\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ...")]),a._v("\n    mysql/\n      Chart.yaml\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ...")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br")])]),t("p",[a._v("上面的例子展示了WordPress chart 如何通过将这些chart包含在 "),t("code",[a._v("charts/")]),a._v(" 目录中来表达它对Apache 和 MySQL的依赖。")]),a._v(" "),t("p",[t("strong",[a._v("提示：")]),a._v(" "),t("em",[a._v("要将依赖放入"),t("code",[a._v("charts/")]),a._v("目录，使用 "),t("code",[a._v("helm pull")]),a._v(" 命令")])]),a._v(" "),t("h3",{attrs:{id:"使用依赖的操作部分"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用依赖的操作部分"}},[a._v("#")]),a._v(" 使用依赖的操作部分")]),a._v(" "),t("p",[a._v("上面的部分说明如何指定chart的依赖，但是对使用 "),t("code",[a._v("helm install")]),a._v(" 和 "),t("code",[a._v("helm upgrade")]),a._v(" 安装chart有什么影响？")]),a._v(" "),t("p",[a._v('假设有个chart "A" 创建了下面的Kubernetes对象：')]),a._v(" "),t("ul",[t("li",[a._v('namespace "A-Namespace"')]),a._v(" "),t("li",[a._v('statefulset "A-StatefulSet"')]),a._v(" "),t("li",[a._v('service "A-Service"')])]),a._v(" "),t("p",[a._v("另外，A是依赖于chart B创建的对象：")]),a._v(" "),t("ul",[t("li",[a._v('namespace "B-Namespace"')]),a._v(" "),t("li",[a._v('replicaset "B-ReplicaSet"')]),a._v(" "),t("li",[a._v('service "B-Service"')])]),a._v(" "),t("p",[a._v("安装/升级chart A后，会创建/修改一个单独的Helm版本。这个版本会按顺序创建/升级以下所有的Kubernetes对象：")]),a._v(" "),t("ul",[t("li",[a._v("A-Namespace")]),a._v(" "),t("li",[a._v("B-Namespace")]),a._v(" "),t("li",[a._v("A-Service")]),a._v(" "),t("li",[a._v("B-Service")]),a._v(" "),t("li",[a._v("B-ReplicaSet")]),a._v(" "),t("li",[a._v("A-StatefulSet")])]),a._v(" "),t("p",[a._v("这是因为当Helm安卓/升级chart时，chart中所有的Kubernetes对象以及依赖会")]),a._v(" "),t("ul",[t("li",[a._v("聚合成一个单一的集合；然后")]),a._v(" "),t("li",[a._v("按照类型和名称排序；然后")]),a._v(" "),t("li",[a._v("按这个顺序创建/升级。")])]),a._v(" "),t("p",[a._v("至此会为chart及其依赖创建一个包含所有对象的release版本。")]),a._v(" "),t("p",[a._v("Kubernetes类型的安装顺序会按照kind_sorter.go(查看 "),t("a",{attrs:{href:"https://github.com/helm/helm/blob/484d43913f97292648c867b56768775a55e4bba6/pkg/releaseutil/kind_sorter.go",target:"_blank",rel:"noopener noreferrer"}},[a._v("Helm源文件"),t("OutboundLink")],1),a._v(")中给出的枚举顺序进行。")]),a._v(" "),t("h2",{attrs:{id:"templates-and-values"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#templates-and-values"}},[a._v("#")]),a._v(" Templates and Values")]),a._v(" "),t("p",[a._v("Helm Chart 模板是按照"),t("a",{attrs:{href:"https://golang.org/pkg/text/template/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Go模板语言"),t("OutboundLink")],1),a._v("书写，\n增加了50个左右的附加模板函数"),t("a",{attrs:{href:"https://github.com/Masterminds/sprig",target:"_blank",rel:"noopener noreferrer"}},[a._v("来自 Sprig库"),t("OutboundLink")],1),a._v("\n和一些其他"),t("a",{attrs:{href:"http://helm.sh/docs/howto/charts_tips_and_tricks.md",target:"_blank",rel:"noopener noreferrer"}},[a._v("指定的函数"),t("OutboundLink")],1),a._v("。")]),a._v(" "),t("p",[a._v("所有模板文件存储在chart的 "),t("code",[a._v("templates/")]),a._v(" 文件夹。\n当Helm渲染chart时，它会通过模板引擎遍历目录中的每个文件。")]),a._v(" "),t("p",[a._v("模板的Value通过两种方式提供：")]),a._v(" "),t("ul",[t("li",[a._v("Chart开发者可以在chart中提供一个命名为 "),t("code",[a._v("values.yaml")]),a._v(" 的文件。这个文件包含了默认值。")]),a._v(" "),t("li",[a._v("Chart用户可以提供一个包含了value的YAML文件。可以在命令行使用 "),t("code",[a._v("helm install")]),a._v("命令时提供。")])]),a._v(" "),t("p",[a._v("当用户提供自定义value时，这些value会覆盖chart的"),t("code",[a._v("values.yaml")]),a._v("文件中value。")]),a._v(" "),t("h3",{attrs:{id:"模板文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模板文件"}},[a._v("#")]),a._v(" 模板文件")]),a._v(" "),t("p",[a._v("  模板文件遵守书写Go模板的标准惯例（查看"),t("a",{attrs:{href:"https://golang.org/pkg/text/template/",target:"_blank",rel:"noopener noreferrer"}},[a._v("文本/模板 Go 包文档"),t("OutboundLink")],1),a._v("了解跟多）。\n模板文件的例子看起来像这样：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ReplicationController\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("database\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app.kubernetes.io/managed-by")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app.kubernetes.io/name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("database\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app.kubernetes.io/name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("database\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("serviceAccount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("database\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("database\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 【【 .Values.imageRegistry 】】/postgres"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("【【 .Values.dockerTag 】】\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("imagePullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 【【 .Values.pullPolicy 】】\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("env")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" DATABASE_STORAGE\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(' 【【 default "minio" .Values.storage 】】\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br")])]),t("p",[a._v("上面的例子，松散地基于"),t("a",{attrs:{href:"https://github.com/deis/charts",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/deis/charts"),t("OutboundLink")],1),a._v("，\n是一个Kubernetes副本控制器的模板。可以使用下面四种模板值（一般被定义在"),t("code",[a._v("values.yaml")]),a._v("文件）：")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("imageRegistry")]),a._v(": Docker镜像的源注册表")]),a._v(" "),t("li",[t("code",[a._v("dockerTag")]),a._v(": Docker镜像的tag")]),a._v(" "),t("li",[t("code",[a._v("pullPolicy")]),a._v(": Kubernetes的拉取策略")]),a._v(" "),t("li",[t("code",[a._v("storage")]),a._v(": 后台存储，默认设置为"),t("code",[a._v('"minio"')])])]),a._v(" "),t("p",[a._v("所有的值都是模板作者定义的。Helm不需要或指定参数。")]),a._v(" "),t("p",[a._v("要了解更多chart的工作，请查阅"),t("a",{attrs:{href:"https://github.com/helm/charts",target:"_blank",rel:"noopener noreferrer"}},[a._v("Kubernetes Charts 项目"),t("OutboundLink")],1)]),a._v(" "),t("h3",{attrs:{id:"预定义的values"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#预定义的values"}},[a._v("#")]),a._v(" 预定义的Values")]),a._v(" "),t("p",[a._v("Values通过模板中"),t("code",[a._v(".Values")]),a._v("对象可访问的"),t("code",[a._v("values.yaml")]),a._v("文件（或者通过 "),t("code",[a._v("--set")]),a._v(" 参数)提供，\n但可以模板中访问其他预定义的数据片段。")]),a._v(" "),t("p",[a._v("以下值是预定义的，对每个模板都有效，并且可以被覆盖。和所有值一样，名称 "),t("em",[a._v("区分大小写")]),a._v("。")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("Release.Name")]),a._v(": 版本名称(非chart的)")]),a._v(" "),t("li",[t("code",[a._v("Release.Namespace")]),a._v(": 发布的chart版本的命名空间")]),a._v(" "),t("li",[t("code",[a._v("Release.Service")]),a._v(": 组织版本的服务")]),a._v(" "),t("li",[t("code",[a._v("Release.IsUpgrade")]),a._v(": 如果当前操作是升级或回滚，设置为true")]),a._v(" "),t("li",[t("code",[a._v("Release.IsInstall")]),a._v(": 如果当前操作是安装，设置为true")]),a._v(" "),t("li",[t("code",[a._v("Chart")]),a._v(": "),t("code",[a._v("Chart.yaml")]),a._v("的内容。因此，chart的版本可以从 "),t("code",[a._v("Chart.Version")]),a._v(" 获得，\n并且维护者在"),t("code",[a._v("Chart.Maintainers")]),a._v("里。")]),a._v(" "),t("li",[t("code",[a._v("Files")]),a._v(": chart中的包含了非特殊文件的类图对象。这将不允许您访问模板，\n但是可以访问现有的其他文件（除非被"),t("code",[a._v(".helmignore")]),a._v("排除在外）。\n使用"),t("code",[a._v('【【 index .Files "file.name" 】】')]),a._v("可以访问文件或者使用"),t("code",[a._v("【【.Files.Get name 】】")]),a._v("功能。\n您也可以使用"),t("code",[a._v("【【 .Files.GetBytes 】】")]),a._v("作为"),t("code",[a._v("[]byte")]),a._v("方位文件内容。")]),a._v(" "),t("li",[t("code",[a._v("Capabilities")]),a._v(": 包含了Kubernetes版本信息的类图对象。("),t("code",[a._v("【【 .Capabilities.KubeVersion 】】")]),a._v("\n和支持的Kubernetes API 版本("),t("code",[a._v('【【 .Capabilities.APIVersions.Has "batch/v1" 】】')]),a._v(")")])]),a._v(" "),t("p",[t("strong",[a._v("注意：")]),a._v(" 任何未知的"),t("code",[a._v("Chart.yaml")]),a._v("字段会被抛弃。在"),t("code",[a._v("Chart")]),a._v("对象中无法访问。因此，\n"),t("code",[a._v("Chart.yaml")]),a._v("不能用于将任意结构的数据传递到模板中。不过values文件可用于此。")]),a._v(" "),t("h3",{attrs:{id:"values文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#values文件"}},[a._v("#")]),a._v(" Values文件")]),a._v(" "),t("p",[a._v("考虑到前面部分的模板，"),t("code",[a._v("values.yaml")]),a._v("文件提供的必要值如下：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("imageRegistry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"quay.io/deis"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dockerTag")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"latest"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("pullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Always"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"s3"')]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("values文件被定义为YAML格式。chart会包含一个默认的"),t("code",[a._v("values.yaml")]),a._v("文件。\nHelm安装命令允许用户使用附加的YAML values覆盖这个values：")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ helm "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" --generate-name --values"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("myvals.yaml wordpress\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("以这种方式传递值时，它们会合并到默认的values文件中。比如，"),t("code",[a._v("myvals.yaml")]),a._v("文件如下：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"gcs"')]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("当在chart中这个值被合并到"),t("code",[a._v("values.yaml")]),a._v("文件中时，生成的内容是这样：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("imageRegistry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"quay.io/deis"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dockerTag")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"latest"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("pullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Always"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"gcs"')]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("注意只有最后一个字段会覆盖。")]),a._v(" "),t("p",[t("strong",[a._v("注意：")]),a._v(" chart包含的默认values文件 "),t("em",[a._v("必须")]),a._v(" 被命名为"),t("code",[a._v("values.yaml")]),a._v("。不过在命令行指定的文件可以是其他名称。")]),a._v(" "),t("p",[t("strong",[a._v("注意：")]),a._v(" 如果"),t("code",[a._v("helm install")]),a._v("或"),t("code",[a._v("helm upgrade")]),a._v("使用了"),t("code",[a._v("--set")]),a._v("参数，这些值在客户端会被简单地转换为YAML。")]),a._v(" "),t("p",[t("strong",[a._v("注意：")]),a._v(" 如果values 文件存在任何必需的条目，它们会在chart模板中使用"),t("a",{attrs:{href:"http://helm.sh/docs/howto/charts_tips_and_tricks.md",target:"_blank",rel:"noopener noreferrer"}},[a._v("'required'\n函数"),t("OutboundLink")],1),a._v(" 声明为必需的。")]),a._v(" "),t("p",[a._v("然后使用模板中的"),t("code",[a._v(".Values")]),a._v("对象就可以任意访问这些值了：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ReplicationController\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("database\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app.kubernetes.io/managed-by")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app.kubernetes.io/name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("database\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app.kubernetes.io/name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("database\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("serviceAccount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("database\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("database\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 【【 .Values.imageRegistry 】】/postgres"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("【【 .Values.dockerTag 】】\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("imagePullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 【【 .Values.pullPolicy 】】\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("env")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" DATABASE_STORAGE\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(' 【【 default "minio" .Values.storage 】】\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br")])]),t("h3",{attrs:{id:"范围-依赖和值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#范围-依赖和值"}},[a._v("#")]),a._v(" 范围，依赖和值")]),a._v(" "),t("p",[a._v("Values文件可以声明顶级chart的值，以及"),t("code",[a._v("charts/")]),a._v("目录中包含的其他任意chart。\n或者换个说法，values文件可以为chart及其任何依赖项提供值。比如，上面示范的WordPress chart同时有\n"),t("code",[a._v("mysql")]),a._v(" 和 "),t("code",[a._v("apache")]),a._v(" 作为依赖。values文件可以为以下所有这些组件提供依赖：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("title")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"My WordPress Site"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Sent to the WordPress template")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mysql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("max_connections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Sent to MySQL")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"secret"')]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Passed to Apache")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br")])]),t("p",[a._v("更高阶的chart可以访问下面定义的所有变量。因此WordPress chart可以用"),t("code",[a._v(".Values.mysql.password")]),a._v("访问MySQL密码。\n但是低阶的chart不能访问父级chart，所以MySQL无法访问"),t("code",[a._v("title")]),a._v("属性。同样也无法方位"),t("code",[a._v("apache.port")]),a._v("。")]),a._v(" "),t("p",[a._v("Values 被限制在命名空间中，但是命名空间被删减了。因此对于WordPress chart，\n它可以用"),t("code",[a._v(".Values.mysql.password")]),a._v("访问MySQL的密码字段。但是对于MySQL chart，值的范围被缩减了且命名空间前缀被移除了，\n因此它把密码字段简单地看作"),t("code",[a._v(".Values.password")]),a._v("。")]),a._v(" "),t("h4",{attrs:{id:"全局values"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#全局values"}},[a._v("#")]),a._v(" 全局Values")]),a._v(" "),t("p",[a._v('从2.0.0-Alpha.2开始，Helm 支持特殊的"global"值。设想一下前面的示例中的修改版本：')]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("title")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"My WordPress Site"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Sent to the WordPress template")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" MyWordPress\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mysql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("max_connections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Sent to MySQL")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"secret"')]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Passed to Apache")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br")])]),t("p",[a._v("上面添加了"),t("code",[a._v("global")]),a._v("部分和一个值"),t("code",[a._v("app: MyWordPress")]),a._v("。这个值以"),t("code",[a._v(".Values.global.app")]),a._v("在 "),t("em",[a._v("所有")]),a._v(" chart中有效。")]),a._v(" "),t("p",[a._v("比如，"),t("code",[a._v("mysql")]),a._v("模板可以以"),t("code",[a._v("【【.Values.global.app】】")]),a._v("访问"),t("code",[a._v("app")]),a._v("，同样"),t("code",[a._v("apache")]),a._v("chart也可以访问。\n实际上，上面的values文件会重新生成为这样：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("title")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"My WordPress Site"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Sent to the WordPress template")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" MyWordPress\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mysql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" MyWordPress\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("max_connections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Sent to MySQL")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"secret"')]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" MyWordPress\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Passed to Apache")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br")])]),t("p",[a._v("这提供了一种和所有的子chart共享顶级变量的方式，这在类似label设置"),t("code",[a._v("metadata")]),a._v("属性时会很有用。")]),a._v(" "),t("p",[a._v("如果子chart声明了一个全局变量，那这个变量会 "),t("em",[a._v("向下")]),a._v(" 传递（到子chart的子chart），但不会 "),t("em",[a._v("向上")]),a._v(" 传递到父级chart。\n子chart无法影响父chart的值。")]),a._v(" "),t("p",[a._v("并且，父chart的全局变量优先于子chart中的全局变量。")]),a._v(" "),t("h3",{attrs:{id:"架构文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#架构文件"}},[a._v("#")]),a._v(" 架构文件")]),a._v(" "),t("p",[a._v("有时候，chart容器可能想基于它们的values值定义一个结构，这可以在"),t("code",[a._v("values.schema.json")]),a._v("文件中定义一个架构实现。\n架构使用"),t("a",{attrs:{href:"https://json-schema.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("JSON 架构"),t("OutboundLink")],1),a._v("表示。看起来像这样：")]),a._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"$schema"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://json-schema.org/draft-07/schema#"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"properties"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"image"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Container Image"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"properties"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"repo"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n          "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"string"')]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"tag"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n          "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"string"')]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"object"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Service name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"string"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"port"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Port"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"minimum"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"integer"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"protocol"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"string"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"required"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"protocol"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"port"')]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"title"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Values"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"object"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br"),t("span",{staticClass:"line-number"},[a._v("34")]),t("br"),t("span",{staticClass:"line-number"},[a._v("35")]),t("br")])]),t("p",[a._v("这个架构会应用values值并验证它。当执行以下任意命令时会进行验证：")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("helm install")])]),a._v(" "),t("li",[t("code",[a._v("helm upgrade")])]),a._v(" "),t("li",[t("code",[a._v("helm lint")])]),a._v(" "),t("li",[t("code",[a._v("helm template")])])]),a._v(" "),t("p",[a._v("一个符合此架构要求的"),t("code",[a._v("values.yaml")]),a._v("文件示例如下所示：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" frontend\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("protocol")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" https\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("p",[a._v("注意这个架构被应用到了最终的 "),t("code",[a._v(".Values")]),a._v(" 对象，而不仅仅是"),t("code",[a._v("values.yaml")]),a._v("文件。\n这意味着下面的"),t("code",[a._v("yaml")]),a._v("文件是有效的，给定的chart是用下面显示的适当的"),t("code",[a._v("--set")]),a._v("选项安装的：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" frontend\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("protocol")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" https\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("helm "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" --set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("此外，最终的"),t("code",[a._v(".Values")]),a._v("对象是根据"),t("em",[a._v("所有的")]),a._v("子chart架构检查。 这意味着父chart无法规避子chart的限制。\n这也是逆向的 - 如果子chart的"),t("code",[a._v("values.yaml")]),a._v("文件无法满足需求，父chart"),t("em",[a._v("必须")]),a._v(" 满足这些限制才能有效。")]),a._v(" "),t("h3",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[a._v("#")]),a._v(" 参考")]),a._v(" "),t("p",[a._v("在编写模板，值和架构文件时，有几个标准的参考可以帮助您。")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://godoc.org/text/template",target:"_blank",rel:"noopener noreferrer"}},[a._v("Go templates"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://godoc.org/github.com/Masterminds/sprig",target:"_blank",rel:"noopener noreferrer"}},[a._v("Extra template functions"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://yaml.org/spec/",target:"_blank",rel:"noopener noreferrer"}},[a._v("The YAML format"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://json-schema.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("JSON Schema"),t("OutboundLink")],1)])]),a._v(" "),t("h2",{attrs:{id:"用户自定义资源-crd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用户自定义资源-crd"}},[a._v("#")]),a._v(" 用户自定义资源(CRD)")]),a._v(" "),t("p",[a._v("Kubernetes提供了一种声明Kubernetes新类型对象的机制。使用CustomResourceDefinition（CRD），\nKubernetes开发者可以声明自定义资源类型。")]),a._v(" "),t("p",[a._v("Helm 3中,CRD被视为一种特殊的对象。它们被安装在chart的其他部分之前，并受到一些限制。")]),a._v(" "),t("p",[a._v("CRD YAML文件应被放置在chart的"),t("code",[a._v("crds/")]),a._v("目录中。\n多个CRD(用YAML的开始和结束符分隔)可以被放置在同一个文件中。Helm会尝试加载CRD目录中 "),t("em",[a._v("所有的")]),a._v(" 文件到Kubernetes。")]),a._v(" "),t("p",[a._v("CRD 文件 "),t("em",[a._v("无法模板化")]),a._v("，必须是普通的YAML文档。")]),a._v(" "),t("p",[a._v("当Helm安装新chart时，会上传CRD，暂停安装直到CRD可以被API服务使用，然后启动模板引擎，\n渲染chart其他部分，并上传到Kubernetes。因为这个顺序，CRD信息会在Helm模板中的\n"),t("code",[a._v(".Capabilities")]),a._v("对象中生效，并且Helm模板会创建在CRD中声明的新的实例对象。")]),a._v(" "),t("p",[a._v("比如，如果您的chart在"),t("code",[a._v("crds/")]),a._v("目录中有针对于"),t("code",[a._v("CronTab")]),a._v("的CRD，您可以在"),t("code",[a._v("templates/")]),a._v("目录中创建"),t("code",[a._v("CronTab")]),a._v("类型实例：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("crontabs/\n  Chart.yaml\n  crds/\n    crontab.yaml\n  templates/\n    mycrontab.yaml\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("p",[t("code",[a._v("crontab.yaml")]),a._v("文件必须包含没有模板指令的CRD:")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" CustomResourceDefinition\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" crontabs.stable.example.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" stable.example.com\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("versions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Namespaced\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("names")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("plural")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" crontabs\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("singular")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" crontab\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" CronTab\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br")])]),t("p",[a._v("然后模板"),t("code",[a._v("mycrontab.yaml")]),a._v("可以创建一个新的"),t("code",[a._v("CronTab")]),a._v("（照例使用模板）：")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" stable.example.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" CronTab\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 【【 .Values.name 】】\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ...")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("p",[a._v("Helm在安装"),t("code",[a._v("templates/")]),a._v("内容之前会保证"),t("code",[a._v("CronTab")]),a._v("类型安装成功并对Kubernetes API可用。")]),a._v(" "),t("h3",{attrs:{id:"crd的限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#crd的限制"}},[a._v("#")]),a._v(" CRD的限制")]),a._v(" "),t("p",[a._v("不像大部分的Kubernetes对象，CRD是全局安装的。因此Helm管理CRD时会采取非常谨慎的方式。\nCRD受到以下限制：")]),a._v(" "),t("ul",[t("li",[a._v("CRD从不重新安装。 如果Helm确定"),t("code",[a._v("crds/")]),a._v("目录中的CRD已经存在（忽略版本），Helm不会安装或升级。")]),a._v(" "),t("li",[a._v("CRD从不会在升级或回滚时安装。Helm只会在安装时创建CRD。")]),a._v(" "),t("li",[a._v("CRD从不会被删除。自动删除CRD会删除集群中所有命名空间中的所有CRD内容。因此Helm不会删除CRD。")])]),a._v(" "),t("p",[a._v("希望升级或删除CRD的操作员应该谨慎地手动执行此操作。")]),a._v(" "),t("h2",{attrs:{id:"使用helm管理chart"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用helm管理chart"}},[a._v("#")]),a._v(" 使用Helm管理Chart")]),a._v(" "),t("p",[t("code",[a._v("helm")]),a._v("工具有一些命令用来处理chart。")]),a._v(" "),t("p",[a._v("它可以为您创建一个新chart：")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ helm create mychart\nCreated mychart/\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("编辑了chart之后，"),t("code",[a._v("helm")]),a._v("能为您把它打包成一个chart存档：")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ helm package mychart\nArchived mychart-0.1.-.tgz\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("您也可以使用"),t("code",[a._v("helm")]),a._v(" 帮您找到chart的格式或信息的问题：")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ helm lint mychart\nNo issues found\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("h2",{attrs:{id:"chart仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chart仓库"}},[a._v("#")]),a._v(" Chart仓库")]),a._v(" "),t("p",[t("em",[a._v("chart仓库")]),a._v(" 是一个HTTP服务器，包含了一个或多个打包的chart。当"),t("code",[a._v("helm")]),a._v("用来管理本地chart目录时，\n共享chart时，首选的机制就是使用chart仓库。")]),a._v(" "),t("p",[a._v("任何可以服务于YAML文件和tar文件并可以响应GET请求的HTTP服务器都可以用做仓库服务器。\nHelm 团队已经测试了一些服务器，包括激活websit模组的Google Cloud 存储，以及使用website的S3。")]),a._v(" "),t("p",[a._v("仓库的主要特征存在一个名为 "),t("code",[a._v("index.yaml")]),a._v(" 的特殊文件，文件中包含仓库提供的包的完整列表，\n以及允许检索和验证这些包的元数据。")]),a._v(" "),t("p",[a._v("在客户端，仓库使用"),t("code",[a._v("helm repo")]),a._v("命令管理。然而，Helm不提供上传chart到远程仓库的工具。\n这是因为这样做会给执行服务器增加大量的必要条件，也就增加了设置仓库的障碍。")]),a._v(" "),t("h2",{attrs:{id:"chart-starter-包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chart-starter-包"}},[a._v("#")]),a._v(" Chart Starter 包")]),a._v(" "),t("p",[t("code",[a._v("helm create")]),a._v("命令可以附带一个可选的 "),t("code",[a._v("--starter")]),a._v(' 选项让您指定一个 "starter chart"。')]),a._v(" "),t("p",[a._v("Starter就只是普通chart，但是被放置在"),t("code",[a._v("$XDG_DATA_HOME/helm/starters")]),a._v("。作为一个chart开发者，\n您可以编写被特别设计用来作为启动的chart。设计此类chart应注意以下考虑因素：")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("Chart.yaml")]),a._v("会被生成器覆盖。")]),a._v(" "),t("li",[a._v("用户将希望修改此类chart的内容，所以文档应该说明用户如果做到这一点。")]),a._v(" "),t("li",[a._v("所有出现的"),t("code",[a._v("<CHARTNAME>")]),a._v("都会被替换为指定为chart名称，以便chart可以作为模板使用。")])]),a._v(" "),t("p",[a._v("当前增加一个chart的唯一方式就是拷贝chart到"),t("code",[a._v("$XDG_DATA_HOME/helm/starters")]),a._v("。在您的chart文档中，您可能需要解释这个过程。")])])}),[],!1,null,null,null);s.default=n.exports}}]);