(window.webpackJsonp=window.webpackJsonp||[]).push([[314],{947:function(a,s,e){"use strict";e.r(s);var t=e(6),n=Object(t.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"node-js-deployment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#node-js-deployment"}},[a._v("#")]),a._v(" Node.js Deployment")]),a._v(" "),e("blockquote",[e("p",[a._v("Steps to deploy a Node.js app to DigitalOcean using PM2, NGINX as a reverse proxy and an SSL from LetsEncrypt")])]),a._v(" "),e("h2",{attrs:{id:"_1-sign-up-for-digital-ocean"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-sign-up-for-digital-ocean"}},[a._v("#")]),a._v(" 1. Sign up for Digital Ocean")]),a._v(" "),e("p",[a._v("If you use the referal link below, you get $10 free (1 or 2 months) https://m.do.co/c/5424d440c63a")]),a._v(" "),e("h2",{attrs:{id:"_2-create-a-droplet-and-log-in-via-ssh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-create-a-droplet-and-log-in-via-ssh"}},[a._v("#")]),a._v(" 2. Create a droplet and log in via ssh")]),a._v(" "),e("p",[a._v("I will be using the root user, but would suggest creating a new user")]),a._v(" "),e("h2",{attrs:{id:"_3-install-node-npm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-install-node-npm"}},[a._v("#")]),a._v(" 3. Install Node/NPM")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -\n\nsudo apt install nodejs\n\nnode --version\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("h2",{attrs:{id:"_4-clone-your-project-from-github"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-clone-your-project-from-github"}},[a._v("#")]),a._v(" 4. Clone your project from Github")]),a._v(" "),e("p",[a._v("There are a few ways to get your files on to the server, I would suggest using Git")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("git clone yourproject.git\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h3",{attrs:{id:"_5-install-dependencies-and-test-app"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-install-dependencies-and-test-app"}},[a._v("#")]),a._v(" 5. Install dependencies and test app")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("cd yourproject\nnpm install\nnpm start (or whatever your start command)\n# stop app\nctrl+C\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("h2",{attrs:{id:"_6-setup-pm2-process-manager-to-keep-your-app-running"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-setup-pm2-process-manager-to-keep-your-app-running"}},[a._v("#")]),a._v(" 6. Setup PM2 process manager to keep your app running")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("sudo npm i pm2 -g\npm2 start app (or whatever your file name)\n\n# Other pm2 commands\npm2 show app\npm2 status\npm2 restart app\npm2 stop app\npm2 logs (Show log stream)\npm2 flush (Clear logs)\n\n# To make sure app starts when reboot\npm2 startup ubuntu\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br")])]),e("h3",{attrs:{id:"you-should-now-be-able-to-access-your-app-using-your-ip-and-port-now-we-want-to-setup-a-firewall-blocking-that-port-and-setup-nginx-as-a-reverse-proxy-so-we-can-access-it-directly-using-port-80-http"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#you-should-now-be-able-to-access-your-app-using-your-ip-and-port-now-we-want-to-setup-a-firewall-blocking-that-port-and-setup-nginx-as-a-reverse-proxy-so-we-can-access-it-directly-using-port-80-http"}},[a._v("#")]),a._v(" You should now be able to access your app using your IP and port. Now we want to setup a firewall blocking that port and setup NGINX as a reverse proxy so we can access it directly using port 80 (http)")]),a._v(" "),e("h2",{attrs:{id:"_7-setup-ufw-firewall"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-setup-ufw-firewall"}},[a._v("#")]),a._v(" 7. Setup ufw firewall")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("sudo ufw enable\nsudo ufw status\nsudo ufw allow ssh (Port 22)\nsudo ufw allow http (Port 80)\nsudo ufw allow https (Port 443)\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("h2",{attrs:{id:"_8-install-nginx-and-configure"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-install-nginx-and-configure"}},[a._v("#")]),a._v(" 8. Install NGINX and configure")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("sudo apt install nginx\n\nsudo nano /etc/nginx/sites-available/default\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("Add the following to the location part of the server block")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("    server_name yourdomain.com www.yourdomain.com;\n\n    location / {\n        proxy_pass http://localhost:5000; #whatever port your app runs on\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n    }\n# Check NGINX config\nsudo nginx -t\n\n# Restart NGINX\nsudo service nginx restart\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br")])]),e("h3",{attrs:{id:"you-should-now-be-able-to-visit-your-ip-with-no-port-port-80-and-see-your-app-now-let-s-add-a-domain"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#you-should-now-be-able-to-visit-your-ip-with-no-port-port-80-and-see-your-app-now-let-s-add-a-domain"}},[a._v("#")]),a._v(" You should now be able to visit your IP with no port (port 80) and see your app. Now let's add a domain")]),a._v(" "),e("h2",{attrs:{id:"_9-add-domain-in-digital-ocean"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_9-add-domain-in-digital-ocean"}},[a._v("#")]),a._v(" 9. Add domain in Digital Ocean")]),a._v(" "),e("p",[a._v("In Digital Ocean, go to networking and add a domain")]),a._v(" "),e("p",[a._v("Add an A record for @ and for www to your droplet")]),a._v(" "),e("h2",{attrs:{id:"register-and-or-setup-domain-from-registrar"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#register-and-or-setup-domain-from-registrar"}},[a._v("#")]),a._v(" Register and/or setup domain from registrar")]),a._v(" "),e("p",[a._v("I prefer Namecheap for domains. Please use this affiliate link if you are going to use them https://namecheap.pxf.io/c/1299552/386170/5618")]),a._v(" "),e("p",[a._v('Choose "Custom nameservers" and add these 3')]),a._v(" "),e("ul",[e("li",[a._v("ns1.digitalocean.com")]),a._v(" "),e("li",[a._v("ns2.digitalocean.com")]),a._v(" "),e("li",[a._v("ns3.digitalocean.com")])]),a._v(" "),e("p",[a._v("It may take a bit to propogate")]),a._v(" "),e("ol",[e("li",[a._v("Add SSL with LetsEncrypt")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("sudo add-apt-repository ppa:certbot/certbot\nsudo apt-get update\nsudo apt-get install python-certbot-nginx\nsudo certbot --nginx -d yourdomain.com -d www.yourdomain.com\n\n# Only valid for 90 days, test the renewal process with\ncertbot renew --dry-run\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br")])]),e("p",[a._v("Now visit "),e("a",{attrs:{href:"https://yourdomain.com/",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://yourdomain.com"),e("OutboundLink")],1),a._v(" and you should see your Node app")])])}),[],!1,null,null,null);s.default=n.exports}}]);