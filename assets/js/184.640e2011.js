(window.webpackJsonp=window.webpackJsonp||[]).push([[184],{816:function(s,a,t){"use strict";t.r(a);var n=t(6),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"elk-kafka-filebeat日志系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#elk-kafka-filebeat日志系统"}},[s._v("#")]),s._v(" ELK+Kafka+Filebeat日志系统")]),s._v(" "),t("h3",{attrs:{id:"文章目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文章目录"}},[s._v("#")]),s._v(" 文章目录")]),s._v(" "),t("p",[s._v("[toc]")]),s._v(" "),t("h2",{attrs:{id:"_1-环境规划"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境规划"}},[s._v("#")]),s._v(" 1.环境规划")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("IP地址")]),s._v(" "),t("th",[s._v("部署的服务")]),s._v(" "),t("th",[s._v("主机名")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("192.168.81.210")]),s._v(" "),t("td",[s._v("es+kafka+zookeeper+kibana+logstash")]),s._v(" "),t("td",[s._v("elk-1")])]),s._v(" "),t("tr",[t("td",[s._v("192.168.81.220")]),s._v(" "),t("td",[s._v("es+kafka+zookeeper")]),s._v(" "),t("td",[s._v("elk-2")])]),s._v(" "),t("tr",[t("td",[s._v("192.168.81.230")]),s._v(" "),t("td",[s._v("es+kafka+zookeeper+nginx+filebeat")]),s._v(" "),t("td",[s._v("elk-3")])])])]),s._v(" "),t("p",[t("strong",[s._v("日志系统架构图")])]),s._v(" "),t("p",[s._v("nginx—>filebeat—>kafka—>logstash—>elasticsearch—>kibana")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/b9066d7fba54457688d3d8801ae405c4.png",alt:"请添加图片描述"}})]),s._v(" "),t("h2",{attrs:{id:"_2-部署elasticsearch集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-部署elasticsearch集群"}},[s._v("#")]),s._v(" 2.部署elasticsearch集群")]),s._v(" "),t("h3",{attrs:{id:"_2-1-配置es-1节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-配置es-1节点"}},[s._v("#")]),s._v(" 2.1.配置es-1节点")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".下载elasticsearch7.6\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://mirrors.huaweicloud.com/elasticsearch/7.6.0/elasticsearch-7.6.0-x86_64.rpm")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~/soft"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ivh elasticsearch-7.6.0-x86_64.rpm ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".编辑配置文件，配置集群模式\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  vim /etc/elasticsearch/elasticsearch.yml")]),s._v("\ncluster.name: elk-application\nnode.name: elk-1\npath.data: /data/elasticsearch\npath.logs: /var/log/elasticsearch\nbootstrap.memory_lock: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nnetwork.host: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.210,127.0.0.1\nhttp.port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\ncluster.initial_master_nodes: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elk-1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndiscovery.zen.ping.unicast.hosts: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.210"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.220"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.230"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndiscovery.zen.fd.ping_timeout: 120s\ndiscovery.zen.fd.ping_retries: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\ndiscovery.zen.fd.ping_interval: 30s\nhttp.cors.enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nhttp.cors.allow-origin: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".创建数据目录\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /data/elasticsearch/ -p")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chown -R elasticsearch.elasticsearch /data/elasticsearch/")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".配置内存锁定\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /etc/systemd/system/elasticsearch.service.d/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/systemd/system/elasticsearch.service.d/override.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LimitMEMLOCK")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("infinity\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".启动elasticsearch\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start elasticsearch")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable elasticsearch")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("h3",{attrs:{id:"_2-2-配置es-2节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-配置es-2节点"}},[s._v("#")]),s._v(" 2.2.配置es-2节点")]),s._v(" "),t("p",[s._v("只是配置文件中node.name和network.host不同，其他操作方式一致")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-2 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  vim /etc/elasticsearch/elasticsearch.yml")]),s._v("\ncluster.name: elk-application\nnode.name: elk-2\npath.data: /data/elasticsearch\npath.logs: /var/log/elasticsearch\nbootstrap.memory_lock: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nnetwork.host: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.220,127.0.0.1\nhttp.port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\ncluster.initial_master_nodes: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elk-1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndiscovery.zen.ping.unicast.hosts: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.210"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.220"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.230"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndiscovery.zen.fd.ping_timeout: 120s\ndiscovery.zen.fd.ping_retries: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\ndiscovery.zen.fd.ping_interval: 30s\nhttp.cors.enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nhttp.cors.allow-origin: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"_2-3-配置es-3节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-配置es-3节点"}},[s._v("#")]),s._v(" 2.3.配置es-3节点")]),s._v(" "),t("p",[s._v("只是配置文件中node.name和network.host不同，其他操作方式一致")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-2 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  vim /etc/elasticsearch/elasticsearch.yml")]),s._v("\ncluster.name: elk-application\nnode.name: elk-3\npath.data: /data/elasticsearch\npath.logs: /var/log/elasticsearch\nbootstrap.memory_lock: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nnetwork.host: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.230,127.0.0.1\nhttp.port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\ncluster.initial_master_nodes: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elk-1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndiscovery.zen.ping.unicast.hosts: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.210"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.220"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.230"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndiscovery.zen.fd.ping_timeout: 120s\ndiscovery.zen.fd.ping_retries: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\ndiscovery.zen.fd.ping_interval: 30s\nhttp.cors.enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nhttp.cors.allow-origin: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"_2-4-使用es-head插件查看集群状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-使用es-head插件查看集群状态"}},[s._v("#")]),s._v(" 2.4.使用es-head插件查看集群状态")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/b9dd64efa7e14925867b0305a8978a8d.png",alt:"请添加图片描述"}})]),s._v(" "),t("h2",{attrs:{id:"_3-部署kibana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-部署kibana"}},[s._v("#")]),s._v(" 3.部署kibana")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".下载kibana rpm包\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  rpm -ivh kibana-7.6.0-x86_64.rpm ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".配置kibana\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/kibana/kibana.yml")]),s._v("\nserver.port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v("                 \nserver.host: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.210"')]),s._v("               \nserver.name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elk-application"')]),s._v("                        \nelasticsearch.hosts: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.81.210:9200"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("       \ni18n.locale: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zh-CN"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart kibana")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  systemctl enable elasticsearch")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[t("strong",[s._v("kibana部署成功")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/6424482e309e41be978d64816562e14b.png",alt:"请添加图片描述"}})]),s._v(" "),t("h2",{attrs:{id:"_4-部署zookeeper"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-部署zookeeper"}},[s._v("#")]),s._v(" 4.部署zookeeper")]),s._v(" "),t("h3",{attrs:{id:"_4-1-配置zookeeper-1节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-配置zookeeper-1节点"}},[s._v("#")]),s._v(" 4.1.配置zookeeper-1节点")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".下载软件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget http://archive.apache.org/dist/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".解压并移动zookeeper\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf soft/zookeeper-3.4.13.tar.gz -C /data/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mv /data/zookeeper-3.4.13/ /data/zookeeper")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".创建数据目录和日志目录\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /data/zookeeper/{data,logs}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".准备配置文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /data/zookeeper/conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/zookeeper/conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp zoo_sample.cfg zoo.cfg")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/zookeeper/conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim zoo.cfg ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tickTime")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("initLimit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("syncLimit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dataDir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/zookeeper/data\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DataLogDir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/zookeeper/logs\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("clientPort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2181")]),s._v("\n\nserver.1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.210:2888:3888\nserver.2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.220:2888:3888\nserver.3"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.230:2888:3888\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".生成节点id文件\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#节点id只能保护数字")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/zookeeper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 1 > /data/zookeeper/data/myid")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("h3",{attrs:{id:"_4-2-配置zookeeper-2节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-配置zookeeper-2节点"}},[s._v("#")]),s._v(" 4.2.配置zookeeper-2节点")]),s._v(" "),t("p",[s._v("与zookeeper-1节点只有配置文件和节点id文件有点不同，其余全一样")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-2 /data/zookeeper/conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat zoo.cfg ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tickTime")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("initLimit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("syncLimit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dataDir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/zookeeper/data\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DataLogDir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/zookeeper/logs\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("clientPort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2181")]),s._v("\n\nserver.1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.210:2888:3888\nserver.2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.220:2888:3888\nserver.3"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.230:2888:3888\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-2 /data/zookeeper/conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 2 > /data/zookeeper/data/myid")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h3",{attrs:{id:"_4-3-配置zookeeper-3节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-配置zookeeper-3节点"}},[s._v("#")]),s._v(" 4.3.配置zookeeper-3节点")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 /data/zookeeper/conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat zoo.cfg ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tickTime")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("initLimit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("syncLimit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dataDir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/zookeeper/data\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DataLogDir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/zookeeper/logs\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("clientPort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2181")]),s._v("\n\nserver.1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.210:2888:3888\nserver.2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.220:2888:3888\nserver.3"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.230:2888:3888\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 /data/zookeeper/conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 3 > /data/zookeeper/data/myid")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h3",{attrs:{id:"_4-4-启动所有节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-启动所有节点"}},[s._v("#")]),s._v(" 4.4.启动所有节点")]),s._v(" "),t("blockquote",[t("p",[s._v("zookeeper集群必须保证有两个节点存活，也就是说必须同时要启动两个节点，否则集群将启动不成功，因此要都修改好配置文件后，再统一启动")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/zookeeper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./bin/zkServer.sh status")]),s._v("\nZooKeeper JMX enabled by default\nUsing config: /data/zookeeper/bin/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/conf/zoo.cfg\nMode: follower\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-2 /data/zookeeper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./bin/zkServer.sh status")]),s._v("\nZooKeeper JMX enabled by default\nUsing config: /data/zookeeper/bin/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/conf/zoo.cfg\nMode: follower\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 /data/zookeeper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./bin/zkServer.sh status")]),s._v("\nZooKeeper JMX enabled by default\nUsing config: /data/zookeeper/bin/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/conf/zoo.cfg\nMode: leader\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h2",{attrs:{id:"_5-部署kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-部署kafka"}},[s._v("#")]),s._v(" 5.部署kafka")]),s._v(" "),t("p",[t("strong",[s._v("注意：")]),t("code",[s._v("不要使用kafka2.11版本，有严重的bug，filebeat无法写入数据到kafka集群，写入的协议版本不同，存在问题")])]),s._v(" "),t("h3",{attrs:{id:"_5-1-配置kafka-1节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-配置kafka-1节点"}},[s._v("#")]),s._v(" 5.1.配置kafka-1节点")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".下载二进制包\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://archive.apache.org/dist/kafka/2.0.0/kafka_2.11-2.0.0.tgz")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".安装kafka\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~/soft"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf kafka_2.13-2.4.0.tgz -C /data/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mv /data/kafka_2.13-2.4.0 /data/kafka")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".修改配置文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /data/kafka")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/kafka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim config/server.properties ")]),s._v("\nbroker.id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listeners")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PLAINTEXT://192.168.81.210:9092\nhost.name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.210\nadvertised.listeners"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PLAINTEXT://192.168.81.210:9092\nadvertised.host.name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.210\nnum.network.threads"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nnum.io.threads"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\nsocket.send.buffer.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\nsocket.receive.buffer.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\nsocket.request.max.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("104857600")]),s._v("\nlog.dirs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/kafka/data\nnum.partitions"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\ndelete.topic.enable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\nauto.create.topics.enable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true \nreplica.fetch.max.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5242880")]),s._v("\nnum.recovery.threads.per.data.dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\noffsets.topic.replication.factor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\ntransaction.state.log.replication.factor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\ntransaction.state.log.min.isr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nmessage.max.byte"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5242880")]),s._v("\nlog.cleaner.enable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\nlog.retention.hours"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\nlog.segment.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1073741824")]),s._v("\nlog.retention.check.interval.ms"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\nzookeeper.connect"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.210:2181,192.168.81.220:2181,192.168.81.230:2181\nzookeeper.connection.timeout.ms"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60000")]),s._v("\ngroup.initial.rebalance.delay.ms"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".创建数据目录\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /data/kafka/data")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("h3",{attrs:{id:"_5-2-配置kafka-2节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-配置kafka-2节点"}},[s._v("#")]),s._v(" 5.2.配置kafka-2节点")]),s._v(" "),t("p",[s._v("只是配置文件不同，其余与kafka-1节点操作一致")]),s._v(" "),t("p",[s._v("配置文件需要改的地方：broker.id改成2，表示第二个节点 listeners host.name advertised.listeners advertised.host.name改成本机ip地址")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-2 /data/kafka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat config/server.properties ")]),s._v("\nbroker.id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listeners")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PLAINTEXT://192.168.81.220:9092\nhost.name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.220\nadvertised.listeners"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PLAINTEXT://192.168.81.220:9092\nadvertised.host.name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.220\nnum.network.threads"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nnum.io.threads"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\nsocket.send.buffer.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\nsocket.receive.buffer.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\nsocket.request.max.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("104857600")]),s._v("\nlog.dirs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/kafka/data\nnum.partitions"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\ndelete.topic.enable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\nauto.create.topics.enable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true \nreplica.fetch.max.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5242880")]),s._v("\nnum.recovery.threads.per.data.dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\noffsets.topic.replication.factor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\ntransaction.state.log.replication.factor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\ntransaction.state.log.min.isr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nmessage.max.byte"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5242880")]),s._v("\nlog.cleaner.enable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\nlog.retention.hours"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\nlog.segment.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1073741824")]),s._v("\nlog.retention.check.interval.ms"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\nzookeeper.connect"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.210:2181,192.168.81.220:2181,192.168.81.230:2181\nzookeeper.connection.timeout.ms"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60000")]),s._v("\ngroup.initial.rebalance.delay.ms"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("h3",{attrs:{id:"_5-3-配置kafka-3节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-配置kafka-3节点"}},[s._v("#")]),s._v(" 5.3.配置kafka-3节点")]),s._v(" "),t("p",[s._v("只是配置文件不同，其余与kafka-1节点操作一致")]),s._v(" "),t("p",[s._v("配置文件需要改的地方：broker.id改成3，表示第三个节点 listeners host.name advertised.listeners advertised.host.name改成本机ip地址")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 /data/kafka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat config/server.properties ")]),s._v("\nbroker.id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listeners")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PLAINTEXT://192.168.81.230:9092\nhost.name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.230\nadvertised.listeners"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PLAINTEXT://192.168.81.230:9092\nadvertised.host.name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.230\nnum.network.threads"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nnum.io.threads"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\nsocket.send.buffer.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\nsocket.receive.buffer.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\nsocket.request.max.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("104857600")]),s._v("\nlog.dirs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/kafka/data\nnum.partitions"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\ndelete.topic.enable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\nauto.create.topics.enable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true \nreplica.fetch.max.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5242880")]),s._v("\nnum.recovery.threads.per.data.dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\noffsets.topic.replication.factor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\ntransaction.state.log.replication.factor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\ntransaction.state.log.min.isr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nmessage.max.byte"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5242880")]),s._v("\nlog.cleaner.enable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\nlog.retention.hours"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\nlog.segment.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1073741824")]),s._v("\nlog.retention.check.interval.ms"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\nzookeeper.connect"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".81.210:2181,192.168.81.220:2181,192.168.81.230:2181\nzookeeper.connection.timeout.ms"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60000")]),s._v("\ngroup.initial.rebalance.delay.ms"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("h3",{attrs:{id:"_5-4-启动kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-启动kafka"}},[s._v("#")]),s._v(" 5.4.启动kafka")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /data/kafka/bin/kafka-server-start -daemon /data/kafka/config/server.properties")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-2 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /data/kafka/bin/kafka-server-start -daemon /data/kafka/config/server.properties")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /data/kafka/bin/kafka-server-start -daemon /data/kafka/config/server.properties")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"_6-测试kafka与zookeeper连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-测试kafka与zookeeper连接"}},[s._v("#")]),s._v(" 6.测试kafka与zookeeper连接")]),s._v(" "),t("p",[s._v("kafka能够产生数据并消费，整个集群就可以使用了")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".创建一个topic\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/kafka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./bin/kafka-topics.sh --create --zookeeper 192.168.81.210:2181,192.168.81.220:2181,192.168.81.230:2181 --replication-factor 1 --partitions 1 --topic testpic")]),s._v("\nCreated topic "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"testpic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".查看topic\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/kafka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./bin/kafka-topics.sh --list --zookeeper 192.168.81.210:2181,192.168.81.220:2181,192.168.81.230:2181")]),s._v("\ntestpic\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".查看topic的描述信息\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/kafka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./bin/kafka-topics.sh --describe --zookeeper 192.168.81.210:2181,192.168.81.220:2181,192.168.81.230:2181 --topic testpic")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".使用kafka-console-producer控制台生产数据\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/kafka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./bin/kafka-console-producer.sh --broker-list 192.168.81.210:9092,192.168.81.220:9092,192.168.81.230:9092 --topic testpic")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("test1\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("test2\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("test3\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("test4\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("test5\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("test6\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("test7\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("test8\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("test9\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("test10\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".使用kafka-console-consumer控制台消费数据\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/kafka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./bin/kafka-console-consumer.sh --bootstrap-server 192.168.81.210:9092,192.168.81.220:9092,192.168.81.230:9092 --topic testpic --from-beginning")]),s._v("\ntest1\ntest2\ntest3\ntest4\ntest5\ntest6\ntest7\ntest8\ntest9\ntest10\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除一个topic")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/kafka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./bin/kafka-topics.sh --delete --zookeeper 192.168.81.210:2181  --topic testpic")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/61738bb4dacf417784c5a62ce3388bdd.png",alt:"请添加图片描述"}})]),s._v(" "),t("h2",{attrs:{id:"_7-配置filebeat收集nginx、tomcat日志并存储到kafka中"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-配置filebeat收集nginx、tomcat日志并存储到kafka中"}},[s._v("#")]),s._v(" 7.配置filebeat收集nginx、tomcat日志并存储到kafka中")]),s._v(" "),t("h3",{attrs:{id:"_7-1-安装并配置nginx服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-安装并配置nginx服务"}},[s._v("#")]),s._v(" 7.1.安装并配置nginx服务")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".安装nginx\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum -y install nginx")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".配置nginx日志格式\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/nginx/nginx.conf")]),s._v("\nhttp "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n··············\n    log_format  main "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"时间":"$time_iso8601",\'')]),s._v("\n                       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"客户端外网地址":"$http_x_forwarded_for",\'')]),s._v("\n                       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"客户端内网地址":"$remote_addr",\'')]),s._v("\n                       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"状态码\":$status,'")]),s._v("\n                       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"传输流量\":$body_bytes_sent,'")]),s._v("\n                       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"跳转来源":"$http_referer",\'')]),s._v("\n                       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"URL":"$request",\'')]),s._v("\n                       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"浏览器":"$http_user_agent",\'')]),s._v("\n                       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"请求响应时间\":$request_time,'")]),s._v("\n                       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"后端地址":"$upstream_addr"}\'')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    access_log  /var/log/nginx/access.log  main"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n··············\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".启动nginx\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable nginx")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".访问产生日志查看效果\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 127.0.0.1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tail /var/log/nginx/access.log ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"时间"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-07-12T11:29:33+08:00"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"客户端外网地址"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"客户端内网地址"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"状态码"')]),s._v(":200,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"传输流量"')]),s._v(":4833,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"跳转来源"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"URL"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"浏览器"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.29.0"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"请求响应时间"')]),s._v(":0.000,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"后端地址"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("h3",{attrs:{id:"_7-2-安装tomcat服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-安装tomcat服务"}},[s._v("#")]),s._v(" 7.2.安装tomcat服务")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf apache-tomcat-8.5.12.tar.gz -C /data/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mv /data/apache-tomcat-8.5.12/ /data/tomcat")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /data/tomcat/bin/startup.sh ")]),s._v("\nUsing CATALINA_BASE:   /data/tomcat\nUsing CATALINA_HOME:   /data/tomcat\nUsing CATALINA_TMPDIR: /data/tomcat/temp\nUsing JRE_HOME:        /usr\nUsing CLASSPATH:       /data/tomcat/bin/bootstrap.jar:/data/tomcat/bin/tomcat-juli.jar\nTomcat started.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"_7-3-安装filebeat服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-安装filebeat服务"}},[s._v("#")]),s._v(" 7.3.安装filebeat服务")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ivh filebeat-7.6.0-x86_64.rpm ```")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_7-4-配置filebeat收集应用日志并存储到kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-配置filebeat收集应用日志并存储到kafka"}},[s._v("#")]),s._v(" 7.4.配置filebeat收集应用日志并存储到kafka")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".配置filebeat\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/filebeat/filebeat.yml ")]),s._v("\nfilebeat.inputs:\n- type: log                                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#类型为log")]),s._v("\n  enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  paths:                                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定日志所在的路径")]),s._v("\n    - /var/log/nginx/access.log\n  json.keys_under_root: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#支持json格式的日志输出")]),s._v("\n  json.overwriite_keys: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  fields:                                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在日志中增加一个字段，字段为log_topic，值为nginx_access，logstash根据带有这个字段的日志存储到指定的es索引库")]),s._v("\n    log_topic: nginx-access\n  tail_files: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启日志监控，从日志的最后一行开始收集")]),s._v("\n\n- type: log\n  enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  paths:\n    - /data/tomcat/logs/catalina.out\n  multiline.pattern: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^20'")]),s._v("                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#收集tomcat错误日志，从第一个20到下一个20之间的日志整合在一行中显示")]),s._v("\n  multiline.negate: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  multiline.match: after\n  fields:\n    log_topic: tomcat-cata\n  tail_files: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\noutput.kafka:                                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输出到kafka系统")]),s._v("\n  enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  hosts: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.210:9092"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.220:9092"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.230:9092"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#kafka的地址")]),s._v("\n  topic: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%{[fields][log_topic]}'")]),s._v("               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定将日志存储到kafka集群的哪个topic中，这里的topic值是引用在inputs中定义的fields，通过这种方式可以将不同路径的日志分别存储到不同的topic中")]),s._v("\n  partition.round_robin:\n    reachable_only: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  required_acks: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  compression: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v("\n  max_message_bytes: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".启动filebeat\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start filebeat")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable filebeat")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("h3",{attrs:{id:"_7-5-产生程序日志数据观察数据是否存储kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-5-产生程序日志数据观察数据是否存储kafka"}},[s._v("#")]),s._v(" 7.5.产生程序日志数据观察数据是否存储kafka")]),s._v(" "),t("p",[t("strong",[s._v("1.产生程序日志")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".产生nginx日志\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ab -n 1000 -c 100 http://127.0.0.1/index.html")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".产生tomcat日志\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /data/tomcat/bin/shutdown.sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /data/tomcat/bin/startup.sh ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("2.观察kafka中是否创建对应的topic")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/kafka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./bin/kafka-topics.sh --list --zookeeper 192.168.81.210:2181,192.168.81.220:2181,192.168.81.230:2181")]),s._v("\n__consumer_offsets\nnginx-access\ntestpic\ntomcat-cata\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx-access以及tomcat-cata的topic已经创建成功")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[t("strong",[s._v("3.观察kafka日志的输出")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-1 /data/kafka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tail -f logs/kafkaServer.out")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/ec8b60b64feb4c1c818b878612dce48d.png",alt:"在这里插入图片描述"}})]),s._v(" "),t("h2",{attrs:{id:"_8-配置logstash从kafka中读取数据并存储到es集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-配置logstash从kafka中读取数据并存储到es集群"}},[s._v("#")]),s._v(" 8.配置logstash从kafka中读取数据并存储到es集群")]),s._v(" "),t("blockquote",[t("p",[s._v("部署logstash，配置logstash从kafka中读取topic数据并存储到es集群")])]),s._v(" "),t("h3",{attrs:{id:"_8-1-部署logstash服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-部署logstash服务"}},[s._v("#")]),s._v(" 8.1.部署logstash服务")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".安装logstash\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ivh logstash-7.6.0.rpm")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_8-2-配置logstash从kafka读取数据存储到es集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-配置logstash从kafka读取数据存储到es集群"}},[s._v("#")]),s._v(" 8.2.配置logstash从kafka读取数据存储到es集群")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/logstash/conf.d/in_kafka_to_es.conf ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从kafka中读取日志数据")]),s._v("\ninput "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据源端")]),s._v("\n  kafka "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#类型为kafka")]),s._v("\n    bootstrap_servers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.210:9092,192.168.81.220:9092,192.168.81.230:9092"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#kafka集群地址")]),s._v("\n    topics "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-access"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tomcat-cata"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#要读取那些kafka topics")]),s._v("\n    codec "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"json"')]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#处理json格式的数据")]),s._v("\n    auto_offset_reset "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"latest"')]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#只消费最新的kafka数据")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#处理数据，去掉没用的字段")]),s._v("\nfilter "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  if"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fields"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("log_topic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-access"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果log_topic字段为nginx-access则进行以下数据处理")]),s._v("\n      json "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#json格式数据处理")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#source等于message的")]),s._v("\n           remove_field "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@version"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"beat"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"input"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"offset"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prospector"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tags"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除指定的字段")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      mutate "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改数据")]),s._v("\n           remove_field "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_index"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_type"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_version"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_score"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"referer"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"agent"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除没用的字段")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n  if"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fields"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("log_topic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tomcat-cata"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果log_topic字段为tomcat-cata")]),s._v("\n      grok "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解析格式")]),s._v("\n     match "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(?<时间>20[0-9]{2}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}) \\[(?<线程名称>[^\\s]{0,})\\] (?<日志等级>\\w+) (?<类名称>[^\\s]{0,}) (?<日志详情>[\\W\\w]+)"')]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将message的值增加上一些格式")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      mutate "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改数据")]),s._v("\n                 remove_field "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_index"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_type"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_version"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_score"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"referer"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"agent"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除没用的字段")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据处理后存储es集群")]),s._v("\noutput "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#目标端")]),s._v("\n  if"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fields"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("log_topic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-access"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果log_topic的字段值为nginx-access就存到下面的es集群里")]),s._v("\n      elasticsearch "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("           \n    action "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index"')]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#类型为索引")]),s._v("\n    hosts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.210:9200"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.220:9200"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.230:9200"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#es集群地址")]),s._v("\n    index "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-access-%{+YYYY.MM.dd}"')]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#存储到es集群的哪个索引里")]),s._v("\n    codec "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"json"')]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#处理json格式的解析")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n  if"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fields"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("log_topic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tomcat-cata"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果log_topic的字段值为tomcat-cata就存到下面的es集群里")]),s._v("\n      elasticsearch "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    action "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index"')]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#类型为索引")]),s._v("\n    hosts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.210:9200"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.220:9200"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.81.230:9200"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#es集群地址")]),s._v("\n    index "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tomcat-cata-%{+YYYY.MM.dd}"')]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#存储到es集群的哪个索引里")]),s._v("\n    codec "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"json"')]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#处理json格式的解析")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("     \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br")])]),t("h3",{attrs:{id:"_8-3-启动logstash并观察日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-启动logstash并观察日志"}},[s._v("#")]),s._v(" 8.3.启动logstash并观察日志")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@elk-3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nphup /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/in_kafka_to_es.conf &")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("观察日志的输出，已经从nginx-access、tomcat-cata topic中读取了数据并存到了es集群中\n"),t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/dea0c0f1f103481c9a73df6a82ca16d7.png",alt:"在这里插入图片描述"}})]),s._v(" "),t("h3",{attrs:{id:"_8-4-查看elasticsearch集群是否增加了对应的索引库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-查看elasticsearch集群是否增加了对应的索引库"}},[s._v("#")]),s._v(" 8.4.查看elasticsearch集群是否增加了对应的索引库")]),s._v(" "),t("p",[s._v("es集群已经生成了tomcat-cata以及nginx-access索引库")]),s._v(" "),t("p",[s._v("到此为止logstash已经成功从kafka集群读取到日志数据，然后传入到elasticsearch集群不同的索引库")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/186fadff16cc45d188cb2ee02b40d11f.png",alt:"请添加图片描述"}})]),s._v(" "),t("h2",{attrs:{id:"_9-在kibana上关联elasticsearch索引库浏览日志数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-在kibana上关联elasticsearch索引库浏览日志数据"}},[s._v("#")]),s._v(" 9.在kibana上关联elasticsearch索引库浏览日志数据")]),s._v(" "),t("h3",{attrs:{id:"_9-1-在kibana上添加nginx-access索引模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-在kibana上添加nginx-access索引模式"}},[s._v("#")]),s._v(" 9.1.在kibana上添加nginx-access索引模式")]),s._v(" "),t("p",[t("strong",[s._v("1）点击创建索引")]),s._v(" "),t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/70a3b3aeb1c4474e8326021566c7f70c.png",alt:"在这里插入图片描述"}})]),s._v(" "),t("p",[t("strong",[s._v("2）填写索引名")])]),s._v(" "),t("p",[s._v("采用通配符的方式，填写完点击下一步完成创建即可")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/b31ee5436a13417eb40c9fa57c36b010.png",alt:"在这里插入图片描述"}})]),s._v(" "),t("p",[t("strong",[s._v("3）添加一个时间筛选字段")]),s._v(" "),t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/7dc6fe61a48247419859ea2b10770f36.png",alt:"在这里插入图片描述"}})]),s._v(" "),t("p",[t("strong",[s._v("4）创建成功")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/9d02b90e81b54360a8952d356453cdfc.png",alt:"在这里插入图片描述"}})]),s._v(" "),t("h3",{attrs:{id:"_9-2-同样方法添加tomcat-cata索引模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-同样方法添加tomcat-cata索引模式"}},[s._v("#")]),s._v(" 9.2.同样方法添加tomcat-cata索引模式")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/f64e10dd7823423cb905551c93340751.png",alt:"在这里插入图片描述"}})]),s._v(" "),t("h3",{attrs:{id:"_9-3-查询nginx-access索引日志数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-查询nginx-access索引日志数据"}},[s._v("#")]),s._v(" 9.3.查询nginx-access索引日志数据")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/4540ea34a2d44141a0faff48019d077d.png",alt:"在这里插入图片描述"}})]),s._v(" "),t("h3",{attrs:{id:"_9-4-查看tomcat-cata索引日志数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-查看tomcat-cata索引日志数据"}},[s._v("#")]),s._v(" 9.4.查看tomcat-cata索引日志数据")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/9317c5e4851d40178f101c88058e8cbc.png",alt:"在这里插入图片描述"}})]),s._v(" "),t("h2",{attrs:{id:"_10-报错合集"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-报错合集"}},[s._v("#")]),s._v(" 10.报错合集")]),s._v(" "),t("h3",{attrs:{id:"_10-1-es启动时报错无法指定被请求的地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-es启动时报错无法指定被请求的地址"}},[s._v("#")]),s._v(" 10.1.es启动时报错无法指定被请求的地址")]),s._v(" "),t("blockquote",[t("p",[s._v("报错内容如下")]),s._v(" "),t("p",[s._v("解决方法：仔细检查配置文件，肯定是某个地址配置错了，我的就是监听地址的ip写错了\n"),t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/146eb6476be4493ab8285c8457087ac2.png",alt:"在这里插入图片描述"}})])]),s._v(" "),t("h3",{attrs:{id:"_10-2-filebeat写入数据到kafka-api版本报错"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-filebeat写入数据到kafka-api版本报错"}},[s._v("#")]),s._v(" 10.2.filebeat写入数据到kafka api版本报错")]),s._v(" "),t("blockquote",[t("p",[s._v("报错如下：")]),s._v(" "),t("p",[s._v("分析解决思路：初步判定为kafka2.11版本问题导致的，换成2.13问题解决")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/others/cb481cdb7ef5411795728d7d4bdc4843.png",alt:"在这里插入图片描述"}})]),s._v(" "),t("blockquote",[t("p",[s._v("该文章为转载内容，仅做备份私人学习使用，原文：https://jiangxl.blog.csdn.net/article/details/119733673")])])])}),[],!1,null,null,null);a.default=e.exports}}]);