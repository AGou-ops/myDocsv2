(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{694:function(s,a,t){"use strict";t.r(a);var n=t(6),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"六-pod-配置清单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#六-pod-配置清单"}},[s._v("#")]),s._v(" 六 POD 配置清单")]),s._v(" "),t("h2",{attrs:{id:"_6-1-pods-metadata-pod元数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-pods-metadata-pod元数据"}},[s._v("#")]),s._v(" 6.1 pods.metadata POD元数据")]),s._v(" "),t("h3",{attrs:{id:"_6-1-1-labels-标签"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-1-labels-标签"}},[s._v("#")]),s._v(" 6.1.1 labels 标签")]),s._v(" "),t("ul",[t("li",[s._v("labels 定义标签，键值对组成的标签")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("  labels:\n    app: myapp\n    tier: frontend\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"_6-2-pods-spec-规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-pods-spec-规范"}},[s._v("#")]),s._v(" 6.2 pods.spec 规范")]),s._v(" "),t("h3",{attrs:{id:"_6-2-1-nodename-运行节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-1-nodename-运行节点"}},[s._v("#")]),s._v(" 6.2.1 nodeName 运行节点")]),s._v(" "),t("ul",[t("li",[s._v("在使用资源清单定义 pod 时候，使用 nodeName 可以直接绑定资源对象在哪个 POD 运行的节点")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deme\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" frontend\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node2                           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接指定 POD 运行的节点")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ikubernetes/myapp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h3",{attrs:{id:"_6-2-2-nodeselector-节点选择"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-2-nodeselector-节点选择"}},[s._v("#")]),s._v(" 6.2.2 nodeSelector 节点选择")]),s._v(" "),t("ul",[t("li",[s._v("在使用资源清单定义 pod 时候，使用 nodeSelector （节点标签选择器）字段，来定义节点的倾向性")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deme\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" frontend\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 spec 中定义这个 POD 的节点倾向性")]),s._v("\n  \t"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("disktype")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ssd                         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个 POD 最终会运行在拥有 disktype 标签且值为 ssd 的 nodes 上")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ikubernetes/myapp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("ul",[t("li",[s._v("从文件启动 pod，观察 pod 运行的节点，会发现已经运行在有标签的 node 节点上了")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl create -f pod-demo.yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("kubectl get pods -o wide\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("NAME       READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED NODE   READINESS GATES\npod-demo   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21s   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".2.29   node3   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_6-2-3-restartpolicy-pod重启策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-3-restartpolicy-pod重启策略"}},[s._v("#")]),s._v(" 6.2.3 restartPolicy POD重启策略")]),s._v(" "),t("p",[s._v("Always：一旦容器挂了，那么总是重启它，k8s 每次重启策略为 30 秒的两倍，直到等待 300 秒重启。")]),s._v(" "),t("p",[s._v("OnFailure：只有其状态为错误的时候才去重启它")]),s._v(" "),t("p",[s._v("Never：从来不重启，挂了就挂了")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("一旦某个 POD 被调度到某个节点上，只要这个节点在，那么它就不会被重新调度，只能被重启，除非 POD 被删除才会被重新调度，或者 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" 挂了，才会被重新调度，否则只要 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" 在，那么 POD 就不会被重新调度，如果 POD 启动失败，那么将不断的重启 POD。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("当需要终止 POD ，k8s 发送 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -15 信号，让容器平滑的终止，等待 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" 秒的宽限期，如果没有终止，那么则发送 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" 信号\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_6-2-4-hostnetwork-主机网络空间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-4-hostnetwork-主机网络空间"}},[s._v("#")]),s._v(" 6.2.4 hostNetwork 主机网络空间")]),s._v(" "),t("p",[s._v("使用布尔值指定是否让 POD 使用主机的网络名称空间")]),s._v(" "),t("h3",{attrs:{id:"_6-2-5-hostpid-主机pid空间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-5-hostpid-主机pid空间"}},[s._v("#")]),s._v(" 6.2.5 hostPID 主机PID空间")]),s._v(" "),t("p",[s._v("使用布尔值指定是否让 POD 使用主机的PID名称空间")]),s._v(" "),t("h3",{attrs:{id:"_6-2-6-containers-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-6-containers-配置"}},[s._v("#")]),s._v(" 6.2.6 containers 配置")]),s._v(" "),t("blockquote",[t("p",[s._v("kubectl explain pods.spec.containers")])]),s._v(" "),t("p",[s._v("描述 POD 内所运行容器，语法：containers <[]Object>，表示它的值为数组，数组内使用对象的方式来描述一个容器，对象可以有以下参数：")]),s._v(" "),t("ul",[t("li",[s._v("可用参数")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("参数")]),s._v(" "),t("th",[s._v("作用")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("args")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("command")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("env")]),s._v(" "),t("td",[s._v("向容器传递环境变量")])]),s._v(" "),t("tr",[t("td",[s._v("envFrom")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("image")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("imagePullPolicy")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("lifecycle")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("livenessProbe")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("name")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("ports")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("readinessProbe")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("resources")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("securityContext")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("stdin")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("stdinOnce")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("terminationMessagePath")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("terminationMessagePolicy")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("tty")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("volumeDevices")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("volumeMounts")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("workingDir")]),s._v(" "),t("td")])])]),s._v(" "),t("ul",[t("li",[s._v("示例型配置")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-deme                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod 的名称")]),s._v("\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n    - name: myapp                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行的容器名称")]),s._v("\n      image: ikubernetes/myapp:v1      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器的镜像")]),s._v("\n      imagePullPolicy: IfNotPresent    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从仓库获取镜像的策略")]),s._v("\n      ports:                           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义容器暴漏的端口")]),s._v("\n    - name: busybox\n      image: busybox:latest\n      command:\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v("\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v("\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sleep 10"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h4",{attrs:{id:"_6-2-6-1-imagepullpolicy下载策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-6-1-imagepullpolicy下载策略"}},[s._v("#")]),s._v(" 6.2.6.1 imagePullPolicy下载策略")]),s._v(" "),t("ul",[t("li",[s._v("imagePullPolicy 镜像获取的策略，详见："),t("code",[s._v("kubectl explain pods.spec.containers")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Always            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 总是从仓库下载")]),s._v("\nNever             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从不下载，本地有就用，没有就失败")]),s._v("\nIfNotPresent      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果本地存在就直接使用，如果不存在就下载")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("blockquote",[t("p",[s._v("如果标签是 latest 那么则始终从仓库下载")])]),s._v(" "),t("h4",{attrs:{id:"_6-2-6-2-ports-端口信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-6-2-ports-端口信息"}},[s._v("#")]),s._v(" 6.2.6.2 ports 端口信息")]),s._v(" "),t("ul",[t("li",[s._v("ports 定义容器保暴露的，详见："),t("code",[s._v("kubectl explain pods.spec.containers.ports")])])]),s._v(" "),t("p",[s._v("在此处暴露的端口可为系统提供有关容器的网络连接的信息，但主要是信息性的，此处没有指定的端口也不会阻止容器暴露该端口，容器中任何侦听 0.0.0.0 地址的端口都可以从网络访问")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义两个端口对象一个 http 一个 https")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义这个端口的名称，方便别的对象取引用")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 端口号")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方便引用的名称")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个端口号仅仅是起到信息的作用，方便查看和使用名称引用")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"_6-2-6-3-env-传递环境变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-6-3-env-传递环境变量"}},[s._v("#")]),s._v(" 6.2.6.3 env 传递环境变量")]),s._v(" "),t("ul",[t("li",[s._v("Use Pod fields")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MY_NODE_NAME\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" spec.nodeName\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MY_POD_NAME\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metadata.name\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MY_POD_NAMESPACE\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metadata.namespace\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MY_POD_IP\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" status.podIP\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MY_POD_SERVICE_ACCOUNT\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" spec.serviceAccountName\n              \n              \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("ul",[t("li",[s._v("Use Container fields")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MY_CPU_REQUEST\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceFieldRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" requests.cpu\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MY_CPU_LIMIT\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceFieldRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" limits.cpu\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MY_MEM_REQUEST\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceFieldRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" requests.memory\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MY_MEM_LIMIT\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceFieldRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" limits.memory\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("在容器中获取 POD 的信息\n\n可以使用环境变量\n可以使用 downwardAPI\nhttps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//kubernetes.io/zh/docs/tasks/inject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("application/downward"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("api"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("expose"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("information/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"_6-2-6-4-command-entrypoint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-6-4-command-entrypoint"}},[s._v("#")]),s._v(" 6.2.6.4 command ENTRYPOINT")]),s._v(" "),t("ul",[t("li",[s._v("command 定义容器运行的程序，详见：")])]),s._v(" "),t("p",[s._v("https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/")]),s._v(" "),t("p",[s._v("一个 entrypoint array 而 command 启动的程序是不会运行在 Shell 中的，如果想要运行在 Shell 中需要自己填写，如果没有提供这个指令，那么将运行 docker 镜像中的 ENTRYPOINT。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("Image Entrypoint")]),s._v(" "),t("th",[s._v("Image Cmd")]),s._v(" "),t("th",[s._v("Container command")]),s._v(" "),t("th",[s._v("Container args")]),s._v(" "),t("th",[s._v("Command run")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("code",[s._v("[/ep-1]")])]),s._v(" "),t("td",[t("code",[s._v("[foo bar]")])]),s._v(" "),t("td",[t("not",{attrs:{set:""}})],1),s._v(" "),t("td",[t("not",{attrs:{set:""}})],1),s._v(" "),t("td",[t("code",[s._v("[ep-1 foo bar]")])])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("[/ep-1]")])]),s._v(" "),t("td",[t("code",[s._v("[foo bar]")])]),s._v(" "),t("td",[t("code",[s._v("[/ep-2]")])]),s._v(" "),t("td",[t("not",{attrs:{set:""}})],1),s._v(" "),t("td",[t("code",[s._v("[ep-2]")])])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("[/ep-1]")])]),s._v(" "),t("td",[t("code",[s._v("[foo bar]")])]),s._v(" "),t("td",[t("not",{attrs:{set:""}})],1),s._v(" "),t("td",[t("code",[s._v("[zoo boo]")])]),s._v(" "),t("td",[t("code",[s._v("[ep-1 zoo boo]")])])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("[/ep-1]")])]),s._v(" "),t("td",[t("code",[s._v("[foo bar]")])]),s._v(" "),t("td",[t("code",[s._v("[/ep-2]")])]),s._v(" "),t("td",[t("code",[s._v("[zoo boo]")])]),s._v(" "),t("td",[t("code",[s._v("[ep-2 zoo boo]")])])])])]),s._v(" "),t("h4",{attrs:{id:"_6-2-6-5-args-cmd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-6-5-args-cmd"}},[s._v("#")]),s._v(" 6.2.6.5 args CMD")]),s._v(" "),t("ul",[t("li",[s._v("args 向 command 传递参数的")])]),s._v(" "),t("p",[s._v("如果你没有定义 args 而镜像中又存在 ENTRYPOINT 指令和 CMD 指令，那么镜像自己的 CMD 将作为参数传递给 ENTRYPOINT。如果手动指定了 args 那么镜像中的 CMD 字段不再作为参数进行传递。")]),s._v(" "),t("p",[s._v("如果在 args 中引用了变量，则需要使用 $(VAR_NAME) 来引用一个变量，如果不想在这里进行命令替换，那么可以 $$(VAR_NAME)，转义后在容器内使用。")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MESSAGE\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello kaliarch"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/echo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$(MESSAGE)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"_6-2-6-6-annotations-注解信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-6-6-annotations-注解信息"}},[s._v("#")]),s._v(" 6.2.6.6 annotations 注解信息")]),s._v(" "),t("p",[s._v("annotations 与 label 不同的地方在于，它不能用于挑选资源对象，仅为对象提供元数据，它的长度不受限制")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deme\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" frontend\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注解关键字")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kaliarch/created-by")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xuel"')]),s._v("                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加键值对的资源注解")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ikubernetes/myapp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h4",{attrs:{id:"_6-2-6-7-pod-生命周期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-6-7-pod-生命周期"}},[s._v("#")]),s._v(" 6.2.6.7 POD 生命周期")]),s._v(" "),t("ul",[t("li",[s._v("一般状态")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Pending：已经创建但是没有适合运行它的节点，已经调度，但是尚未完成\nRunning：运行状态\nFailed： 启动失败\nSucceed：成功，这个状态很短\nUnkown： 未知的状态，如果 Apiserver 与 kubelet 通信失败则会处于这个状态\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("创建 POD 阶段")])]),s._v(" "),t("p",[s._v("用户的创建请求提交给 apiserver ，而 apiserver 会将请求的目标状态保存在 etcd 中，而后 apiserver 会请求 schedule 进行调度，并且把调度的结果更新在 etcd 的 pod 状态中，随后一旦保存在 etcd 中，并完成 schedule 更新后目标节点的 kubelet 就会从 etcd 的状态变化得知有新任务给自己，所以此时会拿到用户所希望的资源清单目标状态，根据清单在当前节点运行这个 POD，如果创建成功或者失败，则将结果发回给 apiserver ，apiserver 再次保存在 etcd 中。")]),s._v(" "),t("h4",{attrs:{id:"_6-2-6-8-livenessprobe-存活性探测"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-6-8-livenessprobe-存活性探测"}},[s._v("#")]),s._v(" 6.2.6.8 livenessProbe 存活性探测")]),s._v(" "),t("blockquote",[t("p",[s._v("详细见：kubectl explain pods.spec.containers.livenessProbe")])]),s._v(" "),t("ul",[t("li",[s._v("livenessProbe / readinessProbe 是 k8s 两个生命周期，这两个生命周期都可以定义探针来探测容器状态做出不同反应")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("livenessProbe     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指示容器是否正在运行。如果存活探测失败，则依据 restartPolicy 策略来进行重启")]),s._v("\nreadinessProbe    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指示容器是否准备好服务请求。如果就绪探测失败端点控制器将从与 Pod 匹配的所有 Service 的端点中删除该 Pod 的 IP 地址")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("livenessProbe / readinessProbe 可用的探针和探针特性，探针只能定义一种类型，例如：HTTPGetAction")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在容器内执行指定命令。如果命令退出时返回码为 0 则认为诊断成功。")]),s._v("\ntcpSocket     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对指定端口上的容器的 IP 地址进行 TCP 检查。如果端口打开，则诊断被认为是成功的。")]),s._v("\nhttpGet       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTP GET 请求指定端口和路径上的容器。如果响应码大于等于200 且小于 400，则诊断被认为是成功的。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("failureThreshold    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 探测几次才判定为探测失败，默认为 3 次。")]),s._v("\nperiodSeconds       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每次探测周期的间隔时长。")]),s._v("\ntimeoutSeconds      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每次探测发出后等待结果的超时时间，默认为 1 秒。")]),s._v("\ninitalDelaySeconds  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在容器启动后延迟多久去进行探测，默认为启动容器后立即探测。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[s._v("使用 exec 探针，实验结果应该为 39 秒后 POD 显示 ERROR ，但不自动重启 POD")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: execlive\n  namespace: default\n  labels:\n    app: myapp\n    tier: frontend\nspec:\n  containers:\n    - name: busybox\n      image: busybox\n      command:\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v("\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v("\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 3600"')]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个文件等待 30 秒，这个时间探针应该是成功的，30 秒后则失败")]),s._v("\n      livenessProbe:                                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器的存活性检测，如果失败则按照 restartPolicy 策略来重启 POD")]),s._v("\n        exec:                                          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exec 类型探针，进入容器执行一条命令")]),s._v("\n          command: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-e"')]),s._v(" ,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/tmp/healthy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行的命令为测试文件存在性")]),s._v("\n        initialDelaySeconds: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("                         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器启动后延迟多久进行探测")]),s._v("\n        periodSeconds: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每次探测周期的间隔时长为 3 秒")]),s._v("\n        failureThreshold: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3 次失败后则判定为容器探测存活性失败")]),s._v("\n  restartPolicy: Never                                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当探测到容器失败是否重启 POD")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("ul",[t("li",[s._v("使用 httpGet 探针，实验结果应该大约 40 秒后探测存活性失败，自动重启 POD，第一次重启会立即进行，随后是 30 秒的2倍直到 300 秒。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpgetlive\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" frontend\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ikubernetes/myapp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("livenessProbe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器的存活性检测，如果失败则按照 restartPolicy 策略来重启 POD")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("httpGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# httpget 探针")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /error.html            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 探测的页面，为了效果这个页面不存在")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 探测的端口，使用名称引用容器的端口")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("httpHeaders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# httpget 时候设置请求头")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Custom"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Header\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Awesome\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("initialDelaySeconds")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器启动后延迟多久进行探测")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeoutSeconds")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每次探测发出等待结果的时长")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当探测到容器失败是否重启 POD")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("h4",{attrs:{id:"_6-2-6-9-readinessprobe-就绪性检测"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-6-9-readinessprobe-就绪性检测"}},[s._v("#")]),s._v(" 6.2.6.9 readinessProbe 就绪性检测")]),s._v(" "),t("p",[s._v("例如有一个容器运行的是 tomcat ，而 tomcat 展开 war 包，部署完成的时间可能较长，而默认 k8s 会在容器启动就标记为 read 状态，接收 service 的调度请求，但是容器启动不代表 tomcat 已经成功运行，所以需要 readinessProbe 进行就绪性探测，来决定是否可以接入 service 上。")]),s._v(" "),t("ul",[t("li",[s._v("livenessProbe / readinessProbe 可用的探针和探针特性基本一样，探针只能定义一种类型，例如：HTTPGetAction")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("livenessProbe     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指示容器是否正在运行。如果存活探测失败，则依据 restartPolicy 策略来进行重启")]),s._v("\nreadinessProbe    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指示容器是否准备好服务请求。如果就绪探测失败端点控制器将从与 Pod 匹配的所有 Service 的端点中删除该 Pod 的 IP 地址")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("使用 httpGet 探针，实验结果应该大约 40 秒后探测存活性失败，自动重启 POD，第一次重启会立即进行，随后是 30 秒的2倍直到 300 秒。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpgetread\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" frontend\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ikubernetes/myapp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("livenessProbe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器的存活性检测，如果失败则按照 restartPolicy 策略来重启 POD")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("httpGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# httpget 探针")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /error.html            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 探测的页面，为了效果这个页面不存在")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 探测的端口，使用名称引用容器的端口")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("httpHeaders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# httpget 时候设置请求头")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Custom"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Header\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Awesome\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("initialDelaySeconds")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器启动后延迟多久进行探测")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeoutSeconds")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每次探测发出等待结果的时长")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当探测到容器失败是否重启 POD")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("ul",[t("li",[s._v("手动进入容器，删除 index.html 以触发就绪性探针的检测")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it httpgetread -- /bin/sh\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f /usr/share/nginx/html/index.html\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("结果这个 POD 的 READY 状态已经变成非就绪了，此时 service 不会再调度到这个节点了")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -w")]),s._v("\nNAME                            READY   STATUS    RESTARTS   AGE\nhttpgetread                     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2m50s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("在容器内再创建一个文件，以触发就绪性探针的检测")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it httpgetread -- /bin/sh\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello worlld"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/usr/share/nginx/html/index.html\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("结果这个 POD 的的 READY 状态已经编程就绪了，此时 service 会调度到这个节点了")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -w")]),s._v("\nNAME                            READY   STATUS    RESTARTS   AGE\nhttpgetread                     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          8m15s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"_6-2-6-10-lifecycle-生命周期钩子"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-6-10-lifecycle-生命周期钩子"}},[s._v("#")]),s._v(" 6.2.6.10 lifecycle 生命周期钩子")]),s._v(" "),t("blockquote",[t("p",[s._v("详见：kubectl explain pods.spec.containers.lifecycle")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("postStart           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在容器启动后立即执行的命令，如果这个操作失败了，那么容器会终止，且根据 restartPolicy 来决定是否重启")]),s._v("\npreStop             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在容器终止前立即执行的命令")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("postStart / preStop 的基本使用")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: lifecycle-demo\nspec:\n  containers:\n  - name: lifecycle-demo-container\n    image: nginx\n\n    lifecycle:\n      postStart:\n        exec:\n          command: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo Hello from the postStart handler > /usr/share/message"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      preStop:\n        exec:\n          command: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-s"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quit"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("POD控制器")]),s._v(" "),t("p",[s._v("控制器管理的 POD 可以实现，自动维护 POD 副本数量，它能实现 POD 的扩容和缩容，但是不能实现滚动更新等高级功能。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("名称")]),s._v(" "),t("th",[s._v("作用")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("ReplicationController")]),s._v(" "),t("td",[s._v("原来 k8s 只有这一种控制器，目前已经接近废弃")])]),s._v(" "),t("tr",[t("td",[s._v("ReplicaSet")]),s._v(" "),t("td",[s._v("代用户创建指定数量的 POD 副本，还支持扩缩容，被称为新一代的 ReplicationController。主要由 3 个指标，1. 用户希望的 POD 副本，2. 标签选择器，判定 POD 是否归自己管理，3. 如果 POD 副本不够，按照哪个 POD template 创建 POD，但一般我们不直接使用 ReplicaSet。")])]),s._v(" "),t("tr",[t("td",[s._v("Deployment")]),s._v(" "),t("td",[s._v("Deployment 通过控制 ReplicaSet 来实现功能，除了支持 ReplicaSet 的扩缩容意外，还支持滚动更新和回滚等，还提供了声明式的配置，这个是我们日常使用最多的控制器。它是用来管理无状态的应用。")])]),s._v(" "),t("tr",[t("td",[s._v("DaemonSet")]),s._v(" "),t("td",[s._v("用于确保集群内的每个 node 上只运行一个指定的 POD，如果有新增的节点也都会自动运行这个 POD，所以这个控制器无需定义 POD 运行的数量，只需要定义标签选择器和 POD template。所以可以跟根据标签选择器选中的 node 上只运行一个 POD 副本。")])]),s._v(" "),t("tr",[t("td",[s._v("Job")]),s._v(" "),t("td",[s._v("执行一个一次性任务，例如数据库备份，任务完成后正常退出，则 POD 不会再被启动了，除非任务异常终止。")])]),s._v(" "),t("tr",[t("td",[s._v("CronJob")]),s._v(" "),t("td",[s._v("执行一些周期性任务")])]),s._v(" "),t("tr",[t("td",[s._v("StatefulSet")]),s._v(" "),t("td",[s._v("管理有状态的 POD ，但是对每个不同的有状态应用需要自行编写脚本，完成对有状态服务的管理，为了解决 StatefulSet 不方便编写有状态应用管理的问题。k8s 还提供了 helm 这样类似于 yum 的方式，方便用户从 helm 市场来安装一个有状态的应用。")])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);