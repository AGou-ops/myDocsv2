(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{704:function(s,e,a){"use strict";a.r(e);var t=a(6),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"kubectlè¿œç¨‹è¿æ¥k8s"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubectlè¿œç¨‹è¿æ¥k8s"}},[s._v("#")]),s._v(" kubectlè¿œç¨‹è¿æ¥k8s")]),s._v(" "),a("h2",{attrs:{id:"æ–¹æ¡ˆä¸€-é€šè¿‡å®‰å…¨ä¸Šä¸‹æ–‡è®¿é—®æœ¬åœ°ç½‘ç»œk8s"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ–¹æ¡ˆä¸€-é€šè¿‡å®‰å…¨ä¸Šä¸‹æ–‡è®¿é—®æœ¬åœ°ç½‘ç»œk8s"}},[s._v("#")]),s._v(" æ–¹æ¡ˆä¸€ï¼šé€šè¿‡å®‰å…¨ä¸Šä¸‹æ–‡è®¿é—®æœ¬åœ°ç½‘ç»œk8s")]),s._v(" "),a("h3",{attrs:{id:"åŸºæœ¬æµç¨‹æ“ä½œ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åŸºæœ¬æµç¨‹æ“ä½œ"}},[s._v("#")]),s._v(" åŸºæœ¬æµç¨‹æ“ä½œ")]),s._v(" "),a("p",[s._v("é¦–å…ˆè¦ç¡®ä¿k8sçš„"),a("code",[s._v("apiServer")]),s._v("å¯ä»¥è¢«å½“å‰ç½‘ç»œè®¿é—®ï¼Œç¡®ä¿ç½‘æ®µåœ¨å…¶ç›‘å¬çš„èŒƒå›´ä¹‹å†…ã€‚ï¼ˆé‡è¦ï¼‰")]),s._v(" "),a("p",[s._v("ç™»å½•åˆ°"),a("code",[s._v("master")]),s._v("ä¸»æœºä¸Šï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ kubectl cluster-info\nKubernetes control plane is running at https://0.0.0.0:6443 \nCoreDNS is running at https://0.0.0.0:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy \n\nTo further debug and diagnose cluster problems, use "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kubectl cluster-info dump'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("âš ï¸æä¸æ¨èä½¿ç”¨"),a("code",[s._v("0.0.0.0")]),s._v("ï¼Œè¿™é‡Œæˆ‘åªæ˜¯å›¾æ–¹ä¾¿è¿›è¡Œæµ‹è¯•ä½¿ç”¨ã€‚")]),s._v(" "),a("p",[s._v("è·å–å½“å‰é›†ç¾¤çš„é…ç½®æ–‡ä»¶ï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.kube/config\napiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: LS0tLS1CRUdJTiBã€æ­¤å¤„çœç•¥ã€‚ã€‚ã€‚ã€‘"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n    server: https://0.0.0.0:6443\n  name: kind-my-cluster\ncontexts:\n- context:\n    cluster: kind-my-cluster\n    user: kind-my-cluster\n  name: kind-my-cluster\ncurrent-context: kind-my-cluster\nkind: Config\npreferences: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nusers:\n- name: kind-my-cluster\n  user:\n    client-certificate-data: LS0tLS1ã€æ­¤å¤„çœç•¥ã€‚ã€‚ã€‚ã€‘"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n    client-key-data: LS0tã€æ­¤å¤„çœç•¥ã€‚ã€‚ã€‚ã€‘"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("é…ç½®æ–‡ä»¶ä¸­çš„"),a("code",[s._v("certificate-authority-dataã€æœåŠ¡å™¨ç«¯CAã€‘")]),s._v("ã€"),a("code",[s._v("client-certificate-dataã€å®¢æˆ·ç«¯è¯ä¹¦ã€‘")]),s._v("å’Œ"),a("code",[s._v("client-key-dataã€å®¢æˆ·ç«¯ç§é’¥ã€‘")]),s._v("éƒ½æ˜¯"),a("code",[s._v("base64")]),s._v("ç®€å•åŠ å¯†è¿‡çš„ï¼Œæ‰€ä»¥åœ¨å¼•å…¥ä¸Šä¸‹æ–‡ä¹‹å‰å…ˆå°†å…¶è§£å¯†ã€‚")]),s._v(" "),a("ul",[a("li",[s._v("ä½¿ç”¨"),a("code",[s._v("base64")]),s._v("å‘½ä»¤è¿›è¡Œè§£å¯†ï¼š"),a("code",[s._v("echo <data> | base64 -d")])]),s._v(" "),a("li",[s._v("ä½¿ç”¨åœ¨çº¿ç½‘ç«™è¿›è¡Œè§£å¯†ï¼šhttps://www.base64decode.org/")])]),s._v(" "),a("p",[s._v("å°†è§£å¯†ä¹‹åçš„æ–‡ä»¶ä¿å­˜åœ¨å½“å‰ä¸»æœºçš„"),a("code",[s._v("~/.kube/")]),s._v("ç›®å½•ä¹‹ä¸‹ï¼Œåˆ†åˆ«å‘½åä¸ºï¼ˆåå­—éšæ„ï¼Œè®°ä½å°±å¥½ï¼‰ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("my-cluster.ca")]),s._v(" "),a("li",[s._v("k8s.crt")]),s._v(" "),a("li",[s._v("k8s.key")])]),s._v(" "),a("blockquote",[a("p",[s._v("å½“å‰ä¸»æœºè¿˜æ²¡æœ‰"),a("code",[s._v("kubectl")]),s._v("ï¼Ÿä¸‰æ¡å‘½ä»¤å¿«é€Ÿå®‰è£…ã€‚")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -LO "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://dl.k8s.io/release/'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L -s https://dl.k8s.io/release/stable.txt"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('/bin/linux/amd64/kubectl"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -o root -g root -m 0755 kubectl /usr/local/bin/kubectl\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl version --client\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("p",[s._v("æ‰“å¼€ç»ˆç«¯ï¼Œç¡®ä¿"),a("code",[s._v("kubectl")]),s._v("å·²æ­£ç¡®å®‰è£…åè¿è¡Œä»¥ä¸‹å‡ æ¡å‘½ä»¤æ¥æ·»åŠ å®‰å…¨ä¸Šä¸‹æ–‡ï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ·»åŠ é›†ç¾¤åœ°å€ï¼Œå¹¶è®¾ç½®é›†ç¾¤ca")]),s._v("\nkubectl config set-cluster my-k8s --server https://10.0.0.18:6443  --certificate-authority"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/agou-ops/.kube/my-cluster.ca\t\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ·»åŠ ç”¨æˆ·ï¼Œä»¥åŠè®¾ç½®å®¢æˆ·ç«¯è¯ä¹¦åŠç§é’¥")]),s._v("\nkubectl config set-credentials kubernetes-admin     --client-certificate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/agou-ops/.kube/k8s.crt     --client-key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/agou-ops/.kube/k8s.key\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŒ‡å®šä¸Šä¸‹æ–‡ï¼Œset-contextåç§°å¯éšä¾¿å–")]),s._v("\nkubectl config set-context ubuntu --cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-k8s  --namespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("default --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-admin \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¿€æ´»ä¸Šä¸‹æ–‡")]),s._v("\nkubectl config use-context ubuntu \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("ä½¿ç”¨"),a("code",[s._v("kubectl config view")]),s._v("å‘½ä»¤æ£€æŸ¥é…ç½®æ–‡ä»¶ã€‚")]),s._v(" "),a("p",[s._v("æœ€åä½¿ç”¨"),a("code",[s._v("kubectl cluster info")]),s._v("è¿›è¡ŒæŸ¥çœ‹å³å¯ï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kubectl --insecure-skip-tls-verify cluster-info\nKubernetes control plane is running at https://10.0.0.18:6443\nCoreDNS is running at https://10.0.0.18:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\nTo further debug and diagnose cluster problems, use "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kubectl cluster-info dump'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("Done. ğŸ˜„")]),s._v(" "),a("h3",{attrs:{id:"é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"}},[s._v("#")]),s._v(" é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("Unable to connect to the server: x509: certificate is valid for 10.96.0.1, 172.18.0.4, 0.0.0.0, not 10.0.0.18")])])]),s._v(" "),a("blockquote",[a("p",[s._v("One option is to tell "),a("code",[s._v("kubectl")]),s._v(" that you don't want the certificate to be validated. Obviously this brings up security issues but I guess you are only testing so here you go:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl --insecure-skip-tls-verify --context"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("employee-context get pods\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æˆ–è€…å°†å…¶å†™å…¥é…ç½®æ–‡ä»¶ï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl config set-cluster my-k8s --insecure-skip-tls-verify"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("The better option is to fix the certificate. Easiest if you reinitialize the cluster by running "),a("code",[s._v("kubeadm reset")]),s._v(" on all nodes including the master and then do")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubeadm init --apiserver-cert-extra-sans"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.215")]),s._v(".201.87\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("It's also possible to fix that certificate without wiping everything, but that's a bit more tricky. Execute something like this on the master as root:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /etc/kubernetes/pki/apiserver.*\nkubeadm init phase certs all --apiserver-advertise-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 --apiserver-cert-extra-sans"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.161")]),s._v(".233.80,114.215.201.87\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -q -f "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=k8s_kube-apiserver*'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nsystemctl restart kubelet\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æ¥è‡ªï¼šhttps://stackoverflow.com/a/46360852")])]),s._v(" "),a("h2",{attrs:{id:"æ–¹æ¡ˆäºŒ-ä¿®æ”¹è¯ä¹¦åŸŸ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ–¹æ¡ˆäºŒ-ä¿®æ”¹è¯ä¹¦åŸŸ"}},[s._v("#")]),s._v(" æ–¹æ¡ˆäºŒï¼šä¿®æ”¹è¯ä¹¦åŸŸ")]),s._v(" "),a("h3",{attrs:{id:"æŸ¥çœ‹-apiserver-è¯ä¹¦åŒ…å«å“ªäº›åœ°å€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥çœ‹-apiserver-è¯ä¹¦åŒ…å«å“ªäº›åœ°å€"}},[s._v("#")]),s._v(" æŸ¥çœ‹ Apiserver è¯ä¹¦åŒ…å«å“ªäº›åœ°å€")]),s._v(" "),a("ol",[a("li",[s._v("è¿›å…¥è¯ä¹¦ç›®å½•")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/kubernetes/pki  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("æŸ¥çœ‹è¯ä¹¦")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ openssl x509 -in apiserver.crt -noout -text"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -A  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Alternative'")]),s._v("\n\nX509v3 Subject Alternative Name:  \n                DNS:1-1-1-1, DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, DNS:lb-apiserver.kubernetes.local, DNS:localhost, IP Address:1.1.1.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("è¿™é‡Œå¦‚æœåªå…è®¸é€šè¿‡ 1.1.1.1 è®¿é—®é›†ç¾¤çš„ Apiserverã€‚å¦‚æœéœ€è¦ä½¿ç”¨åŸŸåï¼Œ"),a("code",[s._v("kubernetesã€kubernetes.defaultã€kubernetes.default.svc")]),s._v(" ç­‰ï¼Œåˆ™éœ€è¦é…ç½® hosts å°†å…¶æŒ‡å‘ 1.1.1.1 ã€‚")]),s._v(" "),a("h3",{attrs:{id:"æ·»åŠ æ–°çš„åŸŸåæˆ–-ip-åˆ°è¯ä¹¦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ·»åŠ æ–°çš„åŸŸåæˆ–-ip-åˆ°è¯ä¹¦"}},[s._v("#")]),s._v(" æ·»åŠ æ–°çš„åŸŸåæˆ– IP åˆ°è¯ä¹¦")]),s._v(" "),a("ol",[a("li",[s._v("å¤‡ä»½è¯ä¹¦")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/kubernetes/pki  \n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" apiserver.crt apiserver.crt.bak  \n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" apiserver.key apiserver.key.bak  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("ä¿®æ”¹ "),a("code",[s._v("/etc/kubernetes/kubeadm-config.yaml")])])]),s._v(" "),a("p",[s._v("åœ¨ ClusterConfiguration çš„ apiServer å­—æ®µä¸‹ï¼Œæ‰¾åˆ° certSANsã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubeadm.k8s.io/v1beta2  \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterConfiguration  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("certSANs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kubernetes  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kubernetes.default  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kubernetes.default.svc  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kubernetes.default.svc.cluster.local  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 10.233.0.1  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("åœ¨ certSANs ä¸­æ·»åŠ è¿œç¨‹è®¿é—®çš„åŸŸåæˆ– IP åœ°å€ï¼š")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("certSANs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" remote.doamin.com  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 1.2.3.4  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kubernetes  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kubernetes.default  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kubernetes.default.svc  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kubernetes.default.svc.cluster.local  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 10.233.0.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("å¦‚æœä½ åœ¨ "),a("code",[s._v("/etc/kubernetes/")]),s._v(" ç›®å½•ä¸­æ²¡æœ‰æ‰¾åˆ° kubeadm-config.yaml æ–‡ä»¶ï¼Œä¸è¦ç´§å¼ ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ç”Ÿæˆä¸€ä¸ªå½“å‰é›†ç¾¤çš„é…ç½®æ–‡ä»¶ï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ kubectl get cm kubeadm-config  -n kube-system -o yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/kubernetes/kubeadm-config.yaml  \næˆ–è€…  \n$ kubeadm config view "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/kubernetes/kubeadm-config.yaml  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("å½“ç„¶ä½ çš„é›†ç¾¤çš„é…ç½®æ–‡ä»¶ä¸­å¯èƒ½æ²¡æœ‰ "),a("code",[s._v("certSANs")]),s._v(" é…ç½®æ®µï¼Œä½ å¯ä»¥ç›´æ¥åŠ åœ¨ç±»ä¼¼ä¸‹é¢çš„ä½ç½®å¤„ï¼š")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("certSANs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" remote.doamin.com  \n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 1.2.3.4  \n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kubernetes  \n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kubernetes.default  \n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kubernetes.default.svc  \n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kubernetes.default.svc.cluster.local  \n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 10.233.0.1  \n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("extraArgs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("authorization-mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("RBAC  \n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeoutForControlPlane")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 4m0s  \n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubeadm.k8s.io/v1beta2  \n         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v(".  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("é‡æ–°ç”Ÿæˆè¯ä¹¦")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ kubeadm init phase certs apiserver --config /etc/kubernetes/kubeadm-config.yaml  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("å†æ¬¡æŸ¥çœ‹è¯ä¹¦")])]),s._v(" "),a("p",[s._v("æ£€æŸ¥è¾“å‡ºçš„ç»“æœä¸­ï¼Œæ˜¯å¦åŒ…å«å‰é¢å¢åŠ çš„å…¬ç½‘ IPï¼Œå¦‚æœ‰åˆ™è¯æ˜æ“ä½œæˆåŠŸã€‚")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ openssl x509 -in pki/apiserver.crt -noout -text "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(".3.4  \n                IP Address:192.168.0.8, IP Address: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(".3.4  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("é‡å¯ kube-apiserver")])]),s._v(" "),a("ul",[a("li",[s._v("å¦‚æœæ˜¯é«˜å¯ç”¨é›†ç¾¤")])]),s._v(" "),a("p",[s._v("ç›´æ¥æ€æ­»å½“å‰èŠ‚ç‚¹çš„ kube-apiserver è¿›ç¨‹ï¼Œç­‰å¾… kubelet æ‹‰èµ· kube-apiserver å³å¯ã€‚éœ€è¦åœ¨ä¸‰ä¸ªèŠ‚ç‚¹æ‰§è¡Œæ­¥éª¤ 1 åˆ°æ­¥éª¤ 4ï¼Œé€ä¸€æ›´æ–°ã€‚")]),s._v(" "),a("ul",[a("li",[s._v("å¦‚æœæ˜¯éé«˜å¯ç”¨é›†ç¾¤")])]),s._v(" "),a("p",[s._v("æ€æ­» kube-apiserver å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡æœ‰ä¸­æ–­ï¼Œéœ€è¦åœ¨ä¸šåŠ¡ä½å³°çš„æ—¶å€™æ“ä½œã€‚")]),s._v(" "),a("p",[s._v("è¿›å…¥ "),a("code",[s._v("/etc/kubernetes/manifests")]),s._v(" ç›®å½•ä¸‹ï¼Œç§»åŠ¨ kube-apiserver.yaml æ–‡ä»¶è‡³å…¶å®ƒä½ç½®ï¼Œç„¶ååˆç§»å›æ¥å³å¯ã€‚")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /etc/kubernetes/manifests/kube-apiserver.yaml /root/  \n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /root/kube-apiserver.yaml /etc/kubernetes/manifests  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"6"}},[a("li",[s._v("ä¿®æ”¹ kubeconfig ä¸­çš„ server ip")])]),s._v(" "),a("p",[s._v("æœ€åï¼Œä½ åªéœ€è¦å°† "),a("code",[s._v("kubeconfig")]),s._v(" æ–‡ä»¶ä¸­ "),a("code",[s._v("server")]),s._v(" åœ°å€ä¿®æ”¹ä¸º "),a("code",[s._v("1.2.3.4")]),s._v("ã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1  \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//1.2.3.4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("  \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("ä¿å­˜ä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡å…¬ç½‘ IP è®¿é—® Kubernetes é›†ç¾¤ã€‚")]),s._v(" "),a("p",[a("code",[s._v("$ kubectl get node")])]),s._v(" "),a("blockquote",[a("p",[s._v("è¯¥éƒ¨åˆ†å†…å®¹è½¬è½½è‡ªï¼šhttps://kubesphereio.com/post/add-public-ip-to-kubernetes-apiserver-operation-guide/")])]),s._v(" "),a("h2",{attrs:{id:"è®¿é—®äº‘ç«¯k8s"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è®¿é—®äº‘ç«¯k8s"}},[s._v("#")]),s._v(" è®¿é—®äº‘ç«¯k8s")]),s._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")])]),s._v(" "),a("p",[s._v("æœªå®Œã€‚")])])}),[],!1,null,null,null);e.default=n.exports}}]);