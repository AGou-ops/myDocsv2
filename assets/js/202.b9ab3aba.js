(window.webpackJsonp=window.webpackJsonp||[]).push([[202],{834:function(s,a,t){"use strict";t.r(a);var e=t(6),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ceph-rgw"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ceph-rgw"}},[s._v("#")]),s._v(" Ceph RGW")]),s._v(" "),t("h2",{attrs:{id:"ceph-rgw-架构简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ceph-rgw-架构简介"}},[s._v("#")]),s._v(" Ceph RGW 架构简介")]),s._v(" "),t("p",[s._v("RGW就是提供对象存储的网关，也即对象存储网关。所谓对象存储网关，也就是对象存储的入口，"),t("strong",[s._v("本质上是一个HTTP服务器")]),s._v("，与Nginx和Apache无异。通过这个入口，用户可以通过HTTP协议，以RESTful的方式访问Ceph的对象存储。 对象存储网关实际上是"),t("em",[s._v("调用"),t("code",[s._v("librados")]),s._v("的API")]),s._v("来实现数据的存储和读取，而该网关同时提供了"),t("strong",[s._v("兼容AWS S3和OpenStack Swift的对象存储访问接口（API）")]),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"安装ceph对象存储网关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装ceph对象存储网关"}},[s._v("#")]),s._v(" 安装Ceph对象存储网关")]),s._v(" "),t("p",[s._v("简单使用"),t("code",[s._v("ceph-deploy")]),s._v("部署命令安装对象存储网关：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入ceph集群配置文件路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ceph-cluster\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ceph-deploy install --rgw <gateway-node1> [<gateway-node2> ...]")]),s._v("\nceph-deploy "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --rgw stor1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"创建rgw实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建rgw实例"}},[s._v("#")]),s._v(" 创建RGW实例")]),s._v(" "),t("p",[s._v("上面步骤只是安装了必要的软件，但并没有创建需要的存储资源（存储池）：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建存储池")]),s._v("\nceph-deploy rgw create stor1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("ℹ️ 查看集群资源状态：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@stor1 ceph-cluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("# rados lspools\n.rgw.root\ndefault.rgw.control\ndefault.rgw.meta\ndefault.rgw.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"验证对象存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证对象存储"}},[s._v("#")]),s._v(" 验证对象存储")]),s._v(" "),t("p",[s._v("上面提到过 Ceph 的对象存储网关是基于 HTTP 的，因此我们可以通过 HTTP 协议访问特定地址来进项验证：")]),s._v(" "),t("p",[s._v("打开浏览器，输入 http://172.16.1.128:7480/")]),s._v(" "),t("p",[s._v("大致会输出以下内容：")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ListAllMyBucketsResult")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("xmlns")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://s3.amazonaws.com/doc/2006-03-01/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Owner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ID")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("anonymous"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("ID")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("DisplayName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Owner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Buckets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("ListAllMyBucketsResult")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"创建用户以使用对象存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建用户以使用对象存储"}},[s._v("#")]),s._v(" 创建用户以使用对象存储")]),s._v(" "),t("p",[s._v("对象存储的数据结构，数据必须存储在某个用户下面。因此，想正常的访问RGW，需要创建相应的RGW用户，并赋予相应的权限，"),t("code",[s._v("radosgw-admin")]),s._v("命令实现了这些功能。 执行下面命令，来创建一个名为"),t("code",[s._v("testuser")]),s._v("的用户：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("radosgw-admin user create --uid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"testuser"')]),s._v(" --display-name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"First User"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("执行完成之后，会输出一堆相关数据，其中，需要特别保存返回结果中的"),t("code",[s._v("keys->access_key")]),s._v("和"),t("code",[s._v("keys->secret_key")])]),s._v(" "),t("h3",{attrs:{id:"创建子用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建子用户"}},[s._v("#")]),s._v(" 创建子用户")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("radosgw-admin subuser create --uid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("testuser --subuser"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("testuser:swift --access"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("full\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),t("ul",[t("li",[s._v("https://zhuanlan.zhihu.com/p/66671590")]),s._v(" "),t("li",[s._v("https://link.zhihu.com/?target=https%3A//www.jianshu.com/p/f6e336bd9999")]),s._v(" "),t("li",[s._v("https://link.zhihu.com/?target=https%3A//blog.csdn.net/u011446736/article/details/81083078")]),s._v(" "),t("li",[s._v("https://link.zhihu.com/?target=https%3A//blog.csdn.net/Poo_Chai/article/details/80856662%3Futm_source%3Dblogxgwz1")])])])}),[],!1,null,null,null);a.default=n.exports}}]);