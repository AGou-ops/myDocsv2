(window.webpackJsonp=window.webpackJsonp||[]).push([[154],{786:function(s,a,n){"use strict";n.r(a);var t=n(6),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"docker-volume"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-volume"}},[s._v("#")]),s._v(" Docker Volume")]),s._v(" "),n("p",[s._v("查看容器存储卷挂载情况使用："),n("code",[s._v("docker inspect -f 【【.Mounts】】 ID")])]),s._v(" "),n("h2",{attrs:{id:"volume-数据共享"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#volume-数据共享"}},[s._v("#")]),s._v(" Volume 数据共享")]),s._v(" "),n("p",[s._v("容器"),n("code",[s._v("busybox2")]),s._v("共享使用"),n("code",[s._v("busybox2")]),s._v("的数据卷")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" create --name busybox1 -v /data/test1:/data/test1 busybox\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -itd --name busybox2 --volumes-from busybox1 busybox\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("可以挂载多个共享卷，使用多个"),n("code",[s._v("--volumes-from")]),s._v("参数即可.")]),s._v(" "),n("h2",{attrs:{id:"volume-数据备份与恢复"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#volume-数据备份与恢复"}},[s._v("#")]),s._v(" Volume 数据备份与恢复")]),s._v(" "),n("p",[s._v("ℹ️实用性不高。。。")]),s._v(" "),n("p",[s._v("备份：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --rm --volumes-from busybox1 -v "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(":/backup busybox "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" cvf /backup/backup.tar /data/test1/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("恢复：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -itd -v --name busybox3 /data/ busybox /bin/sh\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --volumes-from busybox1 -v /data/backup/:/backup busybox "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xf /backup/backup.tar\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"volume-使用外部存储-nfs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#volume-使用外部存储-nfs"}},[s._v("#")]),s._v(" Volume 使用外部存储(NFS)")]),s._v(" "),n("p",[s._v("简单配置 NFS 服务器（172.16.1.128）：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nfs-utils rpcbind -y\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /data/nfs/docker\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/nfs *(rw,no_root_squash,sync)"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/etc/exports\nexportfs -r\nsystemctl start rpcbind nfs-server\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 NFS 状态")]),s._v("\nshowmount -e localhost\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("客户端（也就是容器端）：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确保主机安装了 nfs 的客户端工具")]),s._v("\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y nfs-utils rpcbind\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 NFS 挂载卷")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume create --driver "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --opt "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nfs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --opt "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("o")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("addr"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.128,rw "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --opt "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("device")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(":/data/nfs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  volume-nfs\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("查看并使用 NFS 外部存储：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume inspect volume-nfs\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 NFS")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -itd --name busybox4 -v volume-nfs:/nfs busybox\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器挂载情况")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect -f 【【.Mounts】】 busybox4\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("删除挂载卷：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f -v volume-nfs\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" volume-nfs\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);