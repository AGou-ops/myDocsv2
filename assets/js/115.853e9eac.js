(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{748:function(s,a,n){"use strict";n.r(a);var t=n(6),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"mongodb-installation"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-installation"}},[s._v("#")]),s._v(" MongoDB Installation")]),s._v(" "),n("h2",{attrs:{id:"预先准备与安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#预先准备与安装"}},[s._v("#")]),s._v(" 预先准备与安装")]),s._v(" "),n("p",[s._v("安装之前禁用大页内存机制:")]),s._v(" "),n("blockquote",[n("p",[s._v("透明大页面（THP）是一种Linux内存管理系统，它通过使用较大的内存页面来减少具有大量内存的计算机上的转换后备缓冲区（TLB）查找的开销。\n但是，在启用THP的情况下，数据库工作负载通常表现不佳，因为它们往往具有稀疏而不是连续的内存访问模式。在Linux上运行MongoDB时，应禁用THP以获得最佳性能")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------ systemd管理的系统")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建服务:")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/systemd/system/disable-transparent-huge-pages.service\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Disable Transparent Huge Pages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("THP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DefaultDependencies")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("no\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sysinit.target local-fs.target\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Before")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mongod.service\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("oneshot\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/sh -c "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo never | tee /sys/kernel/mm/transparent_hugepage/enabled > /dev/null'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("basic.target\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重载服务")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start disable-transparent-huge-pages\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" disable-transparent-huge-pages\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查是否关闭")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /sys/kernel/mm/transparent_hugepage/enabled\nalways madvise "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("never"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("更多参考: https://docs.mongodb.com/manual/tutorial/transparent-huge-pages/")]),s._v(" "),n("h3",{attrs:{id:"使用现成二进制安装包进行安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用现成二进制安装包进行安装"}},[s._v("#")]),s._v(" 使用现成二进制安装包进行安装")]),s._v(" "),n("p",[s._v("Debian10 系统下:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器包")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://repo.mongodb.org/apt/debian/dists/buster/mongodb-org/4.4/main/binary-amd64/mongodb-org-server_4.4.1_amd64.deb\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端shell包")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://repo.mongodb.org/apt/debian/dists/buster/mongodb-org/4.4/main/binary-amd64/mongodb-org-shell_4.4.1_amd64.deb\n$ dpkg -i mongodb-org-s*.deb\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("ℹ️ 使用安装包安装的 MongoDB 默认数据文件存在于"),n("code",[s._v("/var/lib/mongodb")]),s._v(", 默认日志文件存在于"),n("code",[s._v("/var/log/mongodb")]),s._v(".")]),s._v(" "),n("p",[s._v("启动 MongoDB :")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start mongod\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果报出 Failed to start mongod.service: Unit mongod.service not found. 错误, 则运行")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("其他操作系统安装参考: https://docs.mongodb.com/manual/installation/#mongodb-community-edition-installation-tutorials")]),s._v(" "),n("h3",{attrs:{id:"手动安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#手动安装"}},[s._v("#")]),s._v(" 手动安装")]),s._v(" "),n("p",[s._v("从 https://www.mongodb.com/try/download/community?tck=docs_server 下载指定tar包")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装依赖包")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libcurl4 openssl liblzma5\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf mongodb-linux-*-4.4.1.tgz\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" -g "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("800")]),s._v(" mongod\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -u "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("801")]),s._v(" -g mongod mongod\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" mongod\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -pv /mongodb/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("bin,conf,log,data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R mongod:mongod /mongodb\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建软连接, 方便直接使用")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s  /path/to/the/mongodb-directory/bin/* /usr/local/bin/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("运行 MongoDB:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("mongod --dbpath /mongodb/data --logpath /mongodb/log/mongodb.log --port"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v(" --logappend --fork\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"参考链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),n("ul",[n("li",[s._v("MongoDB documentations: https://docs.mongodb.com/manual/")])])])}),[],!1,null,null,null);a.default=e.exports}}]);