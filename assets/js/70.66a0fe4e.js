(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{703:function(s,a,e){"use strict";e.r(a);var n=e(6),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"四-入门命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四-入门命令"}},[s._v("#")]),s._v(" 四 入门命令")]),s._v(" "),e("h2",{attrs:{id:"_4-1-kubectl"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-kubectl"}},[s._v("#")]),s._v(" 4.1 kubectl")]),s._v(" "),e("p",[s._v("kubectl 是 apiserver 的客户端程序，这个客户端程序是通过连接 master 节点上的 apiserver ，实现各种 k8s 对象的增删改查等基本操作，在 k8s 可被管理的对象有很多个")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("基本命令 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("初级"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n  create         从文件或标准输入创建资源\n  expose         获取一个复制控制器, 服务, 部署或者暴露一个 POD 将其作为新的 Kubernetes 服务公开\n  run            创建并运行特定的镜像, 创建使用 deployment 或 job 管理的容器\n  "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v("            设置对象的特定功能, 例如发布, 每次去set 不用的image tag\n\n基本命令 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("中级"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n  explain        文档或者资源, 可以用来查看资源清单写法\n  get            显示一个或多个资源\n  edit           编辑服务器上的资源\n  delete         按文件名, 标准输入, 资源和名称或资源和标签选择器删除资源\n\n部署命令:\n  rollout        管理资源的部署\n  scale          为部署设置新大小, ReplicaSet, Replication Controller, Job\n  autoscale      自动扩展一个部署, ReplicaSet, 或者 ReplicationController\n\n群集管理命令:\n  certificate    修改证书资源\n  cluster-info   显示群集信息\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("            显示资源"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CPU / 内存/ 存储"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("使用情况, 需要安装metrics-server\n  cordon         将节点标记为不可调度\n  uncordon       将节点标记为可调度\n  drain          设定 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" 进入维护模式\n  taint          更新一个或多个节点上的污点\n\n故障排除和调试命令:\n  describe       显示特定资源或资源组的详细信息\n  logs           在容器中打印容器的日志\n  attach         附加到正在运行的容器\n  "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("           在容器中执行命令\n  port-forward   将一个或多个本地端口转发到 pod\n  proxy          运行代理到 Kubernetes API 服务器\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v("             将文件和目录复制到容器, 和从容器复制, 跨容器复制文件\n  auth           检查授权\n\n高级命令:\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("diff")]),s._v("           针对将要应用的版本的 Diff 实时版本\n  apply          通过文件名或标准输入将配置应用于资源\n  patch          使用策略合并补丁更新资源的字段\n  replace        用文件名或标准输入替换资源\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),s._v("           实验阶段命令: 在一个或多个资源上等待特定条件, 定义一个触发器\n  convert        在不同的API版本之间转换配置文件\n  kustomize      从目录或远程 URL 构建 kustomization 目标\n\n设置命令:\n  label          更新资源上的标签\n  annotate       更新资源上的注释\n  completion     命令补全相关功能\n\n其他命令:\n  api-resources  在服务器上打印支持的API资源\n  api-versions   以 "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group/version"')]),s._v(" 的形式在服务器上打印支持的API版本\n  config         修改 kubeconfig 文件\n  plugin         提供与插件交互的实用程序\n  version        打印客户端和服务器版本信息\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br")])]),e("h2",{attrs:{id:"_4-2-run"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-run"}},[s._v("#")]),s._v(" 4.2 run")]),s._v(" "),e("ul",[e("li",[s._v("创建控制器并运行镜像")])]),s._v(" "),e("p",[s._v("创建一个名为 nginx 的 deployment，镜像为 nginx:latest ,如果不知道副本数，则为1")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl run nginx --image"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:latest\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("指定运行的 POD 数量")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl run nginx --image"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx --replicas"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 5 个 POD")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("不运行容器的默认命令，使用自定义的指令")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl run nginx --image"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx --command -- "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("cmd"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("arg"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("argN"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("运行一个周期任务")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl run pi --schedule"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0/5 * * * ?"')]),s._v(" --image"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("perl --restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("OnFailure -- perl -Mbignum"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bpi -wle "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'print bpi(2000)'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("指定控制器名称运行 nginx 指定端口和副本数量，以测试模式运行")])]),s._v(" "),e("p",[s._v("指定参数 dry-run 可以用来验证写的 yaml 文件是否存在异常，不会真正执行")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl run nginx-deploy --image"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx --port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --replicas"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --dry-run"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("查看容器是否运行")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get deployment\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("查看被调度的主机")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get pod -o wide\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("通过 ip 地址直接访问，由于所有的 POD 处于同一个网络中，所以在集群内部是可以访问的")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".2.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("假如现在删除刚创建的这个 POD，那么副本控制器会自动在其他的 node 上重建这个 POD")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl delete pods nginx-deploy-5c9b546997-jsmk6\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("再次执行查看，会发现容器已经被调度到其他节点上运行了")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get pod -o wide\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_4-3-expose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-expose"}},[s._v("#")]),s._v(" 4.3 expose")]),s._v(" "),e("p",[s._v("现在存在一个问题，就是 POD 的 IP 地址可能随时发生变动，所以不能作为访问的入口，那么就需要 service 来代理 POD 来创建一个固定的端点。")]),s._v(" "),e("ul",[e("li",[s._v("创建一个 service 来暴露一个服务")])]),s._v(" "),e("p",[s._v("在控制器 nginx-deploy 上创建名字为 nginx 的 service , 它工作端口为 80, 代理的后端容器端口 80, 协议为 TCP")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl expose deployment nginx-deploy --name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx --port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --target-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --protocol"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("TCP\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("可以看到刚刚创建的名字为 nginx 的 service ，现在就可以在集群内用 service 的地址来访问了, 如果外部访问可以使用 NodePort 模式")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("删除一个任务")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl delete deployment nginx-deploy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_4-4-cp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-cp"}},[s._v("#")]),s._v(" 4.4 cp")]),s._v(" "),e("ul",[e("li",[s._v("拷贝宿主机文件或目录到pod中，⚠️要求tar二进制文件已经存在容器中，不然拷贝会失败")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /tmp/foo_dir "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("some-pod"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":/tmp/bar_dir\n \n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl cp flannel.tar  nginx-58cd4d4f44-8pwb7:/usr/share/nginx/html ")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl cp mainfile/  nginx-58cd4d4f44-8pwb7:/usr/share/nginx/html ")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it nginx-58cd4d4f44-8pwb7 -- /bin/bash")]),s._v("\nroot@nginx-58cd4d4f44-8pwb7:/"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -l /usr/share/nginx/html/")]),s._v("\ntotal "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("54108")]),s._v("\n-rw-r--r-- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("537")]),s._v(" Jul "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v(" 50x.html\n-rw-r--r-- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("355")]),s._v(" May "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" 06:47 dashboard-adminuser.yaml\n-rw------- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("55390720")]),s._v(" May "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" 01:49 flannel.tar\n-rw-r--r-- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("612")]),s._v(" Jul "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v(" index.html\ndrwxr-xr-x "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" root root       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v(" Aug "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":16 mainfile\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h2",{attrs:{id:"_4-5-port-forward"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-port-forward"}},[s._v("#")]),s._v(" 4.5 port-forward")]),s._v(" "),e("ul",[e("li",[s._v("端口转发，将svc地址或着pods端口利用kubelet映射到宿主机上,将访问宿主机的8888端口的所有流量转发到8111svc")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl port-forward --address "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 service/nginx "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8111")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("转发pods端口,将访问宿主机的8888端口流量转发到pod的5000端口")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl port-forward pod/mypod "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v(":5000\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_4-6-coredns"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-coredns"}},[s._v("#")]),s._v(" 4.6 coredns")]),s._v(" "),e("p",[s._v("service 提供了对 pod 的固定访问端点，但是 service 本身的变动我们无法知晓，需要 coredns 对 service 做域名解析。")]),s._v(" "),e("ul",[e("li",[s._v("查看 coredns 运行状态")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get pods -n kube-system -o wide "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" coredns\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("查看各个 kube-system 命名空间运行的服务，可以看到 kube-dns 运行的 IP 地址")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" -n kube-system\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("使用 kube-dns 来解析 nginx 这个 service 的地址就可以正常解析了")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("dig")]),s._v(" -t A nginx.default.svc.cluster.local @10.96.0.10\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("创建一个访问 nginx 客户端容器，并进入交互式模式，这个容器默认的 dns 服务器就是 kube-dns 所在的服务器")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl run client --image"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("busybox --replicas"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" -it --restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Never\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/ "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/resolv.conf ")]),s._v("\nnameserver "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.10                                               "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kube-dns 地址")]),s._v("\nsearch default.svc.cluster.local svc.cluster.local cluster.local    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认的解析搜索域")]),s._v("\noptions ndots:5\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ul",[e("li",[s._v("在 busybox 这个容器中请求 nginx 这个域名的 service ，能够正常访问")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O - -q http://nginx:80/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_4-7-模拟-pod-被删除"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-模拟-pod-被删除"}},[s._v("#")]),s._v(" 4.7 模拟 POD 被删除")]),s._v(" "),e("ul",[e("li",[s._v("现在我们删除 service 后端的 POD ，副本控制器会自动创建新的 POD，而 service 则会自动指向新创建的 POD")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl delete pods nginx-deploy-5c9b546997-4w24n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("查看由副本控制器自动创建的 POD")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get pods\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("在 busybox 这个容器中请求 nginx 这个域名的 service ，访问没有受到影响")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O - -q http://nginx:80/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_4-8-模拟-service-被删除"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-模拟-service-被删除"}},[s._v("#")]),s._v(" 4.8 模拟 service 被删除")]),s._v(" "),e("ul",[e("li",[s._v("当我们删除 service 并且重新建立一个 service 再次查看 service 的地址已经发生变化了")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl delete "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl expose deployment nginx-deploy --name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx --port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --target-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --protocol"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("TCP\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("在 busybox 这个容器中请求 nginx 这个域名的 service ，访问没有仍然没有受到影响")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O - -q http://nginx:80/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_4-9-labels"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-9-labels"}},[s._v("#")]),s._v(" 4.9 labels")]),s._v(" "),e("p",[s._v("为什么 Pod 被删除后，servic 仍然能够正确的调度到新的 POD 上，这就是 k8s 的 labels 这个机制来保证的。")]),s._v(" "),e("p",[s._v("能够使用标签机制不止有 pod、在 k8s 中很多对象都可以使用标签，例如：node、service")]),s._v(" "),e("ul",[e("li",[s._v("查看 service 的详细信息，会发现标签选择器")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl describe "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("Name:              nginx\nNamespace:         default\nLabels:            "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx-deploy\nAnnotations:       "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nSelector:          "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx-deploy       "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个选择器会自动选中 run 标签，且值为 nginx-deploy 的 POD")]),s._v("\nType:              ClusterIP\nIP:                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".149.4\nPort:              "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP\nTargetPort:        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP\nEndpoints:         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".2.4:80          "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当 service 的后端，当 POD 发生变动则立即会更新")]),s._v("\nSession Affinity:  None\nEvents:            "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("ul",[e("li",[s._v("查看 POD 的标签，会看到拥有 run=nginx-deploy 标签的容器，而人为删除一个 POD 后，副本控制器创建的副本上的标签不会变化，所以标签又被 service 关联。")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get pods --show-labels\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("NAME                            READY   STATUS    RESTARTS   AGE     LABELS\nclient                          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m     "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("client\nnginx-deploy-5c9b546997-kh88w   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          8m37s   pod-template-hash"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("5c9b546997,run"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx-deploy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[s._v("查看 POD 的详细信息，也可以查看到 POD 的详细信息")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl describe deployment nginx-deploy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("根据标签过滤，使用 -l 来指定标签名称或同时过滤其值")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get pods --show-labels -l "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx-deploy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("标签选择器集中运算")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("关系与:  KEY,KEY "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KEY")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("VALUE2,KEY"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("VALUE2       "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -l run,app")]),s._v("\n等值关系:KEY "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" VALUE KEY "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" VALUE           "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -l run=nginx-deploy,app!=myapp")]),s._v("\n集合关系:KYE "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("not "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VALUE1,VALUE2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# -l "release in (canary,bata,alpha)"  ')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[s._v("显示指定的标签的值，下面显示了两个标签")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get pods --show-labels -L run,pod-template-hash\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("为指定的 POD 打标签，为 client 这个 POD 打上一个 release 标签，其值为 canary")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl label pods client "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("release")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("canary\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("修改 POD 的标签，使用 --overwrite 进行修改原有标签")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl label pods client "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("release")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("stable --overwrite\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("删除指定的 nodes 上的标签，使用标签名称加 - 符号")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl label nodes node2 disktype-\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("许多资源支持内嵌字段来定义其使用的标签选择器，例如 service 关联 pod 时候：")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("matchLabels: 直接给定键值\nmatchExpressions: 基于给定的表达式来定义使用标签选择器: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("key:"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"KEY"')]),s._v(",operator:"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OPERATOR"')]),s._v(",value:"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("VAL1,VAL2,"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    使用 key 与 value 进行 operator 运算, 复合条件的才被选择\n    操作符:\n    \tIn, NotIn: 其 value 列表必须有值\n    \tExists, NotExists: 其 value 必须为空\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("ul",[e("li",[s._v("k8s 中很多对象都可以打标签，例如给 nodes 打一个标记，随后在添加资源时候就可以让资源对节点有倾向性了")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl label nodes node2 "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("disktype")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ssd\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get nodes --show-labels\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_4-10-动态扩容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-10-动态扩容"}},[s._v("#")]),s._v(" 4.10 动态扩容")]),s._v(" "),e("ul",[e("li",[s._v("扩容一个集群的的 POD，下面命令表示修改 deployment 控制器下的 nginx-deply 容器的副本数量为2")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl scale --replicas"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" deployment nginx-deploy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_4-11-滚动升级"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-11-滚动升级"}},[s._v("#")]),s._v(" 4.11 滚动升级")]),s._v(" "),e("ul",[e("li",[s._v("更换 nginx-deploy 这个控制器下的 nginx-deploy 容器镜像为 ikubernetes/myapp:v2")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image deployment nginx-deploy nginx-deploy"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ikubernetes/myapp:v2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("查看更新的过程，直到 5 个容器中运行的镜像全部更新完")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl rollout status deployment nginx-deploy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl rollout status deployment nginx-deploy")]),s._v("\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" out of "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" new replicas have been updated"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" out of "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" new replicas have been updated"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" out of "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" new replicas have been updated"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" out of "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" new replicas have been updated"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" out of "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" new replicas have been updated"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" out of "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" new replicas have been updated"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" out of "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" new replicas have been updated"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" out of "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" new replicas have been updated"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" out of "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" new replicas have been updated"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" out of "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" new replicas have been updated"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" old replicas are pending termination"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" old replicas are pending termination"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" old replicas are pending termination"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" old replicas are pending termination"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" old replicas are pending termination"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" old replicas are pending termination"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" rollout to finish: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" of "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" updated replicas are available"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ndeployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-deploy"')]),s._v(" successfully rolled out\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("ul",[e("li",[s._v("回滚操作，不指定任何的镜像则为上一个版本的镜像")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl rollout undo deployment nginx-deploy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("如果防止更新过程中被调度，那么就需要学习就绪性检测才能实现")])]),s._v(" "),e("h2",{attrs:{id:"_4-12-集群外访问"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-12-集群外访问"}},[s._v("#")]),s._v(" 4.12 集群外访问")]),s._v(" "),e("ul",[e("li",[s._v("修改 service 的网络类型为 NodePort")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl edit "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("type: ClusterIP -"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" type: NodePort\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("查看 service 的信息，发现多了一个 30982 端口")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        AGE\nkubernetes   ClusterIP   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1      "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP        15h\nnginx        NodePort    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.105")]),s._v(".27.11   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":30982/TCP   42m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[s._v("在集群外部使用任意的 node IP 地址 + 端口来访问")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("http://172.16.100.101:30982/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_4-13-排查日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-13-排查日志"}},[s._v("#")]),s._v(" 4.13 排查日志")]),s._v(" "),e("ul",[e("li",[s._v("查看一个 pod 的某个容器的运行日志")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl logs pod-demo busybox\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_4-14-连入-pod-容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-14-连入-pod-容器"}},[s._v("#")]),s._v(" 4.14 连入 POD 容器")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it pod-demo -c myapp -- /bin/sh\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);