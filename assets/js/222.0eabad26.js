(window.webpackJsonp=window.webpackJsonp||[]).push([[222],{854:function(s,n,a){"use strict";a.r(n);var t=a(6),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"haproxy-参考示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#haproxy-参考示例"}},[s._v("#")]),s._v(" HAProxy 参考示例")]),s._v(" "),a("p",[s._v("示例一(七层):")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("global\n    log         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 local2\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chroot")]),s._v(" /usr/local/haproxy\n    pidfile     /var/run/haproxy.pid\n    maxconn     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v("\n    user        haproxy\n    group       haproxy\n    daemon\n    spread-checks "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\ndefaults\n    mode                    http\n    log                     global\n    option                  httplog\n    option                  dontlognull\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  不要在日志中记录空连接")]),s._v("\n    option http-server-close\n    option forwardfor       except "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.0/8\n    option                  redispatch\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" http-request    2s\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" queue           3s\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" connect         1s\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" client          10s\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" server          2s\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" http-keep-alive 10s\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" check           2s\n    maxconn                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18000")]),s._v(" \n\nfrontend http-in\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v("             *:8080\n    mode             http\n    log              global\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  以下是日志记录内容配置")]),s._v("\n    capture request  header Host len "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n    capture request  header Referer len "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n    capture request  header Content-Length len "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n    capture response  header Server len "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("\n    capture response  header Content-Length len "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n    capture response  header Cache-Control len "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n    \n    acl url_static   path_beg  -i /static /images /stylesheets\n    acl url_static   path_end  -i .jpg .jpeg .gif .png .ico .bmp .css .js\n    acl url_static   path_end  -i .html .htm .shtml .shtm .pdf .mp3 .mp4 .rm .rmvb .txt\n    acl url_static   path_end  -i .zip .rar .gz .tgz .bz2 .tgz\n\n    use_backend      static_group   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" url_static\n    default_backend  dynamic_group\n    \n    errorfile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),s._v(" /usr/local/haproxy/examples/errorfiles/400.http\n    errorfile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("403")]),s._v(" /usr/local/haproxy/examples/errorfiles/403.http\n    errorfile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("408")]),s._v(" /usr/local/haproxy/examples/errorfiles/408.http\n    errorfile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" /usr/local/haproxy/examples/errorfiles/500.http\n    errorfile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" /usr/local/haproxy/examples/errorfiles/502.http\n    errorfile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" /usr/local/haproxy/examples/errorfiles/503.http\n    errorfile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v(" /usr/local/haproxy/examples/errorfiles/504.http\n\nbackend static_group\n    balance            roundrobin\n    option             http-keep-alive\n    http-reuse         safe\n    option httpchk     GET /health.html\n    http-check "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v("  status "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n    server staticsrv1  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".159.129:80 check rise "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" maxconn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n    server staticsrv2  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".159.130:80 check rise "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" maxconn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n    option forwardfor header X-Forwarded-For\n    \nbackend dynamic_group\n    cookie appsrv insert nocache\n    balance roundrobin\n    option http-server-close\n    option httpchk     GET  /health.html\n    http-check "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v("  status "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n    server appsrv1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".159.129:81   check rise "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" maxconn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(" cookie appsrv1\n    server appsrv2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".159.130:81  check rise "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" maxconn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(" cookie appsrv2\n    option forwardfor header X-Forwarded-For\n    \nlisten report_stats\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" *:8081\n        stats "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v("\n        stats hide-version\n        stats uri    /hastats\n        stats realm  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pls enter your name"')]),s._v("\n        stats auth   admin:admin\n        stats admin  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" TRUE\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br")])]),a("ul",[a("li",[s._v("(1).静态请求将分配给static_group并进行roundrobin调度，同时通过获取index.html来做健康状况检查，此外还设置了haproxy和后端连接重用的功能。")]),s._v(" "),a("li",[s._v("(2).动态请求将分配给dynamic_group并进行roundrobin调度，但是向响应报文中插入了一个cookie，保证被调度过的服务端和客户端能保持会话。此外还设置了通过获取index.php来做健康状况检查。")])]),s._v(" "),a("p",[s._v("示例二(四层):")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("global\n    daemon\n    maxconn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30000")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ulimit -n至少为60018")]),s._v("\n    user        haproxy\n    group       haproxy\n    pidfile     /var/run/haproxy.pid\n    log "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 local0 info\n    log "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 local1 warning\n\ndefaults\n    mode tcp\n    log global\n    option tcplog            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启tcplog")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" connect 5000ms\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" client 10000ms\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" server 10000ms   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TCP模式下，应将timeout client和timeout server设置为一样的值，以防止出现问题")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# option tcp-check ...   # 定义默认的健康检查策略")]),s._v("\n\nfrontend tcp-in\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" *:9002\n    maxconn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30000")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义此端口上的maxconn")]),s._v("\n    default_backend default_servers  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求定向至后端服务群default_servers")]),s._v("\n\nbackend default_servers    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义后端服务群default_servers")]),s._v("\n    balance roundrobin\n    server sqlsrv1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".159.129:3306 maxconn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" check\n    server sqlsrv2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".159.130:3306 maxconn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" check\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("p",[s._v("示例配置详解:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   全局配置")]),s._v("\nglobal\n    log "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 local0         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   设置日志")]),s._v("\n    log "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 local1 notice\n    maxconn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v("                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   最大连接数")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chroot")]),s._v(" /usr/local/haproxy    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   安装目录")]),s._v("\n    user haproxy\n    group haproxy\n    daemon                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   守护进程运行")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  nbproc 1                    #   进程数量，只能用于守护进程模式的haproxy；默认启动一个进程，一般只在单进程仅能打开少数文件描述符的场景中才使用多进程模式；")]),s._v("\n    pidfile /var/run/haproxy.pid\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   默认配置")]),s._v("\ndefaults\n    log     global\n    mode    http                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   默认的模式mode { tcp|http|health }，tcp是4层，http是7层，health只会返回OK")]),s._v("\n    option  httplog              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   http 日志格式")]),s._v("\n    option dontlognull           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   不记录健康检查日志信息；")]),s._v("\n    option  redispatch           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   serverId对应的服务器挂掉后,强制定向到其他健康的服务器")]),s._v("\n    option http-server-close\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  option  abortonclose        #   当服务器负载很高的时候，自动结束掉当前队列处理比较久的链接；")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  option  forwardfor          #   如果后端服务器需要获得客户端真实ip需要配置的参数，可以从Http Header中获得客户端ip；")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  option  httpclose           #   主动关闭http通道,每次请求完毕后主动关闭http通道,ha-proxy不支持keep-alive,只能模拟这种模式的实现;  ")]),s._v("\n    balance roundrobin           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   负载均衡算法,轮询；")]),s._v("\n    retries "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   重试次数；")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" http-request    10s     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  此为等待客户端发送完整请求的最大时长，应该设置较短些防止洪水攻击，如设置为2-3秒")]),s._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  haproxy总是要求一次请求或响应全部发送完成后才会处理、转发，")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" queue           1m      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  请求在队列中的最大时长，1分钟太长了。设置为10秒都有点长，10秒请求不到资源客户端会失去耐心")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" connect         10s     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  haproxy和服务端建立连接的最大时长，设置为1秒就足够了。局域网内建立连接一般都是瞬间的")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" client          1m      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  和客户端保持空闲连接的超时时长，在高并发下可稍微短一点，可设置为10秒以尽快释放连接")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" server          1m      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  和服务端保持空闲连接的超时时长，局域网内建立连接很快，所以尽量设置短一些，特别是并发时，如设置为1-3秒")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" http-keep-alive 10s     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  和客户端保持长连接的最大时长。优先级高于timeout http-request高于timeout client")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" check           10s     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  和后端服务器成功建立连接后到最终完成检查的时长(不包括建立连接的时间，只是读取到检查结果的时长)，")]),s._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  可设置短一点，如1-2秒")]),s._v("\n    maxconn                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  默认和前段的最大连接数，但不能超过global中的maxconn硬限制数")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   统计页面配置")]),s._v("\nlisten admin_stats  \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:50000           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   监听IP和端口，为了安全可以设置本机的局域网IP及端口；")]),s._v("\n    mode http\n    option httplog               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   采用http日志格式  ")]),s._v("\n    stats refresh 30s            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   统计页面自动刷新时间  ")]),s._v("\n    stats uri /haproxy?stats     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   状态管理页面，通过/haproxy?stats来访问")]),s._v("\n    stats realm Haproxy Manager  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   统计页面密码框上提示文本  ")]),s._v("\n    stats auth admin:admin     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   统计页面用户名和密码设置  ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  stats hide-version          #   隐藏统计页面上HAProxy的版本信息")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  errorfile 403 /usr/local/haproxy/examples/errorfiles/   #  设置haproxy 错误页面")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  前端配置")]),s._v("\nfrontend http_main\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   http请求的端口，会被转发到设置的ip及端口")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   转发规则")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  acl url_yuming   path_beg www.yuming.com")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  use_backend server_yuming if url_yuming")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   默认跳转项，当上面都没有匹配上，就转到backend的http_default上；")]),s._v("\n    default_backend http_default\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   提升失败的时候的用户体验")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  errorfile 502 /usr/local/haproxy/examples/errorfiles/502.http")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  errorfile 503 /usr/local/haproxy/examples/errorfiles/503.http")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  errorfile 504 /usr/local/haproxy/examples/errorfiles/504.http")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   后端配置")]),s._v("\nbackend http_default\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   额外的一些设置，按需使用")]),s._v("\n    option forwardfor\n    option forwardfor header Client-IP\n    option http-server-close\n    option httpclose\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   负载均衡方式")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  source 根据请求源IP")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  static-rr 根据权重")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  leastconn 最少连接先处理;在有着较长时间会话的场景中推荐使用此算法，如LDAP、SQL等，其并不太适用于较短会话的应用层协议，如HTTP；此算法是动态的，")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  uri 根据请求的uri")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  url_param 根据请求的url参数")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  rdp-cookie 据据cookie(name)来锁定并哈希每一次请求")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  hdr(name) 根据HTTP请求头来锁定每一次HTTP请求")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  roundrobin 轮询方式")]),s._v("\n    balance roundrobin           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   负载均衡的方式,轮询方式")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   设置健康检查页面")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  option httpchk GET /index.html")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  传递客户端真实IP")]),s._v("\n    option forwardfor header X-Forwarded-For\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   需要转发的ip及端口")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   inter 2000 健康检查时间间隔2秒")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   rise 3 检测多少次才认为是正常的")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   fall 3 失败多少次才认为是不可用的")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   weight 30 权重")]),s._v("\n    server node1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.101:8080 check inter "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v(" rise "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" fall "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" weight "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n    server node2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.101:8081 check inter "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v(" rise "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" fall "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" weight "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br")])]),a("h2",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),a("ul",[a("li",[s._v("haproxy实现会话保持(cookie):https://www.cnblogs.com/f-ck-need-u/p/8553190.html")])])])}),[],!1,null,null,null);n.default=e.exports}}]);