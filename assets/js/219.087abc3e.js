(window.webpackJsonp=window.webpackJsonp||[]).push([[219],{851:function(s,a,t){"use strict";t.r(a);var e=t(6),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"vsftp-基础实战"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vsftp-基础实战"}},[s._v("#")]),s._v(" vsFTP 基础实战")]),s._v(" "),t("h2",{attrs:{id:"vsftp登录方式及ftp数据连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vsftp登录方式及ftp数据连接"}},[s._v("#")]),s._v(" vsFTP登录方式及FTP数据连接")]),s._v(" "),t("p",[s._v("FTP可以有三种登入方式分别是：")]),s._v(" "),t("ul",[t("li",[s._v("匿名(anonymous)登录方式：不需要用户密码，匿名用户默认全部都映射"),t("code",[s._v("ftp")]),s._v("用户，其目录在"),t("code",[s._v("/var/ftp")])]),s._v(" "),t("li",[s._v("本地用户登入：使用本地用户和密码登入，使用的是"),t("code",[s._v("PAM")]),s._v("认证("),t("code",[s._v("/etc/pam.d/vsftpd")]),s._v(")，其默认目录为系统用户的家目录")]),s._v(" "),t("li",[s._v("虚拟用户方式：也是使用用户和密码登入，但是该用户不是linux中创建的用户")])]),s._v(" "),t("p",[s._v("FTP的两个连接，分别是"),t("strong",[s._v("命令连接和数据连接")]),s._v("，其中数据连接的建立方式又分为"),t("strong",[s._v("主动和被动")]),s._v("连接两种：")]),s._v(" "),t("blockquote",[t("p",[s._v("FTP服务端会监听2个端口, 控制进程20,数据进程21(主动模式) 数据连接,站在服务器角度,有2种模式：")]),s._v(" "),t("p",[s._v("主动模式：ftp server从20端口主动向客户端发起连接,由于源端口固定,所以适用于模式防火墙模式.")]),s._v(" "),t("p",[s._v("被动模式：ftp server被动等待客户端来连我的这个端口(控制连接后会告知会将passive ip/port告知了客户端) 一般情况下默认都是被动模式")])]),s._v(" "),t("h2",{attrs:{id:"vsftp安装及其程序环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vsftp安装及其程序环境"}},[s._v("#")]),s._v(" vsFTP安装及其程序环境")]),s._v(" "),t("p",[s._v("源码和二进制包下载地址：https://pkgs.org/download/vsftpd")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y vsftpd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("主要文件目录：")]),s._v(" "),t("ul",[t("li",[s._v("主程序："),t("code",[s._v("/usr/sbin/vsftp")])]),s._v(" "),t("li",[s._v("启动脚本文件："),t("code",[s._v("/etc/rc.d/init.d/vsftpd")])]),s._v(" "),t("li",[s._v("系统服务单元目录："),t("code",[s._v("/usr/lib/systemd/system/vsftpd.service")])]),s._v(" "),t("li",[s._v("主配置文件："),t("code",[s._v("/etc/vsftp/vsftp.conf")])]),s._v(" "),t("li",[t("code",[s._v("/etc/pam.d/vsftpd")]),s._v("：PAM认证文件（此文件中"),t("code",[s._v("file=/etc/vsftpd/ftpusers")]),s._v("字段，指明阻止访问的用户来自该文件中的用户）")]),s._v(" "),t("li",[t("code",[s._v("/etc/vsftpd/ftpusers")]),s._v("：禁止使用vsftpd的用户列表文件【黑名单】")]),s._v(" "),t("li",[t("code",[s._v("/etc/vsftpd/user_list")]),s._v("：禁止或允许使用vsftpd的用户列表文件，这个文件中指定的用户缺省情况（即在"),t("code",[s._v("/etc/vsftpd/vsftpd.conf")]),s._v("中设置"),t("code",[s._v("userlist_deny=YES")]),s._v("）下也不能访问FTP服务器，在设置了"),t("code",[s._v("userlist_deny=NO")]),s._v("时,仅允许user_list中指定的用户访问FTP服务器")]),s._v(" "),t("li",[s._v("匿名用户数据根目录："),t("code",[s._v("/var/ftp")])]),s._v(" "),t("li",[s._v("匿名用户的下载上传目录："),t("code",[s._v("/var/ftp/pub")]),s._v("此目录需赋权根chmod 1777 pub（1为特殊权限，使上载后无法删除）")]),s._v(" "),t("li",[s._v("vsFTP的日志文件："),t("code",[s._v("/etc/logrotate.d/vsftpd.log")])])]),s._v(" "),t("h2",{attrs:{id:"vsftp配置文件参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vsftp配置文件参数"}},[s._v("#")]),s._v(" vsFTP配置文件参数")]),s._v(" "),t("h3",{attrs:{id:"基本选项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本选项"}},[s._v("#")]),s._v(" 基本选项")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许匿名登录FTP服务器，默认设置为YES允许")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户可使用用户名ftp或anonymous进行ftp登录，口令为用户的E-mail地址。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如不允许匿名访问则设置为NO")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("anonymous_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许本地用户(即linux系统中的用户帐号)登录FTP服务器，默认设置为YES允许")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地用户登录后会进入用户主目录，而匿名用户登录后进入匿名用户的下载目录/var/ftp/pub")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若只允许匿名用户访问，前面加上注释掉即可阻止本地用户访问FTP服务器")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("local_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许本地用户对FTP服务器文件具有写权限，默认设置为YES允许")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("write_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 掩码，本地用户默认掩码为077")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 你可以设置本地用户的文件掩码为缺省022，也可根据个人喜好将其设置为其他值")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("local_umask")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("022\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许匿名用户上传文件，须将全局的write_enable=YES。默认为YES")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("anon_upload_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许匿名用户创建新文件夹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("anon_mkdir_write_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否激活目录欢迎信息功能")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当用户用CMD模式首次访问服务器上某个目录时，FTP服务器将显示欢迎信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认情况下，欢迎信息是通过该目录下的.message文件获得的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此文件保存自定义的欢迎信息，由用户自己建立")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dirmessage_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否让系统自动维护上传和下载的日志文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认情况该日志文件为/var/log/vsftpd.log,也可以通过下面的xferlog_file选项对其进行设定")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认值为NO")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xferlog_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Make sure PORT transfer connections originate from port 20 (ftp-data).")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否设定FTP服务器将启用FTP数据端口的连接请求")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ftp-data数据传输，21为连接控制端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connect_from_port_20")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设定是否允许改变上传文件的属主，与下面一个设定项配合使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意，不推荐使用root用户上传文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("chown_uploads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置想要改变的上传文件的属主，如果需要，则输入一个系统用户名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以把上传的文件都改成root属主。whoever：任何人")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("chown_username")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("whoever\n* "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设定系统维护记录FTP服务器上传和下载情况的日志文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /var/log/vsftpd.log是默认的，也可以另设其它")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xferlog_file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/vsftpd.log\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否以标准xferlog的格式书写传输日志文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认为/var/log/xferlog，也可以通过xferlog_file选项对其进行设定")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认值为NO")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xferlog_std_format")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下是附加配置，添加相应的选项将启用相应的设置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否生成两个相似的日志文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认在/var/log/xferlog和/var/log/vsftpd.log目录下")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前者是wu_ftpd类型的传输日志，可以利用标准日志工具对其进行分析；后者是vsftpd类型的日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dual_log_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否将原本输出到/var/log/vsftpd.log中的日志，输出到系统日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("syslog_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置数据传输中断间隔时间，此语句表示空闲的用户会话中断时间为600秒")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 即当数据传输结束后，用户连接FTP服务器的时间不应超过600秒。可以根据实际情况对该值进行修改")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("idle_session_timeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置数据连接超时时间，该语句表示数据连接超时时间为120秒，可根据实际情况对其个修改")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("data_connection_timeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行vsftpd需要的非特权系统用户，缺省是nobody")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nopriv_user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ftpsecure\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否识别异步ABOR请求。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果FTP client会下达“async ABOR”这个指令时，这个设定才需要启用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 而一般此设定并不安全，所以通常将其取消")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("async_abor_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否以ASCII方式传输数据。默认情况下，服务器会忽略ASCII方式的请求。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用此选项将允许服务器以ASCII方式传输数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 不过，这样可能会导致由"SIZE /big/file"方式引起的DoS攻击')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ascii_upload_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ascii_download_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录FTP服务器时显示的欢迎信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如有需要，可在更改目录欢迎信息的目录下创建名为.message的文件，并写入欢迎信息保存后")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ftpd_banner")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Welcome to blah FTP service.\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 黑名单设置。如果很讨厌某些email address，就可以使用此设定来取消他的登录权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以将某些特殊的email address抵挡住。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("deny_email_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当上面的deny_email_enable=YES时，可以利用这个设定项来规定哪些邮件地址不可登录vsftpd服务器")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此文件需用户自己创建，一行一个email address即可")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("banned_email_file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/vsftpd/banned_emails\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户登录FTP服务器后是否具有访问自己目录以外的其他文件的权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置为YES时，用户被锁定在自己的home目录中，vsftpd将在下面chroot_list_file选项值的位置寻找chroot_list文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 必须与下面的设置项配合")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("chroot_list_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 被列入此文件的用户，在登录后将不能切换到自己目录以外的其他目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从而有利于FTP服务器的安全管理和隐私保护。此文件需自己建立")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("chroot_list_file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/vsftpd/chroot_list\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许递归查询。默认为关闭，以防止远程用户造成过量的I/O")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ls_recurse_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许监听。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果设置为YES，则vsftpd将以独立模式运行，由vsftpd自己监听和处理IPv4端口的连接请求")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listen")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改默认监听的端口，应当尽量大于4000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listen_port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4449")]),s._v("\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端连接语句：`lftp 172.16.122.126 4449`")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设定是否支持IPV6。如要同时监听IPv4和IPv6端口，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 则必须运行两套vsftpd，采用两套配置文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同时确保其中有一个监听选项是被注释掉的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listen_ipv6")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置PAM外挂模块提供的认证服务所使用的配置文件名，即/etc/pam.d/vsftpd文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此文件中file=/etc/vsftpd/ftpusers字段，说明了PAM模块能抵挡的帐号内容来自文件/etc/vsftpd/ftpusers中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pam_service_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vsftpd\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许ftpusers文件中的用户登录FTP服务器，默认为NO")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若此项设为YES，则user_list文件中的用户允许登录FTP服务器")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 而如果同时设置了userlist_deny=YES，则user_list文件中的用户将不允许登录FTP服务器，甚至连输入密码提示信息都没有")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("userlist_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES/NO\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置是否阻扯user_list文件中的用户登录FTP服务器，默认为YES")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("userlist_deny")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES/NO\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否使用tcp_wrappers作为主机访问控制方式。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcp_wrappers可以实现linux系统中网络服务的基于主机地址的访问控制")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在/etc目录中的hosts.allow和hosts.deny两个文件用于设置tcp_wrappers的访问控制")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前者设置允许访问记录，后者设置拒绝访问记录。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如想限制某些主机对FTP服务器192.168.57.2的匿名访问，编缉/etc/hosts.allow文件，如在下面增加两行命令：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vsftpd:192.168.57.1:DENY 和vsftpd:192.168.57.9:DENY")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表明限制IP为192.168.57.1/192.168.57.9主机访问IP为192.168.57.2的FTP服务器")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时FTP服务器虽可以PING通，但无法连接")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcp_wrappers")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br")])]),t("p",[s._v("FROM：https://www.jb51.net/article/94223.htm")]),s._v(" "),t("h3",{attrs:{id:"欢迎语设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#欢迎语设置"}},[s._v("#")]),s._v(" 欢迎语设置")]),s._v(" "),t("p",[t("code",[s._v("dirmessage_enable=YES/NO（YES）")]),s._v("：如果启动这个选项，那么使用者第一次进入一个目录时，会检查该目录下是否有.message这个档案，如果有，则会出现此档案的内容，通常这个档案会放置欢迎话语，或是对该目录的说明。默认值为开启。\n"),t("code",[s._v("message_file=.message")]),s._v("：设置目录消息文件，可将要显示的信息写入该文件。默认值为.message。\n"),t("code",[s._v("banner_file=/etc/vsftpd/banner")]),s._v("：当使用者登入时，会显示此设定所在的档案内容，通常为欢迎话语或是说明。默认值为无。如果欢迎信息较多，则使用该配置项。\n"),t("code",[s._v("ftpd_banner=Welcome to AGou's FTP server")]),s._v("：这里用来定义欢迎话语的字符串，banner_file是档案的形式，而ftpd_banner 则是字符串的形式。预设为无。")]),s._v(" "),t("h3",{attrs:{id:"限制最大连接数和传输速率"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#限制最大连接数和传输速率"}},[s._v("#")]),s._v(" 限制最大连接数和传输速率")]),s._v(" "),t("p",[t("code",[s._v("max_client")]),s._v("：用于设置FTP服务器所允许的最大客户端连接数，值为0时表示不限制。例如"),t("code",[s._v("max_client=100")]),s._v("表示FTP服务器的所有客户端最大连接数不超过100个。\n"),t("code",[s._v("max_per_ip")]),s._v("： 用于设置对于同一IP地址允许的最大客户端连接数，值为0时表示不限制。例如"),t("code",[s._v("max_per_ip=5")]),s._v("表示同一IP地址的FTP客户机与FTP服务器建立的最大连接数不超过5个。\n"),t("code",[s._v("local_max_rate")]),s._v("： 用于设置本地用户的最大传输速率，单位为B/s，值为0时表示不限制。例如"),t("code",[s._v("local_max_rate=500000")]),s._v("表示FTP服务器的本地用户最大传输速率设置为500KB/s.\n"),t("code",[s._v("anon_max_rate")]),s._v("：用于设置匿名用户的最大传输速率，单位为B/s,值为0表示不限制。例如"),t("code",[s._v("ano_max_rate=200000")]),s._v("，表示FTP服务器的匿名用户最大传输速率设置为200KB/s.")]),s._v(" "),t("h3",{attrs:{id:"指定用户的权限设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#指定用户的权限设置"}},[s._v("#")]),s._v(" 指定用户的权限设置")]),s._v(" "),t("p",[t("code",[s._v("vsftpd.user_list")]),s._v("文件需要与"),t("code",[s._v("vsftpd.conf")]),s._v("文件中的配置项结合来实现对于"),t("code",[s._v("vsftpd.user_list")]),s._v("文件中指定用户账号的访问控制：")]),s._v(" "),t("p",[s._v("（1）设置禁止登录的用户账号（"),t("strong",[s._v("黑名单")]),s._v("）")]),s._v(" "),t("p",[s._v("当"),t("code",[s._v("vsftpd.conf")]),s._v("配置文件中包括以下设置时，"),t("code",[s._v("vsftpd.user_list")]),s._v("文件中的用户账号被禁止进行FTP登录：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("userlist_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("userlist_deny")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("userlist_enable设置项设置使用vsftpd.user_list文件，userlist_deny设置为YES表示vsftpd.user_list文件用于设置禁止的用户账号。")]),s._v(" "),t("p",[s._v("（2）设置只允许登录的用户账号（"),t("strong",[s._v("白名单，建议方式")]),s._v("）")]),s._v(" "),t("p",[s._v("当"),t("code",[s._v("vsftpd.conf")]),s._v("配置文件中包括以下设置时，只有"),t("code",[s._v("vsftpd.user_list")]),s._v("文件中的用户账号能够进行FTP登录：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("userlist_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("userlist_deny")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NO\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"控制用户是否允许切换到上级目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#控制用户是否允许切换到上级目录"}},[s._v("#")]),s._v(" 控制用户是否允许切换到上级目录")]),s._v(" "),t("p",[s._v("在默认配置下，本地用户登入FTP后可以使用cd命令切换到其他目录，这样会对系统带来安全隐患。可以通过以下三条配置文件来控制用户切换目录：\n"),t("code",[s._v("chroot_list_enable=YES/NO（NO）")]),s._v("：设置是否启用chroot_list_file配置项指定的用户列表文件。默认值为NO。\n"),t("code",[s._v("chroot_list_file=/etc/vsftpd.chroot_list")]),s._v("：用于指定用户列表文件，该文件用于控制哪些用户可以切换到用户家目录的上级目录。\n"),t("code",[s._v("chroot_local_user=YES/NO（NO）")]),s._v("：用于指定用户列表文件中的用户是否允许切换到上级目录。默认值为NO。\n通过搭配能实现以下几种效果：\n①当"),t("code",[s._v("chroot_list_enable=YES")]),s._v("，"),t("code",[s._v("chroot_local_user=YES")]),s._v("时，在"),t("code",[s._v("/etc/vsftpd.chroot_list")]),s._v("文件中列出的用户，可以切换到其他目录；未在文件中列出的用户，不能切换到其他目录。\n②当"),t("code",[s._v("chroot_list_enable=YES")]),s._v("，"),t("code",[s._v("chroot_local_user=NO")]),s._v("时，在"),t("code",[s._v("/etc/vsftpd.chroot_list")]),s._v("文件中列出的用户，不能切换到其他目录；未在文件中列出的用户，可以切换到其他目录。\n③当"),t("code",[s._v("chroot_list_enable=NO")]),s._v("，"),t("code",[s._v("chroot_local_user=YES")]),s._v("时，所有的用户均不能切换到其他目录。\n④当"),t("code",[s._v("chroot_list_enable=NO")]),s._v("，"),t("code",[s._v("chroot_local_user=NO")]),s._v("时，所有的用户均可以切换到其他目录。")]),s._v(" "),t("h3",{attrs:{id:"设置用户组"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置用户组"}},[s._v("#")]),s._v(" 设置用户组")]),s._v(" "),t("p",[s._v("简单示例：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /home/ftpuser \t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 递归创建新目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" ftpuser  新建组\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -g ftpuser -d /home/ftpuser ftpuser1 \t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新建用户ftpuser1并指定家目录和属组")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -g ftpuser -d /home/ftpuser ftpuser2 \t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新建用户ftpuser2并指定家目录和属组")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -g ftpuser -d /home/ftpuser ftpuser3 \t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建用户ftpuser3并指定家目录和属组")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" ftpuser1 /home/ftpuser \t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置目录属主为用户ftpuser1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" .ftpuser /home/ftpuser \t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置目录属组为组ftpuser")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("750")]),s._v(" /home/ftpuser \t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置目录访问权限ftpuser1为读，写，执行；ftpuser2，ftpuser3为读，执行`")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("说明：由于本地用户登录FTP服务器后进入自己主目录，而"),t("code",[s._v("ftpuser1")]),s._v("，"),t("code",[s._v("ftpuser2")]),s._v("， "),t("code",[s._v("ftpuser3")]),s._v("对主目录"),t("code",[s._v("/home/ftpuser")]),s._v("分配的权限不同，所以通过FTP访问的权限也不同，"),t("code",[s._v("ftpuser1")]),s._v("访问权限为："),t("strong",[s._v("上传，下载，建目录；")]),t("code",[s._v("ftpuser2")]),s._v("，"),t("code",[s._v("ftpuser3")]),s._v("访问权限为"),t("strong",[s._v("下载，浏览，不能建目录和上传")]),s._v("。实现了群组中用户不同访问级别，加强了对FTP服务器的分级安全管理。")]),s._v(" "),t("h3",{attrs:{id:"连接超时设定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接超时设定"}},[s._v("#")]),s._v(" 连接超时设定")]),s._v(" "),t("p",[s._v("配置空闲的用户会话的中断时间：如下配置将在用户会话空闲5分钟后被中断，以释放服务器的资源")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Idle_session_timeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("配置空闲的数据连接的中断时间：如下配置将在数据空闲连接1分钟后被中断，同样也是为了释放服务器的资源")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Data_connection_timeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("配置客户端空闲时的自动中断和激活连接的时间：如下配置将使客户端空闲1分钟后自动中断连接，并在30秒后自动激活连接")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Accept_timeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Connect_timeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"虚拟用户使用-pam-mysql-so-模块认证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#虚拟用户使用-pam-mysql-so-模块认证"}},[s._v("#")]),s._v(" 虚拟用户使用 pam_mysql.so 模块认证")]),s._v(" "),t("ol",[t("li",[s._v("创建用户，并建立数据库")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建可用用户，此处可以只给其读权限")]),s._v("\nMariaDB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" vsftpd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" vsftpd"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'127.0.0.1'")]),s._v(" IDENTIFIED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vsftpd'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nMariaDB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" FLUSH "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建立数据库")]),s._v("\nMariaDB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATABASE")]),s._v(" vsftpd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nMariaDB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" vsftpd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建账号密码表")]),s._v("\nMariaDB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("vsftpd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" users"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNSIGNED")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNIQUE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加用户和密码")]),s._v("\nMariaDB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("vsftpd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" users"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'suofeiya'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("PASSWORD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'suofeiya'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("PASSWORD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看创建结果")]),s._v("\nMariaDB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("vsftpd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+----------+-------------------------------------------+")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" name     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" password                                  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+----------+-------------------------------------------+")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" suofeiya "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("AE36A05192361576481222E6D5358109134F64 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" test     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("BDCEBE19083CE2A1F959FD02F964C7AF4CFC29 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+----------+-------------------------------------------+")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("为虚拟用户添加家目录")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -pv /data\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -d /data/ftpvuser ftpvuser\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查是否成功创建用户")]),s._v("\nfinger ftpvuser\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("安装认证所需的"),t("code",[s._v("pam_mysql.so")]),s._v("模块")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在CentOS 6上，直接安装pam_mysql即可")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -u pam_mysql\n* 需要注意的一点是："),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("pam_mysql"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("属于"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("epel"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("仓库，需要提前安装好"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("epel"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("仓库\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在CentOS 7上，需要编译安装pam_mysql.so模块")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 源码包下载地址：https://sourceforge.net/projects/pam-mysql/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 预先准备")]),s._v("\n yum groupinstall "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Development Tools"')]),s._v(" -y\nyum groupinstall mysql-devel  pam-devel -y\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译并安装")]),s._v("\n./configure --with-mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr --with-pam"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr --with-pam-mods-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/lib64/security\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查是否成功安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /usr/lib64/security/ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" pam_mysql.so\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("建立pam认证所需文件")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/pam.d/vsftp.vuser\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("####")]),s._v("\nauth required /lib64/security/pam_mysql.so "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vsftpd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("passwd")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vsftpd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vsftpd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("table")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("users "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("usercolumn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("name "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("passwdcolumn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("password "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("crypt")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\naccount required /lib64/security/pam_mysql.so "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vsftpd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("passwd")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vsftpd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vsftpd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("table")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("users "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("usercolumn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("name "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("passwdcolumn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("password "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("crypt")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("####")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("修改vsftp的配置文件")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/vsftpd/vsftpd.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("####")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pam_service_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vsftpd\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改为  --\x3e")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pam_service_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vsftp.vuser\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#其他 配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("guest_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("guest_username")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ftpvuser\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("####")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("为虚拟用户添加所需权限（对用户单独配置权限）")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑vsftp的配置文件，添加以下内容，表示用户配置目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("####")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user_config_dir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/vsftpd/vusers.d/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("####")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /etc/vsftpd/vusers.d/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建与用户名同名的配置文件，为用户添加上传和创建目录权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/vsftpd/vusers.d/suofeiya\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("####")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("anon_upload_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("anon_mkdir_write_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("####")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启服务使其生效")]),s._v("\nsystemctl restart vsftpd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("出现的一些小问题：")]),s._v(" "),t("ol",[t("li",[s._v("登录被拒绝，解决方法：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 去除目录的写权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a-w /data/ftpvuser\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("使用"),t("code",[s._v("ls")]),s._v("命令出现"),t("code",[s._v("226 Transfer done (but failed to open directory).")]),s._v("无法使用等问题，解决方法：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改共享文件夹的属组属组即可")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" ftpvuser:ftpvuser /data/ftpvuser/pub\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);