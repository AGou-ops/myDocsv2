(window.webpackJsonp=window.webpackJsonp||[]).push([[205],{837:function(s,e,a){"use strict";a.r(e);var t=a(6),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"cepha-部署octopus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cepha-部署octopus"}},[s._v("#")]),s._v(" Cepha   部署octopus")]),s._v(" "),a("p",[s._v("获取"),a("code",[s._v("cephadm")]),s._v("部署工具")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl --silent --remote-name --location https://github.com/ceph/ceph/raw/octopus/src/cephadm/cephadm")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod +x cephadm")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("注意提前安装好docker和chronyd\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./cephadm add-repo --release octopus")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./cephadm install")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# which cephadm")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("安装引导集群:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -p /etc/ceph")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cephadm bootstrap --mon-ip 192.168.159.139")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("此命令将：")]),s._v(" "),a("ul",[a("li",[s._v("在本地主机上为新集群创建监视和管理器守护程序。")]),s._v(" "),a("li",[s._v("为Ceph集群生成一个新的SSH密钥，并将其添加到root用户的"),a("code",[s._v("/root/.ssh/authorized_keys")]),s._v("文件中。")]),s._v(" "),a("li",[s._v("将与新群集通信所需的最小配置文件写入"),a("code",[s._v("/etc/ceph/ceph.conf")]),s._v("。")]),s._v(" "),a("li",[s._v("将client.admin管理（root）密钥的副本写入"),a("code",[s._v("/etc/ceph/ceph.client.admin.keyring")]),s._v("。")]),s._v(" "),a("li",[s._v("将公共密钥的副本写入"),a("code",[s._v("/etc/ceph/ceph.pub")]),s._v("。")])]),s._v(" "),a("p",[s._v("启用CEPH CLI")]),s._v(" "),a("p",[s._v("与之前不同的是, ceph的命令不再在bash shell中出现, 而是单独出来了.")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cephadm shell")]),s._v("\n为了方便,可以添加一个别名\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# alias ceph='cephadm shell -- ceph'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("你还可以安装ceph-common软件包，其中包含所有ceph命令，包括ceph，rbd，mount.ceph（用于安装CephFS文件系统）等：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("cephadm add-repo --release octopus\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cephadm install ceph-common")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("确认可以使用以下命令访问ceph命令：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph -v")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("使用以下命令确认ceph命令可以连接到集群及其状态:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph status")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("将主机添加到集群中")]),s._v(" "),a("p",[s._v("在新主机的root用户的authorized_keys文件中安装群集的公共SSH密钥：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id -f -i /etc/ceph/ceph.pub root@stor2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("告诉Ceph，新节点是集群的一部分：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph orch host add stor2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);