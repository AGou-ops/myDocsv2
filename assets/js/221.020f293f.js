(window.webpackJsonp=window.webpackJsonp||[]).push([[221],{853:function(s,a,t){"use strict";t.r(a);var n=t(6),r=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"haproxy-basic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#haproxy-basic"}},[s._v("#")]),s._v(" HAProxy Basic")]),s._v(" "),t("h2",{attrs:{id:"haproxy简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#haproxy简介"}},[s._v("#")]),s._v(" HAProxy简介")]),s._v(" "),t("p",[s._v("HAProxy提供高可用性、负载均衡以及基于TCP和HTTP应用的代理，支持虚拟主机，它是免费、快速并且可靠的一种解决方案。")]),s._v(" "),t("p",[s._v("HAProxy特别适用于那些负载特大的web站点，这些站点通常又需要会话保持或七层处理。")]),s._v(" "),t("p",[s._v("HAProxy运行在当前的硬件上，完全可以支持数以万计的并发连接。并且它的运行模式使得它可以很简单安全的整合进您当前的架构中， 同时可以保护你的web服务器不被暴露到网络上。")]),s._v(" "),t("p",[s._v("HAProxy实现了一种事件驱动, 单一进程模型，此模型支持非常大的并发连接数。多进程或多线程模型受内存限制 、系统调度器限制以及无处不在的锁限制，很少能处理数千并发连接。事件驱动模型因为在有更好的资源和时间管理的用户空间(User-Space) 实现所有这")]),s._v(" "),t("p",[s._v("些任务，所以没有这些问题。此模型的弊端是，在多核系统上，这些程序通常扩展性较差。这就是为什么他们必须进行优化以 使每个CPU时间片(Cycle)做更多的工作。")]),s._v(" "),t("h2",{attrs:{id:"haproxy安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#haproxy安装"}},[s._v("#")]),s._v(" HAProxy安装")]),s._v(" "),t("h3",{attrs:{id:"直接通过yum仓库安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#直接通过yum仓库安装"}},[s._v("#")]),s._v(" 直接通过yum仓库安装")]),s._v(" "),t("p",[t("code",[s._v("yum install -y haproxy")]),s._v(",默认安装版本为"),t("code",[s._v("1.5.18")]),s._v("(截止目前为止)")]),s._v(" "),t("h3",{attrs:{id:"编译安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译安装"}},[s._v("#")]),s._v(" 编译安装")]),s._v(" "),t("ol",[t("li",[s._v("从"),t("a",{attrs:{href:"http://www.haproxy.org/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方仓库"),t("OutboundLink")],1),s._v("下载源码包,并解压缩")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://www.haproxy.org/download/1.8/src/haproxy-1.8.25.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xf haproxy-1.8.25.tar.gz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("编译及安装")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" haproxy-1.8.25\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看安装说明")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("less")]),s._v(" README\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nTo build haproxy, you have to choose your target OS amongst the following ones\nand assign it to the TARGET variable "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n\n  - linux26     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Linux "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.6")]),s._v(" and above\n  - linux2628   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Linux "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.6")]),s._v(".28, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".x, and above "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("enables splice and tproxy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前内核版本")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -r\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.10")]),s._v(".0-1062.18.1.el7.x86_64\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所以使用linux2628来进行编译")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始编译")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TARGET")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("linux2628 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ARCH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("x86_64 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PREFIX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/haproxy\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PREFIX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/haproxy\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("启动")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("/usr/local/haproxy/sbin/haproxy -f /usr/local/haproxy/haproxy.cfg\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用软连接方便使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -sv /usr/local/haproxy/sbin/haproxy /usr/sbin/haproxy\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("为haproxy创建相关目录")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -pv /usr/local/haproxy/conf.d     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为多配置文件准备")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -pv /usr/local/haproxy/logs\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# haproxy日志目录,可做软连接")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -pv /etc/haproxy/conf.d                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建主配置目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" /usr/local/haproxy/haproxy.cfg  \t "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建配置文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -sv /usr/local/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg \t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加配置文件软连接方便管理")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -sv /usr/local/haproxy/conf.d /etc/haproxy/conf.d\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("为haproxy添加到系统服务或者创建"),t("code",[s._v("UNIT file")]),s._v("方便管理")])]),s._v(" "),t("p",[s._v("添加到系统服务:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /root/haproxy-1.8.25/examples/haproxy.init /etc/init.d/haproxy\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前面那个文件为源码包里面的示例文件,按照需求修改即可")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" /etc/init.d/haproxy\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" --add haproxy\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" haproxy on\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" --list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" haproxy\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("添加到"),t("code",[s._v("UNIT FILE")]),s._v(":")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("# "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /usr/lib/systemd/system/haproxy.service\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("HAProxy Load Balancer\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("syslog.target network.target\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EnvironmentFile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/sysconfig/haproxy\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/haproxy/sbin/haproxy -f /usr/local/haproxy/haproxy.cfg -p /run/haproxy.pid "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTIONS")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecReload")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/kill -USR2 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KillMode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mixed\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h2",{attrs:{id:"haproxy命令行工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#haproxy命令行工具"}},[s._v("#")]),s._v(" haproxy命令行工具")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查配置文件语法")]),s._v("\nhaproxy -c -f /etc/haproxy/haproxy.cfg\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以daemon模式启动，以systemd管理的daemon模式启动")]),s._v("\nhaproxy -D -f /etc/haproxy/haproxy.cfg "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-p /var/run/haproxy.pid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhaproxy -Ds -f /etc/haproxy/haproxy.cfg "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-p /var/run/haproxy.pid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动调试功能，将显示所有连接和处理信息在屏幕")]),s._v("\nhaproxy -d -f /etc/haproxy/haproxy.cfg\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# restart。需要使用st选项指定pid列表")]),s._v("\nhaproxy -f /etc/haproxy.cfg "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-p /var/run/haproxy.pid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -st "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/run/haproxy.pid"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# graceful restart，即reload。需要使用sf选项指定pid列表")]),s._v("\nhaproxy -f /etc/haproxy.cfg "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-p /var/run/haproxy.pid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -sf "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/run/haproxy.pid"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示haproxy编译和启动信息")]),s._v("\nhaproxy -vv\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),t("ul",[t("li",[s._v("官方站点:http://www.haproxy.org/")]),s._v(" "),t("li",[s._v("1.8官方文档:http://cbonte.github.io/haproxy-dconv/1.8/configuration.html")])])])}),[],!1,null,null,null);a.default=r.exports}}]);