(window.webpackJsonp=window.webpackJsonp||[]).push([[335],{968:function(s,a,n){"use strict";n.r(a);var t=n(6),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"dnsmasq-部署与使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dnsmasq-部署与使用"}},[s._v("#")]),s._v(" dnsmasq 部署与使用")]),s._v(" "),n("h2",{attrs:{id:"编译安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编译安装"}},[s._v("#")]),s._v(" 编译安装")]),s._v(" "),n("p",[s._v("从 http://www.thekelleys.org.uk/dnsmasq/ 下载源码包, 安装编译环境, 然后直接使用"),n("code",[s._v("root")]),s._v("身份运行"),n("code",[s._v("make install")]),s._v("命令即可, 默认安装的二进制文件位置为"),n("code",[s._v("/usr/local/sbin/dnsmasq")]),s._v(".")]),s._v(" "),n("h2",{attrs:{id:"install-dnsmasq-on-ubuntu"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#install-dnsmasq-on-ubuntu"}},[s._v("#")]),s._v(" install dnsmasq on ubuntu")]),s._v(" "),n("h3",{attrs:{id:"step-1-installing-dnsmasq-on-ubuntu-18-04"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-1-installing-dnsmasq-on-ubuntu-18-04"}},[s._v("#")]),s._v(" Step 1: Installing Dnsmasq on Ubuntu 18.04")]),s._v(" "),n("p",[s._v("Ubuntu 18.04 comes with systemd-resolve which you need to disable since it binds to port "),n("strong",[s._v("53")]),s._v(" which will conflict with Dnsmasq port.")]),s._v(" "),n("p",[s._v("Run the following commands to disable the resolved service:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl disable systemd-resolved\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop systemd-resolved\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("Also, remove the symlinked "),n("code",[s._v("resolv.conf")]),s._v(" file")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -lh /etc/resolv.conf \nlrwxrwxrwx "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v(" Aug  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":52 /etc/resolv.conf -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/run/systemd/resolve/stub-resolv.conf\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /etc/resolv.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("Then create new "),n("strong",[s._v("resolv.conf")]),s._v(" file.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nameserver 8.8.8.8"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/resolv.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("Dnsmasq is available on the apt repository, easy installation can be done by running:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" dnsmasq\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("The main configuration file for Dnsmasq is "),n("code",[s._v("/etc/dnsmasq.conf")]),s._v(". Configure Dnsmasq by modifying this file.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/dnsmasq.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("Here is minimal configuration")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Listen on this specific port instead of the standard DNS port")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (53). Setting this to zero completely disables DNS function,")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# leaving only DHCP and/or TFTP.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Never forward plain names (without a dot or domain part)")]),s._v("\ndomain-needed\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Never forward addresses in the non-routed address spaces.")]),s._v("\nbogus-priv\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# By  default,  dnsmasq  will  send queries to any of the upstream")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# servers it knows about and tries to favour servers to are  known")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# to  be  up.  Uncommenting this forces dnsmasq to try each query")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# with  each  server  strictly  in  the  order  they   appear   in")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /etc/resolv.conf")]),s._v("\nstrict-order\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set this (and domain: see below) if you want to have a domain")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# automatically added to simple names in a hosts-file.")]),s._v("\nexpand-hosts\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set the domain for dnsmasq. this is optional, but if it is set, it")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# does the following things.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1) Allows DHCP hosts to have fully qualified domain names, as long")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     as the domain part matches this setting.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 2) Sets the "domain" DHCP option thereby potentially setting the')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    domain of all systems configured by DHCP")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 3) Provides the domain part for "expand-hosts"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#domain=thekelleys.org.uk")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("domain")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mypridomain.com\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set Liste address")]),s._v("\nlisten-address"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set to Server IP for network responses")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("If you want to enable DNSSEC validation and caching, uncomment")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#dnssec")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("Make any other changes you see relevant and restart dnsmasq when done:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart dnsmasq\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"step-2-adding-dns-records-to-dnsmasq"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-2-adding-dns-records-to-dnsmasq"}},[s._v("#")]),s._v(" Step 2: Adding DNS records to Dnsmasq")]),s._v(" "),n("p",[s._v("Add DNS records in the file."),n("code",[s._v("/etc/hosts")]),s._v(". Dnsmasq will reply to queries from clients using these records.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/hosts\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".3.4 server1.mypridomain.com\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".4.4 erp.mypridomain.com \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.2 checkout.mypridomain.com \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".4.3 hello.world\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("You need to restart dnsmasq service after adding the records.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart dnsmasq\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"step-3-testing-dnsmasq-dns-functionality"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-3-testing-dnsmasq-dns-functionality"}},[s._v("#")]),s._v(" Step 3: Testing Dnsmasq DNS functionality")]),s._v(" "),n("p",[s._v("To verify that Dnsmasq responds to the records we added, point DNS server of your servers to Dnsmasq server. Edit "),n("code",[s._v("/etc/network/interfaces")]),s._v(" for persistent configuration, or the file "),n("code",[s._v("/etc/netplan/")]),s._v(" on Ubuntu 18.04 servers.")]),s._v(" "),n("p",[s._v("Since this is a test, I’ll modify runtime file "),n("code",[s._v("/etc/resolv.conf")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/resolv.conf\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("Test using dig:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("dig")]),s._v(" A erp.mypridomain.com\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" DiG "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.11")]),s._v(".3-1ubuntu1.1-Ubuntu "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" A erp.mypridomain.com\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" global options: +cmd\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Got answer:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("HEADER"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),s._v(" opcode: QUERY, status: NOERROR, id: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("43392")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" flags: qr aa rd ra"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" QUERY: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", ANSWER: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", AUTHORITY: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", ADDITIONAL: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" OPT PSEUDOSECTION:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" EDNS: version: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", flags:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" udp: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" QUESTION SECTION:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("erp.mypridomain.com.\t\tIN\tA\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" ANSWER SECTION:\nerp.mypridomain.com.\t"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\tIN\tA\t"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".4.4\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Query time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" msec\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" SERVER: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53(127.0.0.1)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" WHEN: Tue Aug "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":35:41 UTC "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" MSG SIZE  rcvd: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("p",[s._v("Here is another example:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("dig")]),s._v(" checkout.mypridomain.com A +noall +answer\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" DiG "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.11")]),s._v(".3-1ubuntu1.1-Ubuntu "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" checkout.mypridomain.com A +noall +answer\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" global options: +cmd\ncheckout.mypridomain.com. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" IN A "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("You can confirm that we’re getting responses as configured.")]),s._v(" "),n("h3",{attrs:{id:"configure-dnsmasq-as-dhcp-server-optional"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#configure-dnsmasq-as-dhcp-server-optional"}},[s._v("#")]),s._v(" Configure Dnsmasq as DHCP Server (Optional)")]),s._v(" "),n("p",[s._v("You can use Dnsmasq to assign IP addresses to clients, either static or dynamic.")]),s._v(" "),n("p",[s._v("Edit the file a"),n("code",[s._v("/etc/dnsmasq.conf")]),s._v(" and provide DHCP options. You need to provide:")]),s._v(" "),n("ul",[n("li",[s._v("Default gateway IP address")]),s._v(" "),n("li",[s._v("DNS server IP address (Probably Dnsmasq or different DNS server)")]),s._v(" "),n("li",[s._v("Network Subnet mask")]),s._v(" "),n("li",[s._v("DHCP Addresses range")]),s._v(" "),n("li",[s._v("NTP server")])]),s._v(" "),n("p",[s._v("See below example")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("dhcp-range"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".3.25,192.168.3.50,24h\ndhcp-option"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("option:router,192.168.3.1\ndhcp-option"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("option:ntp-server,192.168.3.5\ndhcp-option"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("option:dns-server,192.168.3.5\ndhcp-option"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("option:netmask,255.255.255.0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("Restart dnsmasq and configure clients to obtain an IP address from this server.")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo systemctl restart dnsmasq\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"conclusion"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[s._v("#")]),s._v(" Conclusion")]),s._v(" "),n("p",[s._v("Dnsmasq is an easy to configure DNS cache which can speed up internet browsing and the resolving of domain records on your systems. You can also enjoy its DHCP subsystem which is easy to configure and use for a small network.")]),s._v(" "),n("blockquote",[n("p",[s._v("来源: https://computingforgeeks.com/install-and-configure-dnsmasq-on-ubuntu-18-04-lts/")])]),s._v(" "),n("h2",{attrs:{id:"install-dnsmasq-on-centos"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#install-dnsmasq-on-centos"}},[s._v("#")]),s._v(" install dnsmasq on CentOS")]),s._v(" "),n("blockquote",[n("p",[s._v("参考: https://www.tecmint.com/setup-a-dns-dhcp-server-using-dnsmasq-on-centos-rhel/")])]),s._v(" "),n("h2",{attrs:{id:"参考链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),n("ul",[n("li",[s._v("dnsmasq docs: http://www.thekelleys.org.uk/dnsmasq/doc.html")])])])}),[],!1,null,null,null);a.default=e.exports}}]);