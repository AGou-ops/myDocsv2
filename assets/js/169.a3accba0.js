(window.webpackJsonp=window.webpackJsonp||[]).push([[169],{800:function(s,a,t){"use strict";t.r(a);var n=t(6),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"kubernetes-rest-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-rest-api"}},[s._v("#")]),s._v(" Kubernetes REST API")]),s._v(" "),t("h2",{attrs:{id:"从-pod-中访问-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从-pod-中访问-api"}},[s._v("#")]),s._v(" 从 Pod 中访问 API")]),s._v(" "),t("p",[s._v("从 Pod 内部访问 API 时，定位 API 服务器和向服务器认证身份的操作 与外部客户端场景不同。")]),s._v(" "),t("p",[s._v("从 Pod 使用 Kubernetes API 的最简单的方法就是使用官方的 "),t("a",{attrs:{href:"https://kubernetes.io/zh/docs/reference/using-api/client-libraries/",target:"_blank",rel:"noopener noreferrer"}},[s._v("客户端库"),t("OutboundLink")],1),s._v("。 这些库可以自动发现 API 服务器并进行身份验证。")]),s._v(" "),t("h2",{attrs:{id:"使用官方客户端库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用官方客户端库"}},[s._v("#")]),s._v(" 使用官方客户端库")]),s._v(" "),t("p",[s._v("从一个 Pod 内部连接到 Kubernetes API 的推荐方式为：")]),s._v(" "),t("ul",[t("li",[s._v("对于 Go 语言客户端，使用官方的 "),t("a",{attrs:{href:"https://github.com/kubernetes/client-go/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Go 客户端库"),t("OutboundLink")],1),s._v("。 函数 "),t("code",[s._v("rest.InClusterConfig()")]),s._v(" 自动处理 API 主机发现和身份认证。 参见"),t("a",{attrs:{href:"https://git.k8s.io/client-go/examples/in-cluster-client-configuration/main.go",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里的一个例子"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("li",[s._v("对于 Python 客户端，使用官方的 "),t("a",{attrs:{href:"https://github.com/kubernetes-client/python/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Python 客户端库"),t("OutboundLink")],1),s._v("。 函数 "),t("code",[s._v("config.load_incluster_config()")]),s._v(" 自动处理 API 主机的发现和身份认证。 参见"),t("a",{attrs:{href:"https://github.com/kubernetes-client/python/blob/master/examples/in_cluster_config.py",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里的一个例子"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("li",[s._v("还有一些其他可用的客户端库，请参阅"),t("a",{attrs:{href:"https://kubernetes.io/zh/docs/reference/using-api/client-libraries/",target:"_blank",rel:"noopener noreferrer"}},[s._v("客户端库"),t("OutboundLink")],1),s._v("页面。")])]),s._v(" "),t("p",[s._v("在以上场景中，客户端库都使用 Pod 的服务账号凭据来与 API 服务器安全地通信。")]),s._v(" "),t("h2",{attrs:{id:"直接访问-rest-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#直接访问-rest-api"}},[s._v("#")]),s._v(" 直接访问 REST API")]),s._v(" "),t("p",[s._v("在运行在 Pod 中时，可以通过 "),t("code",[s._v("default")]),s._v(" 命名空间中的名为 "),t("code",[s._v("kubernetes")]),s._v(" 的服务访问 Kubernetes API 服务器。也就是说，Pod 可以使用 "),t("code",[s._v("kubernetes.default.svc")]),s._v(" 主机名 来查询 API 服务器。官方客户端库自动完成这个工作。")]),s._v(" "),t("p",[s._v("向 API 服务器进行身份认证的推荐做法是使用 "),t("a",{attrs:{href:"https://kubernetes.io/zh/docs/tasks/configure-pod-container/configure-service-account/",target:"_blank",rel:"noopener noreferrer"}},[s._v("服务账号"),t("OutboundLink")],1),s._v("凭据。 默认情况下，每个 Pod 与一个服务账号关联，该服务账户的凭证（令牌）放置在此 Pod 中 每个容器的文件系统树中的 "),t("code",[s._v("/var/run/secrets/kubernetes.io/serviceaccount/token")]),s._v(" 处。")]),s._v(" "),t("p",[s._v("如果证书包可用，则凭证包被放入每个容器的文件系统树中的 "),t("code",[s._v("/var/run/secrets/kubernetes.io/serviceaccount/ca.crt")]),s._v(" 处， 且将被用于验证 API 服务器的服务证书。")]),s._v(" "),t("p",[s._v("最后，用于命名空间域 API 操作的默认命名空间放置在每个容器中的 "),t("code",[s._v("/var/run/secrets/kubernetes.io/serviceaccount/namespace")]),s._v(" 文件中。")]),s._v(" "),t("h2",{attrs:{id:"使用-kubectl-proxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-kubectl-proxy"}},[s._v("#")]),s._v(" 使用 kubectl proxy")]),s._v(" "),t("p",[s._v("如果你希望不使用官方客户端库就完成 API 查询，可以将 "),t("code",[s._v("kubectl proxy")]),s._v(" 作为 "),t("a",{attrs:{href:"https://kubernetes.io/zh/docs/tasks/inject-data-application/define-command-argument-container/",target:"_blank",rel:"noopener noreferrer"}},[s._v("command"),t("OutboundLink")],1),s._v(" 在 Pod 中启动一个边车（Sidecar）容器。这样，"),t("code",[s._v("kubectl proxy")]),s._v(" 自动完成对 API 的身份认证，并将其暴露到 Pod 的 "),t("code",[s._v("localhost")]),s._v(" 接口，从而 Pod 中的其他容器可以 直接使用 API。")]),s._v(" "),t("h2",{attrs:{id:"不使用代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#不使用代理"}},[s._v("#")]),s._v(" 不使用代理")]),s._v(" "),t("p",[s._v("通过将认证令牌直接发送到 API 服务器，也可以避免运行 kubectl proxy 命令。 内部的证书机制能够为链接提供保护。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向内部 API 服务器的主机名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("APISERVER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://kubernetes.default.svc\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务账号令牌的路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVICEACCOUNT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/secrets/kubernetes.io/serviceaccount\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取 Pod 的名字空间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAMESPACE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("SERVICEACCOUNT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/namespace"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取服务账号的持有者令牌")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TOKEN")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("SERVICEACCOUNT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/token"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 引用内部证书机构（CA）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CACERT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVICEACCOUNT}")]),s._v("/ca.crt\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用令牌访问 API")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --cacert "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CACERT}")]),s._v(" --header "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Authorization: Bearer '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TOKEN}")]),s._v('"')]),s._v(" -X GET "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${APISERVER}")]),s._v("/api\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("输出类似于：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"kind"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"APIVersions"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"versions"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"serverAddressByClientCIDRs"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"clientCIDR"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0/0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"serverAddress"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.1.149:443"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h2",{attrs:{id:"使用ambassador容器简化访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用ambassador容器简化访问"}},[s._v("#")]),s._v(" 使用ambassador容器简化访问")]),s._v(" "),t("p",[t("code",[s._v("Dockerfile")]),s._v("以及jio本文件：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Dockerfile")]),s._v("\nFROM alpine\nRUN apk update "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" apk "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -LO "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://dl.k8s.io/release/'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L -s https://dl.k8s.io/release/stable.txt"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('/bin/linux/amd64/kubectl"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x kubectl\n\nADD kubectl-proxy.sh /kubectl-proxy.sh\nENTRYPOINT /kubectl-proxy.sh\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl-proxy.sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/sh")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("API_SERVER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBERNETES_SERVICE_HOST")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBERNETES_SERVICE_PORT")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CA_CRT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TOKEN")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/run/secrets/kubernetes.io/serviceaccount/token"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v("\n\n/kubectl proxy --server"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$API_SERVER")]),s._v('"')]),s._v(" --certificate-authority"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CA_CRT")]),s._v('"')]),s._v(" --token"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TOKEN")]),s._v('"')]),s._v(" --accept-paths"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^.*'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("测试样例：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("with"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kubeapi\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" main\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" curlimages/curl\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sleep 99999s"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ambassador\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" suofeiya/kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("api"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1.1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("连入"),t("code",[s._v("main")]),s._v("容器通过代理访问"),t("code",[s._v("kubernetes API")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" pod-with-kubeapi -c main -- "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v("  localhost:8001/apis/batch/v1\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1278")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1278")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   181k      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" --:--:-- --:--:-- --:--:--  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kind"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"APIResourceList"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apiVersion"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"groupVersion"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"batch/v1"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"resources"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cronjobs"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"singularName"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"namespaced"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kind"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CronJob"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"verbs"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"delete"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deletecollection"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"patch"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"update"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shortNames"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cj"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"categories"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"all"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"storageVersionHash"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sd5LIXh4Fjs="')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cronjobs/status"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"singularName"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"namespaced"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kind"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CronJob"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"verbs"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"patch"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"update"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jobs"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"singularName"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"namespaced"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kind"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Job"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"verbs"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"delete"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deletecollection"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"patch"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"update"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"categories"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"all"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"storageVersionHash"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mudhfqk/qZY="')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jobs/status"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"singularName"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"namespaced"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kind"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Job"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"verbs"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"patch"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"update"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("208k\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br")])]),t("p",[s._v("😄 Success.")]),s._v(" "),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),t("ul",[t("li",[s._v("access api from pod: "),t("a",{attrs:{href:"https://kubernetes.io/zh/docs/tasks/run-application/access-api-from-pod/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://kubernetes.io/zh/docs/tasks/run-application/access-api-from-pod/"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);