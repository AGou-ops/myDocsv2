(window.webpackJsonp=window.webpackJsonp||[]).push([[297],{930:function(s,a,t){"use strict";t.r(a);var e=t(6),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"tomcat-调优"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcat-调优"}},[s._v("#")]),s._v(" Tomcat 调优")]),s._v(" "),t("h2",{attrs:{id:"从内存、并发、缓存三个方面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从内存、并发、缓存三个方面"}},[s._v("#")]),s._v(" 从内存、并发、缓存三个方面")]),s._v(" "),t("p",[t("strong",[s._v("1.Tomcat内存优化")]),s._v("\nTomcat内存优化主要是对 tomcat 启动参数优化，我们可以在 tomcat 的启动脚本 catalina.sh 中设置 java_OPTS 参数。")]),s._v(" "),t("p",[s._v("JAVA_OPTS参数说明")]),s._v(" "),t("blockquote",[t("p",[s._v("-server 启用jdk 的 server 版；\n-Xms java虚拟机初始化时的最小内存；\n-Xmx java虚拟机可使用的最大内存；\n-XX: PermSize 内存永久保留区域\n-XX:MaxPermSize 内存最大永久保留区域")])]),s._v(" "),t("p",[s._v("服务器参数配置\n现公司服务器内存一般都可以加到最大2G ，所以可以采取以下配置：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("’-Xms1024m -Xmx2048m -XX: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PermSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("256M -XX:MaxNewSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("256m -XX:MaxPermSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("256m’\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("配置完成后可重启Tomcat ，通过以下命令进行查看配置是否生效：\n首先查看Tomcat 进程号：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v(" -i:9027\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("我们可以看到Tomcat 进程号是 12222 。\n查看是否配置生效：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" jmap – heap "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12222")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("我们可以看到MaxHeapSize 等参数已经生效。")]),s._v(" "),t("p",[t("strong",[s._v("2.Tomcat并发优化")]),s._v("\n　　1.Tomcat连接相关参数\n　　在Tomcat 配置文件 server.xml 中的")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Connector "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9027"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HTTP/1.1"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxHttpHeaderSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8192"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("minProcessors")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxProcessors")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("acceptCount")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("redirectPort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8443"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("disableUploadTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("2.调整连接器connector的并发处理能力")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("　　"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("参数说明\n　　maxThreads 客户请求最大线程数 \n　　minSpareThreads Tomcat初始化时创建的 socket 线程数 \n　　maxSpareThreads Tomcat连接器的最大空闲 socket 线程数 \n　　enableLookups 若设为true, 则支持域名解析，可把 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" 地址解析为主机名 \n　　redirectPort 在需要基于安全通道的场合，把客户请求转发到基于SSL 的 redirectPort 端口 \n　　acceptAccount 监听端口队列最大数，满了之后客户请求会被拒绝（不能小于maxSpareThreads ） \n　　connectionTimeout 连接超时 \n　　minProcessors 服务器创建时的最小处理线程数 \n　　maxProcessors 服务器同时最大处理线程数 \n　　URIEncoding URL统一编码\n　　\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("Tomcat中的配置示例\n　　"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Connector "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9027"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HTTP/1.1"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxHttpHeaderSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8192"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxThreads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("minSpareThreads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxSpareThreads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("minProcessors")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxProcessors")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enableLookups")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("URIEncoding")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("acceptCount")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("redirectPort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8443"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("disableUploadTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[t("strong",[s._v("3.Tomcat缓存优化")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("　　"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("参数说明\n　　c ompression 打开压缩功能 \n　　compressionMinSize 启用压缩的输出内容大小，这里面默认为2KB \n　　compressableMimeType 压缩类型 \n　　connectionTimeout 定义建立客户连接超时的时间. 如果为 -1, 表示不限制建立客户连接的时间\n\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("Tomcat中的配置示例\n　　"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Connector "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9027"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HTTP/1.1"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxHttpHeaderSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8192"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxThreads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("minSpareThreads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxSpareThreads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("minProcessors")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxProcessors")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enableLookups")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("compression")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("compressionMinSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2048"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("compressableMimeType")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/html,text/xml,text/javascript,text/css,text/plain"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connectionTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("URIEncoding")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("acceptCount")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("redirectPort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8443"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("disableUploadTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[t("strong",[s._v("4.参考配置")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("旧有的配置\n参考网络对服务器做过如下配置，拿出来分享下：\n　　"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Connector "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9027"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HTTP/1.1"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxHttpHeaderSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8192"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxThreads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("minSpareThreads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"25"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxSpareThreads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"75"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enableLookups")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("compression")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("compressionMinSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2048"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("compressableMimeType")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/html,text/xml,text/javascript,text/css,text/plain"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connectionTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("URIEncoding")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("acceptCount")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("redirectPort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8443"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("disableUploadTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(" /"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  后来发现在访问量达到3 百万多的时候出现性能瓶颈。 \n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("更改后的配置\n　　"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Connector "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9027"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HTTP/1.1"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxHttpHeaderSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8192"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxThreads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("minSpareThreads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxSpareThreads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("minProcessors")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxProcessors")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enableLookups")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("compression")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("compressionMinSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2048"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("compressableMimeType")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/html,text/xml,text/javascript,text/css,text/plain"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connectionTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("URIEncoding")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("acceptCount")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("redirectPort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8443"')]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("disableUploadTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("h2",{attrs:{id:"屏蔽dns查询enablelookups-false"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#屏蔽dns查询enablelookups-false"}},[s._v("#")]),s._v(" 屏蔽dns查询enableLookups=”false”")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Connector  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8081"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HTTP/1.1"')]),s._v("\n               "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connectionTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6000"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enableLookups")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("acceptCount")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"800"')]),s._v("\n               "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("redirectPort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8443"')]),s._v(" /"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"jvm调优"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm调优"}},[s._v("#")]),s._v(" jvm调优")]),s._v(" "),t("p",[s._v("Tomcat最吃内存，只要内存足够，这只猫就跑的很快。\n如果系统资源有限，那就需要进行调优，提高资源使用率。\n优化catalina.sh配置文件。在catalina.sh配置文件中添加以下代码：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms1024m -Xmx1024m -XX:NewSize=512m -XX:MaxNewSize=512m -XX:PermSize=512m -XX:MaxPermSize=512m"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("server:一定要作为第一个参数，在多个CPU时性能佳\n-Xms：初始堆内存Heap大小，使用的最小内存,cpu性能高时此值应设的大一些\n-Xmx：初始堆内存heap最大值，使用的最大内存\n上面两个值是分配JVM的最小和最大内存，取决于硬件物理内存的大小，建议均设为物理内存的一半。\n-XX:PermSize:设定内存的永久保存区域\n-XX:MaxPermSize:设定最大内存的永久保存区域\n-XX:MaxNewSize:\n-Xss 15120 这使得JBoss每增加一个线程（thread)就会立即消耗15M内存，而最佳值应该是128K,默认值好像是512k.\n+XX:AggressiveHeap 会使得 Xms没有意义。这个参数让jvm忽略Xmx参数,疯狂地吃完一个G物理内存,再吃尽一个G的swap。\n-Xss：每个线程的Stack大小\n-verbose:gc 现实垃圾收集信息\n-Xloggc:gc.log 指定垃圾收集日志文件\n-Xmn：young generation的heap大小，一般设置为Xmx的3、4分之一\n-XX:+UseParNewGC ：缩短minor收集的时间\n-XX:+UseConcMarkSweepGC ：缩短major收集的时间")])]),s._v(" "),t("h2",{attrs:{id:"修改-tomcat-启动模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改-tomcat-启动模式"}},[s._v("#")]),s._v(" 修改 tomcat 启动模式")]),s._v(" "),t("p",[s._v("tomcat的运行模式有3种：")]),s._v(" "),t("p",[s._v("**bio：**默认的模式,性能非常低下,没有经过任何优化处理和支持.")]),s._v(" "),t("p",[s._v("**nio：**nio(new I/O)，是Java SE 1.4及后续版本提供的一种新的I/O操作方式(即java.nio包及其子包)。Java nio是一个基于缓冲区、并能提供非阻塞I/O操作的Java API，因此nio也被看成是non-blocking I/O的缩写。它拥有比传统I/O操作(bio)更好的并发运行性能。")]),s._v(" "),t("p",[s._v("**apr：**安装起来最困难,但是从操作系统级别来解决异步的IO问题,大幅度的提高性能.")]),s._v(" "),t("p",[t("strong",[s._v("启动NIO模式")])]),s._v(" "),t("p",[s._v("修改"),t("code",[s._v("server.xml")]),s._v("里的Connector节点：")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Connector")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("8080"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("HTTP/1.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n               "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("connectionTimeout")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("20000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n               "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("redirectPort")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("8443"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n-- 在`71`行左右将其改为\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Connector")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("8080"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.coyote.http11.Http11NioProtocol"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n               "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("connectionTimeout")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("20000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n               "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("redirectPort")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("8443"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h2",{attrs:{id:"执行器优化-线程池"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行器优化-线程池"}},[s._v("#")]),s._v(" 执行器优化（线程池）")]),s._v(" "),t("p",[s._v("在tomcat中每一个用户请求都是一个线程，所以可以使用线程池提高性能。")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Service")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("Catalina"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--The connectors can use a shared executor, you can define one or more named thread pools--\x3e")]),s._v("\n-- 在`59`行左右取消注释以下内容\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('\x3c!--\n    <Executor name="tomcatThreadPool" namePrefix="catalina-exec-"\n        maxThreads="150" minSpareThreads="4"/>\n    --\x3e')]),s._v("\n\n      \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("在"),t("code",[s._v("Connector")]),s._v("中指定使用共享线程池：")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[s._v("-- 在 connector 中指定线程池\n\t"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Connector")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("executor")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("tomcatThreadPool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("8080"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.coyote.http11.Http11NioProtocol"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("connectionTimeout")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("20000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n               "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("redirectPort")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("8443"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("Executor重要参数说明：")])]),s._v(" "),t("p",[s._v("name：共享线程池的名字。这是Connector为了共享线程池要引用的名字，该名字必须唯一。默认值：None；")]),s._v(" "),t("p",[s._v("namePrefix:在JVM上，每个运行线程都可以有一个name 字符串。这一属性为线程池中每个线程的name字符串设置了一个前缀，Tomcat将把线程号追加到这一前缀的后面。默认值：tomcat-exec-；")]),s._v(" "),t("p",[s._v("maxThreads：该线程池可以容纳的最大线程数。默认值：200；")]),s._v(" "),t("p",[s._v("maxIdleTime：在Tomcat关闭一个空闲线程之前，允许空闲线程持续的时间(以毫秒为单位)。只有当前活跃的线程数大于minSpareThread的值，才会关闭空闲线程。默认值：60000(一分钟)。")]),s._v(" "),t("p",[s._v("minSpareThreads：Tomcat应该始终打开的最小不活跃线程数。默认值：25。")]),s._v(" "),t("p",[s._v("threadPriority：线程的等级。默认是Thread.NORM_PRIORITY")]),s._v(" "),t("p",[t("strong",[s._v("Connector重要参数说明：")])]),s._v(" "),t("p",[s._v("executor：表示使用该参数值对应的线程池；")]),s._v(" "),t("p",[s._v("minProcessors：服务器启动时创建的处理请求的线程数；")]),s._v(" "),t("p",[s._v("maxProcessors：最大可以创建的处理请求的线程数；")]),s._v(" "),t("p",[s._v("acceptCount：指定当所有可以使用的处理请求的线程数都被使用时，可以放到处理队列中的请求数，超过这个数的请求将不予处理。")]),s._v(" "),t("p",[t("strong",[s._v("最佳参数实践：")])]),s._v(" "),t("p",[t("img",{attrs:{src:"http://p3.pstatp.com/large/pgc-image/b6f4cfebbff84bc99e79f78c3ca288bb",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"禁用ajp连接器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#禁用ajp连接器"}},[s._v("#")]),s._v(" 禁用AJP连接器")]),s._v(" "),t("p",[t("strong",[s._v("AJP（Apache JServer Protocol）")]),s._v("\nAJPv13协议是面向包的。WEB服务器和Servlet容器通过TCP连接来交互；为了节省SOCKET创建的昂贵代价，WEB服务器会尝试维护一个永久TCP连接到servlet容器，并且在多个请求和响应周期过程会重用连接。")]),s._v(" "),t("p",[s._v("我们一般是使用Nginx+tomcat的架构，所以用不着AJP协议，所以把AJP连接器禁用。")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("server.xml")]),s._v("文件中，注释以下内容即可：")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[s._v(" 92     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- Define an AJP 1.3 Connector on port 8009 --\x3e")]),s._v("\n 93     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Connector")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("8009"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("AJP/1.3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("redirectPort")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("8443"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n 94 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);