(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{680:function(t,e,s){"use strict";s.r(e);var a=s(6),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"使用国内源及相关小工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用国内源及相关小工具"}},[t._v("#")]),t._v(" 使用国内源及相关小工具")]),t._v(" "),s("h2",{attrs:{id:"国内镜像源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#国内镜像源"}},[t._v("#")]),t._v(" 国内镜像源")]),t._v(" "),s("p",[t._v("Azure China提供了目前用过的质量最好的镜像源，涵盖了docker.io，gcr.io，quay.io。无论是速度还是覆盖范围，体验都极佳。而且都支持匿名拉取，也就是不需要登录。这点特别友好。azk8s.cn支持的镜像代理转换如下列表。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("global")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("proxy in China")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("format")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("example")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://xuxinkun.github.io/2019/06/11/cn-registry/hub.docker.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("dockerhub"),s("OutboundLink")],1),t._v(" (docker.io)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://mirror.azk8s.cn/help/docker-registry-proxy-cache.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("dockerhub.azk8s.cn"),s("OutboundLink")],1)]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("dockerhub.azk8s.cn//:")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("dockerhub.azk8s.cn/microsoft/azure-cli:2.0.61")]),t._v(" "),s("code",[t._v("dockerhub.azk8s.cn/library/nginx:1.15")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("gcr.io")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://mirror.azk8s.cn/help/gcr-proxy-cache.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("gcr.azk8s.cn"),s("OutboundLink")],1)]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("gcr.azk8s.cn//:")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("gcr.azk8s.cn/google_containers/hyperkube-amd64:v1.13.5")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("quay.io")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://mirror.azk8s.cn/help/quay-proxy-cache.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("quay.azk8s.cn"),s("OutboundLink")],1)]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("quay.azk8s.cn//:")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("quay.azk8s.cn/deis/go-dev:v1.10.0")])])])])]),t._v(" "),s("blockquote",[s("p",[t._v("Note: "),s("code",[t._v("k8s.gcr.io")]),t._v(" would redirect to "),s("code",[t._v("gcr.io/google-containers")]),t._v(", following image urls are identical:")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("k8s.gcr.io/pause-amd64:3.1\ngcr.io/google_containers/pause-amd64:3.1\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("这里，我开发了一个小的脚本azk8spull，这个脚本可以自动根据镜像名称进行解析，转换为azure的mirror镜像源域名。并进行拉取。拉取完成后会自动进行tag重命名为原本的镜像名。该脚本已经开源在 https://github.com/xuxinkun/littleTools#azk8spull 上。以下是使用样例。")]),t._v(" "),s("p",[t._v("安装"),s("code",[t._v("azk8spull")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("git clone https://github.com/xuxinkun/littleTools\ncd littleTools\nchmod +x install.sh\n./install.sh\nsource /etc/profile\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-64-216 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# azk8spull quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.24.1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## azk8spull try to pull image from mirror quay.azk8s.cn/kubernetes-ingress-controller/nginx-ingress-controller:0.24.1.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.24")]),t._v(".1: Pulling from kubernetes-ingress-controller/nginx-ingress-controller\nDigest: sha256:76861d167e4e3db18f2672fd3435396aaa898ddf4d1128375d7c93b91c59f87f\nStatus: Image is up to "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" quay.azk8s.cn/kubernetes-ingress-controller/nginx-ingress-controller:0.24.1\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## azk8spull try to tag quay.azk8s.cn/kubernetes-ingress-controller/nginx-ingress-controller:0.24.1 to quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.24.1.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## azk8spull finish pulling.")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-64-216 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# azk8spull k8s.gcr.io/pause-amd64:3.1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## azk8spull try to pull image from mirror gcr.azk8s.cn/google_containers/pause-amd64:3.1.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.1")]),t._v(": Pulling from google_containers/pause-amd64\nDigest: sha256:59eec8837a4d942cc19a52b8c09ea75121acc38114a2c68b98983ce9356b8610\nStatus: Image is up to "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" gcr.azk8s.cn/google_containers/pause-amd64:3.1\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## azk8spull try to tag gcr.azk8s.cn/google_containers/pause-amd64:3.1 to k8s.gcr.io/pause-amd64:3.1.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## azk8spull finish pulling.")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br")])]),s("h2",{attrs:{id:"kubeadm源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm源"}},[t._v("#")]),t._v(" kubeadm源")]),t._v(" "),s("p",[t._v("kubeadm直接使用阿里云的源即可。速度也比较快。")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Debian/Ubuntu")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y apt-transport-https\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" apt-key "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" -\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF"),s("span",{pre:!0,attrs:{class:"token bash punctuation"}},[t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/etc/apt/sources.list.d/kubernetes.list")]),t._v("\ndeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\nEOF")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y kubelet kubeadm kubectl\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# CentOS/RHEL/Fedora")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF"),s("span",{pre:!0,attrs:{class:"token bash punctuation"}},[t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /etc/yum.repos.d/kubernetes.repo")]),t._v("\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),t._v("\nsetenforce "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y kubelet kubeadm kubectl\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br")])]),s("h2",{attrs:{id:"参考链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"http://mirror.azure.cn/help/docker-registry-proxy-cache.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Registry Proxy Cache 帮助 http://mirror.azure.cn/help/docker-registry-proxy-cache.html"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/Azure/container-service-for-azure-china/tree/master/aks#22-container-registry-proxy",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure China container registry proxy https://github.com/Azure/container-service-for-azure-china/tree/master/aks#22-container-registry-proxy"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/maguowei/kubernetes-for-china",target:"_blank",rel:"noopener noreferrer"}},[t._v("k8s for China https://github.com/maguowei/kubernetes-for-china"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("http://mirror.azure.cn/")])]),t._v(" "),s("blockquote",[s("p",[t._v("该文章转载自：https://xuxinkun.github.io/2019/06/11/cn-registry/")])])])}),[],!1,null,null,null);e.default=n.exports}}]);