(window.webpackJsonp=window.webpackJsonp||[]).push([[198],{830:function(t,s,a){"use strict";a.r(s);var n=a(6),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"收集java、tomcat日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#收集java、tomcat日志"}},[t._v("#")]),t._v(" 收集Java、Tomcat日志")]),t._v(" "),a("h2",{attrs:{id:"通过-logstash-收集-tomcat-日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过-logstash-收集-tomcat-日志"}},[t._v("#")]),t._v(" 通过 Logstash 收集 Tomcat 日志")]),t._v(" "),a("h3",{attrs:{id:"预先准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预先准备"}},[t._v("#")]),t._v(" 预先准备")]),t._v(" "),a("p",[t._v("安装配置"),a("code",[t._v("jdk")]),t._v(", "),a("code",[t._v("ELK")]),t._v("在此不再赘述.")]),t._v(" "),a("p",[t._v("首先, 准备好测试页面, 确保测试页面可以正常访问, 在这里我准备好的测试页面是 http://192.168.0.126:8080/test/")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master apache-tomcat-9.0.34"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("# "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.126:8080/test/index.html\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("TEST PAGE"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("修改 tomcat 的日志格式, 将原先默认的"),a("code",[t._v(".txt")]),t._v("格式改为"),a("code",[t._v(".json")]),t._v("格式, 编辑"),a("code",[t._v("/usr/local/apache-tomcat-9.0.34/conf/server.xml")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 大概在164行左右 --\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Valve")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("className")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.catalina.valves.AccessLogValve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("directory")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n               "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("prefix")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("tomcat_access_log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("suffix")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v(".log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n               "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("pattern")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("clientip"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("%h"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(","),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("ClientUser"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("%l"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(","),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("authenticated"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("%u"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(","),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("AccessTime"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("%t"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(","),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("%r"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(","),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("status"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("%s"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(","),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("SendBytes"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("%b"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(","),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("Query?string"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("%q"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(","),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("partner"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("%{Referer}i"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(","),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("AgentVersion"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("%{User-Agent}i"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:'"'}},[t._v("&quot;")]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v(" \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("blockquote",[a("p",[t._v("扩展: "),a("code",[t._v("&quot;")]),t._v("表示的是"),a("code",[t._v('"')]),t._v("英文引号的意思.")])]),t._v(" "),a("p",[t._v("修改完配置文件之后, 保存退出, 并重启 tomcat 服务.")]),t._v(" "),a("p",[t._v("然后在浏览器或者使用"),a("code",[t._v("curl")]),t._v("命令模拟访问 tomcat 服务, 使之产生日志文件.")]),t._v(" "),a("p",[t._v("查看日志文件:")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("# "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" tomcat_access_log.2020-07-09.log\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"clientip"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.0.125"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ClientUser"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"authenticated"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AccessTime"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[09/Jul/2020:09:29:15 -0400]"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"method"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /test/ HTTP/1.1"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"304"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SendBytes"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Query?string"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partner"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AgentVersion"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Safari/537.36"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"clientip"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.0.125"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ClientUser"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"authenticated"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AccessTime"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[09/Jul/2020:09:29:24 -0400]"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"method"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /test/ HTTP/1.1"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"200"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SendBytes"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"19"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Query?string"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partner"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AgentVersion"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.55.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"clientip"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.0.125"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ClientUser"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"authenticated"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AccessTime"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[09/Jul/2020:09:29:24 -0400]"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"method"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /test/ HTTP/1.1"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"200"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SendBytes"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"19"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Query?string"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partner"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AgentVersion"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.55.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"clientip"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.0.125"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ClientUser"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"authenticated"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AccessTime"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[09/Jul/2020:09:29:27 -0400]"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"method"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /test/fsdsd HTTP/1.1"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"404"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SendBytes"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"723"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Query?string"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partner"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AgentVersion"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.55.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h3",{attrs:{id:"收集-tomcat-日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#收集-tomcat-日志"}},[t._v("#")]),t._v(" 收集 tomcat 日志")]),t._v(" "),a("p",[t._v("编辑"),a("code",[t._v("logstash")]),t._v("的 tomcat 日志收集配置文件"),a("code",[t._v("config/java_tomcat.conf")]),t._v(", 内容大致如下:")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('input {\n  file {\n   path => "/usr/local/logstash-7.7.1/logs/logstash-plain.log"  #收集java的日志文件目录\n   start_position => "beginning"\n   stat_interval => 3\n   type => "java-log"\n  }\n \n  file {\n   path => "/usr/local/apache-tomcat-9.0.34/logs/tomcat_access_log.*.log"  # 收集tomcat日志的文件目录\n   start_position => "beginning"\n   stat_interval => 3\n   type => "tomcat-access-log"\n   codec => "json"  # 输出tomcat 的json日志格式\n  }\n}\n \noutput {\n  if [type] == "java-log" {\n   elasticsearch {\n   hosts => ["192.168.0.126:9200"]\n   index => "javalog-7-102-%{+YYYY.MM.dd}"\n   }\n  }\n \n  if [type] == "tomcat-access-log" {\n   elasticsearch {\n   hosts => ["192.168.0.126:9200"]\n   index => "tomcat-access-log-%{+YYYY.MM.dd}"\n   }\n  }\n}\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br")])]),a("p",[t._v("启动"),a("code",[t._v("logstash")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("bin/logstash -f config/java_tomcat.conf\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("blockquote",[a("p",[t._v("过程中遇到的问题: "),a("code",[t._v("logstash")]),t._v("无法加载到"),a("code",[t._v("tomcat")]),t._v("的日志, 原因是如果运行"),a("code",[t._v("logstash")]),t._v("的用户为普通用户, 则可能会因为权限问题无法访问到"),a("code",[t._v("tomcat")]),t._v("的日志, 在此需要特别注意.")])]),t._v(" "),a("p",[t._v("打开浏览器访问logstash的web管理页面, 找到以下页面, 并添加一个索引:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/elk%20stack/log/java-tomcat-log-1.png",alt:"",title:"添加索引"}})]),t._v(" "),a("p",[t._v("随后打开"),a("code",[t._v("Dashboard")]),t._v("进行查看:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/elk%20stack/log/java-tomcat-log-2.png",alt:"",title:"查看"}})]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("elasticsearch")]),t._v("的web面板中查看:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/elk%20stack/log/java-tomcat-log-3.png",alt:"",title:"es 中查看"}})]),t._v(" "),a("h2",{attrs:{id:"日志合并-multiline-codec-plugin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志合并-multiline-codec-plugin"}},[t._v("#")]),t._v(" 日志合并-Multiline codec plugin")]),t._v(" "),a("p",[t._v("本编解码器的最初目标是允许加入多行消息从文件到一个单独的事件。")]),t._v(" "),a("p",[t._v("示例"),a("code",[t._v("java")]),t._v("日志配置文件(部分):")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('input {\n  file {\n   path => "/usr/local/logstash-7.7.1/logs/logstash-plain.log"  # 要采集的log日志\n   start_position => "beginning"\n      codec => multiline {\n             pattern => "^\\["  # 以[开头开始匹配\n             negate => true\n             what => "previous"\n      }\n   }\n}\noutput {\n   elasticsearch {\n   hosts => ["192.168.0.126:9200"]\n   index => "javalog-%{+YYYY.MM.dd}"\n   }\n  }\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("h2",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),a("ul",[a("li",[t._v("codecs-multiline Documentations: https://www.elastic.co/guide/en/logstash/current/plugins-codecs-multiline.html")])])])}),[],!1,null,null,null);s.default=e.exports}}]);