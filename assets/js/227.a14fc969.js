(window.webpackJsonp=window.webpackJsonp||[]).push([[227],{860:function(s,a,t){"use strict";t.r(a);var n=t(6),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"kvm-basic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kvm-basic"}},[s._v("#")]),s._v(" KVM Basic")]),s._v(" "),t("h1",{attrs:{id:"kvm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kvm"}},[s._v("#")]),s._v(" KVM")]),s._v(" "),t("h2",{attrs:{id:"kvm-简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kvm-简介"}},[s._v("#")]),s._v(" KVM 简介")]),s._v(" "),t("p",[s._v("KVM (全称是 Kernel-based Virtual Machine) 是 Linux 下 x86 硬件平台上的全功能虚拟化解决方案，包含一个可加载的内核模块 kvm.ko 提供和虚拟化核心架构和处理器规范模块。")]),s._v(" "),t("p",[s._v("使用 KVM 可允许多个包括 Linux 和 Windows 每个虚拟机有私有的硬件，包括网卡、磁盘以及图形适配卡等。")]),s._v(" "),t("blockquote",[t("p",[s._v("虚拟化是云计算的基础。简单的说，虚拟化使得在一台物理的服务器上可以跑多台虚拟机，虚拟机共享物理机的 CPU、内存、IO 硬件资源，但逻辑上虚拟机之间是相互隔离的。\n物理机我们一般称为宿主机（Host），宿主机上面的虚拟机称为客户机（Guest）")])]),s._v(" "),t("p",[t("strong",[s._v("KVM工作原理")]),s._v("：用户模式的QEMU通过ioctl进入内核模式，kvm模块为虚拟机创建虚拟内存，虚拟CPU后执行VMLAUCH指令进入客户模式。加载Guest OS并执行。如果Guest OS发生外部中断或者影子页表却也之类的情况，会暂停Guest OS的执行，退出客户模式进行异常处理，执行客户代码。如果发生I/O事件或者信号队列有信号到达，就会进入用户模式处理。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1630703/201910/1630703-20191007235241385-873683991.png",alt:"",title:"kvm原理"}})]),s._v(" "),t("p",[s._v("KVM 由处于内核态的 KVM 模块和用户态的 QEMU 两部分构成。内核模块实现了 CPU 和内存虚拟化等决定关键性能和核心安全的功能并向用户空间提供了使用这些功能的接口，QEMU 利用 KVM 模块提供的接口来实现设备模拟、 IO 虚拟化和网络虚拟化等。单个虚拟机是宿主机上的一个普通 QEMU 进程，虚拟机中的 CPU 核（vCPU）是 QEMU 的一个线程，VM 的物理地址空间是 QEMU 的虚拟地址空间")]),s._v(" "),t("p",[s._v("因此在虚拟机运行时，有三种模式：")]),s._v(" "),t("p",[s._v("客户模式：执行非I/O的客户代码，虚拟机运行在这个模式下。")]),s._v(" "),t("p",[s._v("用户模式：代表用户执行I/O指令，QEMU运行在这个模式下。")]),s._v(" "),t("p",[s._v("内核模式：实现客户模式的切换，处理因为I/O或者其他指令引起的从客户模式退出（VM_EXIT）。kvm模块运行在这个模式下。")]),s._v(" "),t("p",[s._v("kvm模型中，每一个Guest OS都是作为一个标准的Linux进程，都可以使用Linux进程管理命令管理。")]),s._v(" "),t("h2",{attrs:{id:"kvm-环境配置与安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kvm-环境配置与安装"}},[s._v("#")]),s._v(" kvm 环境配置与安装")]),s._v(" "),t("ol",[t("li",[s._v("首先检查主机是否支持虚拟化：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" -o "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vmx|svm'")]),s._v(" /proc/cpuinfo\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("为了方便起见，关闭防火墙和"),t("code",[s._v("SElinux")]),s._v("：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl stop firewalld\nsystemctl disable firewalld\nsetenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -ri "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^(SELINUX=).*/\\1disabled/g'")]),s._v(" /etc/selinux/config\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("安装必要工具：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" epel-release "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" net-tools "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("zip")]),s._v(" gcc gcc-c++ bridge-utils\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("安装 kvm：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" kvm qemu-kvm qemu-kvm-tools qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer bridge-utils libguestfs-tools python-virtinst\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("设置"),t("code",[s._v("libvirtd")]),s._v("为开机自启项：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" libvirtd\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启主机")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reboot")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("重启之后检查是否加载"),t("code",[s._v("kvm")]),s._v("模块：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@kvm ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("# lsmod "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" kvm\nkvm_intel             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("188688")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \nkvm                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("636965")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" kvm_intel\nirqbypass              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13503")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" kvm\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",{attrs:{start:"6"}},[t("li",[s._v("配置 kvm 服务器网络")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/sysconfig/network-scripts/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" ifcfg-ens33 ifcfg-br0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑 ifcfg-ens33 文件，在原先基础上添加以下内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NM_CONTROLLED")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("no\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BRIDGE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("br0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑 ifcfg-br0 文件，修改并添加以下内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Bridge\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("br0\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEVICE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("br0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("重启网络服务，查看网卡信息：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@kvm network-scripts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("# "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" a\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": lo: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("LOOPBACK,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" qdisc noqueue state UNKNOWN group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/8 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" \n       valid_lft forever preferred_lft forever\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": ens33: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc pfifo_fast master br0 state UP group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/ether 00:0c:29:db:c4:08 brd ff:ff:ff:ff:ff:ff\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": br0: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue state UP group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/ether 00:0c:29:db:c4:08 brd ff:ff:ff:ff:ff:ff\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.140/24 brd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.255 scope global noprefixroute br0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::20c:29ff:fedb:c408/64 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" \n       valid_lft forever preferred_lft forever\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("发现"),t("code",[s._v("ens33")]),s._v("原来的ip是不显示的，这是因为"),t("code",[s._v("br0")]),s._v("网卡占用了，并且此时物理机上的Linux系统的ip是被br0覆盖掉的，原先的ip地址不能再使用了。此时我们看到br0的ip地址就是这台物理机ip地址，这不是虚拟机的地址")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1501874/201902/1501874-20190227234758267-625194066.png",alt:"",title:"桥接网络模型"}})]),s._v(" "),t("ol",{attrs:{start:"7"}},[t("li",[s._v("测试验证安装结果：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" -c qemu:///system list\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" --version\nvirt-install --version\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",{attrs:{start:"8"}},[t("li",[s._v("创建软连接：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/libexec/qemu-kvm /usr/bin/qemu-kvm\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"9"}},[t("li",[s._v("查看当前网桥信息：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@kvm ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("# brctl show\nbridge name     bridge "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("               STP enabled     interfaces\nbr0             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v(".000c29dbc408       no              ens33\nvirbr0          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v(".5254008ad9e8       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("             virbr0-nic\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("由于当前未创建任何虚拟机，所以暂时没有虚拟网卡出现。")]),s._v(" "),t("h2",{attrs:{id:"创建、克隆虚拟机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建、克隆虚拟机"}},[s._v("#")]),s._v(" 创建、克隆虚拟机")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("virt-install --name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("elk01 --memory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(",maxmemory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3072")]),s._v(" --vcpus"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(",maxvcpus"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" --os-type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("linux --os-variant"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("rhel6 --location"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/iso/CentOS-6.10-x86_64-minimal.iso --disk "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/elk01.img,size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" --bridge"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("br0 --graphics"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none --console"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pty,target_type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("serial --extra-args"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"console=tty0 console=ttyS0"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("⚠️注意：镜像文件不要放置于根家目录下，不然会运行失败，显示"),t("code",[s._v("Permission Denied")]),s._v("错误")]),s._v(" "),t("p",[s._v("参数说明：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("--name")]),s._v("指定虚拟机的名称")]),s._v(" "),t("li",[t("code",[s._v("--memory")]),s._v("指定分配给虚拟机的内存资源大小")]),s._v(" "),t("li",[t("code",[s._v("maxmemory")]),s._v("指定可调节的最大内存资源大小，因为KVM支持热调整虚拟机的资源")]),s._v(" "),t("li",[t("code",[s._v("--vcpus")]),s._v("指定分配给虚拟机的CPU核心数量")]),s._v(" "),t("li",[t("code",[s._v("maxvcpus")]),s._v("指定可调节的最大CPU核心数量")]),s._v(" "),t("li",[t("code",[s._v("--os-type")]),s._v(" 指定虚拟机安装的操作系统类型")]),s._v(" "),t("li",[t("code",[s._v("--os-variant")]),s._v("指定系统的发行版本")]),s._v(" "),t("li",[t("code",[s._v("--location")]),s._v("指定ISO镜像文件所在的路径，支持使用网络资源路径，也就是说可以使用URL")]),s._v(" "),t("li",[t("code",[s._v("--disk path")]),s._v("指定虚拟硬盘所存放的路径及名称，size 则是指定该硬盘的可用大小，单位是G")]),s._v(" "),t("li",[t("code",[s._v("--bridge")]),s._v("指定使用哪一个桥接网卡，也就是说使用桥接的网络模式")]),s._v(" "),t("li",[t("code",[s._v("--graphics")]),s._v("指定是否开启图形")]),s._v(" "),t("li",[t("code",[s._v("--console")]),s._v("定义终端的属性，target_type 则是定义终端的类型")]),s._v(" "),t("li",[t("code",[s._v("--extra-args")]),s._v("定义终端额外的参数")])]),s._v(" "),t("p",[s._v("克隆虚拟机：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("virt-clone -o elk04 -n elk05 -f /data/elk05.img\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("参数说明：")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("-o")]),s._v("后跟旧的系统的名称")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("-n")]),s._v("后跟克隆后的新系统的名称")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("-f")]),s._v("后跟克隆后的系统存放的位置")])])]),s._v(" "),t("p",[s._v("创建"),t("code",[s._v("windows server 2008")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("virt-install -n windows_vm04 -r "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8196")]),s._v(" --vcpus"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" --os-type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("windows --accelerate -c /data/vpsdata/img/virtio-win.iso --disk "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/vpsdata/img/cn_windows_server_2008_r2.iso,device"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cdrom --disk "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/vpsdata/vps/vm04.img,format"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("qcow2,bus"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("virtio --network "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bridge")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("br0 --vnc --vncport"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5904")]),s._v(" --vnclisten"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 --force --autostart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("创建完成之后，使用"),t("code",[s._v("VNC")]),s._v("远程连接软件进行安装.")]),s._v(" "),t("h2",{attrs:{id:"管理虚拟机常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理虚拟机常用命令"}},[s._v("#")]),s._v(" 管理虚拟机常用命令")]),s._v(" "),t("p",[s._v("查看虚拟机命令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" list --all\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有虚拟机")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" dominfo elk01\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示虚拟机信息")]),s._v("\nvirt-top\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示虚拟机内存和cpu使用情况，该工具需要单独安装")]),s._v("\nvirt-df elk01\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示虚拟机分区挂载信息")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("管理虚拟机命令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" console elk01          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入指定的虚拟机，进入的时候还需要按一下回车")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" start elk01          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动虚拟机")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v(" elk01          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭虚拟机")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" destroy elk01          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制停止虚拟机")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" undefine elk01          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 彻底销毁虚拟机，会删除虚拟机配置文件，但不会删除虚拟磁盘")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" autostart elk01          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置宿主机开机时该虚拟机也开机")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" autostart --disable elk01          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解除开机启动")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("suspend")]),s._v(" elk01         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂起虚拟机")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" resume elk01         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 恢复挂起的虚拟机")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("给虚拟机添加、删除硬盘：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" attach-disk kvm-1 /dev/sdb vbd --driver qemu --mode shareable\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v(" detach-disk kvm vdb\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"使用-webvirtmgr-虚拟机管理的-web-gui"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-webvirtmgr-虚拟机管理的-web-gui"}},[s._v("#")]),s._v(" 使用 WebVirtMgr 虚拟机管理的 web gui")]),s._v(" "),t("p",[s._v("项目开源地址：https://github.com/retspen/webvirtmgr")]),s._v(" "),t("ol",[t("li",[s._v("安装所需程序包：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 首先确保主机有epel仓库，没有则需要先安装")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" epel-release\n\nyum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" python-pip libvirt-python libxml2-python python-websockify supervisor nginx\nyum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc python-devel\npip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" numpy\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("安装python依赖并配置"),t("code",[s._v("Django")]),s._v("环境")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git://github.com/retspen/webvirtmgr.git\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" webvirtmgr\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" pip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -r requirements.txt   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or python-pip (RedHat, Fedora, CentOS, OpenSuse)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始化账户")]),s._v("\n./manage.py syncdb\n./manage.py collectstatic\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("配置"),t("code",[s._v("nginx")]),s._v("：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" webvirtmgr /var/www/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("Add file "),t("code",[s._v("webvirtmgr.conf")]),s._v(" in "),t("code",[s._v("/etc/nginx/conf.d")]),s._v(":")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" default_server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    server_name "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$hostname")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log /var/log/nginx/webvirtmgr_access_log; ")]),s._v("\n\n    location /static/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        root /var/www/webvirtmgr/webvirtmgr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or /srv instead of /var")]),s._v("\n        expires max"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    location ~ .*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("js"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           proxy_pass http://127.0.0.1:8000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    location / "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        proxy_pass http://127.0.0.1:8000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header X-Real-IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header X-Forwarded-for "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header X-Forwarded-Proto "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_connect_timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_read_timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_send_timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        client_max_body_size 1024M"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set higher depending on your needs ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("p",[s._v("Open nginx.conf out of "),t("code",[s._v("/etc/nginx/nginx.conf")]),s._v(":")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注释掉以下信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        listen       80 default_server;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        server_name  localhost;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        root         /usr/share/nginx/html;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        #charset koi8-r;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        #access_log  /var/log/nginx/host.access.log  main;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        # Load configuration files for the default server block.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        include /etc/nginx/default.d/*.conf;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        location / {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        }")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        # redirect server error pages to the static page /40x.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        #")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        error_page  404              /404.html;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        location = /40x.html {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        }")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        # redirect server error pages to the static page /50x.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        #")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        error_page   500 502 503 504  /50x.html;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        location = /50x.html {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        }")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    }")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("设置完成之后，重启 nginx 服务，"),t("code",[s._v("systemctl restart nginx")])]),s._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[s._v("配置"),t("code",[s._v("Supervisor")]),s._v("：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置Supervisor开机启动")]),s._v("\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" supervisor\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R nginx:nginx /var/www/webvirtmgr\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("Create file "),t("code",[s._v("/etc/supervisord.d/webvirtmgr.ini")]),s._v(" with following content:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("program:webvirtmgr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/python /var/www/webvirtmgr/manage.py run_gunicorn -c /var/www/webvirtmgr/conf/gunicorn.conf.py\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("directory")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/www/webvirtmgr\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("autostart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("autorestart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("logfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/supervisor/webvirtmgr.log\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log_stderr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("program:webvirtmgr-console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/python /var/www/webvirtmgr/console/webvirtmgr-console\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("directory")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/www/webvirtmgr\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("autostart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("autorestart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("stdout_logfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/supervisor/webvirtmgr-console.log\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("redirect_stderr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("启动：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./manage.py runserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":8000\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("打开浏览器访问"),t("code",[s._v("http://x.x.x.x:8000 (x.x.x.x - your server IP address )")])]),s._v(" "),t("h2",{attrs:{id:"解决虚拟机无法连接外网问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决虚拟机无法连接外网问题"}},[s._v("#")]),s._v(" 解决虚拟机无法连接外网问题")]),s._v(" "),t("p",[s._v("参考：https://blog.csdn.net/zhydream77/article/details/81629586")]),s._v(" "),t("h2",{attrs:{id:"附-kvm-安装脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#附-kvm-安装脚本"}},[s._v("#")]),s._v(" 附：kvm 安装脚本")]),s._v(" "),t("p",[t("RouterLink",{attrs:{to:"/post/KVM/kvm_install.sh.html"}},[s._v("kvm_install.sh")])],1),s._v(" "),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),t("ul",[t("li",[s._v("Kvm 虚拟化介绍: https://www.cnblogs.com/wete/p/11099339.html")]),s._v(" "),t("li",[s._v("Kvm 基本运维命令：https://www.cnblogs.com/zy-303/p/9930353.html")]),s._v(" "),t("li",[s._v("webvirtmgr installation: https://github.com/retspen/webvirtmgr/wiki/Install-WebVirtMgr")])])])}),[],!1,null,null,null);a.default=e.exports}}]);