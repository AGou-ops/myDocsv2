(window.webpackJsonp=window.webpackJsonp||[]).push([[311],{944:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nginx-编译及制作包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-编译及制作包"}},[s._v("#")]),s._v(" Nginx 编译及制作包")]),s._v(" "),a("h2",{attrs:{id:"nginx编译安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx编译安装"}},[s._v("#")]),s._v(" Nginx编译安装")]),s._v(" "),a("ol",[a("li",[s._v("安装编译环境")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum groupinstall "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Development Tools"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Server Platform Development"')]),s._v(" -y\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y pcre-devel openssl-devel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("编译过程(./configure --help)")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./configure --prefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/share/nginx --sbin-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/nginx --modules-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/lib64/nginx/modules --conf-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/nginx/nginx.conf --error-log-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/nginx/error.log --http-log-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/nginx/access.log --http-client-body-temp-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/nginx/tmp/client_body --http-proxy-temp-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/nginx/tmp/proxy --http-fastcgi-temp-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/nginx/tmp/fastcgi --http-uwsgi-temp-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/nginx/tmp/uwsgi --http-scgi-temp-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/nginx/tmp/scgi --pid-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/run/nginx.pid --lock-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/run/lock/subsys/nginx --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx --group"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx --with-file-aio --with-ipv6 --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-stream_ssl_preread_module --with-http_addition_module --with-http_xslt_module"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dynamic --with-http_image_filter_module"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dynamic --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_slice_module --with-http_stub_status_module --with-http_perl_module"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dynamic --with-http_auth_request_module --with-mail"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dynamic --with-mail_ssl_module --with-pcre --with-pcre-jit --with-stream"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dynamic --with-stream_ssl_module --with-google_perftools_module --with-debug --with-cc-opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic'")]),s._v(" --with-ld-opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -Wl,-E'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("以上为epel仓库中默认的选项,按照自身需求进行添加或者删除")]),s._v(" "),a("p",[s._v("编译安装:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("Nginx的Unit File(参考epel仓库中的Unit File)")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /usr/lib/systemd/system/nginx.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("The nginx HTTP and reverse proxy server\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target remote-fs.target nss-lookup.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PIDFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/run/nginx.pid\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nginx will fail to start if /run/nginx.pid already exists but has the wrong")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELinux context. This might happen when running `nginx -t` from the cmdline.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://bugzilla.redhat.com/show_bug.cgi?id=1268621")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPre")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/rm -f /run/nginx.pid\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPre")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/nginx -t\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/nginx\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecReload")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/kill -s HUP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KillSignal")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SIGQUIT\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TimeoutStopSec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KillMode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("process\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PrivateTmp")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h2",{attrs:{id:"nginx自定义rpm包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx自定义rpm包"}},[s._v("#")]),s._v(" Nginx自定义RPM包")]),s._v(" "),a("ol",[a("li",[s._v("下载并安装Nginx的 "),a("code",[s._v("src.rpm")]),s._v(" 包,以CentOS 7 为例")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://nginx.org/packages/centos/7/SRPMS/nginx-1.16.1-1.el7.ngx.src.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh nginx-1.16.1-1.el7.ngx.src.rpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("查看安装生成的"),a("code",[s._v("rpmbuild/")]),s._v("目录")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("rpmbuild/\n├── SOURCES\n│   ├── COPYRIGHT\n│   ├── "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("logrotate")]),s._v("\n│   ├── nginx-1.16.1.tar.gz\n│   ├── nginx.check-reload.sh\n│   ├── nginx.conf\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义配置文件默认内容")]),s._v("\n│   ├── nginx-debug.service\n│   ├── nginx-debug.sysconf\n│   ├── nginx.init.in\n│   ├── nginx.service\n│   ├── nginx.suse.logrotate\n│   ├── nginx.sysconf\n│   ├── nginx.upgrade.sh\n│   └── nginx.vh.default.conf\n└── SPECS\n    └── nginx.spec\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指明如何定义RPM包,模块可以在此文件定义")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" directories, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" files\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("修改好需求后,即可开始制作")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("rpmbuild -bb rpmbuild/SPECS/nginx.spec\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选项-bb表示只建立二进制包,-ba表示建立源码和二进制包")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("执行完成之后,会在"),a("code",[s._v("rpmbuild")]),s._v("文件夹中生成一个名为"),a("code",[s._v("RPMS")]),s._v("的文件夹,内容即为制作好的"),a("code",[s._v("RPM")]),s._v("包,可以直接进行安装")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("rpmbuild/RPMS\n└── x86_64\n    ├── nginx-1.16.1-1.el7.ngx.x86_64.rpm\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接安装即可使用")]),s._v("\n    └── nginx-debuginfo-1.16.1-1.el7.ngx.x86_64.rpm\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" directory, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" files\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"nginx编译参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx编译参数"}},[s._v("#")]),s._v(" Nginx编译参数")]),s._v(" "),a("p",[a("strong",[s._v("查看Nginx编译参数")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Nginx ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx -V")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("下表展示了Nginx编译参数选项以及作用\n"),a("img",{attrs:{src:"http://bak.agou-ops.top/uploads/linux/images/m_7631947d4602972ffd8cdc039960e216_r.png",alt:"null"}})]),s._v(" "),a("p",[a("strong",[s._v("Nginx常用模块")]),s._v("\nNginx模块分为 Nginx官方模块以及Nginx第三方模块\n"),a("img",{attrs:{src:"http://bak.agou-ops.top/uploads/linux/images/m_aebb6eae6beb31b1507f0131e67d543e_r.png",alt:"null"}})]),s._v(" "),a("h2",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),a("ul",[a("li",[s._v("nginx官方RPMS仓库:http://nginx.org/packages/centos/7/SRPMS/")])])])}),[],!1,null,null,null);t.default=e.exports}}]);