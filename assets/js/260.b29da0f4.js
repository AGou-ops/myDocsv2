(window.webpackJsonp=window.webpackJsonp||[]).push([[260],{891:function(s,a,e){"use strict";e.r(a);var t=e(6),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"prometheus-安装与部署、grafana"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-安装与部署、grafana"}},[s._v("#")]),s._v(" Prometheus 安装与部署、Grafana")]),s._v(" "),e("h2",{attrs:{id:"prometheus-简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-简介"}},[s._v("#")]),s._v(" Prometheus 简介")]),s._v(" "),e("p",[s._v("Prometheus受启发于Google的Brogmon监控系统（相似的Kubernetes是从Google的Brog系统演变而来），从2012年开始由前Google工程师在Soundcloud以开源软件的形式进行研发，并且于2015年早期对外发布早期版本。2016年5月继Kubernetes之后成为第二个正式加入CNCF基金会的项目，同年6月正式发布1.0版本。2017年底发布了基于全新存储层的2.0版本，能更好地与容器平台、云平台配合。")]),s._v(" "),e("h3",{attrs:{id:"主要功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#主要功能"}},[s._v("#")]),s._v(" 主要功能")]),s._v(" "),e("ul",[e("li",[s._v("多维 "),e("a",{attrs:{href:"https://prometheus.io/docs/concepts/data_model/",target:"_blank",rel:"noopener noreferrer"}},[s._v("数据模型"),e("OutboundLink")],1),s._v("（时序由 metric 名字和 k/v 的 labels 构成）。")]),s._v(" "),e("li",[s._v("灵活的查询语句（"),e("a",{attrs:{href:"https://prometheus.io/docs/querying/basics/",target:"_blank",rel:"noopener noreferrer"}},[s._v("PromQL"),e("OutboundLink")],1),s._v("）。")]),s._v(" "),e("li",[s._v("无依赖存储，支持 local 和 remote 不同模型。")]),s._v(" "),e("li",[s._v("采用 http 协议，使用 pull 模式，拉取数据，简单易懂。")]),s._v(" "),e("li",[s._v("监控目标，可以采用服务发现或静态配置的方式。")]),s._v(" "),e("li",[s._v("支持多种统计数据模型，图形化友好。")])]),s._v(" "),e("h3",{attrs:{id:"核心组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#核心组件"}},[s._v("#")]),s._v(" 核心组件")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/prometheus/prometheus",target:"_blank",rel:"noopener noreferrer"}},[s._v("Prometheus Server"),e("OutboundLink")],1),s._v("， 主要用于抓取数据和存储时序数据，另外还提供查询和 Alert Rule 配置管理。")]),s._v(" "),e("li",[e("a",{attrs:{href:"https://prometheus.io/docs/instrumenting/clientlibs/",target:"_blank",rel:"noopener noreferrer"}},[s._v("client libraries"),e("OutboundLink")],1),s._v("，用于对接 Prometheus Server, 可以查询和上报数据。")]),s._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/prometheus/pushgateway",target:"_blank",rel:"noopener noreferrer"}},[s._v("push gateway"),e("OutboundLink")],1),s._v(" ，用于批量，短期的监控数据的汇总节点，主要用于业务数据汇报等。")]),s._v(" "),e("li",[s._v("各种汇报数据的 "),e("a",{attrs:{href:"https://prometheus.io/docs/instrumenting/exporters/",target:"_blank",rel:"noopener noreferrer"}},[s._v("exporters"),e("OutboundLink")],1),s._v(" ，例如汇报机器数据的 node_exporter, 汇报 MongoDB 信息的 "),e("a",{attrs:{href:"https://github.com/dcu/mongodb_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("MongoDB exporter"),e("OutboundLink")],1),s._v(" 等等。")]),s._v(" "),e("li",[s._v("用于告警通知管理的 "),e("a",{attrs:{href:"https://github.com/prometheus/alertmanager",target:"_blank",rel:"noopener noreferrer"}},[s._v("alertmanager"),e("OutboundLink")],1),s._v(" 。")])]),s._v(" "),e("h3",{attrs:{id:"基础架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基础架构"}},[s._v("#")]),s._v(" 基础架构")]),s._v(" "),e("p",[e("img",{attrs:{src:"http://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/promethues%20%2B%20grafana/architecture.png",alt:""}})]),s._v(" "),e("p",[s._v("它大致使用逻辑是这样：")]),s._v(" "),e("ol",[e("li",[s._v("Prometheus server 定期从静态配置的 targets 或者服务发现的 targets 拉取数据。")]),s._v(" "),e("li",[s._v("当新拉取的数据大于配置内存缓存区的时候，Prometheus 会将数据持久化到磁盘（如果使用 remote storage 将持久化到云端）。")]),s._v(" "),e("li",[s._v("Prometheus 可以配置 rules，然后定时查询数据，当条件触发的时候，会将 alert 推送到配置的 Alertmanager。")]),s._v(" "),e("li",[s._v("Alertmanager 收到警告的时候，可以根据配置，聚合，去重，降噪，最后发送警告。")]),s._v(" "),e("li",[s._v("可以使用 API， Prometheus Console 或者 Grafana 查询和聚合数据。")])]),s._v(" "),e("h2",{attrs:{id:"下载并运行-prom"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载并运行-prom"}},[s._v("#")]),s._v(" 下载并运行 Prom")]),s._v(" "),e("ol",[e("li",[s._v("为了安全起见，使用"),e("code",[s._v("prometheus")]),s._v("用户来启动服务，首先创建这个用户：")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" prometheus\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -g prometheus -M -s /sbin/nologin prometheus\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("从官方站点下载合适的包，并解压：")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/prometheus/prometheus/releases/download/v2.17.2/prometheus-2.17.2.linux-amd64.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xf prometheus-2.17.2.linux-amd64.tar.gz -C /usr/share/\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /usr/share/prometheus-2.17.2.linux-amd64 /usr/share/prometheus\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -pv /usr/share/prometheus/data\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R prometheus.prometheus /usr/share/prometheus\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/share/prometheus\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("ℹ️ 官方下载站点：https://prometheus.io/download")]),s._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[s._v("创建 prometheus 系统服务启动文件 "),e("code",[s._v("/usr/lib/systemd/system/prometheus.service")]),s._v("：")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Prometheus Server\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://prometheus.io/docs/introduction/overview/\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network-online.target\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("User")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prometheus\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Change this line if you download the ")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Prometheus on different path user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/share/prometheus/prometheus "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --config.file"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/share/prometheus/prometheus.yml "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --storage.tsdb.path"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/share/prometheus/data\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("a . 配置 Prometheus 文件"),e("code",[s._v("prometheus.yml")]),s._v("进行自我监控：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("global:\n  scrape_interval:     15s "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# By default, scrape targets every 15 seconds.")]),s._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Attach these labels to any time series or alerts when communicating with")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# external systems (federation, remote storage, Alertmanager).")]),s._v("\n  external_labels:\n    monitor: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'codelab-monitor'")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A scrape configuration containing exactly one endpoint to scrape:")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Here it's Prometheus itself.")]),s._v("\nscrape_configs:\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),s._v("\n  - job_name: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prometheus'")]),s._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Override the global default and scrape targets from this job every 5 seconds.")]),s._v("\n    scrape_interval: 5s\n\n    static_configs:\n      - targets: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9090'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("p",[s._v("启动 Prom ，"),e("code",[s._v("./prometheus --config.file=prometheus.yml")]),s._v("【默认情况下，Prometheus 将其数据库存储在."),e("code",[s._v("/data")]),s._v("中（可以使用"),e("code",[s._v("--storage.tsdb.path")]),s._v("自定义data路径）】")]),s._v(" "),e("p",[s._v("此时打开浏览器，进入"),e("code",[s._v("localhost:9090")]),s._v("查看其自身的状态页，此外你还可以访问"),e("code",[s._v("localhost:metrics")]),s._v("查看其指标参数")]),s._v(" "),e("blockquote",[e("p",[s._v("简单入门，来自官方文档.")])]),s._v(" "),e("p",[s._v("b. 修改 prometheus 配置文件 "),e("code",[s._v("prometheus.yml")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("global:\n  scrape_interval:     15s \n  evaluation_interval: 15s \n\nalerting:\n  alertmanagers:\n  - static_configs:\n    - targets: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9093"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nrule_files:\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#- "alert.rules"')]),s._v("\n  \nscrape_configs:\n  - job_name: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prometheus'")]),s._v("\n    scrape_interval:     5s\n    static_configs:\n      - targets: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9090'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n  - job_name: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node'")]),s._v("\n    scrape_interval:     10s\n    static_configs:\n      - targets: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9100'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("p",[e("em",[s._v("该配置文件比较完整，该节点安装了 "),e("code",[s._v("node_exporter")]),s._v("以及 "),e("code",[s._v("alertmanager")]),s._v("服务，可以先按照此配置文件做配置，不影响服务的启动过程")])]),s._v(" "),e("p",[s._v("启动服务：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl daemon-reload\nsystemctl start prometheus.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("Prometheus 服务启动完成后，可以通过"),e("a",{attrs:{href:"http://localhost:9090/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://localhost:9090"),e("OutboundLink")],1),s._v("访问 Prometheus 的 UI 界面")]),s._v(" "),e("h2",{attrs:{id:"安装配置-node-exporter"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装配置-node-exporter"}},[s._v("#")]),s._v(" 安装配置 node_exporter")]),s._v(" "),e("p",[s._v("为监控服务器 CPU , 内存 , 磁盘 , I/O 等信息，需要在被监控机器上安装 node_exporter 服务。")]),s._v(" "),e("p",[s._v("从官方站点下载"),e("code",[s._v("node_exporter")]),s._v("包：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/prometheus/node_exporter/releases/download/v1.0.0-rc.0/node_exporter-1.0.0-rc.0.darwin-amd64.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xf node_exporter-1.0.0-rc.0.darwin-amd64.tar.gz -C /usr/share/node_exporter\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R prometheus.prometheus /usr/share/node_exporter\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("创建 node_exporter 系统服务启动文件 "),e("code",[s._v("/usr/lib/systemd/system/node_exporter.service")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Node Exporter\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Wants")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network-online.target\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network-online.target\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("User")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prometheus\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/share/node_exporter/node_exporter\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("default.target\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("启动 node_exporter 服务：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl daemon-reload\nsystemctl start node_exporter\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("服务启动后可以用 http://localhost:9100/metrics 测试 node_exporter 是否获取到节点的监控指标。")]),s._v(" "),e("h2",{attrs:{id:"使用-grafana-展示工具"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-grafana-展示工具"}},[s._v("#")]),s._v(" 使用 Grafana 展示工具")]),s._v(" "),e("p",[s._v("安装"),e("code",[s._v("Grafana")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://dl.grafana.com/oss/release/grafana-6.7.3-1.x86_64.rpm\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" grafana-6.7.3-1.x86_64.rpm\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("启动 Grafana 服务：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl start grafana-server\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("服务启动后 grafana 默认监听在 3000 端口 ，可以通http://localhost:3000 访问 grafana 的 ui 界面，默认登录账号密码为 "),e("code",[s._v("admin/admin")]),s._v(" ，第一次登录需要我们重置密码。")]),s._v(" "),e("p",[s._v("添加"),e("code",[s._v("Prometheus")]),s._v("数据源：")]),s._v(" "),e("p",[e("code",[s._v("Data Sources")]),s._v(" --\x3e "),e("code",[s._v("Add Data Source")]),s._v(" --\x3e "),e("code",[s._v("Prometheus")])]),s._v(" "),e("p",[s._v("导入模板：")]),s._v(" "),e("p",[e("code",[s._v("选择左侧菜单栏 + 号")]),s._v(" --\x3e "),e("code",[s._v("import")]),s._v("  --\x3e "),e("code",[s._v("填入id或者json格式数据")])]),s._v(" "),e("p",[e("img",{attrs:{src:"http://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/promethues%20%2B%20grafana/grafana.png",alt:""}})]),s._v(" "),e("p",[s._v("ℹ️模板来自：https://grafana.com/grafana/dashboards/8919")]),s._v(" "),e("p",[s._v("ℹ️ 模板注意事项：")]),s._v(" "),e("p",[s._v("导入看板后，请根据实际情况在看板右上角点击"),e("code",[s._v("Dashboard settings")]),s._v("--"),e("code",[s._v("Variables")]),s._v("设置好变量：")]),s._v(" "),e("p",[e("strong",[s._v("默认已经设置并关联好"),e("code",[s._v("job")]),s._v("，"),e("code",[s._v("hostname")]),s._v("，"),e("code",[s._v("node")]),s._v("这3个变量。")]),s._v("（name，env变量是自定义的标签，已隐藏。大家可根据需要自行增加。）")]),s._v(" "),e("ul",[e("li",[e("strong",[e("code",[s._v("$node")]),s._v("取值node_exporter的"),e("code",[s._v("instance")]),s._v("，"),e("code",[s._v("IP:端口")]),s._v("格式。大部分查询关联了这个变量，请确保该变量有效")])]),s._v(" "),e("li",[e("strong",[e("code",[s._v("$maxmount")]),s._v("用来查询当前主机的最大分区，默认只获取ext4和xfs类型的分区。")])])]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("⚠️**注意：**所有的监控服务都强依赖时间服务器，要保证服务器客户端和web端的时间一致，否则数据无法正常展示和更新.")]),s._v(" "),e("h2",{attrs:{id:"参考链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),e("ul",[e("li",[s._v("prometheus官方文档：https://prometheus.io/docs/prometheus/latest/getting_started/")]),s._v(" "),e("li",[s._v("grafana 安装文档：https://grafana.com/docs/grafana/latest/installation/rpm/")]),s._v(" "),e("li",[s._v("如何导入一个 Grafana 面板：https://grafana.com/docs/grafana/latest/reference/export_import/#importing-a-dashboard")]),s._v(" "),e("li",[s._v("prometheus 入门进阶：https://yunlzheng.gitbook.io/prometheus-book/")])])])}),[],!1,null,null,null);a.default=r.exports}}]);