(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{755:function(s,a,t){"use strict";t.r(a);var e=t(6),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"mysql-backup-client-tools"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-backup-client-tools"}},[s._v("#")]),s._v(" MySQL BackUP & Client Tools")]),s._v(" "),t("p",[t("strong",[s._v("Mysql备份类型")])]),s._v(" "),t("p",[s._v("1）按照备份时对数据库的影响分为:")]),s._v(" "),t("p",[t("code",[s._v("Hot backup")]),s._v("（热备）：也叫在线备份。指在数据库运行中直接备份，对正在运行的数据库没有任何影响。")]),s._v(" "),t("p",[t("code",[s._v("Cold backup")]),s._v("（冷备）：也叫离线备份。指在数据库停止的情况下备份。")]),s._v(" "),t("p",[t("code",[s._v("Warm backup")]),s._v("（温备）：在数据库运行时备份，会加一个全局锁以保证数据的一致性，会对当前数据库的操作有影响。")]),s._v(" "),t("p",[s._v("2）按照备份后的文件内容分为:")]),s._v(" "),t("p",[t("code",[s._v("逻辑备份")]),s._v("：指备份后的文件内容是可读的，通常为文本文件，内容一般是SQL语句或表内的实际数据（mysqldump和select * into outfile），一般适用于数据库的升级和迁移，还原时间较长。")]),s._v(" "),t("p",[t("code",[s._v("裸文件备份")]),s._v("：也叫物理备份。拷贝数据库的物理文件，数据库既可以处于运行状态（mysqlhotcopy、ibbackup、xtrabackup一类工具），也可以处于停止状态，还原时间较短。")]),s._v(" "),t("p",[s._v("3）按照备份数据库的内容分为:")]),s._v(" "),t("p",[t("code",[s._v("完全备份")]),s._v("：对数据库进行完整的备份。")]),s._v(" "),t("p",[t("code",[s._v("增量备份")]),s._v("：在上一次完整备份的基础上，对更新的数据进行备份（xtrabackup）")]),s._v(" "),t("p",[t("code",[s._v("日志备份")]),s._v("：二进制日志备份，主从同步。")]),s._v(" "),t("h2",{attrs:{id:"mysql-select导出导入指定数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-select导出导入指定数据"}},[s._v("#")]),s._v(" mysql select导出导入指定数据")]),s._v(" "),t("p",[s._v("导出数据：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test_tbl "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUTFILE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/PATH/TO/FILE'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 增加输出格式条件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FIELDS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TERMINATED")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENCLOSED")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LINES")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TERMINATED")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\r\\n'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("导入数据：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USE")]),s._v(" db1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LOAD")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATA")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INFILE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./data.txt"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" db2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("my_table"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"mysqldump-备份数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysqldump-备份数据库"}},[s._v("#")]),s._v(" mysqldump 备份数据库")]),s._v(" "),t("p",[s._v("mysqldump导出来的数据有两个文件，一个是sql文件，一个是txt文件.")]),s._v(" "),t("h3",{attrs:{id:"命令格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令格式"}},[s._v("#")]),s._v(" 命令格式")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysqldump "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("选项"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 数据库名 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("表名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 脚本名\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("或")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysqldump "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("选项"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --数据库名 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("选项 表名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 脚本名\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("或")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysqldump "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("选项"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --all-databases "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("选项"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 脚本名\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"选项说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#选项说明"}},[s._v("#")]),s._v(" 选项说明")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("参数名")]),s._v(" "),t("th",[s._v("缩写")]),s._v(" "),t("th",[s._v("含义")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("--host")]),s._v(" "),t("td",[s._v("-h")]),s._v(" "),t("td",[s._v("服务器IP地址")])]),s._v(" "),t("tr",[t("td",[s._v("--port")]),s._v(" "),t("td",[s._v("-P")]),s._v(" "),t("td",[s._v("服务器端口号")])]),s._v(" "),t("tr",[t("td",[s._v("--user")]),s._v(" "),t("td",[s._v("-u")]),s._v(" "),t("td",[s._v("MySQL 用户名")])]),s._v(" "),t("tr",[t("td",[s._v("--pasword")]),s._v(" "),t("td",[s._v("-p")]),s._v(" "),t("td",[s._v("MySQL 密码")])]),s._v(" "),t("tr",[t("td",[s._v("--databases")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("指定要备份的数据库")])]),s._v(" "),t("tr",[t("td",[s._v("--all-databases")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("备份mysql服务器上的所有数据库")])]),s._v(" "),t("tr",[t("td",[s._v("--compact")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("压缩模式，产生更少的输出")])]),s._v(" "),t("tr",[t("td",[s._v("--comments")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("添加注释信息")])]),s._v(" "),t("tr",[t("td",[s._v("--complete-insert")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("输出完成的插入语句")])]),s._v(" "),t("tr",[t("td",[s._v("--lock-tables")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("备份前，锁定所有数据库表")])]),s._v(" "),t("tr",[t("td",[s._v("--no-create-db/--no-create-info")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("禁止生成创建数据库语句")])]),s._v(" "),t("tr",[t("td",[s._v("--force")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("当出现错误时仍然继续备份操作")])]),s._v(" "),t("tr",[t("td",[s._v("--default-character-set")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("指定默认字符集")])]),s._v(" "),t("tr",[t("td",[s._v("--add-locks")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("备份数据库表时锁定数据库表")])])])]),s._v(" "),t("h3",{attrs:{id:"实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[s._v("#")]),s._v(" 实例")]),s._v(" "),t("p",[s._v("备份所有数据库：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysqldump -uroot -p --all-databases "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /backup/mysqldump/all.db\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("备份指定数据库：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysqldump -uroot -p "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /backup/mysqldump/test.db\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("备份指定数据库指定表(多个表以空格间隔)")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysqldump -uroot -p  mysql db event "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /backup/mysqldump/2table.db\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("备份指定数据库排除某些表")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysqldump -uroot -p "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" --ignore-table"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test.t1 --ignore-table"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test.t2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /backup/mysqldump/test2.db\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"mysqlimport-导入数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysqlimport-导入数据库"}},[s._v("#")]),s._v(" mysqlimport 导入数据库")]),s._v(" "),t("p",[s._v("在使用该工具之前，让我们来了解以下 mysql 命令行导入数据的命令。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql -uroot -p123456 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" test.sql\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" create database "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建数据库")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用已创建的数据库 ")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" names utf8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置编码")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /home/test.sql  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入备份数据库")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"命令格式-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令格式-2"}},[s._v("#")]),s._v(" 命令格式")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysqlimport -u root -p "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--LOCAL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" DBname  File  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"选项说明-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#选项说明-2"}},[s._v("#")]),s._v(" 选项说明")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("选项")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("功能")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("-d or --delete")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("新数据导入数据表中之前删除数据数据表中的所有信息")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("-f or --force")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("不管是否遇到错误，mysqlimport将强制继续插入数据")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("-i or --ignore")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("mysqlimport跳过或者忽略那些有相同唯一 关键字的行， 导入文件中的数据将被忽略。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("-l or -lock-tables")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("数据被插入之前锁住表，这样就防止了， 你在更新数据库时，用户的查询和更新受到影响。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("-r or -replace")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("这个选项与－i选项的作用相反；此选项将替代 表中有相同唯一关键字的记录。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("--fields-enclosed- by= char")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("指定文本文件中数据的记录时以什么括起的， 很多情况下 数据以双引号括起。 默认的情况下数据是没有被字符括起的。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("--fields-terminated- by=char")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("指定各个数据的值之间的分隔符，在句号分隔的文件中， 分隔符是句号。您可以用此选项指定数据之间的分隔符。 默认的分隔符是跳格符（Tab）")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("--lines-terminated- by=str")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("此选项指定文本文件中行与行之间数据的分隔字符串 或者字符。 默认的情况下mysqlimport以newline为行分隔符。 您可以选择用一个字符串来替代一个单个的字符： 一个新行或者一个回车。")])])])]),s._v(" "),t("p",[s._v("⚠️ 注意：如果导入导出是跨平台操作的（比如Windows和Linux），那么就要注意设置参数"),t("code",[s._v("line-terminated-by")]),s._v("，因为两个操作系统的行结尾符是不一样的。Windows上是："),t("code",[s._v("line-terminated-by='\\r\\n'")]),s._v("，Linux上设置为:"),t("code",[s._v("line-terminated='\\n'")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"实例-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实例-2"}},[s._v("#")]),s._v(" 实例")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysqlimport -uroot -p123456 -P "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 mob_adn /tmp/bak/test.txt --fields-terminated-by"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v(" --fields-optionally-enclosed-by"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"xtrabackup-备份-导入数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#xtrabackup-备份-导入数据库"}},[s._v("#")]),s._v(" Xtrabackup 备份/导入数据库")]),s._v(" "),t("p",[s._v("官方站点：https://www.percona.com/blog/tag/xtrabackup/")]),s._v(" "),t("p",[t("strong",[s._v("Xtrabackup 优点")])]),s._v(" "),t("p",[s._v("1）备份速度快，物理备份可靠\n2）备份过程不会打断正在执行的事务（无需锁表）\n3）能够基于压缩等功能节约磁盘空间和流量\n4）自动备份校验\n5）还原速度快\n6）可以流传将备份传输到另外一台机器上\n7）在不增加服务器负载的情况备份数据")]),s._v(" "),t("p",[s._v("安装"),t("code",[s._v("Xtrabackup")]),s._v("工具：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用仓库安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" intall -y xtrabackup\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum仓库中的xtrabackup版本较低，不推荐使用，可以自行去官方仓库下载使用")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.9/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.9-1.el7.x86_64.rpm\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"xtrabackup-实战"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#xtrabackup-实战"}},[s._v("#")]),s._v(" 💽 Xtrabackup 实战")]),s._v(" "),t("h4",{attrs:{id:"全量备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#全量备份"}},[s._v("#")]),s._v(" 全量备份")]),s._v(" "),t("p",[t("strong",[s._v("1.创建备份")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("xtrabackup --uroot -p123456 --databases"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test --backup --target-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/xtrabackup/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果目标目录不存在，"),t("code",[s._v("xtrabackup")]),s._v(" 会创建它。"),t("code",[s._v("xtrabackup")]),s._v("不会覆盖现有文件，如果目标文件已存在它会因操作系统错误17而失败。")]),s._v(" "),t("p",[t("strong",[s._v("2.准备备份")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("xtrabackup --prepare --target-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/xtrabackup/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("一般情况下,在备份完成后，数据尚且不能用于恢复操作，因为备份的数据中可能会包含尚未提交的事务或已经提交但尚未同步至数据文件中的事务。因此，此时数据 文件仍处理不一致状态。"),t("code",[s._v("--prepare")]),s._v("参数实现通过回滚未提交的事务及同步已经提交的事务至数据文件使数据文件处于一致性状态。")]),s._v(" "),t("p",[t("strong",[s._v("3.恢复备份")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl stop mysqld "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭 MySQL 服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -avrP /backup/xtrabackup/ /var/lib/mysql/ "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 还原数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R mysql:mysql /var/lib/mysql \nsystemctl start mysqld "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 MySQL 服务")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"增量备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增量备份"}},[s._v("#")]),s._v(" 增量备份")]),s._v(" "),t("p",[s._v("**1.先创建完全备份 **")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("xtrabackup --uroot -p123456 --databases"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test --backup --target-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/xtrabackup/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("2.创建第一次增量备份")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("xtrabackup --uroot -p123456 --databases"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test --backup --target-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/inc1/ --incremental-basedir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/xtrabackup/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("3.创建第二次增量备份")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("xtrabackup --uroot -p123456 --databases"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test --backup --target-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/inc2/ --incremental-basedir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/inc1/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("4.准备全量备份")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("xtrabackup --prepare --apply-log-only --target-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/xtrabackup/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("--apply-log-only")]),s._v("阻止回滚未提完成的事务")]),s._v(" "),t("p",[t("strong",[s._v("5.准备第一次增量备份")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("xtrabackup --prepare --apply-log-only --target-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/xtrabackup/ --incremental-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/inc1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("6.准备第二次增量备份")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("xtrabackup --prepare --target-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/xtrabackup/ --incremental-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/inc2/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("7.恢复数据")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl stop mysqld \t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -avrP /backup/xtrabackup/ /var/lib/mysql/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R mysql:mysql /var/lib/mysql    \nsystemctl start mysqld \t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动服务")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("现在数据已经恢复到执行第二次增量备份命令时的数据。")]),s._v(" "),t("h2",{attrs:{id:"mysqladmin-mysqlshow-客户端管理工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysqladmin-mysqlshow-客户端管理工具"}},[s._v("#")]),s._v(" mysqladmin/mysqlshow 客户端管理工具")]),s._v(" "),t("p",[s._v("常用示例：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、查看服务器的状况：\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每2秒查看一次服务器的状态，总共重复5次。")]),s._v("\nmysqladmin -uroot -p -i "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" -c "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" status\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".修改root 密码：\nmysqladmin -u root -poldpassword password "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'newpassword'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".检查mysqlserver是否可用：\nmysqladmin -uroot -p "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".查询服务器的版本：\nmysqladmin -uroot -p version\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".显示服务器所有运行的进程：\nmysqladmin -uroot -p processlist\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".创建数据库："),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nmysqladmin -uroot -p create "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".删除数据库 daba-test"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nmysqladmin -uroot -p drop daba-test\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".重载权限信息"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nmysqladmin -uroot -p reload\nmysqladmin -uroot -p flush-privileges\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".刷新所有表缓存，并关闭和打开log\nmysqladmin -uroot -p refresh\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".使用安全模式关闭数据库"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nmysqladmin -uroot -p "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ---------------- mysqlshow工具 ---------------- ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(".显示服务器上的所有数据库\nmysqlshow -uroot -p\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".显示数据库daba-test下有些什么表：\nmysqlshow -uroot -p daba-test\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(".统计daba-test 下数据库表列的汇总\nmysqlshow -uroot -p daba-test -v\n \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(".统计daba-test 下数据库表的列数和行数\nmysqlshow -uroot -p daba-test -v -v\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br")])]),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),t("ul",[t("li",[s._v("mysqldump document: https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html")]),s._v(" "),t("li",[s._v("mysqlimport document: https://dev.mysql.com/doc/refman/8.0/en/mysqlimport.html")]),s._v(" "),t("li",[s._v("mysqladmin document: https://dev.mysql.com/doc/refman/8.0/en/mysqladmin.html")])])])}),[],!1,null,null,null);a.default=n.exports}}]);